<!DOCTYPE html>
<html lang="zh-cn" dir="ltr" class="client-nojs">
<head>
<title>Jabberd2:安装和管理指南 - Jabber/XMPP中文翻译计划</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.18.2" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Jabber/XMPP中文翻译计划 (zh-cn)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.jabbercn.org/api.php?action=rsd" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/" />
<link rel="alternate" type="application/atom+xml" title="Jabber/XMPP中文翻译计划的Atom" href="/index.php?title=%E7%89%B9%E6%AE%8A:%E6%9C%80%E8%BF%91%E6%9B%B4%E6%94%B9&amp;feed=atom" />
<link rel="stylesheet" href="/load.php?debug=false&amp;lang=zh-cn&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cskins.monobook&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE50Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE55Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/skins/monobook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/skins/monobook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}a.new,#quickbar a.new{color:#ba0000}

/* cache key: mediawiki:resourceloader:filter:minify-css:4:c88e2bcd56513749bec09a7e29cb3ffa */</style>
<script src="/load.php?debug=false&amp;lang=zh-cn&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
	mw.config.set({"wgCanonicalNamespace": "", "wgCanonicalSpecialPageName": false, "wgNamespaceNumber": 0, "wgPageName": "Jabberd2:安装和管理指南", "wgTitle": "Jabberd2:安装和管理指南", "wgCurRevisionId": 3003, "wgArticleId": 55, "wgIsArticle": true, "wgAction": "view", "wgUserName": null, "wgUserGroups": ["*"], "wgCategories": ["XMPP服务器文档", "已翻译"], "wgBreakFrames": false, "wgRestrictionEdit": [], "wgRestrictionMove": [], "wgSearchNamespaces": [0]});
}
</script><script>if(window.mw){
	mw.loader.load(["mediawiki.page.startup"]);
}
</script>
<style type="text/css">/*<![CDATA[*/
.source-bash {border: 1px dashed #2f6fab; color: black; background-color: #f9f9f9;}
.source-bash li, .source-bash pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for bash
 * CSS class: source-bash, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-bash .de1, .source-bash .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-bash  {font-family: monospace;}
.source-bash .imp {font-weight: bold; color: red;}
.source-bash li, .source-bash li.li1 {font-weight: normal;}
.source-bash li.li2 {font-weight: bold;}
.source-bash .kw1 {color: #000000; font-weight: bold;}
.source-bash .kw2 {color: #c20cb9; font-weight: bold;}
.source-bash .kw3 {color: #7a0874; font-weight: bold;}
.source-bash .co0 {color: #666666; font-style: italic;}
.source-bash .co1 {color: #800000;}
.source-bash .co2 {color: #cc0000; font-style: italic;}
.source-bash .es0 {color: #000099; font-weight: bold;}
.source-bash .br0 {color: #7a0874; font-weight: bold;}
.source-bash .sy0 {color: #000000; font-weight: bold;}
.source-bash .st0 {color: #ff0000;}
.source-bash .nu0 {color: #000000;}
.source-bash .re0 {color: #007800;}
.source-bash .re1 {color: #007800;}
.source-bash .re2 {color: #007800;}
.source-bash .re4 {color: #007800;}
.source-bash .re5 {color: #660033;}
.source-bash .ln-xtra, .source-bash li.ln-xtra, .source-bash div.ln-xtra {background-color: #ffc;}
.source-bash span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-ini {border: 1px dashed #2f6fab; color: black; background-color: #f9f9f9;}
.source-ini li, .source-ini pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for ini
 * CSS class: source-ini, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-ini .de1, .source-ini .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-ini  {font-family: monospace;}
.source-ini .imp {font-weight: bold; color: red;}
.source-ini li, .source-ini li.li1 {font-weight: normal;}
.source-ini li.li2 {font-weight: bold;}
.source-ini .co0 {color: #666666; font-style: italic;}
.source-ini .sy0 {color: #000066; font-weight:bold;}
.source-ini .st0 {color: #933;}
.source-ini .re0 {color: #000066; font-weight:bold;}
.source-ini .re1 {color: #000099;}
.source-ini .re2 {color: #660066;}
.source-ini .ln-xtra, .source-ini li.ln-xtra, .source-ini div.ln-xtra {background-color: #ffc;}
.source-ini span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-xml {border: 1px dashed #2f6fab; color: black; background-color: #f9f9f9;}
.source-xml li, .source-xml pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for xml
 * CSS class: source-xml, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-xml .de1, .source-xml .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-xml  {font-family: monospace;}
.source-xml .imp {font-weight: bold; color: red;}
.source-xml li, .source-xml li.li1 {font-weight: normal;}
.source-xml li.li2 {font-weight: bold;}
.source-xml .co1 {color: #808080; font-style: italic;}
.source-xml .co2 {color: #404040; font-style: italic;}
.source-xml .co3 {color: #000000;}
.source-xml .co4 {color: #400000; font-weight: bold;}
.source-xml .es0 {color: #000099; font-weight: bold;}
.source-xml .br0 {color: #66cc66;}
.source-xml .sy0 {color: #66cc66;}
.source-xml .st0 {color: #ff0000;}
.source-xml .nu0 {color: #cc66cc;}
.source-xml .re0 {color: #000066;}
.source-xml .re1 {color: #000000; font-weight: bold;}
.source-xml .re2 {color: #000000; font-weight: bold;}
.source-xml .ln-xtra, .source-xml li.ln-xtra, .source-xml div.ln-xtra {background-color: #ffc;}
.source-xml span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-text {border: 1px dashed #2f6fab; color: black; background-color: #f9f9f9;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-text .de1, .source-text .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-text  {font-family: monospace;}
.source-text .imp {font-weight: bold; color: red;}
.source-text li, .source-text li.li1 {font-weight: normal;}
.source-text li.li2 {font-weight: bold;}
.source-text .ln-xtra, .source-text li.ln-xtra, .source-text div.ln-xtra {background-color: #ffc;}
.source-text span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Jabberd2_安装和管理指南 action-view skin-monobook">
<div id="globalWrapper">
<div id="column-content"><div id="content">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading">Jabberd2:安装和管理指南</h1>
	<div id="bodyContent">
		<div id="siteSub">来自Jabber/XMPP中文翻译计划</div>
		<div id="contentSub"></div>
		<div id="jump-to-nav">跳转到： <a href="#column-one">导航</a>, <a href="#searchInput">搜索</a></div>
		<!-- start content -->
<div lang="zh-cn" dir="ltr" class="mw-content-ltr"><p><br />
<b>本文的英文原文来自 <a rel="nofollow" class="external free" href="http://www.jabberdoc.org/jabberd_guide">http://www.jabberdoc.org/jabberd_guide</a> </b>
</p><p><b>Jabberd2安装和管理指南</b>
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>目录</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#.E7.BB.AA.E8.AE.BA"><span class="tocnumber">1</span> <span class="toctext">绪论</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#.E7.9B.AE.E7.9A.84.E5.92.8C.E8.8C.83.E5.9B.B4"><span class="tocnumber">1.1</span> <span class="toctext">目的和范围</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#.E9.9C.80.E8.A6.81.E7.9A.84.E8.83.8C.E6.99.AF.E7.9F.A5.E8.AF.86"><span class="tocnumber">1.2</span> <span class="toctext">需要的背景知识</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#.E5.A6.82.E4.BD.95.E4.BD.BF.E7.94.A8.E6.9C.AC.E6.96.87.E6.A1.A3"><span class="tocnumber">1.3</span> <span class="toctext">如何使用本文档</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#.E6.9C.AC.E6.96.87.E4.BD.BF.E7.94.A8.E7.9A.84.E7.BA.A6.E5.AE.9A"><span class="tocnumber">1.4</span> <span class="toctext">本文使用的约定</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#.E6.9B.B4.E5.A4.9A.E9.98.85.E8.AF.BB"><span class="tocnumber">1.5</span> <span class="toctext">更多阅读</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#.E6.B3.95.E5.BE.8B.E6.9C.AF.E8.AF.AD"><span class="tocnumber">1.6</span> <span class="toctext">法律术语</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#.E6.9D.A5.E6.BA.90"><span class="tocnumber">1.7</span> <span class="toctext">来源</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#.E5.87.86.E5.A4.87.E5.AE.89.E8.A3.85Jabberd2"><span class="tocnumber">2</span> <span class="toctext">准备安装Jabberd2</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#.E6.94.B6.E9.9B.86.E5.BF.85.E9.9C.80.E7.9A.84.E4.BF.A1.E6.81.AF"><span class="tocnumber">2.1</span> <span class="toctext">收集必需的信息</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#.E6.96.B0.E5.BB.BAJabber.E7.94.A8.E6.88.B7.E5.92.8C.E7.BB.84"><span class="tocnumber">2.2</span> <span class="toctext">新建Jabber用户和组</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#.E4.B8.BAPID.27s.E5.92.8CLogs.E6.96.B0.E5.BB.BA.E7.9B.AE.E5.BD.95"><span class="tocnumber">2.3</span> <span class="toctext">为PID's和Logs新建目录</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#.E5.AE.89.E8.A3.85.E5.85.88.E5.86.B3.E6.9D.A1.E4.BB.B6"><span class="tocnumber">2.4</span> <span class="toctext">安装先决条件</span></a>
<ul>
<li class="toclevel-3 tocsection-14"><a href="#OpenSSL"><span class="tocnumber">2.4.1</span> <span class="toctext">OpenSSL</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#Libidn"><span class="tocnumber">2.4.2</span> <span class="toctext">Libidn</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#.E6.95.B0.E6.8D.AE.E5.AD.98.E5.82.A8.E5.8C.85"><span class="tocnumber">2.4.3</span> <span class="toctext">数据存储包</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="#.E9.AA.8C.E8.AF.81.E5.8C.85"><span class="tocnumber">2.4.4</span> <span class="toctext">验证包</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="#.E5.AE.89.E8.A3.85Jabberd_2"><span class="tocnumber">3</span> <span class="toctext">安装Jabberd 2</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="#.E4.B8.8B.E8.BD.BDJabberd_2"><span class="tocnumber">3.1</span> <span class="toctext">下载Jabberd 2</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#.E6.8F.90.E5.8F.96Jabberd.E5.AE.89.E8.A3.85.E6.96.87.E4.BB.B6"><span class="tocnumber">3.2</span> <span class="toctext">提取Jabberd安装文件</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#.E9.85.8D.E7.BD.AEJabberd.E7.BC.96.E8.AF.91"><span class="tocnumber">3.3</span> <span class="toctext">配置Jabberd编译</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#.E7.BC.96.E8.AF.91Jabberd"><span class="tocnumber">3.4</span> <span class="toctext">编译Jabberd</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#.E5.AE.89.E8.A3.85Jabberd"><span class="tocnumber">3.5</span> <span class="toctext">安装Jabberd</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#.E7.BC.BA.E7.9C.81.E6.96.87.E4.BB.B6.E4.BD.8D.E7.BD.AE"><span class="tocnumber">3.6</span> <span class="toctext">缺省文件位置</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#.E8.AE.BE.E7.BD.AE.E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6.E7.9A.84.E6.89.80.E6.9C.89.E6.9D.83"><span class="tocnumber">3.7</span> <span class="toctext">设置配置文件的所有权</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-26"><a href="#.E5.9F.BA.E6.9C.AC.E9.85.8D.E7.BD.AE"><span class="tocnumber">4</span> <span class="toctext">基本配置</span></a>
<ul>
<li class="toclevel-2 tocsection-27"><a href="#.E5.9C.A8sm.xml.E5.92.8Cc2s.xml.E8.AE.BE.E7.BD.AE.E4.B8.BB.E6.9C.BA.E5.90.8D"><span class="tocnumber">4.1</span> <span class="toctext">在sm.xml和c2s.xml设置主机名</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#.E5.AF.B9.E5.AD.98.E5.82.A8.E5.92.8C.E9.AA.8C.E8.AF.81.E5.8C.85.E7.9A.84.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AE"><span class="tocnumber">4.2</span> <span class="toctext">对存储和验证包的提供和配置</span></a></li>
<li class="toclevel-2 tocsection-29"><a href="#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEBerkeleyDB"><span class="tocnumber">4.3</span> <span class="toctext">提供和配置BerkeleyDB</span></a>
<ul>
<li class="toclevel-3 tocsection-30"><a href="#.E6.8F.90.E4.BE.9BBerkeleyDB"><span class="tocnumber">4.3.1</span> <span class="toctext">提供BerkeleyDB</span></a></li>
<li class="toclevel-3 tocsection-31"><a href="#.E9.85.8D.E7.BD.AE.E5.AD.98.E5.82.A8.E4.BD.BF.E7.94.A8BerkeleyDB.28sm.xml.29"><span class="tocnumber">4.3.2</span> <span class="toctext">配置存储使用BerkeleyDB(sm.xml)</span></a></li>
<li class="toclevel-3 tocsection-32"><a href="#.E9.85.8D.E7.BD.AE.E9.AA.8C.E8.AF.81.E4.BD.BF.E7.94.A8BerkeleyDB.28c2s.xml.29"><span class="tocnumber">4.3.3</span> <span class="toctext">配置验证使用BerkeleyDB(c2s.xml)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-33"><a href="#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEMySQL"><span class="tocnumber">4.4</span> <span class="toctext">提供和配置MySQL</span></a>
<ul>
<li class="toclevel-3 tocsection-34"><a href="#.E6.8F.90.E4.BE.9BMySQL"><span class="tocnumber">4.4.1</span> <span class="toctext">提供MySQL</span></a></li>
<li class="toclevel-3 tocsection-35"><a href="#.E9.85.8D.E7.BD.AE.E5.AD.98.E5.82.A8.E4.BD.BF.E7.94.A8MySQL.28sm.xml.29"><span class="tocnumber">4.4.2</span> <span class="toctext">配置存储使用MySQL(sm.xml)</span></a></li>
<li class="toclevel-3 tocsection-36"><a href="#.E9.85.8D.E7.BD.AE.E9.AA.8C.E8.AF.81.E4.BD.BF.E7.94.A8MySQL.28c2s.xml.29"><span class="tocnumber">4.4.3</span> <span class="toctext">配置验证使用MySQL(c2s.xml)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-37"><a href="#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEPostgreSQL"><span class="tocnumber">4.5</span> <span class="toctext">提供和配置PostgreSQL</span></a>
<ul>
<li class="toclevel-3 tocsection-38"><a href="#.E6.8F.90.E4.BE.9BPostgreSQL"><span class="tocnumber">4.5.1</span> <span class="toctext">提供PostgreSQL</span></a></li>
<li class="toclevel-3 tocsection-39"><a href="#.E9.85.8D.E7.BD.AE.E5.AD.98.E5.82.A8.E4.BD.BF.E7.94.A8PostgreSQL.28sm.xml.29"><span class="tocnumber">4.5.2</span> <span class="toctext">配置存储使用PostgreSQL(sm.xml)</span></a></li>
<li class="toclevel-3 tocsection-40"><a href="#.E9.85.8D.E7.BD.AE.E9.AA.8C.E8.AF.81.E4.BD.BF.E7.94.A8PostgreSQL.28c2s.xml.29"><span class="tocnumber">4.5.3</span> <span class="toctext">配置验证使用PostgreSQL(c2s.xml)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-41"><a href="#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEPAM"><span class="tocnumber">4.6</span> <span class="toctext">提供和配置PAM</span></a>
<ul>
<li class="toclevel-3 tocsection-42"><a href="#.E6.8F.90.E4.BE.9BPAM"><span class="tocnumber">4.6.1</span> <span class="toctext">提供PAM</span></a></li>
<li class="toclevel-3 tocsection-43"><a href="#.E9.85.8D.E7.BD.AE.E9.AA.8C.E8.AF.81.E4.BD.BF.E7.94.A8PAM.28c2s.xml.29"><span class="tocnumber">4.6.2</span> <span class="toctext">配置验证使用PAM(c2s.xml)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-44"><a href="#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEOpenLDAP"><span class="tocnumber">4.7</span> <span class="toctext">提供和配置OpenLDAP</span></a>
<ul>
<li class="toclevel-3 tocsection-45"><a href="#.E6.8F.90.E4.BE.9BOpenLDAP"><span class="tocnumber">4.7.1</span> <span class="toctext">提供OpenLDAP</span></a></li>
<li class="toclevel-3 tocsection-46"><a href="#.E9.85.8D.E7.BD.AE.E9.AA.8C.E8.AF.81.E4.BD.BF.E7.94.A8OpenLDAP.28c2s.xml.29"><span class="tocnumber">4.7.2</span> <span class="toctext">配置验证使用OpenLDAP(c2s.xml)</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-47"><a href="#.E6.B5.8B.E8.AF.95.E6.9C.8D.E5.8A.A1.E5.99.A8"><span class="tocnumber">4.8</span> <span class="toctext">测试服务器</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-48"><a href="#.E5.B8.B8.E8.A7.84.E9.85.8D.E7.BD.AE.E4.BB.BB.E5.8A.A1"><span class="tocnumber">5</span> <span class="toctext">常规配置任务</span></a>
<ul>
<li class="toclevel-2 tocsection-49"><a href="#.E4.B8.BA.E4.BA.92.E8.81.94.E7.BD.91.E8.AE.BF.E9.97.AE.E9.85.8D.E7.BD.AE.E9.98.B2.E7.81.AB.E5.A2.99"><span class="tocnumber">5.1</span> <span class="toctext">为互联网访问配置防火墙</span></a></li>
<li class="toclevel-2 tocsection-50"><a href="#.E9.85.8D.E7.BD.AEJabberd_2.E4.BD.BF.E7.94.A8SSL.E8.BF.9E.E6.8E.A5"><span class="tocnumber">5.2</span> <span class="toctext">配置Jabberd 2使用SSL连接</span></a>
<ul>
<li class="toclevel-3 tocsection-51"><a href="#.E5.88.86.E9.85.8D.E4.B8.80.E4.B8.AA.E7.94.A8.E4.BA.8EJabber.E5.AE.A2.E6.88.B7.E7.AB.AF.E7.9A.84.E8.AF.81.E4.B9.A6"><span class="tocnumber">5.2.1</span> <span class="toctext">分配一个用于Jabber客户端的证书</span></a></li>
<li class="toclevel-3 tocsection-52"><a href="#.E5.88.86.E9.85.8D.E4.B8.80.E4.B8.AA.E7.94.A8.E4.BA.8EJabberd.E7.BB.84.E4.BB.B6.E7.9A.84.E8.AF.81.E4.B9.A6"><span class="tocnumber">5.2.2</span> <span class="toctext">分配一个用于Jabberd组件的证书</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-53"><a href="#.E4.BF.AE.E6.94.B9Router.E5.AF.86.E7.A0.81"><span class="tocnumber">5.3</span> <span class="toctext">修改Router密码</span></a></li>
<li class="toclevel-2 tocsection-54"><a href="#.E5.88.9B.E5.BB.BA.E7.AE.A1.E7.90.86.E5.91.98.E7.94.A8.E6.88.B7"><span class="tocnumber">5.4</span> <span class="toctext">创建管理员用户</span></a></li>
<li class="toclevel-2 tocsection-55"><a href="#.E7.A6.81.E6.AD.A2.E5.85.AC.E5.BC.80.E6.B3.A8.E5.86.8C"><span class="tocnumber">5.5</span> <span class="toctext">禁止公开注册</span></a></li>
<li class="toclevel-2 tocsection-56"><a href="#.E5.85.81.E8.AE.B8.E7.94.A8.E6.88.B7.E4.BF.AE.E6.94.B9.E5.AF.86.E7.A0.81"><span class="tocnumber">5.6</span> <span class="toctext">允许用户修改密码</span></a></li>
<li class="toclevel-2 tocsection-57"><a href="#.E8.AE.BE.E7.BD.AEDNS_SRV.E8.AE.B0.E5.BD.95"><span class="tocnumber">5.7</span> <span class="toctext">设置DNS SRV记录</span></a>
<ul>
<li class="toclevel-3 tocsection-58"><a href="#Jabberd.E4.BD.BF.E7.94.A8SRV.E8.AE.B0.E5.BD.95"><span class="tocnumber">5.7.1</span> <span class="toctext">Jabberd使用SRV记录</span></a></li>
<li class="toclevel-3 tocsection-59"><a href="#.E5.9C.A8_Bind_.E9.87.8C.E5.88.9B.E5.BB.BASRV.E8.AE.B0.E5.BD.95"><span class="tocnumber">5.7.2</span> <span class="toctext">在 Bind 里创建SRV记录</span></a></li>
<li class="toclevel-3 tocsection-60"><a href="#.E5.9C.A8_TinyDNS_.E9.87.8C.E5.88.9B.E5.BB.BASRV.E8.AE.B0.E5.BD.95"><span class="tocnumber">5.7.3</span> <span class="toctext">在 TinyDNS 里创建SRV记录</span></a></li>
<li class="toclevel-3 tocsection-61"><a href="#.E6.B5.8B.E8.AF.95SRV.E8.AE.B0.E5.BD.95"><span class="tocnumber">5.7.4</span> <span class="toctext">测试SRV记录</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-62"><a href="#.E4.BD.BF.E7.94.A8Jabberd_1.4.E8.BF.9E.E6.8E.A5.E5.A4.96.E9.83.A8.E6.9C.8D.E5.8A.A1"><span class="tocnumber">5.8</span> <span class="toctext">使用Jabberd 1.4连接外部服务</span></a>
<ul>
<li class="toclevel-3 tocsection-63"><a href="#XDB.E6.AE.B5.E8.90.BD"><span class="tocnumber">5.8.1</span> <span class="toctext">XDB段落</span></a></li>
<li class="toclevel-3 tocsection-64"><a href="#Log.E6.AE.B5.E8.90.BD"><span class="tocnumber">5.8.2</span> <span class="toctext">Log段落</span></a></li>
<li class="toclevel-3 tocsection-65"><a href="#Router.E7.9A.84IP.E5.9C.B0.E5.9D.80.E5.92.8C.E7.AB.AF.E5.8F.A3"><span class="tocnumber">5.8.3</span> <span class="toctext">Router的IP地址和端口</span></a></li>
<li class="toclevel-3 tocsection-66"><a href="#.E5.85.B1.E4.BA.AB.E5.AF.86.E7.A0.81"><span class="tocnumber">5.8.4</span> <span class="toctext">共享密码</span></a></li>
<li class="toclevel-3 tocsection-67"><a href="#Router.E5.88.AB.E5.90.8D"><span class="tocnumber">5.8.5</span> <span class="toctext">Router别名</span></a></li>
<li class="toclevel-3 tocsection-68"><a href="#.E4.BE.8B.E5.AD.90:muc.xml"><span class="tocnumber">5.8.6</span> <span class="toctext">例子:muc.xml</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-69"><a href="#.E4.BD.BF.E7.94.A8JCR.E4.BD.9C.E4.B8.BAJabberd_2.E7.BB.84.E4.BB.B6"><span class="tocnumber">5.9</span> <span class="toctext">使用JCR作为Jabberd 2组件</span></a>
<ul>
<li class="toclevel-3 tocsection-70"><a href="#.E4.B8.8B.E8.BD.BDJCR.E5.92.8CMU_Conference"><span class="tocnumber">5.9.1</span> <span class="toctext">下载JCR和MU Conference</span></a></li>
<li class="toclevel-3 tocsection-71"><a href="#.E7.BC.96.E8.AF.91JCR.E5.BA.93"><span class="tocnumber">5.9.2</span> <span class="toctext">编译JCR库</span></a></li>
<li class="toclevel-3 tocsection-72"><a href="#.E7.BC.96.E8.AF.91.E7.BB.84.E4.BB.B6"><span class="tocnumber">5.9.3</span> <span class="toctext">编译组件</span></a></li>
<li class="toclevel-3 tocsection-73"><a href="#.E9.85.8D.E7.BD.AE.E7.BB.84.E4.BB.B6"><span class="tocnumber">5.9.4</span> <span class="toctext">配置组件</span></a></li>
<li class="toclevel-3 tocsection-74"><a href="#.E5.90.AF.E5.8A.A8.E7.BB.84.E4.BB.B6"><span class="tocnumber">5.9.5</span> <span class="toctext">启动组件</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-75"><a href="#.E5.AE.89.E8.A3.85.E4.B8.80.E4.B8.AA.E4.BD.BF.E7.94.A8Users-Agent.E7.9A.84JUD"><span class="tocnumber">5.10</span> <span class="toctext">安装一个使用Users-Agent的JUD</span></a>
<ul>
<li class="toclevel-3 tocsection-76"><a href="#.E5.AE.89.E8.A3.85.E5.BF.85.E9.9C.80.E7.9A.84Perl.E6.A8.A1.E5.9D.97"><span class="tocnumber">5.10.1</span> <span class="toctext">安装必需的Perl模块</span></a></li>
<li class="toclevel-3 tocsection-77"><a href="#.E4.B8.8B.E8.BD.BD.E5.B9.B6.E5.AE.89.E8.A3.85Users-Agent"><span class="tocnumber">5.10.2</span> <span class="toctext">下载并安装Users-Agent</span></a></li>
<li class="toclevel-3 tocsection-78"><a href="#.E5.88.9B.E5.BB.BAJUD.E6.95.B0.E6.8D.AE.E5.BA.93"><span class="tocnumber">5.10.3</span> <span class="toctext">创建JUD数据库</span></a></li>
<li class="toclevel-3 tocsection-79"><a href="#.E8.AE.BE.E7.BD.AEJUD.E6.95.B0.E6.8D.AE.E5.BA.93.E6.8E.88.E6.9D.83"><span class="tocnumber">5.10.4</span> <span class="toctext">设置JUD数据库授权</span></a></li>
<li class="toclevel-3 tocsection-80"><a href="#.E9.85.8D.E7.BD.AEconfig.xml"><span class="tocnumber">5.10.5</span> <span class="toctext">配置config.xml</span></a></li>
<li class="toclevel-3 tocsection-81"><a href="#.E6.B5.8B.E8.AF.95users-agent"><span class="tocnumber">5.10.6</span> <span class="toctext">测试users-agent</span></a></li>
<li class="toclevel-3 tocsection-82"><a href="#.E8.AE.BE.E7.BD.AEUsers-Agent.E4.BC.B4.E9.9A.8FJabberd_2.E5.90.AF.E5.8A.A8"><span class="tocnumber">5.10.7</span> <span class="toctext">设置Users-Agent伴随Jabberd 2启动</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-83"><a href="#.E9.9B.86.E6.88.90vCard.E6.95.B0.E6.8D.AE.E5.88.B0Users-Agent.28.E4.BB.85.E9.99.90.E7.A7.81.E6.9C.89.E6.9C.8D.E5.8A.A1.E5.99.A8.29"><span class="tocnumber">5.11</span> <span class="toctext">集成vCard数据到Users-Agent(仅限私有服务器)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-84"><a href="#.E5.B8.B8.E8.A7.84.E7.AE.A1.E7.90.86.E4.BB.BB.E5.8A.A1"><span class="tocnumber">6</span> <span class="toctext">常规管理任务</span></a>
<ul>
<li class="toclevel-2 tocsection-85"><a href="#.E5.90.AF.E5.8A.A8.E5.92.8C.E5.81.9C.E6.AD.A2Jabberd_2"><span class="tocnumber">6.1</span> <span class="toctext">启动和停止Jabberd 2</span></a>
<ul>
<li class="toclevel-3 tocsection-86"><a href="#.E5.90.AF.E5.8A.A8Jabberd_2"><span class="tocnumber">6.1.1</span> <span class="toctext">启动Jabberd 2</span></a></li>
<li class="toclevel-3 tocsection-87"><a href="#.E5.81.9C.E6.AD.A2Jabberd_2"><span class="tocnumber">6.1.2</span> <span class="toctext">停止Jabberd 2</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-88"><a href="#.E4.BB.8EJabberd_1.4.E8.BF.81.E7.A7.BB"><span class="tocnumber">6.2</span> <span class="toctext">从Jabberd 1.4迁移</span></a></li>
<li class="toclevel-2 tocsection-89"><a href="#.E6.B7.BB.E5.8A.A0.E7.94.A8.E6.88.B7"><span class="tocnumber">6.3</span> <span class="toctext">添加用户</span></a>
<ul>
<li class="toclevel-3 tocsection-90"><a href="#.E5.85.81.E8.AE.B8Auto-Create"><span class="tocnumber">6.3.1</span> <span class="toctext">允许Auto-Create</span></a></li>
<li class="toclevel-3 tocsection-91"><a href="#.E4.BB.8EMySQL.E6.8E.A7.E5.88.B6.E5.8F.B0.E5.88.9B.E5.BB.BA.E7.94.A8.E6.88.B7"><span class="tocnumber">6.3.2</span> <span class="toctext">从MySQL控制台创建用户</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-92"><a href="#.E5.88.A0.E9.99.A4.E7.94.A8.E6.88.B7"><span class="tocnumber">6.4</span> <span class="toctext">删除用户</span></a></li>
<li class="toclevel-2 tocsection-93"><a href="#.E5.8F.91.E9.80.81MOTD.E5.92.8C.E6.B6.88.E6.81.AF.E7.BB.99.E6.89.80.E6.9C.89.E5.9C.A8.E7.BA.BF.E7.94.A8.E6.88.B7"><span class="tocnumber">6.5</span> <span class="toctext">发送MOTD和消息给所有在线用户</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-94"><a href="#Router.xml.E9.85.8D.E7.BD.AE"><span class="tocnumber">7</span> <span class="toctext">Router.xml配置</span></a>
<ul>
<li class="toclevel-2 tocsection-95"><a href="#ID.2CPID.E5.92.8C.E6.97.A5.E5.BF.97"><span class="tocnumber">7.1</span> <span class="toctext">ID,PID和日志</span></a></li>
<li class="toclevel-2 tocsection-96"><a href="#.E7.BD.91.E7.BB.9C"><span class="tocnumber">7.2</span> <span class="toctext">网络</span></a></li>
<li class="toclevel-2 tocsection-97"><a href="#.E8.BE.93.E5.85.A5.E8.BE.93.E5.87.BA.E6.8E.A7.E5.88.B6"><span class="tocnumber">7.3</span> <span class="toctext">输入输出控制</span></a>
<ul>
<li class="toclevel-3 tocsection-98"><a href="#.E8.BF.9E.E6.8E.A5.E9.99.90.E5.88.B6"><span class="tocnumber">7.3.1</span> <span class="toctext">连接限制</span></a></li>
<li class="toclevel-3 tocsection-99"><a href="#.E9.A2.91.E7.8E.87.E9.99.90.E5.88.B6"><span class="tocnumber">7.3.2</span> <span class="toctext">频率限制</span></a></li>
<li class="toclevel-3 tocsection-100"><a href="#IP.E8.AE.BF.E9.97.AE.E6.8E.A7.E5.88.B6"><span class="tocnumber">7.3.3</span> <span class="toctext">IP访问控制</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-101"><a href="#.E5.88.AB.E5.90.8D"><span class="tocnumber">7.4</span> <span class="toctext">别名</span></a></li>
<li class="toclevel-2 tocsection-102"><a href="#.E5.8A.9F.E8.83.BD.E8.AE.BF.E9.97.AE.E6.8E.A7.E5.88.B6"><span class="tocnumber">7.5</span> <span class="toctext">功能访问控制</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-103"><a href="#Router-users.xml.E9.85.8D.E7.BD.AE"><span class="tocnumber">8</span> <span class="toctext">Router-users.xml配置</span></a></li>
<li class="toclevel-1 tocsection-104"><a href="#Sm.xml.E9.85.8D.E7.BD.AE"><span class="tocnumber">9</span> <span class="toctext">Sm.xml配置</span></a>
<ul>
<li class="toclevel-2 tocsection-105"><a href="#Jabberd.E8.BA.AB.E4.BB.BD"><span class="tocnumber">9.1</span> <span class="toctext">Jabberd身份</span></a></li>
<li class="toclevel-2 tocsection-106"><a href="#.E5.92.8CRouter.E9.80.9A.E8.AE.AF"><span class="tocnumber">9.2</span> <span class="toctext">和Router通讯</span></a></li>
<li class="toclevel-2 tocsection-107"><a href="#.E6.97.A5.E5.BF.97"><span class="tocnumber">9.3</span> <span class="toctext">日志</span></a></li>
<li class="toclevel-2 tocsection-108"><a href="#.E6.95.B0.E6.8D.AE.E5.BA.93.E8.BF.9E.E6.8E.A5.E5.92.8C.E9.85.8D.E7.BD.AE"><span class="tocnumber">9.4</span> <span class="toctext">数据库连接和配置</span></a></li>
<li class="toclevel-2 tocsection-109"><a href="#.E7.AE.A1.E7.90.86.E5.8A.9F.E8.83.BD.E7.9A.84.E8.AE.BF.E9.97.AE.E6.8E.A7.E5.88.B6"><span class="tocnumber">9.5</span> <span class="toctext">管理功能的访问控制</span></a></li>
<li class="toclevel-2 tocsection-110"><a href="#.E4.BC.9A.E8.AF.9D.E8.B0.83.E7.94.A8.E7.9A.84.E6.A8.A1.E5.9D.97"><span class="tocnumber">9.6</span> <span class="toctext">会话调用的模块</span></a></li>
<li class="toclevel-2 tocsection-111"><a href="#.E5.A4.96.E9.83.A8.E7.BB.84.E4.BB.B6.E7.9A.84.E9.9D.99.E6.80.81.E6.B5.8F.E8.A7.88.E8.AE.BE.E7.BD.AE"><span class="tocnumber">9.7</span> <span class="toctext">外部组件的静态浏览设置</span></a></li>
<li class="toclevel-2 tocsection-112"><a href="#.E7.94.A8.E6.88.B7.E9.80.89.E9.A1.B9"><span class="tocnumber">9.8</span> <span class="toctext">用户选项</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-113"><a href="#Resolver.xml.E9.85.8D.E7.BD.AE"><span class="tocnumber">10</span> <span class="toctext">Resolver.xml配置</span></a>
<ul>
<li class="toclevel-2 tocsection-114"><a href="#PID.E6.96.87.E4.BB.B6"><span class="tocnumber">10.1</span> <span class="toctext">PID文件</span></a></li>
<li class="toclevel-2 tocsection-115"><a href="#.E5.92.8CRouter.E9.80.9A.E8.AE.AF_2"><span class="tocnumber">10.2</span> <span class="toctext">和Router通讯</span></a></li>
<li class="toclevel-2 tocsection-116"><a href="#.E6.97.A5.E5.BF.97_2"><span class="tocnumber">10.3</span> <span class="toctext">日志</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-117"><a href="#S2s.xml.E9.85.8D.E7.BD.AE"><span class="tocnumber">11</span> <span class="toctext">S2s.xml配置</span></a>
<ul>
<li class="toclevel-2 tocsection-118"><a href="#PID.E6.96.87.E4.BB.B6_2"><span class="tocnumber">11.1</span> <span class="toctext">PID文件</span></a></li>
<li class="toclevel-2 tocsection-119"><a href="#.E5.92.8CRouter.E9.80.9A.E8.AE.AF_3"><span class="tocnumber">11.2</span> <span class="toctext">和Router通讯</span></a></li>
<li class="toclevel-2 tocsection-120"><a href="#.E6.97.A5.E5.BF.97_3"><span class="tocnumber">11.3</span> <span class="toctext">日志</span></a></li>
<li class="toclevel-2 tocsection-121"><a href="#.E7.BD.91.E7.BB.9C.E9.85.8D.E7.BD.AE"><span class="tocnumber">11.4</span> <span class="toctext">网络配置</span></a></li>
<li class="toclevel-2 tocsection-122"><a href="#S2S.E8.BF.9E.E6.8E.A5.E6.A3.80.E6.9F.A5"><span class="tocnumber">11.5</span> <span class="toctext">S2S连接检查</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-123"><a href="#C2s.xml.E9.85.8D.E7.BD.AE"><span class="tocnumber">12</span> <span class="toctext">C2s.xml配置</span></a>
<ul>
<li class="toclevel-2 tocsection-124"><a href="#PID.E6.96.87.E4.BB.B6_3"><span class="tocnumber">12.1</span> <span class="toctext">PID文件</span></a></li>
<li class="toclevel-2 tocsection-125"><a href="#.E5.92.8CRouter.E9.80.9A.E8.AE.AF_4"><span class="tocnumber">12.2</span> <span class="toctext">和Router通讯</span></a></li>
<li class="toclevel-2 tocsection-126"><a href="#.E6.97.A5.E5.BF.97_4"><span class="tocnumber">12.3</span> <span class="toctext">日志</span></a></li>
<li class="toclevel-2 tocsection-127"><a href="#.E7.BD.91.E7.BB.9C.E9.85.8D.E7.BD.AE_2"><span class="tocnumber">12.4</span> <span class="toctext">网络配置</span></a></li>
<li class="toclevel-2 tocsection-128"><a href="#.E8.BE.93.E5.85.A5.E8.BE.93.E5.87.BA.E6.8E.A7.E5.88.B6_2"><span class="tocnumber">12.5</span> <span class="toctext">输入输出控制</span></a>
<ul>
<li class="toclevel-3 tocsection-129"><a href="#.E8.BF.9E.E6.8E.A5.E9.99.90.E5.88.B6_2"><span class="tocnumber">12.5.1</span> <span class="toctext">连接限制</span></a></li>
<li class="toclevel-3 tocsection-130"><a href="#.E9.A2.91.E7.8E.87.E9.99.90.E5.88.B6_2"><span class="tocnumber">12.5.2</span> <span class="toctext">频率限制</span></a></li>
<li class="toclevel-3 tocsection-131"><a href="#IP.E8.AE.BF.E9.97.AE.E6.8E.A7.E5.88.B6_2"><span class="tocnumber">12.5.3</span> <span class="toctext">IP访问控制</span></a></li>
<li class="toclevel-3 tocsection-132"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E8.BF.9E.E6.8E.A5.E6.A3.80.E6.9F.A5"><span class="tocnumber">12.5.4</span> <span class="toctext">客户端连接检查</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-133"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E9.AA.8C.E8.AF.81.E5.92.8C.E6.B3.A8.E5.86.8C"><span class="tocnumber">12.6</span> <span class="toctext">客户端验证和注册</span></a>
<ul>
<li class="toclevel-3 tocsection-134"><a href="#.E9.AA.8C.E8.AF.81.E5.8C.85_2"><span class="tocnumber">12.6.1</span> <span class="toctext">验证包</span></a></li>
<li class="toclevel-3 tocsection-135"><a href="#.E5.85.AC.E5.BC.80.E6.B3.A8.E5.86.8C"><span class="tocnumber">12.6.2</span> <span class="toctext">公开注册</span></a></li>
<li class="toclevel-3 tocsection-136"><a href="#.E5.AF.86.E7.A0.81.E4.BF.AE.E6.94.B9"><span class="tocnumber">12.6.3</span> <span class="toctext">密码修改</span></a></li>
<li class="toclevel-3 tocsection-137"><a href="#.E9.AA.8C.E8.AF.81.E6.9C.BA.E5.88.B6"><span class="tocnumber">12.6.4</span> <span class="toctext">验证机制</span></a></li>
<li class="toclevel-3 tocsection-138"><a href="#.E9.AA.8C.E8.AF.81.E5.8C.85.E9.85.8D.E7.BD.AE"><span class="tocnumber">12.6.5</span> <span class="toctext">验证包配置</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-139"><a href="#Jabberd_2.E4.BD.93.E7.B3.BB.E7.BB.93.E6.9E.84.28.E8.8D.89.E7.A8.BF.29"><span class="tocnumber">13</span> <span class="toctext">Jabberd 2体系结构(草稿)</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id=".E7.BB.AA.E8.AE.BA">绪论</span></h2>
<p>本文包括 <a rel="nofollow" class="external text" href="http://jabberd.jabberstudio.org/2/">Jabberd 2 服务器</a> (Jabberd) 的安装和管理指南 , 流行的基于<a rel="nofollow" class="external text" href="http://www.jabber.org/protocol/">Jabber协议</a>的开源即时消息系统的最新版本. Jabber的目标是为客户端和客户端之间同步和异步的通讯提供一个XML协议, 尽管Jabber主要用于即时消息 (IM).
</p><p>Jabberd 服务器是Jabberd协议原始的开源服务器实现, 并且留下了大部分流行的软件，无论是布署在公司或作为一个公开的 IM 服务. Jeremie Miller在1998年开始了Jabber项目，提供给所有的IM服务一个自由和开放的选择. Jabberd服务器继续成为Jabber项目的核心, 并且Jabberd 2相对于于使用更广泛的Jabberd 1.4服务器来说是成功者. Jabberd 2 是基于一个新体系结构的完整的新代码, 额外的功能，并更好地遵守了Jabber协议.
</p><p>一个常见的消息协议的建立, 现在大家知道的<a rel="nofollow" class="external text" href="http://www.ietf.org/html.charters/xmpp-charter.html">XMPP</a> (可扩展的消息和出席信息协议), 允许在Jabberd服务器之外新建更多的Jabber服务器实现. 这许多的开源项目中, 包含<a rel="nofollow" class="external text" href="http://www.jabberstudio.org/projects/wpjabber/project/view.php">WP Jabber</a> 和 <a rel="nofollow" class="external text" href="http://www.jabberstudio.org/projects/ejabberd/project/view.php">ejabberd</a>, 以及许多软件来自商业机构如 i3connect, Jabcast, Tipic 和 Jabber, Inc.
</p>
<h3> <span class="mw-headline" id=".E7.9B.AE.E7.9A.84.E5.92.8C.E8.8C.83.E5.9B.B4">目的和范围</span></h3>
<p>本文的作者打算提供一个完整的关于 jabberd 2 安装, 管理和开发的指南:
</p>
<ul><li> 系统准备
</li><li> 服务器准备
</li><li> 服务器配置
</li><li> 体系结构概述
</li></ul>
<p>目标受众是那些希望在Unix或其某个变种安装和/或维护一个jabberd 2服务器的人. 因此, 本文仅覆盖了Unix操作系统上的Jabberd安装.
</p>
<h3> <span class="mw-headline" id=".E9.9C.80.E8.A6.81.E7.9A.84.E8.83.8C.E6.99.AF.E7.9F.A5.E8.AF.86">需要的背景知识</span></h3>
<p>作者做了很多努力来制作这个手把手的指南; 然而, 还是假定读者对Unix 或 Linux 操作系统比较熟悉:
</p>
<ul><li> 能使用Linux命令行控制台
</li><li> 熟悉文件系统，你的服务器将装在那里
</li><li> 熟悉一个文本编辑器, 如 vi, Nano 或 NEdit
</li><li> 基本的编辑 XML 文件的能力
</li></ul>
<p>假定读者基本熟练使用一个Jabber客户端. 另外, 假定读者熟悉硬件和软件, 例如防火墙, 路由器或调制解调器, 如果使用了这类硬件，jabber服务器将用来连接到互联网. 这些次要程序和设备的配置超出了本指南的范围.
</p>
<h3> <span class="mw-headline" id=".E5.A6.82.E4.BD.95.E4.BD.BF.E7.94.A8.E6.9C.AC.E6.96.87.E6.A1.A3">如何使用本文档</span></h3>
<p>本指南根据用户的使用来组织章节:
</p>
<ul><li> 安装和配置 Jabberd 2 (<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.87.86.E5.A4.87.E5.AE.89.E8.A3.85Jabberd2" title="Jabberd2:安装和管理指南">2到4章</a>)
</li><li> 一般的配置和管理任务 (<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.B8.80.E8.88.AC.E7.9A.84.E9.85.8D.E7.BD.AE.E4.BB.BB.E5.8A.A1" title="Jabberd2:安装和管理指南">5到6章</a>)
</li><li> Jabberd 2配置文件概要 (<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Router.xml.E9.85.8D.E7.BD.AE" title="Jabberd2:安装和管理指南">7到12章</a>)
</li><li> Jabber 2体系结构 (<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Jabberd2.E4.BD.93.E7.B3.BB.E7.BB.93.E6.9E.84.28.E8.8D.89.E7.A8.BF.29" title="Jabberd2:安装和管理指南">13章</a>)
</li><li> Jabberd 快速指南 (<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.99.84.E5.BD.95" title="Jabberd2:安装和管理指南">附录A</a>)
</li><li> Jabberd 2 常见问题(<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Jabberd_2_FAQ" title="Jabberd2:安装和管理指南">FAQ</a>)
</li></ul>
<p><a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Jabberd2.E5.BF.AB.E9.80.9F.E6.8C.87.E5.8D.97" title="Jabberd2:安装和管理指南">快速指南</a>是为有经验的用户尽快运行而设计的. 详细的 Jabberd 2 安装指导开始于第二章，<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.87.86.E5.A4.87.E5.AE.89.E8.A3.85Jabberd2" title="Jabberd2:安装和管理指南">准备安装Jabberd2</a>. 第5和第6章分别列出了常见的<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.B8.B8.E8.A7.81.E9.85.8D.E7.BD.AE.E4.BB.BB.E5.8A.A1" title="Jabberd2:安装和管理指南">配置</a>和<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.B8.B8.E8.A7.81.E7.AE.A1.E7.90.86.E4.BB.BB.E5.8A.A1" title="Jabberd2:安装和管理指南">管理</a>任务, 剩下的章节提供了详细的配置信息.
</p>
<h3> <span class="mw-headline" id=".E6.9C.AC.E6.96.87.E4.BD.BF.E7.94.A8.E7.9A.84.E7.BA.A6.E5.AE.9A">本文使用的约定</span></h3>
<p>本文主要是作为一个安装指南提供的, 因此, 使用了特定的约定来使安装对用户来说更容易. 以下出现的约定贯穿本指南的安装章节:
</p><p><b>表 1.4. 本指南使用的文档约定</b>
</p>
<table border="1" cellspacing="0">
<tr>
<th>约定 </th>
<th> 名称 </th>
<th> 描述
</th></tr>
<tr>
<td>P </td>
<td> 参数 </td>
<td> 一个配置文件中关于你的特定安装的信息, 等等.
</td></tr>
<tr>
<td>C </td>
<td> 检查点 </td>
<td> 一个点，停止并检查你的安装
</td></tr>
<tr>
<td>N </td>
<td> 注意 </td>
<td> 强调信息
</td></tr>
<tr>
<td>I </td>
<td> 重要 </td>
<td> 重要的强调或警告
</td></tr>
<tr>
<td>F </td>
<td> 必需的文件 </td>
<td> 完成这一步或下列步骤所需要的软件或特定文件
</td></tr>
<tr>
<td>O </td>
<td> 可选步骤 </td>
<td> 这一步在大部分基本安装中不是必需的步骤
</td></tr>
<tr>
<td>E </td>
<td> 外部系统 </td>
<td> 这一步可能需要在外部系统配置，如路由器
</td></tr></table>
<p>这些里面最有用的约定是参数"Parameters." 第2章开始于一个关于你的安装的信息(参数)的列表，在你的安装步骤中将需要用到它们. 你可以在开始安装Jabberd之前收集所有这些信息, 然后你可以在每一步显示了P的地方参考.
</p><p>这个安装指南用编号来组织这些步骤，下级步骤. 鼓励用户把本指南当成一个检查列表来使用. 当一个步骤的所有下级步骤完成, 接着上级步骤本身也完成了. 注意一个 "可选步骤"的所有子 (下级步骤) 也是可选的. 注意 "可选步骤" 设计用来满足关于在哪个条件和/或下可选步骤应被执行的需求.
</p><p>标为"外部系统"的步骤提供信息给用户，表示安装可能需要执行于一个jabberd之外的系统. 这些系统包括路由器, 防火墙, DNS服务器, 等等. "外部系统" 提示主要是信息提示而不是详尽的. 剩下的约定是不言自明的.
</p><p>注意本指南列出的每个命令引用的一个命令都是进入了一个命令行提示或命令行提示shell, 例如 X-term 或 E-term. 也要注意在本文里, 术语 "Jabberd" 指的是 Jabberd 2 服务器, 除非特别声明. 术语 "Jabber" 指基于Jabber的系统或系统们, 而 "XMPP" 指Jabber系统运行的协议.
</p><p>本文使用<a rel="nofollow" class="external text" href="http://dev.zope.org/Members/jim/StructuredTextWiki/TextFormattingRules">结构化的文本</a>建立. 结构化的文本使用标准文本格式化约定, 例如 underscores, 来展示格式化的文本. 已经做了很多努力来让文本和HTML格式接近. 一个例外是，在文本版本中使用的 bang 字符 ("!") ，在HTML版本中是用来避免不想要的格式的. "Bangs" 出现在文本版本的一些行的开始, 而这些可能被忽略. 它们不显示在 HTML 版本中.
</p>
<h3> <span class="mw-headline" id=".E6.9B.B4.E5.A4.9A.E9.98.85.E8.AF.BB">更多阅读</span></h3>
<p>访问<a rel="nofollow" class="external text" href="http://www.jabber.org/">Jabber软件基金会</a> 获得关于jabberd 2, jabber客户端, 和Jabber协议的最新新闻. <a rel="nofollow" class="external text" href="http://www.jabber.org/about/generalfaq.html">Jabber Faq</a> 回答关于Jabber的基本问题. 鼓励读者访问关于jabber管理的提问 <a rel="nofollow" class="external text" href="http://news.gmane.org/gmane.network.jabber.admin">Jadmin归档</a>, 或订阅 <a rel="nofollow" class="external text" href="http://mailman.jabber.org/listinfo/jadmin/">Jadmin邮件列表</a>得到最新的jabberd管理信息. Jabberd 2开发信息可以在<a rel="nofollow" class="external text" href="http://jabberstudio.org/pipermail/jabberd/">Jabberd归档</a>找到，或订阅<a rel="nofollow" class="external text" href="http://jabberstudio.org/cgi-bin/mailman/listinfo/jabberd">Jabberd邮件列表</a>.
</p><p>也有许多好的关于Jabber的书. 注意以下的书关于jabberd 1.4的只是写于2003年:
</p>
<ul><li> <a rel="nofollow" class="external text" href="http://www.jabber.org/admin/adminguide.html">Jabberd Administration Guide for version 1.4</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.oreilly.com/catalog/jabber/">Programming Jabber by D.J. Adams</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.manning.com/shigeoka/">Instant Messaging for Java by Iain Shigeoka</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.wiley.com/WileyCDA/WileyTitle/productCd-0764549340.html">Jabber Programming by Stephen Lee and Terence Smelser</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.samspublishing.com/">Jabber Developer's Handbook from Sams Publishing</a>
</li></ul>
<h3> <span class="mw-headline" id=".E6.B3.95.E5.BE.8B.E6.9C.AF.E8.AF.AD">法律术语</span></h3>
<p>Jabberd安装和管理指南的版权(2003)由Will Kamishlian and Robert Norris所有。
</p><p>这项工作是根据创作共用许可署名，类似非商业性使用方式共享许可。要查看本许可协议，请访问 <a rel="nofollow" class="external free" href="http://creativecommons.org/licenses/by-nc-sa/1.0/">http://creativecommons.org/licenses/by-nc-sa/1.0/</a> 或发信到 Creative Commons, 559 Nathan Abbott Way, Stanford, California 94305, USA.
</p>
<h3> <span class="mw-headline" id=".E6.9D.A5.E6.BA.90">来源</span></h3>
<p>Robert Norris, 主要的Jabberd 2开发者, 以及Jabberd List的发起人，为本文提供了技术信息.
</p>
<h2> <span class="mw-headline" id=".E5.87.86.E5.A4.87.E5.AE.89.E8.A3.85Jabberd2">准备安装Jabberd2</span></h2>
<p>本章让你和你的系统准备好安装Jabberd 2:
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.94.B6.E9.9B.86.E5.BF.85.E9.9C.80.E7.9A.84.E4.BF.A1.E6.81.AF" title="Jabberd2:安装和管理指南">收集必需的信息</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.96.B0.E5.BB.BAJabber.E7.94.A8.E6.88.B7.E5.92.8C.E7.BB.84" title="Jabberd2:安装和管理指南">新建Jabber用户和组</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.B8.BAPID.27s.E5.92.8CLogs.E6.96.B0.E5.BB.BA.E7.9B.AE.E5.BD.95" title="Jabberd2:安装和管理指南">为PID's和Logs新建目录</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.AE.89.E8.A3.85.E5.85.88.E5.86.B3.E6.9D.A1.E4.BB.B6" title="Jabberd2:安装和管理指南">安装先决条件</a>
</li></ul>
<p>本章的表 2.1. 列出了Jabberd 2安装需要的信息. 在这个点上收集这个信息是可选的; 然而, 现在完成这个表格将使安装更容易.
</p>
<h3> <span class="mw-headline" id=".E6.94.B6.E9.9B.86.E5.BF.85.E9.9C.80.E7.9A.84.E4.BF.A1.E6.81.AF">收集必需的信息</span></h3>
<p>下表列出的信息是安装过程中需要的. 以下是每个参数提供的信息:
</p>
<ul><li> 参数Parameter
</li><li> 必需的Required
</li><li> 章节Section
</li><li> 描述Description
</li><li> 你的信息Your Information
</li></ul>
<p>"Parameter" 是信息的名称部分. 贯穿整个指南, 特定的参数指向 <b>P</b> 约定. "Required 要么是 "Y" (yes), "N" (no), 要么是 <i>可选的名称</i>. <i>可选的名称</i>指向这个参数需要的选项. 一些条目有建议的内容给"Your Information." 这些条目要么显示受限的选择要么显示缺省值. 这里给出了缺省值, 它们被用于本指南的例子.
</p><p>对于最小安装, 完成所有必需的参数. 对于什么条件下需要可选的参数的更多信息, 详见参考章. "Description" 是一个简短描述. 再一次的, 详见参考章.
</p><p><b>I Important: Table Contains Passwords</b>
</p><p>下表包含了密码. 如果你在下表写下了你的密码, 把本文(或页)存在一个安全的地方.
</p><p><b>表 2.1. Jabberd2安装必需的信息</b>
</p>
<table border="1" cellspacing="0">
<tr>
<th>参数 </th>
<th> 必需的 </th>
<th> 章节 </th>
<th> 描述 </th>
<th> 你的信息
</th></tr>
<tr>
<td>Jabberd User and Group </td>
<td> Y </td>
<td> 2.2 </td>
<td> Linux(或其他OS)用户和组，将用于运行Jabberd </td>
<td> user: jabber group: jabber
</td></tr>
<tr>
<td>PID Directory </td>
<td> Y </td>
<td> 2.3 </td>
<td> Jabberd存储PID文件的目录  </td>
<td> /usr/local/var/jabberd/pid
</td></tr>
<tr>
<td>Log Directory </td>
<td> N </td>
<td> 2.3 </td>
<td> 用于Jabberd logs的目录. 如果在配置文件中不指定, 日志缺省存在syslog. </td>
<td> /usr/local/var/jabberd/log
</td></tr>
<tr>
<td>Authentication Package </td>
<td> Y </td>
<td> 2.4.3 3.3, </td>
<td> Jabberd验证管理使用的第三方包 </td>
<td> MySQL, PostgreSQL, Berkeley DB, OpenLDAP or PAM
</td></tr>
<tr>
<td>Data Storage Package </td>
<td> Y </td>
<td> 2.4.4 4.3 </td>
<td> 用于存储Jabberd数据的第三方包 </td>
<td> MySQL, PostgreSQL or Berkeley DB
</td></tr>
<tr>
<td>Data Directory </td>
<td> Berkeley DB </td>
<td> 4.1.1, 4.2.1, </td>
<td> 用于存储Berkeley DB数据文件的目录 </td>
<td> /usr/local/var/jabberd/db
</td></tr>
<tr>
<td>MySQL User and Password </td>
<td> MySQL </td>
<td> 3.5.2.2, 4.1.2, 4.2.2, </td>
<td> Jabberd用于连接MySQL的MySQL用户名和密码 </td>
<td> user: jabberd2 password: secret
</td></tr>
<tr>
<td>PostgreSQL User and Password </td>
<td> PostgreSQL </td>
<td> 3.5.3.1, 1 3, 4.2.3, </td>
<td> Jabberd用于连接PostgreSQL的PostgreSQL用户名和密码 </td>
<td> user: jabberd2 password: secret
</td></tr>
<tr>
<td>OpenLDAP Connection Settings </td>
<td> OpenLDAP </td>
<td> 2.5 </td>
<td> 用于你的OpenLDAP服务器连接设置: 指定LDAP服务器(或IP)的FQDN,端口,和LDAP使用的版本(要么v2要么v3) </td>
<td>
</td></tr>
<tr>
<td>OpenLDAP User and Password </td>
<td> OpenLDAP </td>
<td> 4.2.5 </td>
<td> 连接到你的OpenLDAP服务器的用户名和密码. 只有你的OpenLDAP服务器不允许匿名绑定(访问)时才需要 </td>
<td>
</td></tr>
<tr>
<td>OpenLDAP Query Settings </td>
<td> OpenLDAP </td>
<td> 4.2.5 </td>
<td> Base DN (识别名) 和 User ID 属性用于为OpenLDAP服务器建立查询. Base DN 可以要么是服务器的root DN 要么是一个可以在它那找到 User ID's 的 RDN (相对的识别名). </td>
<td>
</td></tr>
<tr>
<td>Hostname </td>
<td> Y </td>
<td> 4.4 </td>
<td> 你的安装了Jabberd服务器的主机名. 对于可从互联网访问的服务器, 看起来类似 somedomain.com </td>
<td>
</td></tr>
<tr>
<td>SSL Key Location </td>
<td> N </td>
<td> 5.3.1, 5.3.2 </td>
<td> OpenSSL证书文件的位置. 对于SSL加密通讯是必需的 </td>
<td> /usr/local/etc/jabberd/server.pem
</td></tr>
<tr>
<td>Router User and Password </td>
<td> N </td>
<td> 5.4 </td>
<td> 用于别的组件连接到Jabberd Router组件的用户名和密码 </td>
<td> user: jabberd2 password: secret
</td></tr></table>
<h3> <span class="mw-headline" id=".E6.96.B0.E5.BB.BAJabber.E7.94.A8.E6.88.B7.E5.92.8C.E7.BB.84">新建Jabber用户和组</span></h3>
<p>你应该新建一个jabber用户和组来运行服务器:
</p><p><b>P 参数: Jabber User and Group</b>
</p><p>新建一个用于运行Jabberd(作为超级用户)的用户和组:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>          <span class="kw2">su</span>
          groupadd jabber
          useradd <span class="re5">-g</span> jabber jabber</pre></div></div>
<p><b>I 重要: 检查你的用户和组命令</b>
</p><p>以上命令只是一个例子. 在你的系统中增加一个用户和组的命令和参数可能不同. 如果对这些命令有任何疑问请参考手册.
</p>
<h3> <span class="mw-headline" id=".E4.B8.BAPID.27s.E5.92.8CLogs.E6.96.B0.E5.BB.BA.E7.9B.AE.E5.BD.95">为PID's和Logs新建目录</span></h3>
<p>你应该为Jabberd新建一个目录来存储它的PID和log文件, 并让之前新建的用户拥有这些目录的所有权.
</p><p><b>P 参数: PID Directory</b>
</p><p>为PID文件(作为超级用户)新建一个目录:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>          <span class="kw2">su</span>
          <span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>var<span class="sy0">/</span>jabberd<span class="sy0">/</span>pid<span class="sy0">/</span>
          <span class="kw2">chown</span> <span class="re5">-R</span> jabber:jabber <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>var<span class="sy0">/</span>jabberd<span class="sy0">/</span>pid<span class="sy0">/</span></pre></div></div>
<p>以上目录是Jabberd PID 文件的缺省的位置.
</p><p>你也可以选择为logs新建一个目录.
</p><p><b>O 可选的: Log Directory</b>
</p><p>如果你想要, 为logs新建一个独立的目录, 并把所有权赋予你的jabber用户:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>          <span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>var<span class="sy0">/</span>jabberd<span class="sy0">/</span>log<span class="sy0">/</span>
          <span class="kw2">chown</span> <span class="re5">-R</span> jabber:jabber <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>var<span class="sy0">/</span>jabberd<span class="sy0">/</span>log</pre></div></div>
<p><b>N 注意: Log文件缺省为Syslog</b>
</p><p>注意Jabberd缺省地把消息写到syslog. 为了强制Jabberd把它的logs写到上述目录, 必须编辑组件的XML文件以指定上述新建的目录.
</p>
<h3> <span class="mw-headline" id=".E5.AE.89.E8.A3.85.E5.85.88.E5.86.B3.E6.9D.A1.E4.BB.B6">安装先决条件</span></h3>
<p>Jabberd2有四个先决条件:
</p>
<ul><li> <a rel="nofollow" class="external text" href="http://www.openssl.org/">OpenSSL (版本0.9.6b或更高)</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.gnu.org/software/libidn/">Libidn (版本0.3.0或更高)</a>
</li><li> 数据存储包
</li><li> 验证包
</li></ul>
<p>技术上来讲, Jabberd 2的安装可以不需要OpenSSL或Libidn; 然而, 强烈推荐在安装Jabberd之前安装这些包. Jabberd 2也要求数据存储包用于应用和验证; 然而, 一个单独的包, 例如 MySQL, 也可能同时满足数据存储和验证的要求.
</p>
<h4> <span class="mw-headline" id="OpenSSL">OpenSSL</span></h4>
<p>OpenSSL为Jabber提供客户端到服务器以及服务器之间的通讯的加密. XMPP协议要求Jabber服务器支持TLS (传输安全层). TLS是SSL的继任者.
</p><p><b>N 注意: 最小OpenSSL版本</b>
</p><p>Jabberd 2依赖OpenSSL版本0.9.6b或更高. 
</p><p><b>I 重要: OpenSSL升级问题</b>
</p><p>如果你升级了OpenSSL, 你可能需要重新编译安装目前依赖于老版本OpenSSL的软件. 提出这个警告是因为很多工具依赖于OpenSSL, 而且OpenSSL升级之后这些工具可能停止运作. 建议谨慎地更新OpenSSL, 升级OpenSSL的详细指引超出了本文范围.
</p><p>更多信息请看<a rel="nofollow" class="external text" href="http://www.openssl.org/">OpenSSL</a>网站. OpenSSL下载在<a rel="nofollow" class="external text" href="http://www.openssl.org/source">OpenSSL Source</a>页. 为Jabberd 2安装OpenSSL的指引在本指南的附录里. 参见<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.B8.BAJabberd.E5.AE.89.E8.A3.85OpenSSL" title="Jabberd2:安装和管理指南">为Jabberd安装OpenSSL</a>.
</p>
<h4> <span class="mw-headline" id="Libidn">Libidn</span></h4>
<p>Libidn为Jabberd 2提供必要的字符处理功能. 在Jabberd 2稳定版3之前, libidn已经被包含在Jabberd 2分发版里; 然而, 版权冲突使得libidn必须提前独立安装.
</p><p><b>N 注意最小libidn版本</b>
</p><p>Jabberd 2依赖于libidn版本0.3.0或更高.
</p><p>详见<a rel="nofollow" class="external text" href="http://www.gnu.org/software/libidn/">Libidn</a>网站. Libidn下载在<a rel="nofollow" class="external text" href="http://www.gnu.org/software/libidn/#downloading">Libidn Source</a>页. 安装libidn指引在本指南的附录. 参见<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.B8.BAJabberd.E5.AE.89.E8.A3.85Libidn" title="Jabberd2:安装和管理指南">为Jabberd安装Libidn</a>.
</p>
<h4> <span class="mw-headline" id=".E6.95.B0.E6.8D.AE.E5.AD.98.E5.82.A8.E5.8C.85">数据存储包</span></h4>
<p>Jabberd 2对数据库集成的支持比以前更好了, 而且Jabberd 2能使用三种自由数据库之一来提供数据存储:
</p>
<ul><li> <a rel="nofollow" class="external text" href="http://www.mysql.com/">MySQL</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.sleepycat.com/">Berkeley DB (4.1.24或更高版本)</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.postgresql.org/">PostgreSQL</a>
</li></ul>
<p>MySQL是推荐以及缺省的数据存储. 文件也可以用来存储Jabberd 2数据; 然而, 这是不推荐的.
</p><p><b>N 注意: MySQL和Unicode支持</b>
</p><p>MySQL版本4.1和更高版本支持Unicode (UCS-2和UTF8) 字符编码. 如果你的安装需要支持多字母编码, 并且希望使用MySQL, 选择4.1或更高版本.
</p><p>如果你已安装了这些数据库中的一个, 你可以配置它为Jabberd工作. 反之, 你应该选择这些数据库中之一并在继续安装Jabberd之前安装它. MySQL是推荐的数据库; 然而, Berkeley DB 需要的安装和管理工作更少. 从而, 对于用户比较少的安装来说，Berkeley DB 也是理想的选择.
</p><p><b>I 重要: MySQL需要开发库和头文件</b>
</p><p>注意Jabberd需要的不止是最小的MySQL安装. 除了基本的MySQL安装, Jabberd要求开发库和头文件也要安装. 要么执行一个<a rel="nofollow" class="external text" href="http://www.mysql.com/downloads/mysql-4.0.html">MySQL Downloads</a>页列出的<i>最大</i>安装, 要么独立的安装<i>服务器, 客户端程序, 库和头文件</i>, 以及<i>动态客户端库</i>. 为了安装附加的库，可能需要卸载当前的 MySQL安装. 
</p><p>本文的附录包括了为Jabberd 2安装MySQL或Berkeley DB的指引. 参见<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.B8.BAJabberd.E5.AE.89.E8.A3.85Berkeley_DB" title="Jabberd2:安装和管理指南">为Jabberd安装Berkeley DB</a>或<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.B8.BAJabberd.E5.AE.89.E8.A3.85MySQL" title="Jabberd2:安装和管理指南">为Jabberd安装MySQL</a>.
</p>
<h4> <span class="mw-headline" id=".E9.AA.8C.E8.AF.81.E5.8C.85">验证包</span></h4>
<p>Jabberd 2能使用五种第三方数据包之一来处理用户验证: 
</p>
<ul><li> <a rel="nofollow" class="external text" href="http://www.mysql.com/">MySQL</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.sleepycat.com/">Berkeley DB (4.1.24或更高版本)</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.postgresql.org/">PostgreSQL</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.openldap.org/">OpenLDAP (2.1.0或更高版本)</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.kernel.org/pub/linux/libs/pam/">PAM</a>
</li></ul>
<p>注意三种支持的一个应用数据包也被用于管理验证信息. 所以, 安装MySQL, Berkeley DB 或 PostgreSQL 之一同时满足了Jabberd数据包的要求. 可以用一个文件存储验证数据; 然而, 这是不推荐的. 推荐的和缺省的包是MySQL.
</p><p>如果你已经安装了以上五种验证数据包之一, 你可以配置它用于Jabberd 2. 如果没有, 你应该安装以上五个包中的一个或多个.
</p><p>本文的附录包括了为Jabberd 2安装MySQL或Berkeley DB的指引. 参见<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.B8.BAJabberd.E5.AE.89.E8.A3.85Berkeley_DB" title="Jabberd2:安装和管理指南">为Jabberd安装Berkeley DB</a>或<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.B8.BAJabberd.E5.AE.89.E8.A3.85MySQL" title="Jabberd2:安装和管理指南">为Jabberd安装MySQL</a>.
</p>
<h2> <span class="mw-headline" id=".E5.AE.89.E8.A3.85Jabberd_2">安装Jabberd 2</span></h2>
<p>本章描述如何编译和安装Jabberd 2. 
</p>
<h3> <span class="mw-headline" id=".E4.B8.8B.E8.BD.BDJabberd_2">下载Jabberd 2</span></h3>
<p><b>F 必需的文件</b>
</p><p>从 <a rel="nofollow" class="external text" href="http://jabberd.jabberstudio.org/2/">Jabber Studio</a>下载文件 <i>jabberd-2.0sn.tar.gz</i> , 这里 "n" 是Jabberd 2的最新稳定版本号.
</p><p>下载上述文件到一个 /home 下的目录，用于编译这些安装文件. 撰写本文的时候, Jabberd 2 稳定发布版3 是最新的版本并且用于下面的例子.
</p>
<h3> <span class="mw-headline" id=".E6.8F.90.E5.8F.96Jabberd.E5.AE.89.E8.A3.85.E6.96.87.E4.BB.B6">提取Jabberd安装文件</span></h3>
<p>进入到你下载上述文件的目录然后通过命令行提取Jabberd 2文件:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw2">tar</span> <span class="re5">-zxvf</span>  jabberd<span class="nu0">-2</span>.0s3.tar.gz</pre></div></div>
<h3> <span class="mw-headline" id=".E9.85.8D.E7.BD.AEJabberd.E7.BC.96.E8.AF.91">配置Jabberd编译</span></h3>
<p>|| 待做: 准备重写配置指引使得它们更清晰. 也许放一些特别的配置到 FAQ ||
</p><p>进入上面建立的文件夹:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw3">cd</span> jabberd<span class="nu0">-2</span>.0s3</pre></div></div>
<p><b>O 可选的: 查看配置选项</b>
</p><p>在配置Jabberd之前, 你可以查看所有配置选项，运营以下命令:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>          .<span class="sy0">/</span>configure <span class="re5">--help</span></pre></div></div>
<p>这将提供一个设置配置选项的清单和语法. 例如, 你可以安装Jabberd到一个特定的目录，通过使用 --prefix=PREFIX 选项. 通过提供一个 PREFIX 路径, 所有的Jabberd文件将被安装在这个目录下. 如果你正在测试一个新的Jabberd安装,这可能很有用. 另一个有用的选项是 --enable-debug. 这个选项允许Jabberd提供详细的调试信息; 然而, 在生产系统上它应该慎用.
</p><p><b>I 重要: 配置选项已经在稳定版本3中改变了</b>
</p><p>Jabberd 2稳定版本3为配置脚本改变了一些参数. 以下信息属于Jabberd 2稳定版本3和更高版本.
</p><p><b>I 重要: 对于OpenSSL和Libidn使用明确的选项 </b>
</p><p>推荐Jabberd 2把OpenSSL和Libidn配置成明确的选项. 这些包从技术上是可选的. 所以, 配置可以不用它们而编译Jabberd 2，如果当配置运行的时候它们的库和头文件没找到. 
</p><p><b>P 参数: 应用程序数据包和验证数据包</b>
</p><p>验证包和数据包应该以 --enable- 选项指定. 选项为 --enable-mysql, --enable-pgsql, --enable-db, --enable-pam or --enable-ldap. 尽管 --enable-mysql 是缺省的, 如果使用了MySQL，还是推荐指定它. 例如, 这个命令将被用于允许MySQL成为验证和存储包，但不支持调试:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>          .<span class="sy0">/</span>configure <span class="re5">--enable-mysql</span> <span class="re5">--enable-ssl</span> <span class="re5">--enable-idn</span></pre></div></div>
<p>以下命令将用于配置Jabberd使用Berkeley DB，同时用于存储和验证并允许调试:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      .<span class="sy0">/</span>configure <span class="re5">--enable-db</span> <span class="re5">--enable-debug</span> <span class="re5">--enable-ssl</span> <span class="re5">--enable-idn</span></pre></div></div>
<p>如果Jabberd的先决条件之一被安装在一个非标准的位置, 你将需要在运行配置的时候指定这个位置. 指定替代的头文件路径可以使用 --with-extra-include-path 选项，指定替代的库文件路径可使用 -with-extra-library-path 选项. 多路径, 分别位于不同克隆, 可以指定. 例如, 如果OpenSSL和MySQL被安装在 /usr/local, 你可以用以下指令配置:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      .<span class="sy0">/</span>configure <span class="re5">--enable-pgsql</span> <span class="re5">--enable-ssl</span> <span class="re5">--enable-idn</span> \
      <span class="re5">--with</span> extra-include-<span class="re2">path=</span><span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>include:<span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>include<span class="sy0">/</span>mysql \
      --with-extra-library-<span class="re2">path=</span><span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>lib:<span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>lib<span class="sy0">/</span>mysql</pre></div></div>
<p><b>I 重要: 不正确的参数会被忽略</b>
</p><p>Jabberd忽略不正确的配置参数. 因而, 一个不正确的配置参数可能仍会成功配置, 即使错误的Jabberd配置. 如果有疑问运行 ./configure --help .
</p><p><b>I 重要: Redhat 9配置</b>
</p><p>在Redhat 9编译Jabberd 2要求特定的配置，因为Redhat 9自带了自己的Kerberos版本. 详见 FAQ 中关于 Redhat 9 的部分. 
</p><p>如果你希望使用缺省配置,简单地运行配置命令:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      .<span class="sy0">/</span>configure</pre></div></div>
<p>这将配置Jabberd使用MySQL和安装到 /usr/local 目录. 如果你接收到错误, 你可能希望检查 FAQ，你将发现许多系统特定的工作环境.
</p>
<h3> <span class="mw-headline" id=".E7.BC.96.E8.AF.91Jabberd">编译Jabberd</span></h3>
<p>编译Jabberd，运行以下命令:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw2">make</span></pre></div></div>
<h3> <span class="mw-headline" id=".E5.AE.89.E8.A3.85Jabberd">安装Jabberd</span></h3>
<p>切换到超级用户:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw2">su</span></pre></div></div>
<p>运行make install:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw2">make</span> <span class="kw2">install</span></pre></div></div>
<h3> <span class="mw-headline" id=".E7.BC.BA.E7.9C.81.E6.96.87.E4.BB.B6.E4.BD.8D.E7.BD.AE">缺省文件位置</span></h3>
<p>你的Jabberd 2安装完成了. 以下是一个缺省安装的文件位置列表:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      /usr/local/etc/jabberd     Jabberd Configuration Files
      /usr/local/bin       Jabberd Binaries <span class="br0">&#40;</span>jabberd, c2s, resolver, router, s2s, sm<span class="br0">&#41;</span></pre></div></div>
<h3> <span class="mw-headline" id=".E8.AE.BE.E7.BD.AE.E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6.E7.9A.84.E6.89.80.E6.9C.89.E6.9D.83">设置配置文件的所有权</span></h3>
<p>Jabberd配置文件包含密码; 所以, 你应该对这些文件设置所有权和许可，这样他们只能被你的jabber用户读和被root用户写. 使用你的配置文件的位置和你的jabberd用户, 设置这些文件的所有权:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw2">chown</span> <span class="re5">-R</span> root:jabber <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>etc<span class="sy0">/</span>jabberd<span class="sy0">/*</span></pre></div></div>
<p>然后, 给这些文件设置许可，这样别人不能读写它们:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw2">chmod</span> <span class="re5">-R</span> <span class="nu0">640</span> <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>etc<span class="sy0">/</span>jabberd<span class="sy0">/*</span></pre></div></div>
<p>现在, 只有你的jabber用户和和超级用户能读和编辑你的配置文件.
</p><p><b>O 可选的: 为配置文件建立符号连接</b>
</p><p>如果你使用缺省的位置安装Jabberd, 你可能希望在 /etc 目录为配置文件新建一个符号连接(作为超级用户). 这将使你更容易找到和修改它们:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>          <span class="kw2">ln</span> <span class="re5">-s</span> <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>etc<span class="sy0">/</span>jabberd<span class="sy0">/</span> <span class="sy0">/</span>etc<span class="sy0">/</span>jabberd</pre></div></div>
<p>Jabberd 2现在安装完了. 继续下一章配置你的安装.
</p>
<h2> <span class="mw-headline" id=".E5.9F.BA.E6.9C.AC.E9.85.8D.E7.BD.AE">基本配置</span></h2>
<p>本章为大多数基本配置和你的Jabberd 2的测试提供一个快速的路线图. Jabberd 2的基本安装包含这三个步骤:
</p>
<ol><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.9C.A8sm.xml.E5.92.8Cc2s.xml.E8.AE.BE.E7.BD.AE.E4.B8.BB.E6.9C.BA.E5.90.8D" title="Jabberd2:安装和管理指南">设置主机名(sm.xml和c2s.xml)</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.AF.B9.E4.BA.8E.E5.AD.98.E5.82.A8.E5.92.8C.E9.AA.8C.E8.AF.81.E5.8C.85.E7.9A.84.E8.A7.84.E5.AE.9A.E5.92.8C.E9.85.8D.E7.BD.AE" title="Jabberd2:安装和管理指南">对于存储和验证包的规定和配置</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.B5.8B.E8.AF.95.E6.9C.8D.E5.8A.A1.E5.99.A8" title="Jabberd2:安装和管理指南">测试服务器</a>
</li></ol>
<p>Jabberd 2是通过它的6个XML文件来配置的. 对于缺省的安装, 这些配置文件在 /usr/local/etc/jabberd/, 而且它们可以从 /etc/jabberd 访问，如果你为这个目录建立了符号连接的话. 注意如果你在前面第二章收集了必需的信息，本章更容易完成.
</p>
<h3> <span class="mw-headline" id=".E5.9C.A8sm.xml.E5.92.8Cc2s.xml.E8.AE.BE.E7.BD.AE.E4.B8.BB.E6.9C.BA.E5.90.8D">在sm.xml和c2s.xml设置主机名</span></h3>
<p>基本配置的第一步包括在sm.xml 和 c2s.xml设置主机名.
</p><p><b>P 参数: Hostname</b>
</p><p>你的服务器主机名(网络ID) 必须同时在 c2s.xml 和 sm.xml 里设置，这样这个 ID 为你的服务器提供一个可解析的引用. 在 c2s.xml 里，这个 ID 位于头标记为 Local network configuration 的位置(大约第63行), 在 sm.xml 里这个 ID 位于 Session manager configuration (第一行). 编辑 sm.xml 和 c2s.xml ，这样这个 ID 引用你的服务器.
</p><p>在 sm.xml&#160;:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Session manager configuration --&gt;</span>
      <span class="re1">&lt;sm<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Our ID on the network. Users will have this as the domain part of
             their JID. If you want your server to be accessible from other
             Jabber servers, this ID must be resolvable by DNS.s
             (default: localhost) --&gt;</span>
        <span class="re1">&lt;id<span class="re2">&gt;</span></span><span class="co3">somemachine.somedomain.com</span><span class="re1">&lt;/id<span class="re2">&gt;</span></span></pre></div></div>
<p>在 c2s.xml&#160;:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Local network configuration --&gt;</span>
      <span class="re1">&lt;local<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Who we identify ourselves as. This should correspond to the
             ID (host) that the session manager thinks it is. You can
             specify more than one to support virtual hosts, as long as you
             have additional session manager instances on the network to
             handle those hosts. The realm attribute specifies the auth/reg
             or SASL authentication realm for the host. If the attribute is
             not specified, the realm will be selected by the SASL
             mechanism, or will be the same as the ID itself. Be aware that
             users are assigned to a realm, not a host, so two hosts in the
             same realm will have the same users.
             If no realm is specified, it will be set to be the same as the
             ID. --&gt;</span>
        <span class="re1">&lt;id<span class="re2">&gt;</span></span><span class="co3">somemachine.somedomain.com</span><span class="re1">&lt;/id<span class="re2">&gt;</span></span></pre></div></div>
<p>如在 c2s.xml 文件看到的, 这个主机名将被加到你的用户名后面以建立Jabber ID's, 而且为了Jabberd能通过互联网访问，它必须可通过DNS解析，.
</p><p><b>N 注意</b>
</p><p>你可以仅使用一个域名(somedomain.com) 给你的Jabberd 2网络ID，如果你的DNS之前被配置成解析那个ID到你的服务器. 关于为Jabberd 2设置 DNS SRV 记录的信息，参见<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E8.AE.BE.E7.BD.AEDNS.E7.9A.84SRV.E8.AE.B0.E5.BD.95" title="Jabberd2:安装和管理指南">5.7章</a>.
</p>
<h3> <span class="mw-headline" id=".E5.AF.B9.E5.AD.98.E5.82.A8.E5.92.8C.E9.AA.8C.E8.AF.81.E5.8C.85.E7.9A.84.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AE">对存储和验证包的提供和配置</span></h3>
<p>要让Jabberd 2和你选择的外部存储和验证包一起工作，包括这些步骤:
</p>
<ol><li> 提供和Jabberd 2协作的外部包
</li><li> 为你选择的存储包配置 sm.xml
</li><li> 为你选择的验证包配置 c2s.xml
</li></ol>
<p>大多数 Jabberd 2 安装包依赖于单个包, 例如 MySQL, 来同时提供存储和验证服务. 如果你的安装包依赖于单个的包, 你将需要为Jabberd 2配置这个包，并且在 sm.xml 和 c2s.xml里都加入类似的连接信息.
</p><p><b>P 参数: 数据存储和验证包</b>
</p><p>跟随本指南，为你选择的存储和验证包完成有关的条款. (用于存储的 Berkeley DB, MySQL 或 PostgreSQL. 用于验证的 Berkeley DB, MySQL, PostgreSQL, PAM 或 OpenLDAP.)
</p><p>跳到你选择的外部存储包开始: 
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEBerkeleyDB" title="Jabberd2:安装和管理指南">提供和配置Berkeley DB</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEMySQL" title="Jabberd2:安装和管理指南">提供和配置MySQL</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEPostgreSQL" title="Jabberd2:安装和管理指南">提供和配置PostgreSQL</a>
</li></ul>
<p>然后你将被引导继续提供(如果需要) 和配置你的验证包. 一旦你的外部包准备好了, 并且Jabberd被配置好使用它们, 你将进入<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.B5.8B.E8.AF.95.E6.9C.8D.E5.8A.A1.E5.99.A8" title="Jabberd2:安装和管理指南">服务器测试</a>.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section04/html2pdf">以pdf格式查看</a>
</p>
<h3> <span class="mw-headline" id=".E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEBerkeleyDB">提供和配置BerkeleyDB</span></h3>
<p><a rel="nofollow" class="external text" href="http://www.sleepycat.com/">Berkeley DB</a> 提供最简单的方法来让你的Jabberd 2服务器快速启动运行. Jabberd 2需要的最低版本是 4.1.24 或更高.
</p>
<h4> <span class="mw-headline" id=".E6.8F.90.E4.BE.9BBerkeleyDB">提供BerkeleyDB</span></h4>
<p>如果你把Berkeley DB用来存储或验证，请完成本节. 让你的系统提供Berkeley DB是很简单的. Berkeley DB只需要一个目录存储数据文件, 而jabber用户或组拥有这个目录的所有权.
</p><p><b>P 参数: 数据目录</b>
</p>
<dl><dd>新建一个目录并为Berkeley DB设置权限 (使用之前已经建立的用户和组). (以超级用户身份):
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>           <span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>var<span class="sy0">/</span>jabberd<span class="sy0">/</span>db
           <span class="kw2">chown</span> <span class="re5">-R</span> jabber:jabber <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>var<span class="sy0">/</span>jabberd</pre></div></div>
<p>现在Berkeley DB已经准备好用于Jabberd了.
</p>
<h4> <span class="mw-headline" id=".E9.85.8D.E7.BD.AE.E5.AD.98.E5.82.A8.E4.BD.BF.E7.94.A8BerkeleyDB.28sm.xml.29">配置存储使用BerkeleyDB(sm.xml)</span></h4>
<p>如果你使用Berkeley DB来存储，请完成本节. Jabberd 2要求的最低配置是使用Berkeley DB作为后端存储. 简单地设定使用的驱动并指定数据库的位置.
</p><p>在 <i>sm.xml</i> 里的 <i>Storage database configuration</i> (存储数据库配置)段落, 编辑 <i>driver</i> 使用 <i>db</i> (Berkeley DB):
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Storage database configuration --&gt;</span>
        <span class="re1">&lt;storage<span class="re2">&gt;</span></span>
          <span class="co1">&lt;!-- By default, we use the MySQL driver for all storage --&gt;</span>
          <span class="re1">&lt;driver<span class="re2">&gt;</span></span><span class="co3">db</span><span class="re1">&lt;/driver<span class="re2">&gt;</span></span></pre></div></div>
<p><b>P 参数: 数据目录</b>
</p>
<dl><dd>在 <i>sm.xml</i> 里的 <i>Berkeley DB driver configuration</i> 段落, 为你的数据库设定路径 (在上面 4.3.1. 建立的):
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>          <span class="co1">&lt;!-- Berkeley DB driver configuration --&gt;</span>
          <span class="re1">&lt;db<span class="re2">&gt;</span></span>
            <span class="co1">&lt;!-- Directory to store database files under --&gt;</span>
            <span class="re1">&lt;path<span class="re2">&gt;</span></span><span class="co3">/usr/local/var/jabberd/db</span><span class="re1">&lt;/path<span class="re2">&gt;</span></span>
&#160;
            <span class="co1">&lt;!-- Synchronize the database to disk after each write. If you
                 disable this, database accesses may be faster, but data may
                 be lost if jabberd crashes. --&gt;</span>
            <span class="re1">&lt;sync</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;/db<span class="re2">&gt;</span></span></pre></div></div>
<p>现在Jabberd 2贝配置成使用Berkeley DB存储了.
</p><p>如果你希望使用别的Berkeley DB之外的包作为验证包, 跳到你选择的验证包:
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEPAM" title="Jabberd2:安装和管理指南">提供和配置PAM</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEOpenLDAP" title="Jabberd2:安装和管理指南">提供和配置OpenLDAP</a>
</li></ul>
<p>否则, 继续到 4.3.3. 直接往下完成你的Jabberd 2配置.
</p>
<h4> <span class="mw-headline" id=".E9.85.8D.E7.BD.AE.E9.AA.8C.E8.AF.81.E4.BD.BF.E7.94.A8BerkeleyDB.28c2s.xml.29">配置验证使用BerkeleyDB(c2s.xml)</span></h4>
<p>如果你使用Berkeley DB来验证，请完成本节. Jabberd 2对于Berkeley DB验证配置的要求同上，除了包含在 <i>c2s.xml</i> 的信息.
</p><p>在 <i>c2s.xml</i> 的 <i>Authentication/registration database configuration</i> （验证/注册 数据库配置）段落, 编辑 <i>module</i> 使用 <i>db</i> (Berkeley DB):
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Authentication/registration database configuration --&gt;</span>
      <span class="re1">&lt;authreg<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Backend module to use --&gt;</span>
        <span class="re1">&lt;module<span class="re2">&gt;</span></span><span class="co3">db</span><span class="re1">&lt;/module<span class="re2">&gt;</span></span></pre></div></div>
<p><b>P 参数: 数据目录</b>
</p>
<dl><dd>在 <i>c2s.xml</i> 的 <i>Berkeley DB module configuration</i> 段落, 为你的数据库设定路径 (在上面 4.3.1. 建立的):
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>          <span class="co1">&lt;!-- Berkeley DB module configuration --&gt;</span>
          <span class="re1">&lt;db<span class="re2">&gt;</span></span>
            <span class="co1">&lt;!-- Directory to store database files under --&gt;</span>
            <span class="re1">&lt;path<span class="re2">&gt;</span></span><span class="co3">/usr/local/var/jabberd/db</span><span class="re1">&lt;/path<span class="re2">&gt;</span></span>
&#160;
            <span class="co1">&lt;!-- Synchronize the database to disk after each write. If you
                 disable this, database accesses may be faster, but data may
                 be lost if jabberd crashes. --&gt;</span>
            <span class="re1">&lt;sync</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;/db<span class="re2">&gt;</span></span></pre></div></div>
<p>你的Jabberd 2的存储和验证配置现在完成了. 在转移到其他配置任务(例如 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.80.9A.E7.94.A8.E9.85.8D.E7.BD.AE.E4.BB.BB.E5.8A.A1" title="Jabberd2:安装和管理指南">第五章</a> 的配置SSL)之前，跳到 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.B5.8B.E8.AF.95.E6.9C.8D.E5.8A.A1.E5.99.A8" title="Jabberd2:安装和管理指南">测试服务器</a> 去开始测试你的服务器.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section04_3/html2pdf">以PDF格式查看</a>
</p>
<h3> <span class="mw-headline" id=".E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEMySQL">提供和配置MySQL</span></h3>
<p><a rel="nofollow" class="external text" href="http://www.mysql.com/">MySQL</a> 是用于存储和验证的缺省的Jabberd 2包. 
</p>
<h4> <span class="mw-headline" id=".E6.8F.90.E4.BE.9BMySQL">提供MySQL</span></h4>
<p>如果你使用MySQL存储 和/或 验证请完成本节. 为了给Jabberd配置MySQL, 你必须运行Jabberd 2分发包里带的安装脚本. 脚本运行之后, 你应该新建衣蛾用户并赋予数据库权限. 
</p><p>首先, 运行MySQL安装脚本. 这个脚本位于Jabberd源码目录下的/tools子目录. 切换到tools目录并启动MySQL控制台(MySQL服务应该已经在运行中). 然后, 从MySQL控制台运行 <i>db-setup.mysql</i> 脚本: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>   mysql <span class="re5">-u</span> root <span class="re5">-p</span>
   mysql<span class="sy0">&gt;</span>\. db-setup.mysql</pre></div></div>
<p>现在一个用于Jabberd的数据库已经存在于MySQL数据目录, 新建一个MySQL用户给Jabberd用来连接MySQL服务器.
</p><p><b>P 参数: MySQL用户名和密码</b>
</p>
<dl><dd>从MySQL控制台, 运行以下SQL指令, 用你选择的Jabberd MySQL用户的密码替换 <i>secret</i>: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre> GRANT <span class="kw1">select</span>,insert,delete,update ON jabberd2.<span class="sy0">*</span> 
      to jabberd2<span class="sy0">@</span>localhost IDENTIFIED by <span class="st0">'secret'</span>;</pre></div></div>
<p>注意密码 secret 是Jabberd配置文件中用于MySQL的缺省密码.
</p><p>MySQL现在准备好用于Jabberd了.
</p><p><b>N 注意: 缺省的MySQL Socket</b>
</p>
<dl><dd>Jabberd 2稳定版3 连接MySQL服务器的socket位于 ‘’/tmp/mysql.sock‘’ . 从源码安装MySQL时的缺省socket是 ‘’/var/lib/mysql/mysql.sock‘’ . 如果 ‘’/tmp/mysql.sock‘’ 不存在,你需要新建一个软连接: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw2">ln</span> <span class="re5">-s</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>mysql<span class="sy0">/</span>mysql.sock <span class="sy0">/</span>tmp<span class="sy0">/</span>mysql.sock</pre></div></div>
<p>如果你不确定你的MySQL服务器的socket在哪, 参考你的MySQL配置文件(通常位于 <i>/etc/my.cnf</i> 或 <i>/etc/mysql/my.cnf</i> ).
</p>
<h4> <span class="mw-headline" id=".E9.85.8D.E7.BD.AE.E5.AD.98.E5.82.A8.E4.BD.BF.E7.94.A8MySQL.28sm.xml.29">配置存储使用MySQL(sm.xml)</span></h4>
<p>如果你使用MySQL存储，请完成本节. 大多数使用MySQL存储的安装只需要设置驱动, 用户和密码.
</p><p>在 <i>sm.xml</i> 里标为 <i>Storage database configuration</i> 的段落下, 确保 <i>driver</i> 是用 <i>mysql</i> . (缺省这driver应该被设为mysql.): 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre> <span class="co1">&lt;!-- Storage database configuration --&gt;</span>
        <span class="re1">&lt;storage<span class="re2">&gt;</span></span>
          <span class="co1">&lt;!-- By default, we use the MySQL driver for all storage --&gt;</span>
          <span class="re1">&lt;driver<span class="re2">&gt;</span></span><span class="co3">mysql</span><span class="re1">&lt;/driver<span class="re2">&gt;</span></span></pre></div></div>
<p><b>P 参数: MySQL用户名和密码</b>
</p>
<dl><dd>在 <i>sm.xml</i> 里标为 <i>MySQL driver configuration</i> 的段落下, 把 <i>secret</i> 替换成你的MySQL密码. 如果你不使用缺省用户(jabberd2)则还要修改用户名&#160;: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre> <span class="co1">&lt;!-- MySQL driver configuration --&gt;</span>
      <span class="re1">&lt;mysql<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Database server host and port --&gt;</span>
        <span class="re1">&lt;host<span class="re2">&gt;</span></span><span class="co3">localhost</span><span class="re1">&lt;/host<span class="re2">&gt;</span></span>
        <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">3306</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Database name --&gt;</span>
        <span class="re1">&lt;dbname<span class="re2">&gt;</span></span><span class="co3">jabberd2</span><span class="re1">&lt;/dbname<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Database username and password --&gt;</span>
        <span class="re1">&lt;user<span class="re2">&gt;</span></span><span class="co3">jabberd2</span><span class="re1">&lt;/user<span class="re2">&gt;</span></span>
        <span class="re1">&lt;pass<span class="re2">&gt;</span></span><span class="co3">secret</span><span class="re1">&lt;/pass<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Transaction support. If this is commented out, transactions
             will be disabled. This might make database accesses faster,
             but data may be lost if jabberd crashes.
&#160;
             This will need to be disabled if you are using a MySQL
             earlier than v3.23.xx, as transaction support did not appear
             until this version. --&gt;</span>
        <span class="re1">&lt;transactions</span><span class="re2">/&gt;</span></pre></div></div>
<p>注意只有你的MySQL服务器运行在另一个主机上你才应该修改host设置. 只有你的MySQL服务器运行在一个非标准端口(3306是MySQL安装后的缺省端口)你才应该修改port设置. transaction support 段落则是不言自明的了.
</p><p>现在Jabberd 2已经配置成使用MySQL来存储了.
</p><p>如果你希望使用一个不同于MySQL的验证包, 跳到你选择的验证包:
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEPAM" title="Jabberd2:安装和管理指南">提供和配置PAM</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEOpenLDAP" title="Jabberd2:安装和管理指南">提供和配置OpenLDAP</a>
</li></ul>
<p>否则, 继续到 4.4.3. 直接往下完成你的Jabberd 2配置.
</p>
<h4> <span class="mw-headline" id=".E9.85.8D.E7.BD.AE.E9.AA.8C.E8.AF.81.E4.BD.BF.E7.94.A8MySQL.28c2s.xml.29">配置验证使用MySQL(c2s.xml)</span></h4>
<p>如果你使用MySQL来验证，请完成本节. Jabberd 2对于MySQL验证配置的要求同上，除了包含在 <i>c2s.xml</i> 的信息.
</p><p>在 <i>c2s.xml</i> 的 <i>Authentication/registration database configuration</i> （验证/注册 数据库配置）段落, 确保 <i>driver</i> 使用 <i>mysql</i> (驱动缺省应该就是mysql):
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Authentication/registration database configuration --&gt;</span>
      <span class="re1">&lt;authreg<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Backend module to use --&gt;</span>
        <span class="re1">&lt;module<span class="re2">&gt;</span></span><span class="co3">mysql</span><span class="re1">&lt;/module<span class="re2">&gt;</span></span></pre></div></div>
<p><b>P 参数: MySQL用户名和密码</b>
</p>
<dl><dd>在 <i>c2s.xml</i> 的 <i>MySQL module configuration</i> 段落, 把 <i>secret</i> 替换成你的MySQL密码. 如果你不使用缺省用户(jabberd2)则还要修改用户名&#160;: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- MySQL module configuration --&gt;</span>
      <span class="re1">&lt;mysql<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Database server host and port --&gt;</span>
        <span class="re1">&lt;host<span class="re2">&gt;</span></span><span class="co3">localhost</span><span class="re1">&lt;/host<span class="re2">&gt;</span></span>
        <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">3306</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Database name --&gt;</span>
        <span class="re1">&lt;dbname<span class="re2">&gt;</span></span><span class="co3">jabberd2</span><span class="re1">&lt;/dbname<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Database username and password --&gt;</span>
        <span class="re1">&lt;user<span class="re2">&gt;</span></span><span class="co3">jabberd2</span><span class="re1">&lt;/user<span class="re2">&gt;</span></span>
        <span class="re1">&lt;pass<span class="re2">&gt;</span></span><span class="co3">secret</span><span class="re1">&lt;/pass<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/mysql<span class="re2">&gt;</span></span></pre></div></div>
<p>注意只有你的MySQL服务器运行在另一个主机上你才应该修改host设置. 只有你的MySQL服务器运行在一个非标准端口(3306是MySQL安装后的缺省端口)你才应该修改port设置.
</p><p>你的Jabberd 2的存储和验证配置现在完成了. 在转移到其他配置任务(例如 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.80.9A.E7.94.A8.E9.85.8D.E7.BD.AE.E4.BB.BB.E5.8A.A1" title="Jabberd2:安装和管理指南">第五章</a> 的配置SSL)之前，跳到 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.B5.8B.E8.AF.95.E6.9C.8D.E5.8A.A1.E5.99.A8" title="Jabberd2:安装和管理指南">测试服务器</a> 去开始测试你的服务器.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section04_4/html2pdf">以PDF格式查看</a>
</p>
<h3> <span class="mw-headline" id=".E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEPostgreSQL">提供和配置PostgreSQL</span></h3>
<p><a rel="nofollow" class="external text" href="http://www.postgresql.org/">PostgreSQL</a> 和MySQL一样，提供一个非常易于管理的后端用于存储和验证. 和MySQL不同的是, PostgreSQL提供了更好的 unicode支持.
</p>
<h4> <span class="mw-headline" id=".E6.8F.90.E4.BE.9BPostgreSQL">提供PostgreSQL</span></h4>
<p>如果你使用PostgreSQL存储 和/或 验证请完成本节. 为了给Jabberd配置PostgreSQL, 你必须新建一个数据库，新建一个PostgreSQL用户并运行Jabberd 2分发包里带的PostgreSQL脚本. 
</p><p>为Jabberd新建数据库. (PostgreSQL服务器应该已经在运行): 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      createdb <span class="re5">-U</span> postgres jabberd2</pre></div></div>
<p>以上命令讲新建一个数据库，你可以在那个数据库运行接哦本来安装Jabberd PostgreSQL数据库.
</p><p><b>N 注意: Unicode支持</b>
</p>
<dl><dd>如果你希望为你的PostgreSQL数据库激活Unicode支持, 把以上命令修改如下: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      createdb <span class="re5">-U</span> postgres <span class="re5">-E</span> UNICODE jabberd2</pre></div></div>
<p><b>P 参数: PostgreSQL用户名和密码</b>
</p>
<dl><dd>新建你的Jabberd数据库用户, 输入以下命令: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      createuser <span class="re5">-P</span> <span class="re5">-U</span> postgres jabberd2</pre></div></div>
<p>这个命令将初始化一个交互用户创建脚本. 当看到提示, 输入将来用于连接到你的PostgreSQL数据库的Jabberd的密码: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      Enter password <span class="kw1">for</span> user <span class="st0">&quot;jabberd2&quot;</span>:
      Enter it again:
      Shall the new user be allowed to create databases? <span class="br0">&#40;</span>y<span class="sy0">/</span>n<span class="br0">&#41;</span> n
      Shall the new user be allowed to create <span class="kw2">more</span> new <span class="kw2">users</span>? <span class="br0">&#40;</span>y<span class="sy0">/</span>n<span class="br0">&#41;</span> n
      CREATE USER</pre></div></div>
<p><i>CREATE USER</i> 信息表示命令执行成功.
</p><p>在你的jabberd用户创建之后, 你已经准备好运行PostgreSQL安装脚本了. 这个脚本位于 '\[Jabberd Source Files\]\/tools'. 切换到 <i>tools</i> 目录并以jabberd2用户身份启动PostgreSQL控制台: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      psql <span class="re5">-U</span> jabberd2 jabberd2</pre></div></div>
<p>然后, 从PostgreSQL控制台运行 <i>db-setup.pgsql</i> 脚本: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="re2">jabberd2=</span><span class="sy0">&gt;</span>\i db-setup.pgsql</pre></div></div>
<p>PostgreSQL现在准备好用于Jabberd了.
</p>
<h4> <span class="mw-headline" id=".E9.85.8D.E7.BD.AE.E5.AD.98.E5.82.A8.E4.BD.BF.E7.94.A8PostgreSQL.28sm.xml.29">配置存储使用PostgreSQL(sm.xml)</span></h4>
<p>如果你使用PostgreSQL存储，请完成本节. 大多数使用PostgreSQL存储的安装只需要设置驱动, 用户和密码.
</p><p>在 <i>sm.xml</i> 里标为 <i>Storage database configuration</i> 的段落下, 确保 <i>driver</i> 是用 pgsql (PostgreSQL): 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Storage database configuration --&gt;</span>
        <span class="re1">&lt;storage<span class="re2">&gt;</span></span>
          <span class="co1">&lt;!-- By default, we use the MySQL driver for all storage --&gt;</span>
          <span class="re1">&lt;driver<span class="re2">&gt;</span></span><span class="co3">pgsql</span><span class="re1">&lt;/driver<span class="re2">&gt;</span></span></pre></div></div>
<p><b>P 参数: PostgreSQL用户名和密码</b>
</p>
<dl><dd>在 <i>sm.xml</i> 里标为 <i>PostgreSQL driver configuration</i> 的段落下, 把 <i>secret</i> 替换成你的PostgreSQL密码. 如果你不使用缺省用户(jabberd2)则还要修改用户名&#160;: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- PostgreSQL driver configuration --&gt;</span>
      <span class="re1">&lt;pgsql<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Database server host and port --&gt;</span>
        <span class="re1">&lt;host<span class="re2">&gt;</span></span><span class="co3">localhost</span><span class="re1">&lt;/host<span class="re2">&gt;</span></span>
        <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">5432</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Database name --&gt;</span>
        <span class="re1">&lt;dbname<span class="re2">&gt;</span></span><span class="co3">jabberd2</span><span class="re1">&lt;/dbname<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Database username and password --&gt;</span>
        <span class="re1">&lt;user<span class="re2">&gt;</span></span><span class="co3">jabberd2</span><span class="re1">&lt;/user<span class="re2">&gt;</span></span>
        <span class="re1">&lt;pass<span class="re2">&gt;</span></span><span class="co3">secret</span><span class="re1">&lt;/pass<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Transaction support. If this is commented out, transactions
             will be disabled. This might make database accesses faster,
             but data may be lost if jabberd crashes. --&gt;</span>
        <span class="re1">&lt;transactions</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/pgsql<span class="re2">&gt;</span></span></pre></div></div>
<p>注意只有你的PostgreSQL服务器运行在另一个主机上你才应该修改host设置. 只有你的PostgreSQL服务器运行在一个非标准端口(5432是PostgreSQL安装后的缺省端口)你才应该修改port设置. transaction support 段落则是不言自明的了.
</p><p>现在Jabberd 2已经配置成使用PostgreSQL来存储了.
</p><p>如果你希望使用一个不同于PostgreSQL的验证包, 跳到你选择的验证包:
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEPAM" title="Jabberd2:安装和管理指南">提供和配置PAM</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEOpenLDAP" title="Jabberd2:安装和管理指南">提供和配置OpenLDAP</a>
</li></ul>
<p>否则, 继续到 4.5.3. 直接往下完成你的Jabberd 2配置.
</p>
<h4> <span class="mw-headline" id=".E9.85.8D.E7.BD.AE.E9.AA.8C.E8.AF.81.E4.BD.BF.E7.94.A8PostgreSQL.28c2s.xml.29">配置验证使用PostgreSQL(c2s.xml)</span></h4>
<p>如果你使用PostgreSQL来验证，请完成本节. Jabberd 2对于PostgreSQL验证配置的要求同上，除了包含在 <i>c2s.xml</i> 的信息.
</p><p>在 <i>c2s.xml</i> 的 <i>Authentication/registration database configuration</i> （验证/注册 数据库配置）段落, 确保 <i>driver</i> 使用pgsql (PostgreSQL):
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>     <span class="co1">&lt;!-- Authentication/registration database configuration --&gt;</span>
      <span class="re1">&lt;authreg<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Backend module to use --&gt;</span>
        <span class="re1">&lt;module<span class="re2">&gt;</span></span><span class="co3">pgsql</span><span class="re1">&lt;/module<span class="re2">&gt;</span></span></pre></div></div>
<p><b>P 参数: PostgreSQL用户名和密码</b>
</p>
<dl><dd>在 <i>c2s.xml</i> 的 <i>PostgreSQL module configuration</i> 段落, 把 <i>secret</i> 替换成你的PostgreSQL密码. 如果你不使用缺省用户(jabberd2)则还要修改用户名&#160;: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- PostgreSQL module configuration --&gt;</span>
      <span class="re1">&lt;pgsql<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Database server host and port --&gt;</span>
        <span class="re1">&lt;host<span class="re2">&gt;</span></span><span class="co3">localhost</span><span class="re1">&lt;/host<span class="re2">&gt;</span></span>
        <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">5432</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Database name --&gt;</span>
        <span class="re1">&lt;dbname<span class="re2">&gt;</span></span><span class="co3">jabberd2</span><span class="re1">&lt;/dbname<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Database username and password --&gt;</span>
        <span class="re1">&lt;user<span class="re2">&gt;</span></span><span class="co3">jabberd2</span><span class="re1">&lt;/user<span class="re2">&gt;</span></span>
        <span class="re1">&lt;pass<span class="re2">&gt;</span></span><span class="co3">secret</span><span class="re1">&lt;/pass<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/pgsql<span class="re2">&gt;</span></span></pre></div></div>
<p>注意只有你的PostgreSQL服务器运行在另一个主机上你才应该修改host设置. 只有你的PostgreSQL服务器运行在一个非标准端口(5432是PostgreSQL安装后的缺省端口)你才应该修改port设置.
</p><p>你的Jabberd 2的存储和验证配置现在完成了. 在转移到其他配置任务(例如 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.80.9A.E7.94.A8.E9.85.8D.E7.BD.AE.E4.BB.BB.E5.8A.A1" title="Jabberd2:安装和管理指南">第五章</a> 的配置SSL)之前，跳到 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.B5.8B.E8.AF.95.E6.9C.8D.E5.8A.A1.E5.99.A8" title="Jabberd2:安装和管理指南">测试服务器</a> 去开始测试你的服务器.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section04_5/html2pdf">以PDF格式查看</a>
</p>
<h3> <span class="mw-headline" id=".E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEPAM">提供和配置PAM</span></h3>
<p><a rel="nofollow" class="external text" href="http://www.kernel.org/pub/linux/libs/pam/">PAM</a>(Linux的可插拔验证模块)为Jabberd 2提供内建的验证支持.
</p>
<h4> <span class="mw-headline" id=".E6.8F.90.E4.BE.9BPAM">提供PAM</span></h4>
<p>如果你使用PAM验证请完成本节. 通过PAM验证需要一个有效的PAM配置文件 <i>jabberd</i> . 对于多数系统, 这个配置文件应该位于 <i>/etc/pam.d</i> .创建 Jabberd PAM配置文件超出了本指南的范围; 无论如何, 创建这个配置文件有个捷径. 拷贝 <i>system-auth</i> 配置文件到 <i>jabberd</i> (以root身份): 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw2">cp</span> <span class="sy0">/</span>etc<span class="sy0">/</span>pam.d<span class="sy0">/</span>system-auth <span class="sy0">/</span>etc<span class="sy0">/</span>pam.d<span class="sy0">/</span>jabberd</pre></div></div>
<p>这将新建一个PAM配置文件给Jabberd2使用.
</p><p><b>I 重要: PAM验证需要访问PAM数据库</b>
</p>
<dl><dd>通过PAM做Jabberd验证需要Jabberd2有权访问PAM数据库. 对多数系统, 该数据库就是 <i>/etc/shadow</i> 文件. 因此, Jabberd2必须以root身份运行, 或jabberd用户必须被授予对此文件的读权限. 以root身份运行Jabberd2服务是不推荐的.
</dd></dl>
<p><b>N 注意: Winbind可用于集成NT验证到PAM</b>
</p>
<dl><dd>来自Samba项目的Winbind包可被用于支持通过Windows NT做Jabber验证. 当Winbind成功安装并配置之后, 配置Jabberd使用PAM来验证. 然后新建jabberd PAM配置文件如下: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>      auth       required     pam_winbind.so
      password   required     pam_winbind.so
      account    required     pam_winbind.so
      session    required     pam_winbind.so</pre></div></div>
<p>PAM现在准备好用于Jabberd了. 接下来开始配置通过PAM做Jabberd 2验证.
</p>
<h4> <span class="mw-headline" id=".E9.85.8D.E7.BD.AE.E9.AA.8C.E8.AF.81.E4.BD.BF.E7.94.A8PAM.28c2s.xml.29">配置验证使用PAM(c2s.xml)</span></h4>
<p>如果你使用PAM来验证，请完成本节. Jabberd 2需要一点配置来使用PAM.
</p><p>在 <i>c2s.xml</i> 的 <i>Authentication/registration database configuration</i> （验证/注册 数据库配置）段落, 编辑 <i>module</i> 使用pam:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Authentication/registration database configuration --&gt;</span>
      <span class="re1">&lt;authreg<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Backend module to use --&gt;</span>
        <span class="re1">&lt;module<span class="re2">&gt;</span></span><span class="co3">pam</span><span class="re1">&lt;/module<span class="re2">&gt;</span></span></pre></div></div>
<p>用户不能创建他们自己的帐号当使用PAM验证时. 所以, 应该禁止公开帐号注册, 同时激活 <i>auto-create</i> ,这样会话管理器可以在用户第一次登录时自动创建帐号.
</p><p>在 <i>c2s.xml</i> 里的 <i>Authentication/registration database configuration</i> 段落里查找 <i>Registration configuration</i> 子段落. 如下注释掉 <i>enable</i> 标签将禁止公开注册: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Registration configuration --&gt;</span>
      <span class="re1">&lt;register<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Account registration is enabled by default (provided the
             auth/reg module in use supports it). Comment this out to
             disable. --&gt;</span>
        <span class="co1">&lt;!-- &lt;enable/&gt; --&gt;</span></pre></div></div>
<p>在 <i>sm.xml</i> 里标为 <i>User options</i> 的段落 (靠近文件底部), 如下取消注释 <i>auto-create</i> 标签，这样会话管理器将在用户初次登录时创建一个信的Jabberd2帐号: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- User options --&gt;</span>
      <span class="re1">&lt;user<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- By default, users must explicitly created before they can start
             a session. The creation process is usually triggered by a c2s
             component in response to a client registering a new user.
&#160;
             Enableing this option will make it so that a user create will be
             triggered the first time a non-existant user attempts to start
             a session. This is useful if you already have users in an
             external authentication database (eg LDAP) and you don't want
             them to have to register. --&gt;</span>
        <span class="re1">&lt;auto-create</span><span class="re2">/&gt;</span></pre></div></div>
<p>你的Jabberd 2的存储和验证配置现在完成了(前提是你得提供和配置好存储包). 在转移到其他配置任务(例如 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.80.9A.E7.94.A8.E9.85.8D.E7.BD.AE.E4.BB.BB.E5.8A.A1" title="Jabberd2:安装和管理指南">第五章</a> 的配置SSL)之前，跳到 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.B5.8B.E8.AF.95.E6.9C.8D.E5.8A.A1.E5.99.A8" title="Jabberd2:安装和管理指南">测试服务器</a> 去开始测试你的服务器.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section04_6/html2pdf">以PDF格式查看</a>
</p>
<h3> <span class="mw-headline" id=".E6.8F.90.E4.BE.9B.E5.92.8C.E9.85.8D.E7.BD.AEOpenLDAP">提供和配置OpenLDAP</span></h3>
<p><a rel="nofollow" class="external text" href="http://www.openldap.org/">OpenLDAP</a>提供分布式跨平台跨地区的验证支持. Jabberd 2要求的最低版本是OpenLDAP 2.1.0.
</p>
<h4> <span class="mw-headline" id=".E6.8F.90.E4.BE.9BOpenLDAP">提供OpenLDAP </span></h4>
<p>如果你使用OpenLDAP验证请完成本节. 你安装的OpenLDAP应该不需要为Jabberd 2特别配置; 无论如何, 在撰写本文的此刻(Jabberd 2稳定版3), 关于使用Jabberd连接OpenLDAP v3服务器有一个重要的问题. 目前Jabberd 2使用v2的语法. 缺省的, OpenLDAP v3服务器要求使用v3语法.
</p><p>有一个办法来解决这个问题. 添加以下声明到你的 slapd.conf 文件, 并重启你的 slapd 守护进程: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>      allow bind_v2</pre></div></div>
<h4> <span class="mw-headline" id=".E9.85.8D.E7.BD.AE.E9.AA.8C.E8.AF.81.E4.BD.BF.E7.94.A8OpenLDAP.28c2s.xml.29">配置验证使用OpenLDAP(c2s.xml)</span></h4>
<p>如果你使用OpenLDAP来验证，请完成本节. OpenLDAP配置更详细，因为配置需要主机，连接以及查询设置.
</p><p>在 <i>c2s.xml</i> 的 <i>Authentication/registration database configuration</i> （验证/注册 数据库配置）段落, 编辑 <i>driver</i> 使用ldap(OpenLDAP):
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Authentication/registration database configuration --&gt;</span>
      <span class="re1">&lt;authreg<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Backend module to use --&gt;</span>
        <span class="re1">&lt;module<span class="re2">&gt;</span></span><span class="co3">ldap</span><span class="re1">&lt;module<span class="re2">&gt;</span></span></pre></div></div>
<p><b>P 参数: LDAP连接设置</b>
</p>
<dl><dd>在 <i>c2s.xml</i> 的 <i>LDAP module configuration</i> 的第一个部分处理连接你的OpenLDAP服务器所需要的设置. <i>host</i> 必须要么是这个OpenLDAP服务器的可以被服务器解析的主机名要么是它的IP地址. 端口389是OpenLDAP服务器的缺省端口, 所以大部分情况下, <i>port</i> 应该放在那不动. <i>v3</i> 标签指明你的OpenLDAP服务器是否v3版本. 如果是，取消这个标签的注释. 如果使用OpenLDAP v2服务器则保留注释 <i>v3</i> 标签. 最后, 如果你的服务器支持加密(参见下面的备注)，则取消注释 <i>starttls</i> 或 <i>ssl</i> 标签: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- LDAP module configuration --&gt;</span>
      <span class="re1">&lt;ldap<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- LDAP server host and port (default: 389) --&gt;</span>
        <span class="re1">&lt;host<span class="re2">&gt;</span></span><span class="co3">ldap.example.com</span><span class="re1">&lt;/host<span class="re2">&gt;</span></span>
        <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">389</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Use LDAP v3 if possible. If disabled, v2 will be used.
             Encryption options are only available if v3 is enabled. --&gt;</span>
        <span class="co1">&lt;!--
        &lt;v3/&gt;
        --&gt;</span>
&#160;
        <span class="co1">&lt;!-- Encryption. If enabled, this will create an encrypted channel
             to the LDAP server using the LDAP STARTTLS mechanism. --&gt;</span>
        <span class="co1">&lt;!--
        &lt;starttls/&gt;
        --&gt;</span>
&#160;
        <span class="co1">&lt;!-- Encryption. If enabled, this will create an encrypted channel
             to the server using the old-style &quot;ldaps://&quot; mechanism. It is
             recommended that you use &lt;starttls/&gt; instead of this. --&gt;</span>
        <span class="co1">&lt;!--
        &lt;ssl/&gt;
        --&gt;</span></pre></div></div>
<p><b>I 重要: 密码是明文传送的</b>
</p>
<dl><dd>目前本本的Jabberd 2 (stable 3)通过OpenLDAP验证时需要使用明文密码. 所以, 允许加密是绝对重要的. 如上所述, 加密选项只在连接OpenLDAP v3服务器时有效. 
</dd></dl>
<p><b>N 注意: 加密选项</b>
</p>
<dl><dd>作者已经成功的使用Jabberd 2和STARTTLS连接到一个OpenLDAP服务器的最新版本. STARTTLS运行于标准端口(389), 所以允许STARTTLS需要做的就是取消注释 <i>v3</i> 和 <i>starttls</i> 标签. 另一方面, 作者未能成功的使用SSL加密连接Jabberd 2和OpenLDAP. 要设置SSL, 你应该指定OpenLDAP SSL 主机名(如果不同于 非SSL 主机名). 通常类似于 <i>ldaps.example.com</i> . 更重要的是, 你应该指定SSL端口. OpenLDAP的标准SSL端口(LDAPS)是636. 最后, 你应该取消注释 <i>ssl</i> 标签.
</dd></dl>
<p><b>P 参数: OpenLDAP用户名和密码</b>
</p>
<dl><dd>OpenLDAP配置的下一部分处理查询OpenLDAP服务器的用户名和密码. 只有你的OpenLDAP服务器不允许为必需的搜索匿名绑定(验证)的时候才需要一个用户名和密码. 如果你的OpenLDAP服务器的连接要求验证取消注释这个段落. 注意 <i>binddn</i> 是用户的完整RDN(相对可分辨名称). 可能类似于 <i>cn=admin,ou=people,dc=example,dc=com</i>&#160;:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- DN to bind as for searches. If unspecified, the searches
           will be done anonymously. --&gt;</span>
      <span class="co1">&lt;!--
      &lt;binddn&gt;cn=Directory Manager&lt;/binddn&gt;
      &lt;bindpw&gt;secret&lt;/bindpw&gt;
      --&gt;</span></pre></div></div>
<p><b>P 参数: LDAP查询设置</b>
</p>
<dl><dd>最后, 必须为OpenLDAP查询设置用户ID和基础DN. 用户ID由 <i>uidattr</i> 标签指定. 这个ID应该是你的用户在特定基础DN(可分辨的名称)的唯一性标识的属性. 换句话说, 当查询指定的基础DN时, 这个特定的 <i>uidattr</i> 应该是唯一性地标识每个用户. <i>basedn</i> 属性指定查询运行的基础. 这可能是该OpenLDAP服务器的顶级DN, 例如 <i>dc=example,dc=com</i> 或着它可能是一个专门存放用户条目的RDN, 例如 <i>ou=people,ou=sales,dc=example,dc=com</i> . 使用一个低级的RDN好像可以加速OpenLDAP查询. 最后, 如果你的配置要求多个域, 你可以在 <i>basedn</i> 标签使用 <i>realm</i> 属性，为每个域指定一个基础DN. 注意如果你没有使用多个域, 就只需要指定一个单独的 <i>basedn</i> 而不需要 <i>realm</i> 属性: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- LDAP attribute that holds the user ID (default: uid) --&gt;</span>
      <span class="re1">&lt;uidattr<span class="re2">&gt;</span></span><span class="co3">uid</span><span class="re1">&lt;/uidattr<span class="re2">&gt;</span></span>
&#160;
      <span class="co1">&lt;!-- base DN of the tree. You should specify a DN for each
           authentication realm declared in the &lt;local/&gt; section above,
           by using the realm attribute. --&gt;</span>
      <span class="re1">&lt;basedn</span> <span class="re0">realm</span>=<span class="st0">'company'</span><span class="re2">&gt;</span><span class="co3">o=Company.com</span><span class="re1">&lt;/basedn<span class="re2">&gt;</span></span>
      <span class="re1">&lt;basedn<span class="re2">&gt;</span></span><span class="co3">o=Example Corp.</span><span class="re1">&lt;/basedn<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/ldap<span class="re2">&gt;</span></span></pre></div></div>
<p>以下是一个笔者工作中的OpenLDAP配置的展示: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- LDAP module configuration --&gt;</span>
      <span class="re1">&lt;ldap<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- LDAP server host and port (default: 389) --&gt;</span>
        <span class="re1">&lt;host<span class="re2">&gt;</span></span><span class="co3">ldap.mydomain.org</span><span class="re1">&lt;/host<span class="re2">&gt;</span></span>
        <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">389</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Use LDAP v3 if possible. If disabled, v2 will be used.
             Encryption options are only available if v3 is enabled. --&gt;</span>
&#160;
        <span class="re1">&lt;v3</span><span class="re2">/&gt;</span>
&#160;
        <span class="co1">&lt;!-- Encryption. If enabled, this will create an encrypted channel
             to the LDAP server using the LDAP STARTTLS mechanism. --&gt;</span>
&#160;
        <span class="re1">&lt;starttls</span><span class="re2">/&gt;</span>
&#160;
        <span class="co1">&lt;!-- Encryption. If enabled, this will create an encrypted channel
             to the server using the old-style &quot;ldaps://&quot; mechanism. It is
             recommended that you use &lt;starttls/&gt; instead of this. --&gt;</span>
        <span class="co1">&lt;!--
        &lt;ssl/&gt;
        --&gt;</span>
&#160;
        <span class="co1">&lt;!-- DN to bind as for searches. If unspecified, the searches
             will be done anonymously. --&gt;</span>
&#160;
        <span class="co1">&lt;!--
        &lt;binddn&gt;cn=admin,dc=mydomain,dc=org&lt;/binddn&gt;
        &lt;bindpw&gt;snip&lt;/bindpw&gt;
        --&gt;</span>          
&#160;
        <span class="co1">&lt;!-- LDAP attribute that holds the user ID (default: uid) --&gt;</span>
        <span class="re1">&lt;uidattr<span class="re2">&gt;</span></span><span class="co3">uid</span><span class="re1">&lt;/uidattr<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- base DN of the tree. You should specify a DN for each
             authentication realm declared in the &lt;local/&gt; section above,
             by using the realm attribute. --&gt;</span>
&#160;
        <span class="re1">&lt;basedn<span class="re2">&gt;</span></span><span class="co3">ou=people,ou=design,dc=mydomain,dc=org</span><span class="re1">&lt;/basedn<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/ldap<span class="re2">&gt;</span></span></pre></div></div>
<p><br />
当使用OpenLDAP验证时用户不能创建他们自己的帐号. 所以, 应该禁止公开帐号注册, 同时激活 <i>auto-create</i> ,这样会话管理器可以在用户第一次登录时自动创建帐号.
</p><p>在 <i>c2s.xml</i> 里的 <i>Authentication/registration database configuration</i> 段落里查找 <i>Registration configuration</i> 子段落. 如下注释掉 <i>enable</i> 标签将禁止公开注册: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Registration configuration --&gt;</span>
      <span class="re1">&lt;register<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Account registration is enabled by default (provided the
             auth/reg module in use supports it). Comment this out to
             disable. --&gt;</span>
        <span class="co1">&lt;!-- &lt;enable/&gt; --&gt;</span></pre></div></div>
<p>在 <i>sm.xml</i> 里标为 <i>User options</i> 的段落 (靠近文件底部), 如下取消注释 <i>auto-create</i> 标签，这样会话管理器将在用户初次登录时创建一个信的Jabberd2帐号: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- User options --&gt;</span>
      <span class="re1">&lt;user<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- By default, users must explicitly created before they can start
             a session. The creation process is usually triggered by a c2s
             component in response to a client registering a new user.
&#160;
             Enableing this option will make it so that a user create will be
             triggered the first time a non-existant user attempts to start
             a session. This is useful if you already have users in an
             external authentication database (eg LDAP) and you don't want
             them to have to register. --&gt;</span>
        <span class="re1">&lt;auto-create</span><span class="re2">/&gt;</span></pre></div></div>
<p>你的Jabberd 2的存储和验证配置现在完成了(前提是你得提供和配置好存储包). 在转移到其他配置任务(例如 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.80.9A.E7.94.A8.E9.85.8D.E7.BD.AE.E4.BB.BB.E5.8A.A1" title="Jabberd2:安装和管理指南">第五章</a> 的配置SSL)之前，跳到 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.B5.8B.E8.AF.95.E6.9C.8D.E5.8A.A1.E5.99.A8" title="Jabberd2:安装和管理指南">测试服务器</a> 去开始测试你的服务器.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section04_7/html2pdf">以PDF格式查看</a>
</p>
<h3> <span class="mw-headline" id=".E6.B5.8B.E8.AF.95.E6.9C.8D.E5.8A.A1.E5.99.A8">测试服务器</span></h3>
<p>设置好主机名, 提供了外部包, 并配置Jabberd使用外部包之后, 你的服务器已经准备好测试了.
</p><p><b>C 检查点: 启动你的服务器</b>
</p>
<dl><dd>你应该可以使用Jabberd 2启动脚本(以你的jabber用户身份)启动并测试你的Jabberd 2服务器，:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="kw2">su</span>
        <span class="kw2">su</span> jabber
        <span class="kw3">cd</span> <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>bin
        .<span class="sy0">/</span>jabberd</pre></div></div> 
<p><b>N 注意: 疑难解答</b>
</p>
<dl><dd>如果Jabberd无法启动, 确保任何之前的实例已经停止. 这些实例包括所有Jabberd运行时组件( <i>jabberd</i> , <i>router</i> , <i>resolver</i> , <i>sm</i> , <i>s2s</i> 和 <i>c2s</i> ). 注意你的jabber用户(如果按第二章的说明创建了的话.) 可能没有缺省路径; 所以, 你应该 <i>cd</i>  到 <i>/usr/local/bin</i> 目录并如上运行 <i>jabberd</i> . 检查你选择的数据包服务器是否正常运行(除了Berkeley DB, 它不需要启动). 检查你的 <i>syslog</i> 查看错误信息. 如果你的服务器启动失败, 你可以用debug选项启动Jabberd 2(注意这需要在编译Jabberd 2时带上debug选项 — 参见<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.85.8D.E7.BD.AEJabberd.E7.BC.96.E8.AF.91" title="Jabberd2:安装和管理指南">3.3章</a>):
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>bin<span class="sy0">/</span>jabberd <span class="re5">-D</span></pre></div></div> 
<p><b>I 重要: Jabberd 2不应该用超级用户运行</b>
</p>
<dl><dd>和所有守护进程一样, Jabberd 2不应该以超级用户身份运行. 以超级用户身份运行Jabberd 2不仅对系统有破坏的风险, 而且可能导致创建文件许可的问题.
</dd></dl>
<p><b>N 注意: 公开注册</b>
</p>
<dl><dd>Jabberd2缺省允许新用户公开注册. 因此, 测试你的服务器时, 你能通过使用新用户名登录来新建一个用户.
</dd></dl>
<p><b>C 检查点: 从同网络的一台机器连接</b>
</p>
<dl><dd>一旦你检查你的服务器已经正常启动, 尝试从一个同网络的机器连接. 在一个Jabber客户端, 输入一个JID(Jabber ID)，使用你在<a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.9C.A8sm.xml.E5.92.8Cc2s.xml.E8.AE.BE.E7.BD.AE.E4.B8.BB.E6.9C.BA.E5.90.8D" title="Jabberd2:安装和管理指南">4.1章</a> <i>sm.xml</i> 设置的ID, 并尝试连接到你的服务器.
</dd></dl>
<p><b>C 检查点: 从远程网络的客户端连接</b>
</p>
<dl><dd>如果你可以从同网络连接到你的服务器, 那么使用一个Jabber客户端从一个远程网络连接它. 这将测试那个 <i>id</i> 是否正确设以及机器名是否正确的进行DNS解析.
</dd></dl>
<p>你的Jabberd 2服务器现在准备好使用了. 继续到 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.B8.B8.E8.A7.84.E9.85.8D.E7.BD.AE.E4.BB.BB.E5.8A.A1" title="Jabberd2:安装和管理指南">常规配置任务</a> 了解更详细的配置选项, 例如允许SSL连接等.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section04_8/html2pdf">以PDF格式查看</a>
</p>
<h2> <span class="mw-headline" id=".E5.B8.B8.E8.A7.84.E9.85.8D.E7.BD.AE.E4.BB.BB.E5.8A.A1">常规配置任务</span></h2>
<p>在进入详细的Jabberd配置之前, 这里尝试为大部分常规的Jabberd配置任务提供一个指南: 
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.B8.BA.E4.BA.92.E8.81.94.E7.BD.91.E8.AE.BF.E9.97.AE.E9.85.8D.E7.BD.AE.E9.98.B2.E7.81.AB.E5.A2.99" title="Jabberd2:安装和管理指南">为互联网访问配置防火墙</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.85.8D.E7.BD.AEJabberd_2.E4.BD.BF.E7.94.A8SSL.E8.BF.9E.E6.8E.A5" title="Jabberd2:安装和管理指南">配置Jabberd 2使用SSL连接</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.BF.AE.E6.94.B9Router.E5.AF.86.E7.A0.81" title="Jabberd2:安装和管理指南">修改Router密码</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.88.9B.E5.BB.BA.E7.AE.A1.E7.90.86.E5.91.98.E7.94.A8.E6.88.B7" title="Jabberd2:安装和管理指南">创建管理员用户</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E7.A6.81.E6.AD.A2.E5.85.AC.E5.BC.80.E6.B3.A8.E5.86.8C" title="Jabberd2:安装和管理指南">禁止公开注册</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.85.81.E8.AE.B8.E7.94.A8.E6.88.B7.E4.BF.AE.E6.94.B9.E5.AF.86.E7.A0.81" title="Jabberd2:安装和管理指南">允许用户修改密码</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E8.AE.BE.E7.BD.AEDNS_SRV.E8.AE.B0.E5.BD.95" title="Jabberd2:安装和管理指南">设置DNS SRV记录</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.BD.BF.E7.94.A8Jabberd_1.4.E8.BF.9E.E6.8E.A5.E5.A4.96.E9.83.A8.E6.9C.8D.E5.8A.A1" title="Jabberd2:安装和管理指南">使用Jabberd 1.4连接外部服务</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.BD.BF.E7.94.A8JCR.E4.BD.9C.E4.B8.BAJabberd_2.E7.BB.84.E4.BB.B6" title="Jabberd2:安装和管理指南">使用JCR连接外部服务</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.AE.89.E8.A3.85.E4.B8.80.E4.B8.AA.E4.BD.BF.E7.94.A8Users-Agent.E7.9A.84JUD" title="Jabberd2:安装和管理指南">安装一个使用Users-Agent的JUD</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.9B.86.E6.88.90vCard.E6.95.B0.E6.8D.AE.E5.88.B0Users-Agent.28.E4.BB.85.E9.99.90.E7.A7.81.E6.9C.89.E6.9C.8D.E5.8A.A1.E5.99.A8.29" title="Jabberd2:安装和管理指南">集成vCard数据到Users-Agent(仅限私有服务器)</a>
</li></ul>
<p>注意有两个选项用于连接Jabberd 1.4外部服务到你的Jabberd 2安装. Jabberd 2可以连接到服务例如会议和网关, 运行一个Jabberd 1.4进程. 另外, 一个名为JCR的组件封装器已经发布了, 这个封装器允许一个Jabber 1.4组件(用C写的)被编译后以Jabberd 2服务运行. 本文撰写期间, JCR只和MU Conferencing测试通过了.
</p>
<h3> <span class="mw-headline" id=".E4.B8.BA.E4.BA.92.E8.81.94.E7.BD.91.E8.AE.BF.E9.97.AE.E9.85.8D.E7.BD.AE.E9.98.B2.E7.81.AB.E5.A2.99">为互联网访问配置防火墙</span></h3>
<p>尽管防火墙配置超出了本文范围, 管理员应该注意TCP端口需要被允许通过互联网访问:
</p>
<ul><li> 端口 5222 — 非SSL客户端通讯
</li><li> 端口 5223 — SSL客户端通讯
</li><li> 端口 5269 — 服务器间通讯
</li></ul>
<p>如果你的Jabberd 2安装是用于互联网访问，根据你的配置，以上TCP端口应该被允许.
</p>
<h3> <span class="mw-headline" id=".E9.85.8D.E7.BD.AEJabberd_2.E4.BD.BF.E7.94.A8SSL.E8.BF.9E.E6.8E.A5">配置Jabberd 2使用SSL连接</span></h3>
<p>Jabberd 2不仅为Jabberd客户端和服务器之间提供STARTTLS和SSL连接, 而且在Jabberd服务组件( <i>sm</i> , <i>resolver</i> , <i>s2s</i> 和 <i>c2s</i> )和Jabberd <i>router</i> 之间也提供. 这两个功能(Jabber客户端到Jabberd以及Jabberd组件到router)可以共用一个SSL证书, 也可以使用独立的密钥. 如何为Jabberd 2创建你自己的自签名证书，参见附录 <a rel="nofollow" class="external text" href="http://www.jabberdoc.org/app_sslkey.html">生成自签名的SSL证书</a>.
</p><p><b>N 注意: 自签名证书是不被信任的</b>
</p>
<dl><dd>注意自签名证书不会自动被Jabber客户端信任，因为没有信任链来验证授权. 然而, 新建一个自签名证书不仅让你的Jabber用户可以通过一个安全通道连接(客户端可能会显示一个警告), 而且这样一个证书将为5个Jabberd组件( <i>router</i> , <i>sm</i> , <i>resolver</i> , <i>s2s</i> 和 <i>c2s</i> )之间提供安全通讯. 
</dd></dl>
<p><b>N 注意: 添加证书到PSI Jabber客户端</b>
</p>
<dl><dd>我已经写了一个脚本接收和添加自签名证书到PSI客户端证书仓库. 它在 <a rel="nofollow" class="external text" href="http://www.jabberdoc.org/tools">tools目录</a> 的 <a rel="nofollow" class="external text" href="http://www.jabberdoc.org/tools/add_psi_cert.sh">这里</a> 并且已经生效.
</dd></dl>
<h4> <span class="mw-headline" id=".E5.88.86.E9.85.8D.E4.B8.80.E4.B8.AA.E7.94.A8.E4.BA.8EJabber.E5.AE.A2.E6.88.B7.E7.AB.AF.E7.9A.84.E8.AF.81.E4.B9.A6">分配一个用于Jabber客户端的证书</span></h4>
<p>用于Jabber客户端的SSL密钥的配置位于 <i>c2s.xml</i> . 注意 <i>c2s.xml</i> 包含用于Jabber客户端的SSL密钥的位置和用于 <i>c2s</i> 到 <i>router</i> 通讯的SSL密钥的位置.
</p><p><b>P 参数: SSL密钥位置</b>
</p>
<dl><dd>在标为 <i>Local network configuration</i> 的位置取消注释 <i>pemfile</i> (你的SSL密钥), 并把它改成你的SSL密钥的路径. 注意如果你的PEM文件在缺省位置 <i>/usr/local/etc/jabberd/server.pem</i> , 你只需要取消注释以下这个段落: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="co1">&lt;!-- File containing a SSL certificate and private key for client
             connections. If this is commented out, clients will not be
             offered the STARTTLS stream extension --&gt;</span>
&#160;
        <span class="re1">&lt;pemfile<span class="re2">&gt;</span></span><span class="co3">/usr/local/etc/jabberd/server.pem</span><span class="re1">&lt;/pemfile<span class="re2">&gt;</span></span></pre></div></div>
<p>以上修改将在5222端口激活STARTTLS. 旧的Jabber客户端使用5223端口来进行SSL通讯. 如果你希望在5223端口支持SSL, 取消注释 <i>ssl-port</i> 标签: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="re1">&lt;ssl-port<span class="re2">&gt;</span></span><span class="co3">5223</span><span class="re1">&lt;/ssl-port<span class="re2">&gt;</span></span></pre></div></div>
<p>你的服务器现在准备好STARTTLS/SSL连接了. 你只需要重启C2S组件就可以使SSL的配置变更生效了.
</p><p><b>N 注意: 禁止非STARTTLS通讯</b>
</p>
<dl><dd>强制要求STARTTLS通讯, 取消注释 <i>require-starttls</i> 标签，如下: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="co1">&lt;!-- Require STARTTLS. If this is enabled, clients must do STARTTLS
             before they can authenticate. Until the stream is encrypted,
             all packets will be dropped. --&gt;</span>
&#160;
        <span class="re1">&lt;require-starttls</span><span class="re2">/&gt;</span></pre></div></div>
<h4> <span class="mw-headline" id=".E5.88.86.E9.85.8D.E4.B8.80.E4.B8.AA.E7.94.A8.E4.BA.8EJabberd.E7.BB.84.E4.BB.B6.E7.9A.84.E8.AF.81.E4.B9.A6">分配一个用于Jabberd组件的证书</span></h4>
<p>5个Jabberd组件都要各自配置 组件到路由器 的加密通讯. 因此, 这5个配置文件都必须修改并提供Jabberd组件之间的安全通讯: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>        router.xml
        sm.xml
        resolver.xml
        s2s.xml
        c2s.xml</pre></div></div>
<p><b>P 参数: SSL密钥位置</b>
</p>
<dl><dd>在以上每一个文件中, 取消注释 <i>pemfile</i> 标签用于路由器通讯. 在 <i>router.xml</i> 文件, <i>pemfile</i> 被定义在标为 <i>Local network configuration</i> 的段落. 在以上剩下的四个配置文件的每个文件里面, <i>pemfile</i> 定义于标为 <i>Router connection configuration</i> 的段落. 取消注释这个段落并修改它指向你的SSL密钥的位置. 例如, 你讲修改 <i>c2s.xml</i> 如下，如果你的SSL密钥使用缺省路径: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="co1">&lt;!-- Router connection configuration --&gt;</span>
        <span class="re1">&lt;router<span class="re2">&gt;</span></span>
          <span class="co1">&lt;!-- IP/port the router is waiting for connections on --&gt;</span>
          <span class="re1">&lt;ip<span class="re2">&gt;</span></span><span class="co3">127.0.0.1</span><span class="re1">&lt;/ip<span class="re2">&gt;</span></span>      <span class="co1">&lt;!-- default: 127.0.0.1 --&gt;</span>
          <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">5347</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span>       <span class="co1">&lt;!-- default: 5347 --&gt;</span>
&#160;
          <span class="co1">&lt;!-- Username/password to authenticate as --&gt;</span>
          <span class="re1">&lt;user<span class="re2">&gt;</span></span><span class="co3">jabberd</span><span class="re1">&lt;/user<span class="re2">&gt;</span></span>    <span class="co1">&lt;!-- default: jabberd --&gt;</span>
          <span class="re1">&lt;pass<span class="re2">&gt;</span></span><span class="co3">secret</span><span class="re1">&lt;/pass<span class="re2">&gt;</span></span>     <span class="co1">&lt;!-- default: secret --&gt;</span>
&#160;
          <span class="co1">&lt;!-- File containing a SSL certificate and private key to use when
               setting up an encrypted channel with the router. If this is
               commented out, or the file can't be read, no attempt will be
               made to establish an encrypted channel with the router. --&gt;</span>
&#160;
          <span class="re1">&lt;pemfile<span class="re2">&gt;</span></span><span class="co3">/usr/local/etc/jabberd/server.pem</span><span class="re1">&lt;/pemfile<span class="re2">&gt;</span></span></pre></div></div>
<p>重启你的Jabberd服务使配置变更生效.
</p>
<h3> <span class="mw-headline" id=".E4.BF.AE.E6.94.B9Router.E5.AF.86.E7.A0.81">修改Router密码</span></h3>
<p>Jabberd配置文件包含了组件连接到路由器的密码，因为组件和路由器之间的通讯是通过TCP/IP上的XML实现的. 这些密码帮助确保只有你安装的组件可以和路由器通讯. 配置文件, <i>router-users.xml</i> , 包含了允许连接到路由器的ID和密码. 缺省的ID是 <i>jabberd</i> 密码是 <i>secret</i> . 
</p><p>另外, 每个组件(除了 <i>router</i> )在它的配置文件里都有一个用户ID和密码. 这个ID和密码配合给各自的组件用来连接 <i>router</i> . 因此, 对一个可以连接到路由器的组件来说, 该组件的配置文件里必须有一个用户名和密码组合, 并且那个组合必须和 <i>router-users.xml</i> 的ID和密码组合匹配.
</p><p>为了给Jabberd安装你的提高安全性, 你应该修改密码. 这包括修改 <i>router-users.xml</i> 以及 <i>sm.xml</i> , <i>resolver.xml</i> , <i>s2s.xml</i> 和 <i>c2s.xml</i> .
</p><p><b>P 参数: Router用户名和密码</b>
</p>
<dl><dd>为了修改路由器验证用的密码, 首先修改 <i>router-users.xml</i> 如下(用新密码替换掉 <i>newpass</i> ): 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="re1">&lt;users<span class="re2">&gt;</span></span>
        <span class="re1">&lt;user<span class="re2">&gt;</span></span>
          <span class="re1">&lt;name<span class="re2">&gt;</span></span><span class="co3">jabberd</span><span class="re1">&lt;/name<span class="re2">&gt;</span></span>
          <span class="re1">&lt;secret<span class="re2">&gt;</span></span><span class="co3">newpass</span><span class="re1">&lt;/secret<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/user<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/users<span class="re2">&gt;</span></span></pre></div></div>
<p>然后, 修改 <i>sm.xml</i> , <i>resolver.xml</i> , <i>s2s.xml</i> 和 <i>c2s.xml</i> 中的密码 . 在每个文件中的 <i>router</i> 段落有一些标签是给路由器用户的. 修改密码如下(用新密码替换掉 <i>newpass</i> ):
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Router connection configuration --&gt;</span>
      <span class="re1">&lt;router<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- IP/port the router is waiting for connections on --&gt;</span>
        <span class="re1">&lt;ip<span class="re2">&gt;</span></span><span class="co3">127.0.0.1</span><span class="re1">&lt;/ip<span class="re2">&gt;</span></span>      <span class="co1">&lt;!-- default: 127.0.0.1 --&gt;</span>
        <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">5347</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span>       <span class="co1">&lt;!-- default: 5347 --&gt;</span>
&#160;
        <span class="co1">&lt;!-- Username/password to authenticate as --&gt;</span>
        <span class="re1">&lt;user<span class="re2">&gt;</span></span><span class="co3">jabberd</span><span class="re1">&lt;/user<span class="re2">&gt;</span></span>    <span class="co1">&lt;!-- default: jabberd --&gt;</span>
        <span class="re1">&lt;pass<span class="re2">&gt;</span></span><span class="co3">newpass</span><span class="re1">&lt;/pass<span class="re2">&gt;</span></span>     <span class="co1">&lt;!-- default: secret --&gt;</span></pre></div></div>
<p>重启你的Jabberd服务器使变更生效.
</p><p><b>N 注意: 允许多密码</b>
</p>
<dl><dd>注意如果你需要，可以为每一个组件分配一个用户和ID. 
</dd></dl>
<p><b>N 注意: 如果用户变更那么 <i>router.xml</i> 必须修改</b>
</p>
<dl><dd>注意以上只描述了如何修改路由器密码. 如果 <i>router-users.xml</i> 中的用户名修改了, 那么 <i>router.xml</i> 中的 <i>acl</i> 段落也必须修改: 
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Access control information --&gt;</span>
      <span class="re1">&lt;aci<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- The usernames listed here will get access to all restricted
             functions, regardless of restrictions further down --&gt;</span>
        <span class="re1">&lt;acl</span> <span class="re0">type</span>=<span class="st0">'all'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;user<span class="re2">&gt;</span></span><span class="co3">jabberd</span><span class="re1">&lt;/user<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/acl<span class="re2">&gt;</span></span></pre></div></div>
<h3> <span class="mw-headline" id=".E5.88.9B.E5.BB.BA.E7.AE.A1.E7.90.86.E5.91.98.E7.94.A8.E6.88.B7">创建管理员用户</span></h3>
<p>管理员用户的设置位于 <i>sm.xml</i> 文件的 <i>aci</i> 段落 . 缺省的管理员用户为 <i>admin@localhost</i> . 为了让管理员用户能远程操作, 把 <i>jid</i> 改成一个你自己拥有的用户如下:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="re1">&lt;acl</span> <span class="re0">type</span>=<span class="st0">'all'</span><span class="re2">&gt;</span>  
        <span class="re1">&lt;jid<span class="re2">&gt;</span></span><span class="co3">admin@lsomedomain.com</span><span class="re1">&lt;/jid<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/acl<span class="re2">&gt;</span></span></pre></div></div>
<p>你也可能需要从Jabber客户端手工来创建这个用户. 登录后, 该管理员用户将接收到用户创建的提示, 并且他也将能查询到所有在线用户, 接收帮助请求, 发送 MOTD (当日消息), 等等.
</p><p>注意以上用户被授权访问所有管理功能. 你可以通过指定 <i>acl</i> 类型来给用户赋予一些特定的管理权限. 参见 <i>sm.xml</i> 文件里的例子.
</p><p>重启你的 Jabberd 服务使得修改生效.
</p>
<h3> <span class="mw-headline" id=".E7.A6.81.E6.AD.A2.E5.85.AC.E5.BC.80.E6.B3.A8.E5.86.8C">禁止公开注册</span></h3>
<p>缺省情况下, Jabberd 允许所有用户公开注册, 也就是说能连上你的服务器的任何用户可以在你的服务器上创建他们自己的 Jabberd 用户. 为了阻止公开注册, 编辑 <i>c2s.xml</i> 配置文件.
</p><p>在 <i>Authentication/registration database configuration</i> 段落, 寻找 <i>Registration configuration</i> 子段落. 注释掉 <i>enable</i> 标签将禁止公开注册:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Authentication/registration database configuration --&gt;</span>
      <span class="re1">&lt;authreg<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Backend module to use --&gt;</span>
        <span class="re1">&lt;module<span class="re2">&gt;</span></span><span class="co3">mysql</span><span class="re1">&lt;/module<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Registration configuration --&gt;</span>
        <span class="re1">&lt;register<span class="re2">&gt;</span></span>
          <span class="co1">&lt;!-- Account registration is enabled by default (provided the
               auth/reg module in use supports it). Comment this out to
               disable. --&gt;</span>
          <span class="co1">&lt;!--
          &lt;enable/&gt;
          --&gt;</span></pre></div></div>
<p>如果配置使用了 <b>PAM</b> 或 <b>OpenLDAP</b> ，那么应该禁止公开注册, 因为 Jabberd 2 不支持通过 PAM 或 OpenLDAP 进行公开注册.
</p>
<h3> <span class="mw-headline" id=".E5.85.81.E8.AE.B8.E7.94.A8.E6.88.B7.E4.BF.AE.E6.94.B9.E5.AF.86.E7.A0.81">允许用户修改密码</span></h3>
<p>在 Jabberd 2 里用户修改密码缺省是被禁止的. 为了允许你的用户修改他们自己的密码, 在 <i>c2s.xml</i> 文件中取消注释 <i>authreg</i> 段落里的 <i>password</i> 标签:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="co1">&lt;!-- Authentication/registration database configuration --&gt;</span>
      <span class="re1">&lt;authreg<span class="re2">&gt;</span></span>
        <span class="co1">&lt;!-- Backend module to use --&gt;</span>
        <span class="re1">&lt;module<span class="re2">&gt;</span></span><span class="co3">mysql</span><span class="re1">&lt;/module<span class="re2">&gt;</span></span>
&#160;
        <span class="co1">&lt;!-- Registration configuration --&gt;</span>
        <span class="re1">&lt;register<span class="re2">&gt;</span></span>
          <span class="co1">&lt;!-- Account registration is enabled by default (provided the
               auth/reg module in use supports it). Comment this out to
               disable. --&gt;</span>
          <span class="re1">&lt;enable</span><span class="re2">/&gt;</span>
&#160;
          <span class="co1">&lt;!-- Human-readable instructions to be returned to client when
               registration is requested. --&gt;</span>
          <span class="re1">&lt;instructions<span class="re2">&gt;</span></span><span class="co3">Enter a username and password to register with this server.</span><span class="re1">&lt;/instructions<span class="re2">&gt;</span></span>
&#160;
          <span class="co1">&lt;!-- Password change only. When registration is disabled, it may
               still be useful to allow clients to change their password. If
               you want this, uncomment this when you disable registration. --&gt;</span>
          <span class="re1">&lt;password</span><span class="re2">/&gt;</span></pre></div></div>
<p>注意当使用 PAM 或 OpenLDAP 验证的时候这个配置将不能生效，因为这些包不允许通过 Jabberd 修改密码. 重启你的 Jabberd 服务以使修改的配置生效.
</p>
<h3> <span class="mw-headline" id=".E8.AE.BE.E7.BD.AEDNS_SRV.E8.AE.B0.E5.BD.95">设置DNS SRV记录</span></h3>
<p>Jabberd 2, 以及其他Jabber客户端和服务器, 能够使用 DNS SRV 记录用户主机名解析. DNS SRV 记录允许服务 — 通过端口 — 委托给其他主机. 所以, 如果你希望你的Jabber服务器运行在一个非主要域主机的机器上, 你可能会愿意设置 DNS SRV 记录来委托Jabber客户端和服务器服务到另一个或多个主机.
</p><p><b>N 注意: SRV 记录只对 非主要 主机是必要的</b>
</p>
<dl><dd>注意，只有你的Jabberd服务运行在一个和主要域主机不同的机器上并且你不希望在你的Jabber ID 里包含该主机(机器)的名称的时候，DNS SRV 记录才是必要的. 例如, 如果一个 DNS 查询 somedomain.com 解析到 host1.somedomain.com, 而你的 Jabberd 服务器运行在 host1, 那么 SRV 记录就不必要了.
</dd></dl>
<h4> <span class="mw-headline" id="Jabberd.E4.BD.BF.E7.94.A8SRV.E8.AE.B0.E5.BD.95">Jabberd使用SRV记录</span></h4>
<p>对于一个 Jabberd 安装，可以创建三个SRV记录:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>        _jabber._tcp.&lt;domain&gt;   -&gt;    &lt;host&gt;.&lt;domain&gt;:5269
        _xmpp-server._tcp.&lt;domain&gt;    -&gt;    &lt;host&gt;.&lt;domain&gt;:5269 
        _xmpp-client._tcp.&lt;domain&gt;    -&gt;    &lt;host&gt;.&lt;domain&gt;:5222</pre></div></div>
<p>第一和第二个记录指定用于服务器间(s2s)通讯的主机和端口. 之所以有两个记录，是因为新的XMPP协议, 对于SRV记录, 已经取代了旧的Jabber标准. 第三个记录指定用于不加密的客户端(c2s)通讯的主机和端口.
</p>
<h4> <span class="mw-headline" id=".E5.9C.A8_Bind_.E9.87.8C.E5.88.9B.E5.BB.BASRV.E8.AE.B0.E5.BD.95">在 <a rel="nofollow" class="external text" href="http://www.isc.org/products/BIND/">Bind</a> 里创建SRV记录</span></h4>
<p>以下例子是在 BIND 服务器创建一组SRV记录:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>        _jabber._tcp.some_domain.com. 86400 IN SRV 5 0 5269 host.some_domain.com.
        _xmpp-server._tcp.some_domain.com. 86400 IN SRV 5 0 5269 host.some_domain.com.
        _xmpp-client._tcp.some_domain.com. 86400 IN SRV 5 0 5222 host.some_domain.com.</pre></div></div>
<p>把 <i>some_domain.com</i> 替换成你的域名，把主机的名字换成你的主机名, 并且不要忘记在域名后面的那个 "." .
</p>
<h4> <span class="mw-headline" id=".E5.9C.A8_TinyDNS_.E9.87.8C.E5.88.9B.E5.BB.BASRV.E8.AE.B0.E5.BD.95">在 <a rel="nofollow" class="external text" href="http://cr.yp.to/djbdns/tinydns.html">TinyDNS</a> 里创建SRV记录</span></h4>
<p>TinyDNS没有SRV记录格式; 然而, 你可以使用 Rob Mayoff 的 <a rel="nofollow" class="external text" href="http://dqd.com/~mayoff/tools/djbdns/make-record.adp">TinyDNS Record Maker</a> 来创建 TinyDNS SRV 记录. 这些 TinyDNS SRV 记录被创建用于主机 host.some_domain.com ，使用优先级为 10 以及 权重为 '0':
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>           &#160;:_jabber._tcp.some_domain.com:33:\000\012\000\000\024\225\004host\013some_domain\003com\000 
           &#160;:_xmpp-client._tcp.some_domain.com:33:\000\012\000\000\024\146\004host\013some_domain\003com\000 
           &#160;:_xmpp-server._tcp.some_domain.com:33:\000\012\000\000\024\225\004host\013some_domain\003com\000</pre></div></div>
<p>使用 <a rel="nofollow" class="external text" href="http://dqd.com/~mayoff/tools/djbdns/make-record.adp">TinyDNS Record Maker</a> 创建一组记录加入到 TinyDNS 数据文件中.
</p>
<h4> <span class="mw-headline" id=".E6.B5.8B.E8.AF.95SRV.E8.AE.B0.E5.BD.95">测试SRV记录</span></h4>
<p>一旦你的DNS服务器正确地更新之后, 你应该使用Dig测试列出的那些srv. 例如, 为了测试条目 _jabber._tcp.some_domain.com, 使用DNS服务器 my.dns_server.com, 你可以键入以下命令:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        dig <span class="sy0">@</span>my.dns_server.com _jabber._tcp.some_domain.com any +short</pre></div></div>
<p>从你的DNS SRV记录查询得到的结果应该如下:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>        10 0 5269 host.some_domain.com.</pre></div></div>
<h3> <span class="mw-headline" id=".E4.BD.BF.E7.94.A8Jabberd_1.4.E8.BF.9E.E6.8E.A5.E5.A4.96.E9.83.A8.E6.9C.8D.E5.8A.A1">使用Jabberd 1.4连接外部服务</span></h3>
<p>本章描述如何使用一个现有的 Jabberd 1.4 服务器连接外部Jabberd 1.4服务, 例如网关和代理, 到Jabberd 2. 参见下一章,使用 JCR 组件连接外部服务. 参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.99.84.E5.BD.95" title="Jabberd2:安装和管理指南">附录11</a> 初步了解Jabberd 2如何使用Jabberd 1.4x进程来运行一个代理.
</p><p>这里假定读者已经很熟悉 Jabberd 1.4. , 也就是一个正在使用中的 Jabberd 1.4 安装. Jabberd 1.4 的安装和配置超出了本文的范围; 不过, 对此已经有很多好的资源存在, 包括 <a rel="nofollow" class="external text" href="http://news.gmane.org/gmane.network.jabber.admin">Jadmin Archive</a> 和 <a rel="nofollow" class="external text" href="http://jabberd.jabberstudio.org/1.4/doc/adminguide">Jabberd 1.4x管理指南</a> .
</p><p>把Jabberd连接到一个外部服务和把Jabberd 1.4连接到服务很相似; 不过从Jabberd 2连接到一个Jabberd 1.4服务有很多重要的不同: 
</p>
<ul><li> 连接配置文件必须有一个 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#XDB.E6.AE.B5.E8.90.BD" title="Jabberd2:安装和管理指南">XDB段落</a>
</li><li> 连接配置文件必须有一个 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Log.E6.AE.B5.E8.90.BD" title="Jabberd2:安装和管理指南">Log段落</a>
</li><li> 连接配置文件必须指定 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Router.E7.9A.84IP.E5.9C.B0.E5.9D.80.E5.92.8C.E7.AB.AF.E5.8F.A3" title="Jabberd2:安装和管理指南">Router的IP地址和端口</a>
</li><li> 连接配置文件和router配置文件必须共享一个密码
</li><li> router.xml文件必须包含一个 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Router.E5.88.AB.E5.90.8D" title="Jabberd2:安装和管理指南">服务的别名</a>
</li></ul>
<p>另外,如果组件不支持查询( <i>disco</i> ),  <i>sm.xml</i> 里面应该有服务的名字空间. 例如, MU Conference 支持查询, 所以不需要在 <i>sm.xml</i> 配置它的条目以使该服务能够被浏览. 另一方面, JUD (Jabber用户目录)不支持查询; 所以, 需要在 <i>sm.xml</i> 里配置它的条目以使 JUD 可以被用户浏览到. 参见 <i>sm.xml</i>  例子.
</p><p>下面的子段落描述了如何配置一个David Sutton为Jabberd 1.4 写的 MU Conference , 包括一个运行中的 MU Conference 的配置文件. 去 <a rel="nofollow" class="external text" href="http://www.jabberstudio.org/projects/mu-conference/project/view.php">MU Conference</a> 获得下载以及更多关于这个组件的信息. MU Conference 为Jabberd提供了一个多用户聊天室服务.
</p>
<h4> <span class="mw-headline" id="XDB.E6.AE.B5.E8.90.BD">XDB段落</span></h4>
<p>运行一个Jabberd 1.4的网关或代理时, 主Jabberd进程处理XDB和logging函数. 运行Jabberd 2组件时不是这样. 反之, 组件应该运行在它自己的进程里, 并且组件应该自己处理它本身的XDB和logging函数. 也就是说外部组件应该运行在一个自包含的进程中. 但是, 如果你有一个用于连接Jabberd 1.4服务器的外部组件, 你应该添加一个 <i>XDB</i> 段落到该服务的配置文件:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="re1">&lt;xdb</span> <span class="re0">id</span>=<span class="st0">&quot;xdb&quot;</span><span class="re2">&gt;</span>
          <span class="re1">&lt;host<span class="re2">&gt;</span></span><span class="co3">conference.somedomain.com</span><span class="re1">&lt;/host<span class="re2">&gt;</span></span>
&#160;
          <span class="re1">&lt;load<span class="re2">&gt;</span></span>
            <span class="re1">&lt;xdb_file<span class="re2">&gt;</span></span><span class="co3">/usr/local/jabber/xdb_file/xdb_file.so</span><span class="re1">&lt;/xdb_file<span class="re2">&gt;</span></span>
          <span class="re1">&lt;/load<span class="re2">&gt;</span></span>
&#160;
          <span class="re1">&lt;xdb_file</span> <span class="re0">xmlns</span>=<span class="st0">&quot;jabber:config:xdb_file&quot;</span><span class="re2">&gt;</span>
            <span class="re1">&lt;spool<span class="re2">&gt;</span></span><span class="co3">/usr/local/var/spool/jabber</span><span class="re1">&lt;/spool<span class="re2">&gt;</span></span>
          <span class="re1">&lt;/xdb_file<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/xdb<span class="re2">&gt;</span></span></pre></div></div>
<p>以上 <i>XDB</i> 段落指定了 hostname, 装载的XDB模块, 以及写spool的文件位置.
</p>
<h4> <span class="mw-headline" id="Log.E6.AE.B5.E8.90.BD">Log段落</span></h4>
<p>如上所示, 组件配置文件也必须包含一个日志段落. 你可以为你连接的组件添加一个段落到配置文件，如下:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="re1">&lt;log</span> <span class="re0">id</span>=<span class="st0">&quot;muclog&quot;</span><span class="re2">&gt;</span>
          <span class="re1">&lt;file<span class="re2">&gt;</span></span><span class="co3">/usr/local/var/jabberd/log/muc.log</span><span class="re1">&lt;/file<span class="re2">&gt;</span></span>
          <span class="re1">&lt;host</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;logtype</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;format<span class="re2">&gt;</span></span><span class="co3">%d: [%t] (%h):&#160;%s</span><span class="re1">&lt;/format<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/log<span class="re2">&gt;</span></span></pre></div></div>
<p>在这个例子里是一个 MU Conference 网关, 我已经在上面指定日志为 muc.log. 每个服务应该有一个独立的日志文件.
</p>
<h4> <span class="mw-headline" id="Router.E7.9A.84IP.E5.9C.B0.E5.9D.80.E5.92.8C.E7.AB.AF.E5.8F.A3">Router的IP地址和端口</span></h4>
<p>连接的组件应该指定 <i>router</i> 监听的IP地址和端口. <i>router</i> 的缺省端口是 <b>5347</b> , 所以相关配置文件的 id 段落的开头应该类似这样:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="re1">&lt;service</span> <span class="re0">id</span>=<span class="st0">&quot;muclinker&quot;</span><span class="re2">&gt;</span>
          <span class="re1">&lt;uplink</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;connect<span class="re2">&gt;</span></span>
            <span class="re1">&lt;ip<span class="re2">&gt;</span></span><span class="co3">192.168.0.2</span><span class="re1">&lt;/ip<span class="re2">&gt;</span></span> <span class="co1">&lt;!-- IP Address of Router here --&gt;</span>
            <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">5347</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id=".E5.85.B1.E4.BA.AB.E5.AF.86.E7.A0.81">共享密码</span></h4>
<p>Jabberd 2 服务器为每个组件连接使用一个密码. 这个密码类似Jabberd 1.4里的共享密码. 继续上述例子, 你应该为你使用的外部组件创建一个密码. (在 Jabberd 2里, 所有外部组件共享和 <i>router</i> 相同的密码) 这个密码, 或者 <i>secret</i> , 必须在你的连接组件的配置文件中指定:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="re1">&lt;service</span> <span class="re0">id</span>=<span class="st0">&quot;muclinker&quot;</span><span class="re2">&gt;</span>
          <span class="re1">&lt;uplink</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;connect<span class="re2">&gt;</span></span>
            <span class="re1">&lt;ip<span class="re2">&gt;</span></span><span class="co3">192.168.0.2</span><span class="re1">&lt;/ip<span class="re2">&gt;</span></span> <span class="co1">&lt;!-- IP Address of Router here --&gt;</span>
            <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">5347</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span>
            <span class="re1">&lt;secret<span class="re2">&gt;</span></span><span class="co3">ComponentPass</span><span class="re1">&lt;/secret<span class="re2">&gt;</span></span>
          <span class="re1">&lt;/connect<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/service<span class="re2">&gt;</span></span></pre></div></div>
<p>这个 <i>secret</i> 也必须在你的 <i>router.xml</i> 文件中指定. 该 <i>secret</i> 应该在标为 'local network configuration' 的位置:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="co1">&lt;!-- Local network configuration --&gt;</span>
        <span class="re1">&lt;local<span class="re2">&gt;</span></span>
          <span class="co1">&lt;!-- IP address to bind to (default: 0.0.0.0) --&gt;</span>
          <span class="re1">&lt;ip<span class="re2">&gt;</span></span><span class="co3">0.0.0.0</span><span class="re1">&lt;/ip<span class="re2">&gt;</span></span>
          <span class="co1">&lt;!-- Port to bind to (default: 5347) --&gt;</span>
          <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">5347</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span>
          <span class="co1">&lt;!-- File containing the user table. This is where the router gets
               its component and secret information from for component
               authentication.--&gt;</span>
          <span class="re1">&lt;users<span class="re2">&gt;</span></span><span class="co3">/usr/local/etc/jabberd/router-users.xml</span><span class="re1">&lt;/users<span class="re2">&gt;</span></span>
          <span class="co1">&lt;!-- Shared secret used to identify legacy components (that is,
               &quot;jabber:component:accept&quot; components that authenticate using
               the &quot;handshake&quot; method). If this is commented out, support for
               legacy components will be disabled. --&gt;</span>
          <span class="re1">&lt;secret<span class="re2">&gt;</span></span><span class="co3">ComponentPass</span><span class="re1">&lt;/secret<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id="Router.E5.88.AB.E5.90.8D">Router别名</span></h4>
<p><i>router.xml</i> 文件也必须包含用于连接的组件的别名, 而且 <i>router.xml</i> 文件提供了一个连接到MSN代理的例子. 为你连接的组件添加一个别名. 继续上面的例子, 这个别名将在 'router.xml' 文件中设置:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="co1">&lt;!-- Name aliases.
&#160;
             Packets destined for the domain specified in the &quot;name&quot; attribute
             will be routed to the component that has currently bound the name
             in the &quot;target&quot; attribute (assuming it is online).
&#160;
             This is usually only required for some kinds of legacy
             components (particularly jabberd 1.4 &quot;uplink&quot; components) --&gt;</span>
        <span class="re1">&lt;aliases<span class="re2">&gt;</span></span>
          <span class="co1">&lt;!-- Example for a msn transport running from a jabberd 1.4 uplink --&gt;</span>
          <span class="co1">&lt;!--
          &lt;alias name='msn.domain.com' target='msn-linker'/&gt;
          --&gt;</span>
          <span class="re1">&lt;alias</span> <span class="re0">name</span>=<span class="st0">'conference.somedomain.com'</span> <span class="re0">target</span>=<span class="st0">'muclinker'</span><span class="re2">/&gt;</span>
        <span class="re1">&lt;/aliases<span class="re2">&gt;</span></span></pre></div></div>
<p>注意别名参考了组件的DNS解析名, 并且 <i>target</i> 参考了连接组件的XML文件中的 <i>service id</i> (参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.85.B1.E4.BA.AB.E5.AF.86.E7.A0.81" title="Jabberd2:安装和管理指南">5.5.4</a>).
</p>
<h4> <span class="mw-headline" id=".E4.BE.8B.E5.AD.90:muc.xml">例子:muc.xml</span></h4>
<p>下面是一个运行中的 <i>muc.xml</i> 文件，用于 MU Conferencing:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="re1">&lt;jabber<span class="re2">&gt;</span></span>
&#160;
          <span class="re1">&lt;service</span> <span class="re0">id</span>=<span class="st0">&quot;muclinker&quot;</span><span class="re2">&gt;</span>
            <span class="re1">&lt;uplink</span><span class="re2">/&gt;</span>
            <span class="re1">&lt;connect<span class="re2">&gt;</span></span>
              <span class="re1">&lt;ip<span class="re2">&gt;</span></span><span class="co3">192.168.0.2</span><span class="re1">&lt;/ip<span class="re2">&gt;</span></span> <span class="co1">&lt;!-- IP Address of Router here --&gt;</span>
              <span class="re1">&lt;port<span class="re2">&gt;</span></span><span class="co3">5347</span><span class="re1">&lt;/port<span class="re2">&gt;</span></span>
              <span class="re1">&lt;secret<span class="re2">&gt;</span></span><span class="co3">ComponentPass</span><span class="re1">&lt;/secret<span class="re2">&gt;</span></span>
            <span class="re1">&lt;/connect<span class="re2">&gt;</span></span>
          <span class="re1">&lt;/service<span class="re2">&gt;</span></span>
&#160;
          <span class="re1">&lt;service</span> <span class="re0">id</span>=<span class="st0">&quot;conference.somedomain.com&quot;</span><span class="re2">&gt;</span>
&#160;
            <span class="re1">&lt;load<span class="re2">&gt;</span></span>
               <span class="re1">&lt;conference<span class="re2">&gt;</span></span><span class="co3">/usr/local/jabber/mu-conference/src/mu-conference.so</span><span class="re1">&lt;/conference<span class="re2">&gt;</span></span>
            <span class="re1">&lt;/load<span class="re2">&gt;</span></span>
&#160;
            <span class="re1">&lt;conference</span> <span class="re0">xmlns</span>=<span class="st0">&quot;jabber:config:conference&quot;</span><span class="re2">&gt;</span>
              <span class="re1">&lt;public</span><span class="re2">/&gt;</span>
&#160;
              <span class="re1">&lt;vCard<span class="re2">&gt;</span></span>
          <span class="re1">&lt;FN<span class="re2">&gt;</span></span><span class="co3">Public Chatrooms</span><span class="re1">&lt;/FN<span class="re2">&gt;</span></span>
          <span class="re1">&lt;DESC<span class="re2">&gt;</span></span><span class="co3">This service is for public chatrooms.</span><span class="re1">&lt;/DESC<span class="re2">&gt;</span></span>
              <span class="re1">&lt;/vCard<span class="re2">&gt;</span></span>
&#160;
              <span class="re1">&lt;history<span class="re2">&gt;</span></span><span class="co3">50</span><span class="re1">&lt;/history<span class="re2">&gt;</span></span>
&#160;
              <span class="re1">&lt;logdir<span class="re2">&gt;</span></span><span class="co3">/usr/local/var/jabberd/log/muc/</span><span class="re1">&lt;/logdir<span class="re2">&gt;</span></span>
&#160;
              <span class="re1">&lt;sadmin<span class="re2">&gt;</span></span>
          <span class="re1">&lt;user<span class="re2">&gt;</span></span><span class="co3">admin@somedomain.com</span><span class="re1">&lt;/user<span class="re2">&gt;</span></span>
              <span class="re1">&lt;/sadmin<span class="re2">&gt;</span></span>
&#160;
              <span class="re1">&lt;notice<span class="re2">&gt;</span></span>
          <span class="re1">&lt;join<span class="re2">&gt;</span></span><span class="co3">has become available</span><span class="re1">&lt;/join<span class="re2">&gt;</span></span>
          <span class="re1">&lt;leave<span class="re2">&gt;</span></span><span class="co3">has left</span><span class="re1">&lt;/leave<span class="re2">&gt;</span></span>
          <span class="re1">&lt;rename<span class="re2">&gt;</span></span><span class="co3">is now known as</span><span class="re1">&lt;/rename<span class="re2">&gt;</span></span>
              <span class="re1">&lt;/notice<span class="re2">&gt;</span></span>
&#160;
            <span class="re1">&lt;/conference<span class="re2">&gt;</span></span>
&#160;
          <span class="re1">&lt;/service<span class="re2">&gt;</span></span>
&#160;
          <span class="re1">&lt;log</span> <span class="re0">id</span>=<span class="st0">&quot;muclog&quot;</span><span class="re2">&gt;</span>
            <span class="re1">&lt;file<span class="re2">&gt;</span></span><span class="co3">/usr/local/var/jabberd/log/muc.log</span><span class="re1">&lt;/file<span class="re2">&gt;</span></span>
            <span class="re1">&lt;host</span><span class="re2">/&gt;</span>
            <span class="re1">&lt;logtype</span><span class="re2">/&gt;</span>
            <span class="re1">&lt;format<span class="re2">&gt;</span></span><span class="co3">%d: [%t] (%h):&#160;%s</span><span class="re1">&lt;/format<span class="re2">&gt;</span></span>
          <span class="re1">&lt;/log<span class="re2">&gt;</span></span>
&#160;
          <span class="re1">&lt;xdb</span> <span class="re0">id</span>=<span class="st0">&quot;xdb&quot;</span><span class="re2">&gt;</span>
            <span class="re1">&lt;host<span class="re2">&gt;</span></span><span class="co3">conference.somedomain.com</span><span class="re1">&lt;/host<span class="re2">&gt;</span></span>
&#160;
            <span class="re1">&lt;load<span class="re2">&gt;</span></span>
              <span class="re1">&lt;xdb_file<span class="re2">&gt;</span></span><span class="co3">/usr/local/jabber/xdb_file/xdb_file.so</span><span class="re1">&lt;/xdb_file<span class="re2">&gt;</span></span>
            <span class="re1">&lt;/load<span class="re2">&gt;</span></span>
&#160;
            <span class="re1">&lt;xdb_file</span> <span class="re0">xmlns</span>=<span class="st0">&quot;jabber:config:xdb_file&quot;</span><span class="re2">&gt;</span>
              <span class="re1">&lt;spool<span class="re2">&gt;</span></span><span class="co3">/usr/local/var/spool/jabber</span><span class="re1">&lt;/spool<span class="re2">&gt;</span></span>
            <span class="re1">&lt;/xdb_file<span class="re2">&gt;</span></span>
          <span class="re1">&lt;/xdb<span class="re2">&gt;</span></span>
&#160;
        <span class="re1">&lt;/jabber<span class="re2">&gt;</span></span></pre></div></div>
<p><b>C 检查点: 测试你的外部组件</b>
</p>
<dl><dd>一旦你的外部组件安装好了, 你应该启动这个组件，在一个Jabberd 1.4进程中运行它，使用类似下面的命令:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>          <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>jabber<span class="sy0">/</span>jabberd<span class="sy0">/</span>jabberd <span class="re5">-c</span> <span class="sy0">/</span>etc<span class="sy0">/</span>jabber<span class="sy0">/</span>muc.xml</pre></div></div>
<p><i>-c</i> 参数为Jabberd 1.4指定一个配置文件. 在重启你的Jabberd 2服务器之后, 你的新的(外部)服务应该已经运行了. 在这个 MU Conference 的例子中, 你应该能通过一个兼容客户端来配置多用户聊天室了, 或通过包含在tarball里的脚本也可以配置.
</p>
<h3> <span class="mw-headline" id=".E4.BD.BF.E7.94.A8JCR.E4.BD.9C.E4.B8.BAJabberd_2.E7.BB.84.E4.BB.B6">使用JCR作为Jabberd 2组件</span></h3>
<p>因为Jabberd 2服务器比较新, 只有很少的组件是特别为Jabberd 2服务器开发的. 然而, Paul Curtis 写了一个组件封装器 <a rel="nofollow" class="external text" href="http://jabber.terrapin.com/JCR/">Jabber Component Runtime</a> ，可作为Jabberd 2服务的外部组件来运行. Jabber Runtime Component (JCR) 允许用C语言写的Jabberd 1.4组件运行于独立进程来连接到Jabberd 2. 在撰写本文的时候, 只有 MU Conference 和 Yahoo! transport 通过了 JCR 封装测试.JCR如何与Jabberd 2整合，参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Jabberd_2.E4.BB.A3.E7.90.86.E5.85.A5.E9.97.A8" title="Jabberd2:安装和管理指南">附录11</a> .
</p><p>JCR封装器会生成一个二进制文件来运行代理或服务. 实际上, 这个二进制文件提供的所有服务就是一个独立的用于代理或服务的Jabberd 1.4x进程. JCR包的INSTALL文件提供了使用说明, 而且也可以在 <a rel="nofollow" class="external text" href="http://mu-conference.jabberstudio.org/">MU Conference</a> 网站找到好用的说明.
</p><p>以下是一个例子，为MU Conference服务创建一个JCR的二进制文件的步骤:
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.B8.8B.E8.BD.BDJCR.E5.92.8CMU_Conference" title="Jabberd2:安装和管理指南">下载JCR和MU Conference</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E7.BC.96.E8.AF.91JCR.E5.BA.93" title="Jabberd2:安装和管理指南">编译JCR库</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E7.BC.96.E8.AF.91.E7.BB.84.E4.BB.B6" title="Jabberd2:安装和管理指南">编译组件</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.85.8D.E7.BD.AE.E7.BB.84.E4.BB.B6" title="Jabberd2:安装和管理指南">配置组件</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.90.AF.E5.8A.A8.E7.BB.84.E4.BB.B6" title="Jabberd2:安装和管理指南">启动组件</a>
</li></ul>
<p>撰写本文的时候, JCR 0.2.4 和 MU Conference 0.6.0 是最新版本并用于本示例.
</p>
<h4> <span class="mw-headline" id=".E4.B8.8B.E8.BD.BDJCR.E5.92.8CMU_Conference">下载JCR和MU Conference</span></h4>
<p>从 <a rel="nofollow" class="external text" href="http://jabber.terrapin.com/JCR">JCR主页</a> 下载最新的JCR包, 从 <a rel="nofollow" class="external text" href="http://mu-conference.jabberstudio.org/">MU Conference主页</a> 下载最新的MU Conference包，放到工作目录. 然后解压JCR包:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="kw2">tar</span> <span class="re5">-xzvf</span> jcr<span class="nu0">-0.2</span><span class="nu0">.4</span>.tar.gz</pre></div></div>
<p>JCR依赖于 <i>glib-2.0</i> . 在编译JCR库之前，你应该检查你的系统里是否已经装了它.
</p>
<h4> <span class="mw-headline" id=".E7.BC.96.E8.AF.91JCR.E5.BA.93">编译JCR库</span></h4>
<p>进入JCR目录之后编译JCR库:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="kw3">cd</span> jcr<span class="nu0">-0.2</span><span class="nu0">.4</span>
        <span class="kw2">make</span></pre></div></div>
<p>我和其他人注意到编译过程出现了一些以 <i>TERROR_</i> 开头的错误. 这些错误不影响正常使用JCR.
</p>
<h4> <span class="mw-headline" id=".E7.BC.96.E8.AF.91.E7.BB.84.E4.BB.B6">编译组件</span></h4>
<p>移动服务包(在这里是 <i>mu-conference-0.6.0.tar.gz</i> ), 到JCR目录(在这里是 <i>jcr-0.2.4</i> ), 然后把服务包解压到那里:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="kw2">mv</span> ..<span class="sy0">/</span>mu-conference<span class="nu0">-0.6</span><span class="nu0">.0</span>.tar.gz .<span class="sy0">/</span>
        <span class="kw2">tar</span> <span class="re5">-xzvf</span> mu-conference<span class="nu0">-0.6</span><span class="nu0">.0</span>.tar.gz</pre></div></div>
<p>拷贝JCR库文件( <i>main.c</i> 和 <i>jcomp.mk</i> ) 到服务的 <i>src</i> 目录:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="kw2">cp</span> src<span class="sy0">/</span>main.c mu-conference<span class="nu0">-0.6</span><span class="nu0">.0</span><span class="sy0">/</span>src<span class="sy0">/</span>
        <span class="kw2">cp</span> src<span class="sy0">/</span>jcomp.mk mu-conference<span class="nu0">-0.6</span><span class="nu0">.0</span><span class="sy0">/</span>src<span class="sy0">/</span></pre></div></div>
<p>然后 <i>cd</i> 到服务的 <i>src</i> 目录并编译JCR组件:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="kw3">cd</span> mu-conference<span class="nu0">-0.6</span><span class="nu0">.0</span><span class="sy0">/</span>src<span class="sy0">/</span>
        <span class="kw2">make</span> <span class="re5">-f</span> jcomp.mk</pre></div></div>
<p>编译过程应该会产生一个名为 <i>mu-conference</i> 的二进制文件(在 <i>mu-conference/src/</i> 目录). 这个二进制文件为Jabberd 2提供MU Conference服务. 拷贝这个二进制文件到一个bin目录, 例如 <i>/usr/local/bin</i> .
</p>
<h4> <span class="mw-headline" id=".E9.85.8D.E7.BD.AE.E7.BB.84.E4.BB.B6">配置组件</span></h4>
<p>JCR包的 <i>src</i> 目录包含一个示例配置文件( <i>muc_conf.xml</i> ) 用于MU Conference. 拷贝这个文件到你的Jabberd 2配置文件所在的目录, 例如 <i>/etc/jabberd</i> 或 <i>/usr/local/etc/jabberd</i> .
</p><p>为你自己的安装编辑 <i>muc_conf.xml</i> . 在 <i>muc_conf.xml</i> 里, 设置用于 <i>spool</i> , <i>logdir</i> (有两个log目录) 和 <i>pidfile</i> 的目录. 它们应该被设置到你的jabber用户有足够权限的目录. (注意 <i>spool</i> 参照spool <i>目录</i> .) 把 <i>host</i> 设置成一个你的客户端可以解析的名称. 把 <i>ip</i> 设置成你的Jabberd服务器的IP地址或主机名. 设置 <i>secret</i> 要符合你的 <i>router.xml</i> 文件中用来标识外部组件的 <i>secret</i> (位于 <i>local</i> 段落). 你也可以设置一个管理员JID( <i>sadmin</i> ).
</p><p>编辑你的 <i>router.xml</i> 文件来为这个服务提供一个别名. 在 <i>Name aliases</i> 段落,添加一个alias标识这个服务:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="re1">&lt;alias</span> <span class="re0">name</span>=<span class="st0">'conference.somedomain.com'</span> <span class="re0">target</span>=<span class="st0">'linker'</span><span class="re2">/&gt;</span></pre></div></div>
<p>在 <i>mu_conf.xml</i> 文件中 <i>conference.somedomain.com</i> 作为 <i>host</i> , <i>linker</i> 作为 <i>name</i> .
</p>
<h4> <span class="mw-headline" id=".E5.90.AF.E5.8A.A8.E7.BB.84.E4.BB.B6">启动组件</span></h4>
<p>重启你的Jabberd 2服务器使得修改生效, 然后启动 <i>mu-conference</i> 执行文件:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="kw2">su</span> jabber
        <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>bin<span class="sy0">/</span>mu-conference <span class="re5">-c</span> <span class="sy0">/</span>etc<span class="sy0">/</span>jabberd<span class="sy0">/</span>muc-conf.xml</pre></div></div>
<p>你的Jabber用户现在应该能浏览到 Public Chatrooms 服务, 而且他们应该能创建和使用群聊天室. <i>mu-conference</i> 执行文件启动的时候不会从终端断开. 你可能要使用 <a rel="nofollow" class="external text" href="http://www.jabberdoc.org/app_dtools.html">Daemon Tools</a> 来让 <i>mu-conference</i> 开机启动.
</p>
<h3> <span class="mw-headline" id=".E5.AE.89.E8.A3.85.E4.B8.80.E4.B8.AA.E4.BD.BF.E7.94.A8Users-Agent.E7.9A.84JUD">安装一个使用Users-Agent的JUD</span></h3>
<p>Ryan Eatmon已经更新了他的 Users-Agent JUD (Jabber用户目录)包来兼容Jabberd 2, 并且获得来自John Hamill的一些有价值的帮助之后, 我能让它和我的Jabberd 2安装一起跑了. Users-Agent是一个基于Perl的JUD，使用MySQL做数据存储. Jabber.org目前使用Users-Agent作为JUD.
</p><p><b>N 注意: JUD和vCard数据不是一回事</b>
</p>
<dl><dd>JUD提供给用户一个可搜索的数据库，他们可以从这找到联系人. JUD不是一个vCard数据的数据库. vCard数据是独立于JUD数据库的, 所以你不应该期望安装好的JUD包含现有的vCard数据. 反之, 用户必须通过注册来给JUD提供数据.
</dd></dl>
<p><b>N 注意: Fljud提供了LDAP和JUD的集成</b>
</p>
<dl><dd>如果你正使用OpenLDAP作为验证系统, 你可能想看看 <a rel="nofollow" class="external text" href="http://binary-ape.sourceforge.net/">Fljud</a> 产品. Fljud集成了JUD和LDAP数据.
</dd></dl>
<p>我已经记录了获取和运行Users-Agent的步骤; 然而, 我很有兴趣知道别人是怎么干的. 一个运行中的Users-Agent包包括三个元素:
</p>
<ul><li> <i>users-agent</i> (Perl脚本)
</li><li> <i>config.xml</i> (配置文件)
</li><li> <i>JUD</i> (MySQL数据库)
</li></ul>
<p><i>users-agent</i> 脚本是运行程序，它提供JUD服务. <i>users-agent</i> 脚本依赖于 <i>config.xml</i> 文件的配置. <i>config.xml</i> 文件必须和 <i>users-agent</i> 运行文件处于同一个目录 — 或者运行时使用 <i>-c</i> 选项指定 <i>config-xml</i> 的位置. <i>users-agent</i> 把所有数据存储在一个 MySQL数据库 <i>JUD</i> 里面. 这个包带了一个脚本 <i>createDB</i> ,用来安装 <i>JUD</i> 数据库.
</p><p>Users-Agent的安装包括7个步骤, 细节如下:
</p>
<ol><li><a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.AE.89.E8.A3.85.E5.BF.85.E9.9C.80.E7.9A.84Perl.E6.A8.A1.E5.9D.97" title="Jabberd2:安装和管理指南">安装必需的Perl模块</a>
</li><li><a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.B8.8B.E8.BD.BD.E5.B9.B6.E5.AE.89.E8.A3.85Users-Agent" title="Jabberd2:安装和管理指南">下载并安装Users-Agent</a>
</li><li><a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.88.9B.E5.BB.BAJUD.E6.95.B0.E6.8D.AE.E5.BA.93" title="Jabberd2:安装和管理指南">创建JUD数据库</a>
</li><li><a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E8.AE.BE.E7.BD.AEJUD.E6.95.B0.E6.8D.AE.E5.BA.93.E6.8E.88.E6.9D.83" title="Jabberd2:安装和管理指南">设置JUD数据库授权</a>
</li><li><a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.85.8D.E7.BD.AEconfig.xml" title="Jabberd2:安装和管理指南">配置config.xml</a>
</li><li><a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.B5.8B.E8.AF.95users-agent" title="Jabberd2:安装和管理指南">测试users-agent</a>
</li><li><a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E8.AE.BE.E7.BD.AEUsers-Agent.E4.BC.B4.E9.9A.8FJabberd_2.E5.90.AF.E5.8A.A8" title="Jabberd2:安装和管理指南">设置Users-Agent伴随Jabberd 2启动</a>
</li></ol>
<p>这些步骤可能看起来很复杂; 然而, 安装是相当直接的, 并且我已经尝试提供尽可能多的细节.
</p>
<h4> <span class="mw-headline" id=".E5.AE.89.E8.A3.85.E5.BF.85.E9.9C.80.E7.9A.84Perl.E6.A8.A1.E5.9D.97">安装必需的Perl模块</span></h4>
<p>Users-Agent依赖于以下三个Perl模块:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>        Net::Jabber v1.30
        XML::Stream v1.18
        DBI</pre></div></div>
<p>更多关于这些模块的信息, 参见 <a rel="nofollow" class="external text" href="http://www.cpan.org/">CPAN</a> 网站. 安装它们(包括任何依赖)的最简单的办法是使用Perl的 <a rel="nofollow" class="external text" href="http://search.cpan.org/~andk/CPAN-1.76/lib/CPAN.pm">CPAN.pm</a> 安装工具. 要安装这些Perl模块, 运行以下指令(以超级用户身份)进入 <i>cpan</i> shell:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="kw2">perl</span> <span class="re5">-MCPAN</span> <span class="re5">-e</span> shell</pre></div></div>
<p>如果这是你第一次使用 <i>cpan</i> shell, 你将进入一个交互安装脚本. 一旦完成, 你就可以安装上述的包了(此时仍在 <i>cpan</i> shell环境):
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        cpan<span class="sy0">&gt;</span> <span class="kw2">install</span> Net::Jabber
&#160;
        cpan<span class="sy0">&gt;</span> <span class="kw2">install</span> XML::Stream
&#160;
        cpan<span class="sy0">&gt;</span> <span class="kw2">install</span> DBI</pre></div></div>
<p>这些安装完成之后, 你才可以安装Users-Agent. 如果你需要安装其他Perl模块, 你可以使用这个命令( <i>perl -MCPAN -e shell</i> )进入 <i>cpan</i> shell .
</p>
<h4> <span class="mw-headline" id=".E4.B8.8B.E8.BD.BD.E5.B9.B6.E5.AE.89.E8.A3.85Users-Agent">下载并安装Users-Agent</span></h4>
<p>选择一个目录来安装Users-Agent. 在以下例子中, User-Agent安装在 <i>/etc/jabberd</i> .
</p><p>从你选择的目录, 从 <a rel="nofollow" class="external text" href="http://www.jabberstudio.org/">Jabberstudio.org</a> 下载最新版本的 <a rel="nofollow" class="external text" href="http://www.jabberstudio.org/projects/users-agent/releases/">Users-Agent</a> 包 . 下面例子的版本是 Users-Agent 1.1.
</p><p>解压Users-Agent包, 然后切换到刚建的目录:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="kw2">tar</span> <span class="re5">-zxvf</span> users-agent<span class="nu0">-1.1</span>.tar.gz
        <span class="kw3">cd</span> users-agent<span class="nu0">-1.1</span></pre></div></div>
<p>Users-Agent装好了.
</p>
<h4> <span class="mw-headline" id=".E5.88.9B.E5.BB.BAJUD.E6.95.B0.E6.8D.AE.E5.BA.93">创建JUD数据库</span></h4>
<p>Users-Agent包自带了一个 <i>createDB</i> 脚本用来创建 MySQL <i>JUD</i> 数据库. 这个脚本需要对现有的 MySQL 数据库的临时访问权以连接到MySQL并安装 <i>JUD</i> 数据库. 最简单的办法就是临时把你的 MySQL root 密码清空，命令如下:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        mysqladmin <span class="re5">-u</span> root <span class="re5">-p</span> password <span class="st0">&quot;&quot;</span></pre></div></div>
<p>另一个办法是, 你可以编辑 <i>createDB</i> 脚本的第13行和第17行，那里有你的 MySQL root 密码 (在引号之间输入密码). 然而, 如果你不禁用你的MySQL root密码, 你必须在运行 <i>createDB</i> 之前 export <i>DBI_DRIVER</i> 环境变量 . <i>DBI_DRIVER</i> 变量应该被设成 <i>dbi:mysql:test:localhost</i> , 这里 <i>test</i> 指的是一个运行中的MySQL数据库.
</p><p>一旦你禁用你的MySQL root密码(或编辑了 <i>createDB</i> 并设置了 <i>DBI_DRIVER</i> 变量), 运行这个脚本来创建你的 <i>JUD</i> 数据库:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        .<span class="sy0">/</span>createDB</pre></div></div>
<p>在你创建数据库之后, 你应该重置你的MySQL root密码:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        mysqladmin <span class="re5">-u</span> root password <span class="st0">&quot;oldrootpassword&quot;</span></pre></div></div>
<p>然后, 你可以进入mysql console检查这个数据库:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        mysql <span class="re5">-u</span> root <span class="re5">-p</span>
&#160;
        mysql<span class="sy0">&gt;</span> show databases;
        +----------+
        <span class="sy0">|</span> Database <span class="sy0">|</span>
        +----------+
        <span class="sy0">|</span> JUD      <span class="sy0">|</span>
        <span class="sy0">|</span> jabberd2 <span class="sy0">|</span>
        <span class="sy0">|</span> mysql    <span class="sy0">|</span>
        <span class="sy0">|</span> <span class="kw3">test</span>     <span class="sy0">|</span>
        +----------+
        <span class="nu0">4</span> rows <span class="kw1">in</span> <span class="kw1">set</span> <span class="br0">&#40;</span><span class="nu0">0.00</span> sec<span class="br0">&#41;</span></pre></div></div>
<p>现在 <i>JUD</i> 数据库装好了.
</p>
<h4> <span class="mw-headline" id=".E8.AE.BE.E7.BD.AEJUD.E6.95.B0.E6.8D.AE.E5.BA.93.E6.8E.88.E6.9D.83">设置JUD数据库授权</span></h4>
<p>创建 <i>JUD</i> 数据库之后, 需要对它进行授权. 如果你使用MySQL来为Jabberd 2做验证或存储, 你已经有一个MySQL用户可以用于 <i>JUD</i> 数据库. 如果是这种情况, 进入MySQL控制台并运行这个SQL指令来授权MySQL用户jabberd2允许访问 <i>JUD</i> 数据库(如果你不是使用缺省的MySQL用户那么替换掉 <i>jabberd2</i> ):
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        mysql <span class="re5">-u</span> root <span class="re5">-p</span>
&#160;
        mysql<span class="sy0">&gt;</span> use JUD;
        mysql<span class="sy0">&gt;</span> GRANT ALL PRIVILEGES ON <span class="sy0">*</span>.<span class="sy0">*</span> TO <span class="st0">'jabberd2'</span><span class="sy0">@</span><span class="st0">'localhost'</span> WITH GRANT OPTION;</pre></div></div>
<p>如果你的Jabberd 2正在使用MySQL但是不记得你的MySQL用户名, 打开 <i>sm.xml</i> 或 <i>c2s.xml</i> 并扫描以下段落 <i>MySQL driver configuration</i> , 那里可以找到连接Jabberd 2的 <i>user</i> 和密码( <i>pass</i> ) .
</p><p>如果你没有使用MySQL来验证或者存储, 你应该运行一个稍微不同的SQL指令来创建一个新的MySQL用户以及密码，<i>users-agent</i> 将用它来连接MySQL(把 <i>secret_password</i> 替换成你打算用来连接MySQL的用户的密码):
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        mysql <span class="re5">-u</span> root <span class="re5">-p</span>
&#160;
        mysql<span class="sy0">&gt;</span> use JUD;
        mysql<span class="sy0">&gt;</span> GRANT ALL PRIVILEGES ON <span class="sy0">*</span>.<span class="sy0">*</span> TO <span class="st0">'jabberd2'</span><span class="sy0">@</span><span class="st0">'localhost'</span>
            -<span class="sy0">&gt;</span> IDENTIFIED BY <span class="st0">'secret_password'</span> WITH GRANT OPTION;</pre></div></div>
<p>完成授权之后, 你可以用你的jabberd2用户启动MySQL控制台来进行测试. 你的 <i>jabberd2</i> 需要一个MySQL密码(如上创建一个密码或在 <i>sm.xml</i> 找到密码) to start the console:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        mysql <span class="re5">-u</span> jabberd2 <span class="re5">-p</span>
&#160;
        mysql<span class="sy0">&gt;</span> use JUD;
        mysql<span class="sy0">&gt;</span> <span class="kw1">select</span> <span class="sy0">*</span> from jud;</pre></div></div>
<p>你应该接收到类似这样的输出: <i>Empty set (0.01 sec)</i> . 你的 <i>JUD</i> 数据库现在准备好让 <i>users-agent</i> 使用了.
</p>
<h4> <span class="mw-headline" id=".E9.85.8D.E7.BD.AEconfig.xml">配置config.xml</span></h4>
<p>Users-Agent依赖于 <i>config.xml</i> 用于配置. 在一个文本编辑器打开 <i>config.xml</i> . 为了让Users-Agent运行, 我编辑了以下6个标签的值:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>        <span class="re1">&lt;hostname<span class="re2">&gt;</span></span>
        <span class="re1">&lt;port<span class="re2">&gt;</span></span>
        <span class="re1">&lt;secret<span class="re2">&gt;</span></span>
        <span class="re1">&lt;name<span class="re2">&gt;</span></span>
        <span class="re1">&lt;username<span class="re2">&gt;</span></span>
        <span class="re1">&lt;password<span class="re2">&gt;</span></span></pre></div></div>
<ol><li>编辑 <i>hostname</i> 值，为你的Jabberd 2服务器提供主机名. 它应该和 <i>sm.xml</i> 文件中的 <i>id</i> 相同.
</li><li>编辑 <i>port to</i> 提供Jabberd 2 router监听的端口号. 缺省是 <i>5347</i> .
</li><li>编辑 <i>secret</i> 来提供Jabberd 2 router用来连接外部组件的共享 <i>secret</i> . 你正在使用的这个共享 <i>secret</i> 可以在 <i>router.xml</i> 文件顶部附近找到. 在标为 <i>Local Network configuration</i> 的段落查找 <i>secret</i> 标签.
</li><li>编辑 <i>name</i> 来提供 <i>Users-Agent</i> 使用的主机名. 这个主机名类似 <i>users.somedomain.com</i> , <i>users.jabber.somedomain.com</i> , <i>jud.somedomain.com</i> , 等等. 如果你的客户端要从互联网访问它，那么这个主机名必须是可以被DNS解析的.
</li><li>编辑 <i>username</i> 来提供MySQL用户(参见 5.10.4.). 对于缺省安装来说, 这个 <i>username</i> 就是 <i>jabberd2</i> .
</li><li>编辑 <i>password</i> 来提供MySQL用户的密码(参见 5.10.4.). 再一次的,这个 <i>password</i> 可以在 <i>sm.xml</i> 或 <i>c2s.xml</i> 里找到如果你已经在Jabberd 2里使用了MySQL.
</li></ol>
<p>现在 <i>users-agent</i> 配置好了可以用了.
</p>
<h4> <span class="mw-headline" id=".E6.B5.8B.E8.AF.95users-agent">测试users-agent</span></h4>
<p>现在你应该启动并测试 <i>users-agent</i> . 确保你的Jabberd 2和MySQL服务器正在运行. 然后, 启动 <i>users-agent</i>&#160;:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="kw2">su</span> jabber      
        .<span class="sy0">/</span>users-agent</pre></div></div>
<p>Users-Agent应该无错误的启动, 并且它不会退出. Users-Agent不会把自己推到后台运行, 所以它应该保持运行在终端里.
</p><p>从你的Jabberd客户端登录到你的服务器. 随着 <i>users-agent</i> 的运行, 你应该能看到一个可用的服务 <i>Users-Agent</i> . 你的客户端如何显示它依赖于客户端的类型. 这个 <i>Users-Agent</i> 服务应该提供 <i>Register</i> 和 <i>Search</i> 选项.
</p><p>你的 <i>JUD</i> 数据库是空的, 所以你需要注册一些用户来测试它. 从你的Jabber客户端, 选择 <i>Register</i> (在Jabebrd客户端这通常是右键点击选项). 你应该看到这个服务的注册选项，包括一个表单让你输入个人信息.
</p><p><b>I 重要: 客户端的选择会影响代理的使用</b>
</p>
<dl><dd>测试期间, 我不是总能通过测试客户端来获得Users-Agent. 在Linux下, PSI看起来反应良好; 然而, 用户初次尝试注册的时候PSI不显示注册表单. 用户必须注册一次然后再次注册来添加任何数据. 在Windows下, JAJC和Exodus表现良好; 然而, JAJC, 右击 <i>Users-Agent</i> 时不提供 <i>register</i> 和 <i>search</i> 选项. 在JAJC选择 <i>Discovery (info)</i> 无法提供信息. Exodus是我测试过的所有客户端(PSI, Gabber, Gnome-Gabber, Kopete, Exodus, JAJC 和 Neos)中表现最好的.
</dd></dl>
<p>现在, 你应该能准确搜索Users-Agent. 从你的客户端, 返回这个服务并选择 <i>Search</i> . 你应该看到一个搜索表单.
</p><p><b>I 重要: Users-Agent支持局部匹配</b>
</p>
<dl><dd> <i>Users-Agent</i> 支持局部匹配搜索. 不需要也不使用通配符.
</dd></dl>
<p>你应该能够通过搜索注册表单中的任何字段的头一个字母搜索到刚才注册的用户.
</p>
<h4> <span class="mw-headline" id=".E8.AE.BE.E7.BD.AEUsers-Agent.E4.BC.B4.E9.9A.8FJabberd_2.E5.90.AF.E5.8A.A8">设置Users-Agent伴随Jabberd 2启动</span></h4>
<p>当你的Users-Agent配置好运行之后, 你可能希望把它添加到你的"app_rc.html脚本来伴随Jabberd 2启动和停止, 或者你可以选择使用 <a rel="nofollow" class="external text" href="http://www.jabberdoc.org/app_dtools.html">Daemon Tools</a> 来监控它.
</p><p><b>I 重要: 如果User-Agent无法连接Router就会挂掉</b>
</p>
<dl><dd>如果 <i>users-agent</i> 不能连接到 <i>router</i> 组件就会挂掉. 这意味着如果你的Jabberd 2服务器停止或挂掉, <i>users-agent</i> 将会挂掉并且需要重启. 你可能希望使用 <a rel="nofollow" class="external text" href="http://www.jabberdoc.org/app_dtools.html">Daemon Tools</a> 来确保 <i>users-agent</i> 总是在它无法连接 <i>router</i> 时重启启动.
</dd></dl>
<h3> <span class="mw-headline" id=".E9.9B.86.E6.88.90vCard.E6.95.B0.E6.8D.AE.E5.88.B0Users-Agent.28.E4.BB.85.E9.99.90.E7.A7.81.E6.9C.89.E6.9C.8D.E5.8A.A1.E5.99.A8.29">集成vCard数据到Users-Agent(仅限私有服务器)</span></h3>
<p>我已经为Users-Agent写了一个补丁来让Jabberd 2 vCard数据成为Users-Agent的数据源. 应用它之后, Users-Agent使用Jabberd vCard表来搜索和注册. 也就是说, 用户更新他们自己的vCards会被反应到Users-Agent JUD搜索结果里. 用户可以使用常规方法更新他们的vCard数据, 他们也可以通过Users-Agent注册流程来更新Users-Agent字段 (first name, last name, nickname 和 email).
</p><p><b>I 重要: JUD和vCard数据不应该(SHOULD NOT)被集成到公共服务器中</b>
</p>
<dl><dd>这个补丁仅仅用于私有服务器. 在公共服务器, 用户对vCards如何展示个人信息拥有完全的控制. 一个用户可以通过验证那个用户来允许另一个用户显示个人vCard数据，也可以手工注册到JUD. 
</dd></dl>
<p>这个补丁仅用于私有的Jabberd 2服务器, 这些可以用于公司或教育机构. 对它们来说, 经常需要让每个用户很方便的搜索到全部用户列表. 注意, 无论如何, 即时本补丁应用之后, 每个用户也必须创建一个vCard条目才能在Users-Agent JUD里可见.
</p><p><b>I 重要: 补丁未进行高负载的测试</b>
</p>
<dl><dd>这个补丁还未进行经过压力测试. 
</dd></dl>
<p>为了应用本补丁, 首先让Users-Agent跑起来，参见 5.10. 然后, 下载 <a rel="nofollow" class="external text" href="http://www.jabberdoc.org/tools/users-agent.vcard.patch">users-agent.vcard.patch</a> 到你的 <i>users-agent</i> 文件安装的目录. 使用以下指令应用这个补丁:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw2">patch</span> <span class="re5">-p0</span> <span class="sy0">&lt;</span> users-agent.vcard.patch</pre></div></div>
<p>编辑 <i>config.xml</i> 把 <i>dbname</i> 设为你的Jabberd 2 MySQL数据库(通常是 <i>jabberd2  ). 如果必要也编辑 </i>username<i> 和 </i>password<i> . 重启 </i>users-agent<i> , 现在它应该连接到Jabberd 2 vCard数据了.</i>
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section05/html2pdf">以PDF格式查看</a>
</p>
<h2> <span class="mw-headline" id=".E5.B8.B8.E8.A7.84.E7.AE.A1.E7.90.86.E4.BB.BB.E5.8A.A1">常规管理任务</span></h2>
<p>本章尝试为日复一日的Jabberd管理任务，包括用户管理，提供一个指南.
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.90.AF.E5.8A.A8.E5.92.8C.E5.81.9C.E6.AD.A2Jabberd_2" title="Jabberd2:安装和管理指南">启动和停止Jabberd 2</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.BB.8EJabberd_1.4.E8.BF.81.E7.A7.BB" title="Jabberd2:安装和管理指南">从Jabberd 1.4迁移</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.B7.BB.E5.8A.A0.E7.94.A8.E6.88.B7" title="Jabberd2:安装和管理指南">添加用户</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.88.A0.E9.99.A4.E7.94.A8.E6.88.B7" title="Jabberd2:安装和管理指南">删除用户</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.8F.91.E9.80.81MOTD.E5.92.8C.E6.B6.88.E6.81.AF.E7.BB.99.E6.89.80.E6.9C.89.E5.9C.A8.E7.BA.BF.E7.94.A8.E6.88.B7" title="Jabberd2:安装和管理指南">发送MOTD和消息给所有在线用户</a>
</li></ul>
<p>详细的配置信息在下一章.
</p>
<h3> <span class="mw-headline" id=".E5.90.AF.E5.8A.A8.E5.92.8C.E5.81.9C.E6.AD.A2Jabberd_2">启动和停止Jabberd 2</span></h3>
<p>本节描述如何启动和停止Jabberd 2执行文件. 以RC脚本来运行Jabberd 2，参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.99.84.E5.BD.95" title="Jabberd2:安装和管理指南">附录7</a> 或使用Daemontools来运行Jabberd 2,参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.99.84.E5.BD.95" title="Jabberd2:安装和管理指南">附录8</a> .
</p>
<h4> <span class="mw-headline" id=".E5.90.AF.E5.8A.A8Jabberd_2">启动Jabberd 2</span></h4>
<p><i>jabberd</i> 启动脚本启动Jabberd 2服务. 这个脚本被安装在Jabberd 2二进制文件的同一个目录下(缺省为 <i>/usr/local/jabberd</i> ).  要启动这个服务器, 切换到 <i>jabber</i> 用户然后运行启动脚本:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        <span class="kw2">su</span> jabber
        <span class="sy0">/</span>usr<span class="sy0">/</span><span class="kw3">local</span><span class="sy0">/</span>bin<span class="sy0">/</span>jabberd</pre></div></div>
<p>这个脚本包含了五个Jabberd 2执行文件的启动. 这个脚本为每个Jabberd 2执行文件指定了相关的配置文件(缺省位于 <i>/usr/local/etc/jabberd</i> ).
</p>
<h4> <span class="mw-headline" id=".E5.81.9C.E6.AD.A2Jabberd_2">停止Jabberd 2</span></h4>
<p>目前Jabberd 2没有停止脚本; 所以必须手工杀死5个Jabberd 2进程来停止服务器. 为了停止服务器, 要杀死以下进程(以root或jabber用户身份都可以):
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>        router
        resolver
        sm
        c2s
        s2s</pre></div></div>
<p>停止以上进程中的一个可能导致另一个挂掉; 然而, 重要的是在尝试重启之前必须确保所有Jabberd 2进程已经杀死. 单个运行的进程可能会导致服务器无法重启.
</p>
<h3> <span class="mw-headline" id=".E4.BB.8EJabberd_1.4.E8.BF.81.E7.A7.BB">从Jabberd 1.4迁移</span></h3>
<p>Robert Norris, Jabberd的主要开发者, 已经创建了一个Perl脚本把Jabberd 1.4数据迁移到MySQL或PostgreSQL. 特别要注意, 这个脚本只迁移验证信息和好友列表. <a rel="nofollow" class="external text" href="http://www.jabberstudio.org/cgi-bin/viewcvs.cgi/jabberd2/tools/migrate.pl#dirlist">migrate.pl</a> 脚本目前可以从jabberstudio.org的CVS获得; 不过, 下一个版本的Jabberd 2会带上它.
</p><p>基本上, 这个脚本像一个服务一样工作，连接到一个现有的Jabberd 1.4安装, 然后导出到一个现有的Jabberd 2数据库. 它有很多依赖(在脚本里列出来了):
</p>
<ul><li> XML::Stream 1.17 或更高版本 (来自 JabberStudio)
</li><li> Net::Jabber 1.29 或更高版本 (来自 JabberStudio)
</li><li> Digest::SHA1
</li><li> DBI
</li><li> DBD::Pg 或 DBD::mysql
</li></ul>
<p><a rel="nofollow" class="external text" href="http://www.jabberstudio.org/cgi-bin/viewcvs.cgi/jabberd2/tools/migrate.pl#dirlist">migrate.pl</a> 文件包含完整的使用说明.
</p>
<h3> <span class="mw-headline" id=".E6.B7.BB.E5.8A.A0.E7.94.A8.E6.88.B7">添加用户</span></h3>
<p>在本文写就的时刻, 没有脚本用来添加用户; 然而, 用户可以很容易的加入到一个MySQL或PostgreSQL数据库. 本章描述如何添加一个用户到一个MySQL数据库. 天极一个用户到PostgreSQL, 也是类似的. 本章假设已经禁止了公开注册(参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E7.A6.81.E6.AD.A2.E5.85.AC.E5.BC.80.E6.B3.A8.E5.86.8C" title="Jabberd2:安装和管理指南">5.5章</a>).
</p><p><b>N 注意</b>
</p>
<dl><dd>Jabberd 2不支持从Berkeley DB验证存储来添加或删除用户的机制.
</dd></dl>
<h4> <span class="mw-headline" id=".E5.85.81.E8.AE.B8Auto-Create">允许Auto-Create</span></h4>
<p>在 <i>sm.xml</i> 的 <i>user</i> 段落包含了一个标签 <i>auto-create</i> , 允许这个标签可以使得一个用户在初次登录时被存储包自动创建(如果这个用户不存在于数据库中的话). 当这个标签被允许, 用户可以被手工添加到验证( <i>authreg</i> ) 数据库, 并且每个用户初次登录的时候, Jabberd将为那个用户创建好友列表, 模板, 等等. 特别注意的是, 当一个新的用户初次登录的时候, <i>auto-create</i> 标签会导致 <i>user-create</i> 链被调用.
</p><p>缺省Auto-create是禁用的. 为了激活它, 在 <i>sm.xml</i> 文件的  <i>user</i> 段落取消注释 <i>auto-create</i> 标签. 这个标签靠近 <i>sm.xml</i> 文件的结尾.
</p>
<h4> <span class="mw-headline" id=".E4.BB.8EMySQL.E6.8E.A7.E5.88.B6.E5.8F.B0.E5.88.9B.E5.BB.BA.E7.94.A8.E6.88.B7">从MySQL控制台创建用户</span></h4>
<p>现在 <i>auto-create</i> 激活了, 你可以从MySQL控制台创建一个用户.
</p><p>以Jabberd用户登录到MySQL控制台:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        mysql <span class="re5">-u</span> jabberd2 <span class="re5">-p</span></pre></div></div>
<p>从MySQL控制台, 切换到 <i>jabberd2</i> 数据库:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        mysql<span class="sy0">&gt;</span> use jabberd2</pre></div></div>
<p>从MySQL控制台, 插入一行到 <i>authreg</i> 表. 这一行应该包含 <i>username</i> , <i>realm</i> 和 <i>password</i> 的值:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>        mysql<span class="sy0">&gt;</span> insert into authreg <span class="br0">&#40;</span>username, realm, password<span class="br0">&#41;</span>
            -<span class="sy0">&gt;</span> values <span class="br0">&#40;</span><span class="st0">'myusername'</span>, <span class="st0">'somedomain.com'</span>, <span class="st0">'mypassword'</span><span class="br0">&#41;</span>;</pre></div></div>
<p>把 <i>somedomain.com</i> 修改成符合你的配置的值. 大部分情况下, realm将会和Jabber服务器的ID相同. 把 <i>myusername</i> 和 <i>mypassword</i> 修改成你的新用户的名称和密码.
</p><p>你的新用户现在可以用Jabber客户端登录了.
</p>
<h3> <span class="mw-headline" id=".E5.88.A0.E9.99.A4.E7.94.A8.E6.88.B7">删除用户</span></h3>
<p>MySQL控制台也可以用来从一个MySQL验证数据库( <i>authreg</i> )删除用户. 输入这个命令来删除用户:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      mysql<span class="sy0">&gt;</span> delete from authreg where <span class="re2">username=</span><span class="st0">'the_user_name'</span>;</pre></div></div>
<p>注意从 <i>authreg</i> 表删除用户将不会删除其他的用户数据, 例如好友列表; 然而, 一旦该用户被从 <i>authreg</i> 删除, 这个用户将不再能登录到这个Jabberd服务器.
</p>
<h3> <span class="mw-headline" id=".E5.8F.91.E9.80.81MOTD.E5.92.8C.E6.B6.88.E6.81.AF.E7.BB.99.E6.89.80.E6.9C.89.E5.9C.A8.E7.BA.BF.E7.94.A8.E6.88.B7">发送MOTD和消息给所有在线用户</span></h3>
<p>发送MOTD's(当日消息)和消息给所有在线用户，必须从拥有广播权限的管理员账户来发. 如何授权参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.88.9B.E5.BB.BA.E7.AE.A1.E7.90.86.E5.91.98.E7.94.A8.E6.88.B7" title="Jabberd2:安装和管理指南">5.4章</a>. 一旦用户拥有广播的权限, 这些消息就可以从Jabber客户端来发送. 为你创建的管理员用户增加以下联系人:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>      somedomain.com/announce
&#160;
      somedomain.com/announce/online</pre></div></div>
<p>发送一个消息到 <i>somedomain.com/announce</i> 将会发送一个Jabber MOTD到这个域的所有用户. 离线用户将在下次登录的时候接收到消息. 发送一个消息到 <i>somedomain.com/announce/online</i> 将只向在线用户发送消息. 注意如果你的Jabber客户端不提供显式支持MOTD's, 你可以上述的JID添加一个联系人, 然后使用那个联系人发送MOTD's.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section06/html2pdf">以PDF格式查看</a>
</p>
<h2> <span class="mw-headline" id="Router.xml.E9.85.8D.E7.BD.AE">Router.xml配置</span></h2>
<p><i>router.xml</i> 文件提供 <i>router</i> 组件的配置, 它是Jabberd服务器的中枢. router组件接受从其他组件的连接, 然后在它们之间传递XML包. <i>router.xml</i> 文件包含了以下主要章节:
</p>
<ul><li>ID,PID和日志
</li><li>网络
</li><li>输入输出控制
</li><li>别名
</li><li>功能访问控制
</li></ul>
<p>读者们可能都知道, Jabberd XML文件是自文档化的. 本章和子章节的配置段落仅尝试提供这些文件的结构概览以及一些文档本身未提到的小技巧.
</p>
<h3> <span class="mw-headline" id="ID.2CPID.E5.92.8C.E6.97.A5.E5.BF.97">ID,PID和日志</span></h3>
<p><i>router.xml</i> 最前面的三个子段落处理基本的后勤项目. 对于几乎所有的安装来说, <i>id</i> 段落应该保留缺省值( <i>router</i> ). <i>pid</i> 段落指定 <i>router</i> 组件在哪里写入它的进程ID. 如果你不需要从Jabberd外部读取进程ID, 你可以屏蔽掉这个段落. 例如, 如果你使用D.J. Bernstein的DaemonTools来运行Jabberd, 你可以注释掉 <i>pid</i> 段落.
</p><p>Jabberd日志缺省记录到 <i>syslog</i> . 如果你倾向于让 <i>router</i> 把日志写到它自己的日志文件, 把 <i>log type</i> 改为 <i>file</i> , 并指定日志所在位置.
</p>
<h3> <span class="mw-headline" id=".E7.BD.91.E7.BB.9C">网络</span></h3>
<p><i>local</i> 子段落处理 <i>router</i> 的网络和连接设置. <i>ip</i> 和 <i>port</i> 标签指定网络设置.
</p><p><b>N 注意: 0.0.0.0 代表所有可用的IP</b>
</p>
<dl><dd>注意在所有这些Jabberd XML文件中, IP地址 <i>0.0.0.0</i> 表示这个组件应该监听所有可用的IP地址. <i>0.0.0.0</i> 是IP地址的缺省设置, 并且对大部分安装来说保留这个缺省值是不会错的.
</dd></dl>
<p><i>users</i> 标签指定包含用户ID和密码的文件，这些用户可以访问 <i>router</i> . 该文件的描述参见下一章.
</p><p><i>secret</i> 标签指定一个共享的安全码用于外部服务. 外部服务通过共享安全码来进行验证, 反之则通过 <i>router-users.xml</i> 文件中的用户列表来验证. <i>secret</i> 和Jabberd 1.4连接配置文件中的共享安全码是一样的作用. 参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.BD.BF.E7.94.A8Jabberd_1.4.E8.BF.9E.E6.8E.A5.E5.A4.96.E9.83.A8.E6.9C.8D.E5.8A.A1" title="Jabberd2:安装和管理指南">5.8</a> 和 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.BD.BF.E7.94.A8JCR.E4.BD.9C.E4.B8.BAJabberd_2.E7.BB.84.E4.BB.B6" title="Jabberd2:安装和管理指南">5.9</a> 中如何设置外部服务.
</p><p><i>pemfile</i> 位置指定证书文件和私钥的位置用于客户端通讯. 注意在这个例子里, 客户端值的是相对于 <i>router</i> 的客户端, 而不是最终用户的Jabber客户端. 换句话说, 这里的 <i>pemfile</i> 是用于其他Jabberd组件和 <i>router</i> 本身之间的安全通讯. 要了解更多在Jabberd中设置SSL的信息，参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.85.8D.E7.BD.AEJabberd_2.E4.BD.BF.E7.94.A8SSL.E8.BF.9E.E6.8E.A5" title="Jabberd2:安装和管理指南">5.2</a> 和 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.99.84.E5.BD.95" title="Jabberd2:安装和管理指南">附录:生成自签名SSL密钥</a> . 注释掉本段落会导致禁用Jabberd组件之间的SSL通讯.
</p>
<h3> <span class="mw-headline" id=".E8.BE.93.E5.85.A5.E8.BE.93.E5.87.BA.E6.8E.A7.E5.88.B6">输入输出控制</span></h3>
<p><i>i/o</i> 段落控制以下的输入/输出选项:
</p>
<ul><li> 连接限制
</li><li> 频率限制
</li><li> IP访问控制
</li></ul>
<p>注意这些段落的缺省设置应该对大部分安装是可用的.
</p>
<h4> <span class="mw-headline" id=".E8.BF.9E.E6.8E.A5.E9.99.90.E5.88.B6">连接限制</span></h4>
<p>Jabberd通过 <i>max_fds</i> (最大文件句柄数)对连接数设置了一个限制. Jabberd对每一个连接使用一个文件句柄. 所以, 对router设置文件句柄的最大数量会影响Jabberd服务器的并发连接数限制. 如 <i>router.xml</i> 文件所说, <i>router</i> 本身可能使用最多4条连接(和其他Jabberd组件); 所以, 这里设置的最大文件句柄数量实际上比可能的并发连接数量稍微多一点点.
</p>
<h4> <span class="mw-headline" id=".E9.A2.91.E7.8E.87.E9.99.90.E5.88.B6">频率限制</span></h4>
<p><i>limits</i> 段落规定单个连接的吞吐量. 本段落相当于Jabberd 1.4中的一个简化的karma设置. 缺省的 <i>bytes</i> 和 <i>connects</i> 都是0. 就是说, 这些限制缺省都是禁用的. 在重载的时候服务器管理员可能希望设置这个限制来组织用户过量使用服务器资源. <i>router.xml</i> 文件包含一个例子告诉我们如何对连接设置频率限制.
</p>
<h4> <span class="mw-headline" id="IP.E8.AE.BF.E9.97.AE.E6.8E.A7.E5.88.B6">IP访问控制</span></h4>
<p><i>access</i> 子段落指定IP地址应该被允许或禁止访问 <i>router</i> . 被禁止访问 <i>router</i> 的IP地址无法让它们的包被处理所以无法使用Jabberd服务器的功能.
</p><p>|| 问题: 以上描述是真实和准确的吗? ||
</p><p><i>order</i> 子段落指定规则被检查的顺序(先检查allow规则再检查deny规则还是先检查deny规则再检查allow规则). 设置IP限制，要么使用 <i>access</i> 子段落 的 <i>order</i> 下的allow要么使用deny标签. 忽略deny和allow规则那么所有连接都可以接受 — 这也是缺省设置.
</p>
<h3> <span class="mw-headline" id=".E5.88.AB.E5.90.8D">别名</span></h3>
<p><i>aliases</i> 段落提供被连接的外部服务的支持, 例如MU Conference和JUD. 这些外部服务通过被连接的配置直接连接到 <i>router</i> . 每个 <i>alias</i> 为组件指定一个可解析的名字并且 <i>target</i> 指定 <i>service id</i> ， 和被连接的外部组件的XML文件里的一样. 更多关于被连接的外部服务的信息参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.B8.B8.E8.A7.84.E7.AE.A1.E7.90.86.E4.BB.BB.E5.8A.A1" title="Jabberd2:安装和管理指南">6.5</a> .
</p>
<h3> <span class="mw-headline" id=".E5.8A.9F.E8.83.BD.E8.AE.BF.E9.97.AE.E6.8E.A7.E5.88.B6">功能访问控制</span></h3>
<p><i>aci</i> 段落指定 <i>router-users.xml</i> 里的每个用户的访问类型. 缺省的, <i>jabberd</i> 用户被授予全权因为其他Jabberd组件都以 <i>Jabberd</i> 用户来连接到 <i>router</i> . 本段特别要注意例子中的一个用户类型 'acl type = 'log<i>. 这个用户可以接收到所有经过router的包, 也就是说, 所有Jabberd服务器处理的包.</i>
</p><p>尽管Jabberd没有一个机制来记录所有的包, 这样的机制可以很容易的通过给一个用户指定 'acl = 'log<i> 权限，再创建一个组件以这个用户的身份连接到router来提供. 这样一个组件将能记录所有的Jabberd包.</i>
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section07/html2pdf">以PDF格式查看</a>
</p>
<h2> <span class="mw-headline" id="Router-users.xml.E9.85.8D.E7.BD.AE">Router-users.xml配置</span></h2>
<p><i>router-users.xml</i> 文件的唯一的用途是提供一个用户和密码对的列表给 <i>router</i> 来验证. 缺省的用户( <i>jabberd</i> ) 是给其他Jabberd组件 ( <i>sm</i> , <i>resolver</i> , <i>s2s</i> 和 <i>c2s</i> ) 连接验证用的.
</p><p><i>router-users.xml</i> 文集看可能不应该有它自己的段落, <b>除了强烈鼓励所有的Jabberd管理员在生产服务器上修改缺省密码</b> . 使用缺省密码( <i>secret</i> ) 会让你的Jabberd安装容易被黑客攻击.
</p><p>一旦 <i>router-users.xml</i> 的缺省密码修改后, 响应的密码也必须在以下文件中修改:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>      sm.xml
      resolver.xml
      s2s.xml
      c2s.xml</pre></div></div>
<p>这些密码位于上述文件中的 <i>Router connection configuration</i> 标签附近.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section08/html2pdf">以PDF格式查看</a>
</p>
<h2> <span class="mw-headline" id="Sm.xml.E9.85.8D.E7.BD.AE">Sm.xml配置</span></h2>
<p><i>sm.xml</i> 文件配置Jabberd 2的 <i>session manager</i> 组件. <i>session manager</i> 在router和外部可用的组件 (s2s 和 c2s) 之间扮演一个层的角色. <i>sm.xml</i> 文件配置以下功能:
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Jabberd.E8.BA.AB.E4.BB.BD" title="Jabberd2:安装和管理指南">Jabberd身份</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.92.8CRouter.E9.80.9A.E8.AE.AF" title="Jabberd2:安装和管理指南">和Router通讯</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.97.A5.E5.BF.97" title="Jabberd2:安装和管理指南">日志</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.95.B0.E6.8D.AE.E5.BA.93.E8.BF.9E.E6.8E.A5.E5.92.8C.E9.85.8D.E7.BD.AE" title="Jabberd2:安装和管理指南">数据库连接和配置</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E7.AE.A1.E7.90.86.E5.8A.9F.E8.83.BD.E7.9A.84.E8.AE.BF.E9.97.AE.E6.8E.A7.E5.88.B6" title="Jabberd2:安装和管理指南">管理功能的访问控制</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E4.BC.9A.E8.AF.9D.E8.B0.83.E7.94.A8.E7.9A.84.E6.A8.A1.E5.9D.97" title="Jabberd2:安装和管理指南">会话调用的模块</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.A4.96.E9.83.A8.E7.BB.84.E4.BB.B6.E7.9A.84.E9.9D.99.E6.80.81.E6.B5.8F.E8.A7.88.E8.AE.BE.E7.BD.AE" title="Jabberd2:安装和管理指南">外部组件的静态浏览设置</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E7.94.A8.E6.88.B7.E9.80.89.E9.A1.B9" title="Jabberd2:安装和管理指南">用户选项</a>
</li></ul>
<p>以下是 <i>sm.xml</i> 文件的概览.
</p>
<h3> <span class="mw-headline" id="Jabberd.E8.BA.AB.E4.BB.BD">Jabberd身份</span></h3>
<p><i>sm.xml</i> 最前面的两个段落指定网络ID和写PID文件的位置. <i>id</i> 段落非常重要，因为这个ID加在用户名后面就构成了一个 JID (Jabber身份). 对于大部分安装来说, <i>id</i> 就是主机名 — 类似 <i>somedomain.com</i> . 如果服务器要和其他Jabber服务器通讯个，那么这个ID必须可以被DN解析; 当然, 对于封闭的或内部的Jabebrd系统，它不需要可解析. IP地址也可被用作 'id'; 然而, 因为IP地址不可以通过DNS解析, 一个使用IP地址作为ID的系统不能够和别的Jabber服务器通讯.
</p><p><i>pid</i> 段落指定PID文件的位置. 如果不需要PID文件，可以注释掉这一行.
</p>
<h3> <span class="mw-headline" id=".E5.92.8CRouter.E9.80.9A.E8.AE.AF">和Router通讯</span></h3>
<p><i>router</i> 段落控制和 <i>router</i> 组件之间的通讯. 缺省的 <i>ip</i> 和 <i>port</i> 对大部分安装应该够了, 不过要主义如果 <i>session manager</i> 运行在一个独立的服务器上, 这里应该指定一个外部IP地址.
</p><p><i>user</i> 和 <i>pass</i> 子段落指定用于连接 <i>router</i> 的用户名. 它们必须和 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Router-users.xml.E9.85.8D.E7.BD.AE" title="Jabberd2:安装和管理指南">8</a> 中所描述的 <i>router-users.xml</i> 匹配 . 对于生产系统基本的安全要求应该是修改缺省密码.
</p><p><i>pemfile</i> 段落指定和 <i>router</i> 通讯用的证书和私钥. 关于在Jabberd上设置SSL的更多信息，参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.85.8D.E7.BD.AEJabberd_2.E4.BD.BF.E7.94.A8SSL.E8.BF.9E.E6.8E.A5" title="Jabberd2:安装和管理指南">5.2</a> 和 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.99.84.E5.BD.95" title="Jabberd2:安装和管理指南">附录:生成自签名SSL密钥</a> . 注释这一段表示在 <i>session manager</i> 和 <i>router</i> 之间禁用 SSL 通讯.
</p><p><i>retry</i> 段落指定 <i>session manager</i> 如果在启动时无法建立连接或在运行时失去连接应该如何重连到 <i>router</i> . 缺省的设置当无法连接时不会让 <i>session manager</i> 无限地重连. 如果 <i>router</i> 挂掉或被停止，那么这些缺省设置基本上会导致 <i>session manager</i> 也挂掉.
</p>
<h3> <span class="mw-headline" id=".E6.97.A5.E5.BF.97">日志</span></h3>
<p>Jabberd日志缺省写到 <i>syslog</i> . 如果你想让 <i>session manager</i> 写到它自己的日志文件, 把 <i>log type</i> 改为 <i>file</i> , 并指定日志的位置.
</p>
<h3> <span class="mw-headline" id=".E6.95.B0.E6.8D.AE.E5.BA.93.E8.BF.9E.E6.8E.A5.E5.92.8C.E9.85.8D.E7.BD.AE">数据库连接和配置</span></h3>
<p><i>session manager</i> 处理数据库连接的设置请参考本指南的 <i>应用数据包</i> (区别于 <i>验证数据包</i> ). 你只需要编辑你选择的 <i>应用数据包</i> (MySQL, PostgreSQL 或 Berkeley DB)相对应的子段落. 对于和 <i>session manager</i>  运行在同一台服务器的数据库包，你应该只需要编辑连接数据库的密码(这对Berkeley DB无效). 如果数据库运行在独立机器那么要修改 <i>host</i> . 注意不应该在生产环境中使用缺省密码(<i>secret</i>).
</p>
<h3> <span class="mw-headline" id=".E7.AE.A1.E7.90.86.E5.8A.9F.E8.83.BD.E7.9A.84.E8.AE.BF.E9.97.AE.E6.8E.A7.E5.88.B6">管理功能的访问控制</span></h3>
<p><i>acl</i> 段落控制哪个用户拥有管理权限. 这些功能包括广播,消息和搜索. 注意本段落指定的管理员用户不会被自动创建到验证(<i>authreg</i>)数据库. 所以, 你必须单独注册一个用户. <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.8F.91.E9.80.81MOTD.E5.92.8C.E6.B6.88.E6.81.AF.E7.BB.99.E6.89.80.E6.9C.89.E5.9C.A8.E7.BA.BF.E7.94.A8.E6.88.B7" title="Jabberd2:安装和管理指南">6.5</a> 描述了如何使用管理帐户发送消息给所有用户.
</p><p>管理功能目前Jabber客户端只有最小支持; 不过, Windows版 <a rel="nofollow" class="external text" href="http://jajc.ksn.ru/">JAJC</a>] 客户端支持浏览在线用户和向在线用户发送消息的管理功能.
</p>
<h3> <span class="mw-headline" id=".E4.BC.9A.E8.AF.9D.E8.B0.83.E7.94.A8.E7.9A.84.E6.A8.A1.E5.9D.97">会话调用的模块</span></h3>
<p><i>modules</i> 段落控制特定事件调用的模块链. 事件定义基于接收或递送某种类型的包. 这些模块链应该只让有经验的Jabberd管理员来编辑. 特别要注意用户创建(<i>user-create</i>)和用户删除(<i>user-delete</i>)时所调用的链.
</p>
<h3> <span class="mw-headline" id=".E5.A4.96.E9.83.A8.E7.BB.84.E4.BB.B6.E7.9A.84.E9.9D.99.E6.80.81.E6.B5.8F.E8.A7.88.E8.AE.BE.E7.BD.AE">外部组件的静态浏览设置</span></h3>
<p><i>discovery</i> 段落包括用于即时消息(<i>identity</i> 子段落)的标准服务信息和用于外部组件(<i>items</i> 子段落)的静态浏览的设置. 如果你的服务器正在运高兴外部组件, 例如 JUD, MU Conferencing, MSN-T 或 Aimtrans, 如果该组件不支持 <i>disco</i> (浏览),那么你应该完成一个 <i>item</i> 子段落. 这个段落下面有一些例子教你如何为你的外部组件添加一个 <i>item</i> 来设置静态浏览.
</p>
<h3> <span class="mw-headline" id=".E7.94.A8.E6.88.B7.E9.80.89.E9.A1.B9">用户选项</span></h3>
<p><i>user</i> 段落指定了模板，这个模板应该在创建用户时被加入到一个用户的数据存储中去, 这个段落也规定用户登录时如果还不存在，系统是否应该立刻创建它. 这个选项运习惯管理员添加用户到验证数据库(<i>authreg</i>) 然后那些用户除此登录时被自动创建.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section09/html2pdf">以PDF格式查看</a>
</p>
<h2> <span class="mw-headline" id="Resolver.xml.E9.85.8D.E7.BD.AE">Resolver.xml配置</span></h2>
<p><i>resolver.xml</i> 文件配置 <i>router</i> 组件为 <i>s2s</i> (服务器到服务器) 组件处理主机名解析. <i>resolver.xml</i> 文件配置以下功能:
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#PID.E6.96.87.E4.BB.B6" title="Jabberd2:安装和管理指南">PID文件</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.92.8CRouter.E9.80.9A.E8.AE.AF" title="Jabberd2:安装和管理指南">和Router通讯</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.97.A5.E5.BF.97" title="Jabberd2:安装和管理指南">日志</a>
</li></ul>
<p><i>resolver</i> 的配置主要是 <i>resolver</i> 和 <i>router</i> 组件通讯.
</p>
<h3> <span class="mw-headline" id="PID.E6.96.87.E4.BB.B6">PID文件</span></h3>
<p><i>pid</i> 段落指定PID文件的位置. 如果不需要PID文件这个段落可以注释掉.
</p>
<h3> <span class="mw-headline" id=".E5.92.8CRouter.E9.80.9A.E8.AE.AF_2">和Router通讯</span></h3>
<p><i>router</i> 段落控制和 <i>router</i> 组件的通讯. 对大部分安装来说缺省的 <i>ip</i> 和 <i>port</i> 应该够了, 不过要注意如果 <i>resolver</i> 是运行在单独的服务器上时, 这里要指定一个外部的IP地址.
</p><p><i>user</i> 和 <i>pass</i> 子段落指定用于连接 <i>router</i> 的用户名. 它们必须和 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Router-users.xml.E9.85.8D.E7.BD.AE" title="Jabberd2:安装和管理指南">8</a> 中所描述的 <i>router-users.xml</i> 匹配 . 对于生产系统基本的安全要求应该是修改缺省密码.
</p><p><i>pemfile</i> 段落指定和 <i>router</i> 通讯用的证书和私钥. 关于在Jabberd上设置SSL的更多信息，参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.85.8D.E7.BD.AEJabberd_2.E4.BD.BF.E7.94.A8SSL.E8.BF.9E.E6.8E.A5" title="Jabberd2:安装和管理指南">5.2</a> 和 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.99.84.E5.BD.95" title="Jabberd2:安装和管理指南">附录:生成自签名SSL密钥</a> . 注释这一段表示在 <i>resolver</i> 和 <i>router</i> 之间禁用 SSL 通讯.
</p><p><i>retry</i> 段落指定 <i>resolver</i> 如果在启动时无法建立连接或在运行时失去连接应该如何重连到 <i>router</i> . 缺省的设置当无法连接时不会让 <i>resolver</i> 无限地重连. 如果 <i>router</i> 挂掉或被停止，那么这些缺省设置基本上会导致 <i>resolver</i> 也挂掉.
</p>
<h3> <span class="mw-headline" id=".E6.97.A5.E5.BF.97_2">日志</span></h3>
<p>Jabberd日志缺省写到 <i>syslog</i> . 如果你想让 <i>resolver</i> 写到它自己的日志文件, 把 <i>log type</i> 改为 <i>file</i> , 并指定日志的位置.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section10/html2pdf">以PDF格式查看</a>
</p>
<h2> <span class="mw-headline" id="S2s.xml.E9.85.8D.E7.BD.AE">S2s.xml配置</span></h2>
<p><i>s2s.xml</i> 文件配置Jabberd 2的 服务器-服务器 组件. <i>s2s.xml</i> 文件为本组件和 <i>router</i> 组件通讯提供网络设置:
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#PID.E6.96.87.E4.BB.B6" title="Jabberd2:安装和管理指南">PID文件</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.92.8CRouter.E9.80.9A.E8.AE.AF" title="Jabberd2:安装和管理指南">和Router通讯</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.97.A5.E5.BF.97" title="Jabberd2:安装和管理指南">日志</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E7.BD.91.E7.BB.9C.E9.85.8D.E7.BD.AE" title="Jabberd2:安装和管理指南">网络配置</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#S2S.E8.BF.9E.E6.8E.A5.E6.A3.80.E6.9F.A5" title="Jabberd2:安装和管理指南">S2S连接检查</a>
</li></ul>
<p>以下是 <i>s2s.xml</i> 文件配置的概述.
</p>
<h3> <span class="mw-headline" id="PID.E6.96.87.E4.BB.B6_2">PID文件</span></h3>
<p><i>pid</i> 段落指定PID文件的位置. 如果不需要PID文件这个段落可以注释掉.
</p>
<h3> <span class="mw-headline" id=".E5.92.8CRouter.E9.80.9A.E8.AE.AF_3">和Router通讯</span></h3>
<p><i>router</i> 段落控制和 <i>router</i> 组件的通讯. 对大部分安装来说缺省的 <i>ip</i> 和 <i>port</i> 应该够了, 不过要注意如果 <i>s2s</i> 是运行在单独的服务器上时, 这里要指定一个外部的IP地址.
</p><p><i>user</i> 和 <i>pass</i> 子段落指定用于连接 <i>router</i> 的用户名. 它们必须和 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Router-users.xml.E9.85.8D.E7.BD.AE" title="Jabberd2:安装和管理指南">8</a> 中所描述的 <i>router-users.xml</i> 匹配 . 对于生产系统基本的安全要求应该是修改缺省密码.
</p><p><i>pemfile</i> 段落指定和 <i>router</i> 通讯用的证书和私钥. 关于在Jabberd上设置SSL的更多信息，参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.85.8D.E7.BD.AEJabberd_2.E4.BD.BF.E7.94.A8SSL.E8.BF.9E.E6.8E.A5" title="Jabberd2:安装和管理指南">5.2</a> 和 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.99.84.E5.BD.95" title="Jabberd2:安装和管理指南">附录:生成自签名SSL密钥</a> . 注释这一段表示在 <i>s2s</i> 和 <i>router</i> 之间禁用 SSL 通讯.
</p><p><i>retry</i> 段落指定 <i>s2s</i> 如果在启动时无法建立连接或在运行时失去连接应该如何重连到 <i>router</i> . 缺省的设置当无法连接时不会让 <i>s2s</i> 无限地重连. 如果 <i>router</i> 挂掉或被停止，那么这些缺省设置基本上会导致 <i>s2s</i> 也挂掉.
</p>
<h3> <span class="mw-headline" id=".E6.97.A5.E5.BF.97_3">日志</span></h3>
<p>Jabberd日志缺省写到 <i>syslog</i> . 如果你想让 <i>s2s</i> 写到它自己的日志文件, 把 <i>log type</i> 改为 <i>file</i> , 并指定日志的位置.
</p>
<h3> <span class="mw-headline" id=".E7.BD.91.E7.BB.9C.E9.85.8D.E7.BD.AE">网络配置</span></h3>
<p><i>local</i> 子段落指定网络配置让 <i>s2s</i> 能安全地使用回拨密钥. <i>0.0.0.0</i> 是IP地址的缺省设置, 并且对大部分安装来说保留这个缺省值是不会错的( 0.0.0.0 的设置允许s2s监听所有可用IP地址). <i>secret</i> 设置指定 <i>s2s</i> 为其他Jabberd服务器生成回拨密钥的口令. 生产环境中这个 <i>sercret</i> 的缺省设置应该修改.
</p>
<h3> <span class="mw-headline" id="S2S.E8.BF.9E.E6.8E.A5.E6.A3.80.E6.9F.A5">S2S连接检查</span></h3>
<p><i>check</i> 段落负责检查和其他Jabber服务器的连接. 缺省的, 这些检查是禁用的 (<i>interval</i> 设为 <i>0</i>). 为了激活检查功能, 设置一个 <i>interval</i> ，单位是秒, 然后设定队列过期的时间间隔, 非法路由过期 和/或 保持连接.
</p><p>|| 问题: 什么情况下连接检查最有用? ||
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section11/html2pdf">以PDF格式查看</a>
</p>
<h2> <span class="mw-headline" id="C2s.xml.E9.85.8D.E7.BD.AE">C2s.xml配置</span></h2>
<p><i>c2s.xml</i> 文件配置Jabberd的 客户端-服务器 组件. <i>c2s</i> 组件负责和Jabberd客户端之间的通讯, <i>c2s.xml</i> 主要和客户端通讯相关:
</p>
<ul><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#PID.E6.96.87.E4.BB.B6" title="Jabberd2:安装和管理指南">PID文件</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.92.8CRouter.E9.80.9A.E8.AE.AF" title="Jabberd2:安装和管理指南">和Router通讯</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E6.97.A5.E5.BF.97" title="Jabberd2:安装和管理指南">日志</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E7.BD.91.E7.BB.9C.E9.85.8D.E7.BD.AE" title="Jabberd2:安装和管理指南">网络配置</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E8.BE.93.E5.85.A5.E8.BE.93.E5.87.BA.E6.8E.A7.E5.88.B6" title="Jabberd2:安装和管理指南">输入输出控制</a>
</li><li> <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E5.AE.A2.E6.88.B7.E7.AB.AF.E9.AA.8C.E8.AF.81.E5.92.8C.E6.B3.A8.E5.86.8C" title="Jabberd2:安装和管理指南">客户端验证和注册</a>
</li></ul>
<p>以下是 <i>c2s.xml</i> 文件的概览.
</p>
<h3> <span class="mw-headline" id="PID.E6.96.87.E4.BB.B6_3">PID文件</span></h3>
<p><i>pid</i> 段落指定PID文件的位置. 如果不需要PID文件这个段落可以注释掉.
</p>
<h3> <span class="mw-headline" id=".E5.92.8CRouter.E9.80.9A.E8.AE.AF_4">和Router通讯</span></h3>
<p><i>router</i> 段落控制和 <i>router</i> 组件的通讯. 对大部分安装来说缺省的 <i>ip</i> 和 <i>port</i> 应该够了, 不过要注意如果 <i>c2s</i> 是运行在单独的服务器上时, 这里要指定一个外部的IP地址.
</p><p><i>user</i> 和 <i>pass</i> 子段落指定用于连接 <i>router</i> 的用户名. 它们必须和 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#Router-users.xml.E9.85.8D.E7.BD.AE" title="Jabberd2:安装和管理指南">8</a> 中所描述的 <i>router-users.xml</i> 匹配 . 对于生产系统基本的安全要求应该是修改缺省密码.
</p><p><i>pemfile</i> 段落指定和 <i>router</i> 通讯用的证书和私钥. 关于在Jabberd上设置SSL的更多信息，参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.85.8D.E7.BD.AEJabberd_2.E4.BD.BF.E7.94.A8SSL.E8.BF.9E.E6.8E.A5" title="Jabberd2:安装和管理指南">5.2</a> 和 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.99.84.E5.BD.95" title="Jabberd2:安装和管理指南">附录:生成自签名SSL密钥</a> . 注释这一段表示在 <i>c2s</i> 和 <i>router</i> 之间禁用 SSL 通讯.
</p><p><i>retry</i> 段落指定 <i>c2s</i> 如果在启动时无法建立连接或在运行时失去连接应该如何重连到 <i>router</i> . 缺省的设置当无法连接时不会让 <i>c2s</i> 无限地重连. 如果 <i>router</i> 挂掉或被停止，那么这些缺省设置基本上会导致 <i>c2s</i> 也挂掉.
</p>
<h3> <span class="mw-headline" id=".E6.97.A5.E5.BF.97_4">日志</span></h3>
<p>Jabberd日志缺省写到 <i>syslog</i> . 如果你想让 <i>c2s</i> 写到它自己的日志文件, 把 <i>log type</i> 改为 <i>file</i> , 并指定日志的位置.
</p>
<h3> <span class="mw-headline" id=".E7.BD.91.E7.BB.9C.E9.85.8D.E7.BD.AE_2">网络配置</span></h3>
<p><i>local</i> 段落指定 <i>c2s</i> 的网络配置. 对大部分安装来说， <i>id</i> 应该和 <i>sm.xml</i> 中的指定的ID相同. 在多个jabber服务器依赖于同于一个验证数据库的时候要使用 <i>realm</i> 属性. 可能发生在很大的公司，需要用到多个Jabebr服务器通过LDAP验证. 缺省的IP地址和端口对大部分安装来说是够用的( 0.0.0.0 的设置允许c2s监听所有可用IP地址).
</p><p><i>local</i> 段落下的 <i>pemfile</i> 子段落指定和客户端通讯所用的证书和密钥. 关于在Jabberd上设置SSL的更多信息，参见 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.85.8D.E7.BD.AEJabberd_2.E4.BD.BF.E7.94.A8SSL.E8.BF.9E.E6.8E.A5" title="Jabberd2:安装和管理指南">5.2</a> 和 <a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97#.E9.99.84.E5.BD.95" title="Jabberd2:安装和管理指南">附录:生成自签名SSL密钥</a> . 注释这一段表示在Jabberd和客户端之间禁用 SSL 通讯.
</p>
<pre>注意这个密钥对不需要和用于Jabberd组件内部通讯的密钥相同.
</pre>
<h3> <span class="mw-headline" id=".E8.BE.93.E5.85.A5.E8.BE.93.E5.87.BA.E6.8E.A7.E5.88.B6_2">输入输出控制</span></h3>
<p><i>i/o</i> 段落控制以下的输入/输出选项:
</p>
<ul><li> 连接限制
</li><li> 频率限制
</li><li> IP访问控制
</li></ul>
<p>注意这些段落的缺省设置应该对大部分安装是可用的.
</p>
<h4> <span class="mw-headline" id=".E8.BF.9E.E6.8E.A5.E9.99.90.E5.88.B6_2">连接限制</span></h4>
<p>Jabberd通过 <i>max_fds</i> (最大文件句柄数)对连接数设置了一个限制. Jabberd对每一个连接使用一个文件句柄. 所以, 对router设置文件句柄的最大数量会影响Jabberd服务器的并发连接数限制. 如 <i>c2s.xml</i> 文件所说, <i>c2s</i> 本身可能使用最多5条连接(和其他Jabberd组件); 所以, 这里设置的最大文件句柄数量实际上比可能的并发连接数量稍微多一点点.
</p>
<h4> <span class="mw-headline" id=".E9.A2.91.E7.8E.87.E9.99.90.E5.88.B6_2">频率限制</span></h4>
<p><i>limits</i> 段落规定单个连接的吞吐量. 本段落相当于Jabberd 1.4中的一个简化的karma设置. 缺省的 <i>bytes</i> 和 <i>connects</i> 都是0. 就是说, 这些限制缺省都是禁用的. 在重载的时候服务器管理员可能希望设置这个限制来组织用户过量使用服务器资源. <i>c2s.xml</i> 文件包含一个例子告诉我们如何对连接设置频率限制.
</p>
<h4> <span class="mw-headline" id="IP.E8.AE.BF.E9.97.AE.E6.8E.A7.E5.88.B6_2">IP访问控制</span></h4>
<p><i>access</i> 子段落指定IP地址应该被允许或禁止访问 <i>c2s</i> . 被禁止访问 <i>c2s</i> 的IP地址无法让它们的包被处理所以无法使用Jabberd服务器的功能.
</p><p>|| 问题: 以上描述是真实和准确的吗? ||
</p><p><i>order</i> 子段落指定规则被检查的顺序(先检查allow规则再检查deny规则还是先检查deny规则再检查allow规则). 设置IP限制，要么使用 <i>access</i> 子段落 的 <i>order</i> 下的allow要么使用deny标签. 忽略deny和allow规则那么所有连接都可以接受 — 这也是缺省设置.
</p>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E8.BF.9E.E6.8E.A5.E6.A3.80.E6.9F.A5">客户端连接检查</span></h4>
<p><i>check</i> 段落负责检查和其他Jabber客户端的连接. 缺省的, 这些检查是禁用的 (<i>interval</i> 设为 <i>0</i>). 为了激活检查功能, 设置一个 <i>interval</i> ，单位是秒, 然后设定队列过期的时间间隔, 非法路由过期 和/或 保持连接.
</p>
<h3> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E9.AA.8C.E8.AF.81.E5.92.8C.E6.B3.A8.E5.86.8C">客户端验证和注册</span></h3>
<p><i>authreg</i> 段落解决客户端验证和注册的问题:
</p>
<ul><li> 验证包
</li><li> 公开注册
</li><li> 密码修改
</li><li> 验证机制
</li><li> 验证包配置
</li></ul>
<p>这些子段落描述如下.
</p>
<h4> <span class="mw-headline" id=".E9.AA.8C.E8.AF.81.E5.8C.85_2">验证包</span></h4>
<p><i>module</i> 子段落指定所使用的验证数据包. Jabberd根据你编译时候参数的选择来设置这个 <i>module</i> , 所以你应该不需要编辑它，除非你要在安装Jabberd之后修改验证数据包.
</p>
<h4> <span class="mw-headline" id=".E5.85.AC.E5.BC.80.E6.B3.A8.E5.86.8C">公开注册</span></h4>
<p><i>register</i> 子段落下的 <i>enable</i> 控制是否允许新用户的公开注册. 公开注册缺省是允许的. 注释掉这个 <i>enable</i> 标签可以禁止公开注册.
</p>
<h4> <span class="mw-headline" id=".E5.AF.86.E7.A0.81.E4.BF.AE.E6.94.B9">密码修改</span></h4>
<p><i>register</i> 下的 <i>password</i> 段落规定是否允许用户修改他们自己的密码. 密码修改缺省是禁止的. 如 <i>c2s.xml</i> 所提到的, 如果禁用了公开注册，那么允许修改密码可能是有用的.
</p>
<h4> <span class="mw-headline" id=".E9.AA.8C.E8.AF.81.E6.9C.BA.E5.88.B6">验证机制</span></h4>
<p><i>mechanisms</i> 子段落指定提供哪种验证加密方法给客户端. 如 <i>c2s.xml</i> 所述, 你应该注释掉任何不想提供的机制.
</p>
<h4> <span class="mw-headline" id=".E9.AA.8C.E8.AF.81.E5.8C.85.E9.85.8D.E7.BD.AE">验证包配置</span></h4>
<p><i>authreg</i> 的最后一个子段落控制你的验证数据包的连接. 缺省的设置对大部分人来说够用了，除非你的验证数据包运行在一个独立的服务器上.
</p><p><a rel="nofollow" class="external text" href="http://www.jabberdoc.org/section12/html2pdf">以PDF格式查看</a>
</p>
<h2> <span class="mw-headline" id="Jabberd_2.E4.BD.93.E7.B3.BB.E7.BB.93.E6.9E.84.28.E8.8D.89.E7.A8.BF.29">Jabberd 2体系结构(草稿)</span></h2>
<p><b>N 注意: 本章还在创作中</b>
</p>
<dl><dd>注意本章是很大程度上还在创作中. 所以, 以下信息应该被视为草稿, Jabberd 2体系结构的并且不是最终描述. 基本上, 我加入这章是因为我正在学习Jabberd 2.
</dd></dl>
<p>|| 下一步打算: 为体系结构概述添加体系结构特性列表 -或- 只是新特性列表 ||
</p><p><br />
译者注：下文略。。。。。。原因之一是这章草稿似乎变成永久性的草稿了，原因之二是jabberd2后来被波兰人接手了，体系结构有一些改动，所以这章草稿也有点过时了，有可能会造成不必要的误导。
</p>
<!-- 
NewPP limit report
Preprocessor node count: 1536/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mediawiki:pcache:idhash:55-0!*!0!!zh-cn!*!* and timestamp 20160221210433 -->
</div><div class="printfooter">
来自“<a href="http://wiki.jabbercn.org/index.php?title=Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97&amp;oldid=3003">http://wiki.jabbercn.org/index.php?title=Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97&amp;oldid=3003</a>”</div>
		<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks"><a href="/%E7%89%B9%E6%AE%8A:%E9%A1%B5%E9%9D%A2%E5%88%86%E7%B1%BB" title="特殊:页面分类">2个分类</a>: <ul><li><a href="/%E5%88%86%E7%B1%BB:XMPP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%87%E6%A1%A3" title="分类:XMPP服务器文档">XMPP服务器文档</a></li><li><a href="/%E5%88%86%E7%B1%BB:%E5%B7%B2%E7%BF%BB%E8%AF%91" title="分类:已翻译">已翻译</a></li></ul></div></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>查看</h5>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97" title="查看内容页面 [c]" accesskey="c">页面</a></li>
				<li id="ca-talk"><a href="/%E8%AE%A8%E8%AE%BA:Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97" title="关于内容页面的讨论 [t]" accesskey="t">讨论</a></li>
				<li id="ca-viewsource"><a href="/index.php?title=Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97&amp;action=edit" title="本页面已被保护。你可以查看其源代码。 [e]" accesskey="e">查看源代码</a></li>
				<li id="ca-history"><a href="/index.php?title=Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97&amp;action=history" title="本页面的早前修订版本 [h]" accesskey="h">历史</a></li>
			</ul>
		</div>
	</div>

	<div class="portlet" id="p-personal">
		<h5>个人工具</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/index.php?title=%E7%89%B9%E6%AE%8A:%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95&amp;returnto=Jabberd2%3A%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97" title="我们希望您可以登入，但不强求 [o]" accesskey="o">登录/创建账户</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a title="访问首页" style="background-image: url(/skins/common/images/xmppcn.png);" href="/%E9%A6%96%E9%A1%B5"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>导航</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/%E9%A6%96%E9%A1%B5" title="访问首页 [z]" accesskey="z">首页</a></li>
				<li id="n-portal"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E7%A4%BE%E5%8C%BA%E4%B8%93%E9%A1%B5" title="关于本项目，你可以做什么，在哪里找到你需要的事物">社区专页</a></li>
				<li id="n-currentevents"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E6%96%B0%E9%97%BB%E5%8A%A8%E6%80%81" title="查看当前事件的背景信息">新闻动态</a></li>
				<li id="n-recentchanges"><a href="/%E7%89%B9%E6%AE%8A:%E6%9C%80%E8%BF%91%E6%9B%B4%E6%94%B9" title="本wiki的最近更改列表 [r]" accesskey="r">最近更改</a></li>
				<li id="n-randompage"><a href="/%E7%89%B9%E6%AE%8A:%E9%9A%8F%E6%9C%BA%E9%A1%B5%E9%9D%A2" title="随机进入一个页面 [x]" accesskey="x">随机页面</a></li>
				<li id="n-help"><a href="/%E5%B8%AE%E5%8A%A9:%E7%9B%AE%E5%BD%95" title="寻求帮助的地方">帮助</a></li>
			</ul>
		</div>
	</div>
	<div class="generated-sidebar portlet" id="p-XMPP.E8.B5.84.E6.BA.90">
		<h5>XMPP资源</h5>
		<div class='pBody'>
			<ul>
				<li id="n-XMPP.E5.85.AC.E5.85.B1.E6.9C.8D.E5.8A.A1"><a href="/XMPP%E5%85%AC%E5%85%B1%E6%9C%8D%E5%8A%A1">XMPP公共服务</a></li>
				<li id="n-XMPP.E5.AE.A2.E6.88.B7.E7.AB.AF.E8.BD.AF.E4.BB.B6"><a href="/XMPP%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6">XMPP客户端软件</a></li>
				<li id="n-XMPP.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.BD.AF.E4.BB.B6"><a href="/XMPP%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AF%E4%BB%B6">XMPP服务器软件</a></li>
				<li id="n-.E5.8F.8B.E6.83.85.E9.93.BE.E6.8E.A5"><a href="/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5">友情链接</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">搜索</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/index.php" id="searchform">
				<input type='hidden' name="title" value="特殊:搜索"/>
				<input type="search" name="search" title="在Jabber/XMPP中文翻译计划中搜索 [f]" accesskey="f" id="searchInput" />
				<input type="submit" name="go" value="提交" title="如果相同的标题存在的话便直接前往该页面" id="searchGoButton" class="searchButton" />&#160;
				<input type="submit" name="fulltext" value="搜索" title="搜索含这些文字的页面" id="mw-searchButton" class="searchButton" />
			</form>
		</div>
	</div>




<script src="http://yacy.jabbercn.org:8090/yacy/ui/js/jquery-1.3.2.min.js" type="text/javascript"></script>
<script>
   $(document).ready(function() {
      yconf = {
         url : 'http://yacy.jabbercn.org:8090/',
         theme : 'smoothness',
         title : 'XMPP搜索大全',
         logo     : 'http://yacy.jabbercn.org:8090/env/grafics/50-xmpp_logo.jpg',
         link     : 'http://wiki.jabbercn.org',
         urlmaskfilter : '.*',
         width : 500,
         height : 500
      };
      $.getScript(yconf.url+'/yacy/ui/js/yacyui-portalsearch.js', function(){});
   });
</script>
        <div id="p-search" class="portlet">
<h5>站外搜索</h5>
<div id="yacylivesearch" class="pBody">
   <form id="ysearch" method="get" accept-charset="UTF-8" action="http://yacy.jabbercn.org:8090/yacysearch.html">
      <input name="search" id="yquery" type="text" size="8" maxlength="80" value=""/>
      <input type="hidden" name="verify" value="false" />
      <input type="hidden" name="maximumRecords" value="10" />
      <input type="hidden" name="resource" value="local" />
      <input type="hidden" name="urlmaskfilter" value=".*" />
      <input type="hidden" name="prefermaskfilter" value="" />
      <input type="hidden" name="former" value="" />
      <input type="hidden" name="display" value="2" />
      <input type="hidden" name="nav" value="all" />
      <input type="submit" name="Enter" value="搜索" class="searchButton" />
   </form>
</div>
</div>



	<div class="portlet" id="p-tb">
		<h5>工具箱</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/%E7%89%B9%E6%AE%8A:%E9%93%BE%E5%85%A5%E9%A1%B5%E9%9D%A2/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97" title="所有链入本页的wiki页面列表 [j]" accesskey="j">链入页面</a></li>
				<li id="t-recentchangeslinked"><a href="/%E7%89%B9%E6%AE%8A:%E9%93%BE%E5%87%BA%E6%9B%B4%E6%94%B9/Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97" title="本页链入的页面的最近更改 [k]" accesskey="k">链出更改</a></li>
				<li id="t-specialpages"><a href="/%E7%89%B9%E6%AE%8A:%E7%89%B9%E6%AE%8A%E9%A1%B5%E9%9D%A2" title="所有特殊页面列表 [q]" accesskey="q">特殊页面</a></li>
				<li><a href="/index.php?title=Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97&amp;printable=yes" rel="alternate">可打印版</a></li>
				<li id="t-permalink"><a href="/index.php?title=Jabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97&amp;oldid=3003" title="本页面该修订版本的永久链接">永久链接</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-copyrightico">
		<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution-Noncommercial-Share Alike 3.0 Unported" width="88" height="31" /></a>
	</div>
	<div id="f-poweredbyico">
		<a href="http://www.mediawiki.org/"><img src="/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
	</div>
	<ul id="f-list">
		<li id="lastmod"> 本页面最后修订于2013年3月22日 (星期五) 18:10。</li>
		<li id="viewcount">此页面已被浏览过109,376次。</li>
		<li id="copyright">本站全部文字内容使用<a class="external" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Attribution-Noncommercial-Share Alike 3.0 Unported</a>授权。</li>
		<li id="privacy"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E9%9A%90%E7%A7%81%E6%9D%83%E6%94%BF%E7%AD%96" title="Jabber/XMPP中文翻译计划:隐私权政策">隐私权政策</a></li>
		<li id="about"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E5%85%B3%E4%BA%8E" title="Jabber/XMPP中文翻译计划:关于">关于Jabber/XMPP中文翻译计划</a></li>
		<li id="disclaimer"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E5%85%8D%E8%B4%A3%E5%A3%B0%E6%98%8E" title="Jabber/XMPP中文翻译计划:免责声明">免责声明</a></li>
	</ul>
</div>
</div>
<script>if(window.mw){
	mw.loader.load(["mediawiki.user", "mediawiki.util", "mediawiki.page.ready", "mediawiki.legacy.wikibits", "mediawiki.legacy.ajax", "mediawiki.legacy.mwsuggest"]);
}
</script>
<script>if(window.mw){
	mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"highlightbroken":1,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,
	"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"zh-cn","language":"zh-cn","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;mw.user.tokens.set({"editToken":"+\\","watchToken":false});;mw.loader.state({"user.options":"ready","user.tokens":"ready"});
	
	/* cache key: mediawiki:resourceloader:filter:minify-js:4:42c4e9caefe8ca663d220ee0c286ac74 */
}
</script><!-- Piwik -->
<script type="text/javascript">
/* <![CDATA[ */
var pkBaseURL = (("https:" == document.location.protocol) ? "https://rtp.rooyee.im/piwik/" : "http://rtp.rooyee.im/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 5);
piwikTracker.setDocumentTitle("Jabberd2:安装和管理指南");
piwikTracker.setIgnoreClasses("image");

piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
/* ]]> */
</script><noscript><p><img src="http://rtp.rooyee.im/piwik/piwik.php?idsite=5" style="border:0" alt=""/></p></noscript>
<!-- /Piwik --><!-- Served in 0.041 secs. --></body></html>