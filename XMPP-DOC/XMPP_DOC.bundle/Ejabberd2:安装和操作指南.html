<!DOCTYPE html>
<html lang="zh-cn" dir="ltr" class="client-nojs">
<head>
<title>Ejabberd2:安装和操作指南 - Jabber/XMPP中文翻译计划</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.18.2" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Jabber/XMPP中文翻译计划 (zh-cn)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.jabbercn.org/api.php?action=rsd" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/" />
<link rel="alternate" type="application/atom+xml" title="Jabber/XMPP中文翻译计划的Atom" href="/index.php?title=%E7%89%B9%E6%AE%8A:%E6%9C%80%E8%BF%91%E6%9B%B4%E6%94%B9&amp;feed=atom" />
<link rel="stylesheet" href="/load.php?debug=false&amp;lang=zh-cn&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cskins.monobook&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE50Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE55Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/skins/monobook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/skins/monobook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}a.new,#quickbar a.new{color:#ba0000}

/* cache key: mediawiki:resourceloader:filter:minify-css:4:c88e2bcd56513749bec09a7e29cb3ffa */</style>
<script src="/load.php?debug=false&amp;lang=zh-cn&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
	mw.config.set({"wgCanonicalNamespace": "", "wgCanonicalSpecialPageName": false, "wgNamespaceNumber": 0, "wgPageName": "Ejabberd2:安装和操作指南", "wgTitle": "Ejabberd2:安装和操作指南", "wgCurRevisionId": 3581, "wgArticleId": 59, "wgIsArticle": true, "wgAction": "view", "wgUserName": null, "wgUserGroups": ["*"], "wgCategories": ["XMPP服务器文档", "已翻译"], "wgBreakFrames": false, "wgRestrictionEdit": [], "wgRestrictionMove": [], "wgSearchNamespaces": [0]});
}
</script><script>if(window.mw){
	mw.loader.load(["mediawiki.page.startup"]);
}
</script>
<style type="text/css">/*<![CDATA[*/
.source-bash {border: 1px dashed #2f6fab; color: black; background-color: #f9f9f9;}
.source-bash li, .source-bash pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for bash
 * CSS class: source-bash, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-bash .de1, .source-bash .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-bash  {font-family: monospace;}
.source-bash .imp {font-weight: bold; color: red;}
.source-bash li, .source-bash li.li1 {font-weight: normal;}
.source-bash li.li2 {font-weight: bold;}
.source-bash .kw1 {color: #000000; font-weight: bold;}
.source-bash .kw2 {color: #c20cb9; font-weight: bold;}
.source-bash .kw3 {color: #7a0874; font-weight: bold;}
.source-bash .co0 {color: #666666; font-style: italic;}
.source-bash .co1 {color: #800000;}
.source-bash .co2 {color: #cc0000; font-style: italic;}
.source-bash .es0 {color: #000099; font-weight: bold;}
.source-bash .br0 {color: #7a0874; font-weight: bold;}
.source-bash .sy0 {color: #000000; font-weight: bold;}
.source-bash .st0 {color: #ff0000;}
.source-bash .nu0 {color: #000000;}
.source-bash .re0 {color: #007800;}
.source-bash .re1 {color: #007800;}
.source-bash .re2 {color: #007800;}
.source-bash .re4 {color: #007800;}
.source-bash .re5 {color: #660033;}
.source-bash .ln-xtra, .source-bash li.ln-xtra, .source-bash div.ln-xtra {background-color: #ffc;}
.source-bash span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-xml {border: 1px dashed #2f6fab; color: black; background-color: #f9f9f9;}
.source-xml li, .source-xml pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for xml
 * CSS class: source-xml, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-xml .de1, .source-xml .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-xml  {font-family: monospace;}
.source-xml .imp {font-weight: bold; color: red;}
.source-xml li, .source-xml li.li1 {font-weight: normal;}
.source-xml li.li2 {font-weight: bold;}
.source-xml .co1 {color: #808080; font-style: italic;}
.source-xml .co2 {color: #404040; font-style: italic;}
.source-xml .co3 {color: #000000;}
.source-xml .co4 {color: #400000; font-weight: bold;}
.source-xml .es0 {color: #000099; font-weight: bold;}
.source-xml .br0 {color: #66cc66;}
.source-xml .sy0 {color: #66cc66;}
.source-xml .st0 {color: #ff0000;}
.source-xml .nu0 {color: #cc66cc;}
.source-xml .re0 {color: #000066;}
.source-xml .re1 {color: #000000; font-weight: bold;}
.source-xml .re2 {color: #000000; font-weight: bold;}
.source-xml .ln-xtra, .source-xml li.ln-xtra, .source-xml div.ln-xtra {background-color: #ffc;}
.source-xml span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-text {border: 1px dashed #2f6fab; color: black; background-color: #f9f9f9;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-text .de1, .source-text .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-text  {font-family: monospace;}
.source-text .imp {font-weight: bold; color: red;}
.source-text li, .source-text li.li1 {font-weight: normal;}
.source-text li.li2 {font-weight: bold;}
.source-text .ln-xtra, .source-text li.ln-xtra, .source-text div.ln-xtra {background-color: #ffc;}
.source-text span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-ini {border: 1px dashed #2f6fab; color: black; background-color: #f9f9f9;}
.source-ini li, .source-ini pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for ini
 * CSS class: source-ini, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-ini .de1, .source-ini .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-ini  {font-family: monospace;}
.source-ini .imp {font-weight: bold; color: red;}
.source-ini li, .source-ini li.li1 {font-weight: normal;}
.source-ini li.li2 {font-weight: bold;}
.source-ini .co0 {color: #666666; font-style: italic;}
.source-ini .sy0 {color: #000066; font-weight:bold;}
.source-ini .st0 {color: #933;}
.source-ini .re0 {color: #000066; font-weight:bold;}
.source-ini .re1 {color: #000099;}
.source-ini .re2 {color: #660066;}
.source-ini .ln-xtra, .source-ini li.ln-xtra, .source-ini div.ln-xtra {background-color: #ffc;}
.source-ini span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Ejabberd2_安装和操作指南 action-view skin-monobook">
<div id="globalWrapper">
<div id="column-content"><div id="content">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading">Ejabberd2:安装和操作指南</h1>
	<div id="bodyContent">
		<div id="siteSub">来自Jabber/XMPP中文翻译计划</div>
		<div id="contentSub"></div>
		<div id="jump-to-nav">跳转到： <a href="#column-one">导航</a>, <a href="#searchInput">搜索</a></div>
		<!-- start content -->
<div lang="zh-cn" dir="ltr" class="mw-content-ltr"><p><br />
<b>本文的英文原文来自 <a rel="nofollow" class="external free" href="http://www.process-one.net/en/ejabberd/guide_en">http://www.process-one.net/en/ejabberd/guide_en</a> </b>
</p><p><b>ejabberd 2.1.4 安装和管理指南</b>
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>目录</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#.E7.BB.AA.E8.AE.BA"><span class="tocnumber">1</span> <span class="toctext">绪论</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#.E5.85.B3.E9.94.AE.E5.8A.9F.E8.83.BD"><span class="tocnumber">1.1</span> <span class="toctext">关键功能</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#.E9.A2.9D.E5.A4.96.E5.8A.9F.E8.83.BD"><span class="tocnumber">1.2</span> <span class="toctext">额外功能</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#.E5.AE.89.E8.A3.85Installing_ejabberd"><span class="tocnumber">2</span> <span class="toctext">安装Installing ejabberd</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#.E7.94.A8ejabberd.E4.BA.8C.E8.BF.9B.E5.88.B6.E5.AE.89.E8.A3.85.E5.8C.85.E5.AE.89.E8.A3.85"><span class="tocnumber">2.1</span> <span class="toctext">用ejabberd二进制安装包安装</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#.E7.94.A8.E6.93.8D.E4.BD.9C.E7.B3.BB.E7.BB.9F.E7.89.B9.E5.AE.9A.E7.9A.84.E5.8C.85.E5.AE.89.E8.A3.85ejabberd"><span class="tocnumber">2.2</span> <span class="toctext">用操作系统特定的包安装ejabberd</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#.E7.94.A8CEAN.E5.AE.89.E8.A3.85ejabberd"><span class="tocnumber">2.3</span> <span class="toctext">用CEAN安装ejabberd</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#.E4.BB.8E.E6.BA.90.E7.A0.81.E5.AE.89.E8.A3.85ejabberd"><span class="tocnumber">2.4</span> <span class="toctext">从源码安装ejabberd</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#.E9.9C.80.E6.B1.82"><span class="tocnumber">2.4.1</span> <span class="toctext">需求</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#.E4.B8.8B.E8.BD.BD.E6.BA.90.E7.A0.81"><span class="tocnumber">2.4.2</span> <span class="toctext">下载源码</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#.E7.BC.96.E8.AF.91"><span class="tocnumber">2.4.3</span> <span class="toctext">编译</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#.E5.AE.89.E8.A3.85"><span class="tocnumber">2.4.4</span> <span class="toctext">安装</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#.E5.90.AF.E5.8A.A8"><span class="tocnumber">2.4.5</span> <span class="toctext">启动</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#BSD.E7.9A.84.E5.85.B7.E4.BD.93.E8.AF.B4.E6.98.8E"><span class="tocnumber">2.4.6</span> <span class="toctext">BSD的具体说明</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#Sun_Solaris.E7.9A.84.E5.85.B7.E4.BD.93.E8.AF.B4.E6.98.8E"><span class="tocnumber">2.4.7</span> <span class="toctext">Sun Solaris的具体说明</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Microsoft_Windows.E7.9A.84.E5.85.B7.E4.BD.93.E8.AF.B4.E6.98.8E"><span class="tocnumber">2.4.8</span> <span class="toctext">Microsoft Windows的具体说明</span></a>
<ul>
<li class="toclevel-4 tocsection-17"><a href="#.E9.9C.80.E6.B1.82_2"><span class="tocnumber">2.4.8.1</span> <span class="toctext">需求</span></a></li>
<li class="toclevel-4 tocsection-18"><a href="#.E7.BC.96.E8.AF.91_2"><span class="tocnumber">2.4.8.2</span> <span class="toctext">编译</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-19"><a href="#.E6.96.B0.E5.BB.BAXMPP.E7.AE.A1.E7.90.86.E5.B8.90.E5.8F.B7"><span class="tocnumber">2.5</span> <span class="toctext">新建XMPP管理帐号</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#.E5.8D.87.E7.BA.A7ejabberd"><span class="tocnumber">2.6</span> <span class="toctext">升级ejabberd</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-21"><a href="#.E9.85.8D.E7.BD.AEejabberd"><span class="tocnumber">3</span> <span class="toctext">配置ejabberd</span></a>
<ul>
<li class="toclevel-2 tocsection-22"><a href="#.E5.9F.BA.E6.9C.AC.E9.85.8D.E7.BD.AE"><span class="tocnumber">3.1</span> <span class="toctext">基本配置</span></a>
<ul>
<li class="toclevel-3 tocsection-23"><a href="#.E4.B8.BB.E6.9C.BA.E5.90.8D"><span class="tocnumber">3.1.1</span> <span class="toctext">主机名</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#.E8.99.9A.E6.8B.9F.E4.B8.BB.E6.9C.BA"><span class="tocnumber">3.1.2</span> <span class="toctext">虚拟主机</span></a></li>
<li class="toclevel-3"><a href="#.E7.9B.91.E5.90.AC.E7.AB.AF.E5.8F.A3"><span class="tocnumber">3.1.3</span> <span class="toctext">监听端口</span></a>
<ul>
<li class="toclevel-4"><a href="#.E7.AB.AF.E5.8F.A3.E5.8F.B7.2CIP.E5.9C.B0.E5.9D.80.E5.92.8C.E4.BC.A0.E8.BE.93.E5.8D.8F.E8.AE.AE"><span class="tocnumber">3.1.3.1</span> <span class="toctext">端口号,IP地址和传输协议</span></a></li>
<li class="toclevel-4"><a href="#.E7.9B.91.E5.90.AC.E7.9A.84.E6.A8.A1.E5.9D.97"><span class="tocnumber">3.1.3.2</span> <span class="toctext">监听的模块</span></a></li>
<li class="toclevel-4"><a href="#.E9.80.89.E9.A1.B9"><span class="tocnumber">3.1.3.3</span> <span class="toctext">选项</span></a></li>
<li class="toclevel-4"><a href="#.E7.A4.BA.E4.BE.8B"><span class="tocnumber">3.1.3.4</span> <span class="toctext">示例</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#.E9.AA.8C.E8.AF.81"><span class="tocnumber">3.1.4</span> <span class="toctext">验证</span></a>
<ul>
<li class="toclevel-4"><a href="#.E5.86.85.E9.83.A8"><span class="tocnumber">3.1.4.1</span> <span class="toctext">内部</span></a></li>
<li class="toclevel-4"><a href="#SASL.E5.8C.BF.E5.90.8D.E5.92.8C.E5.8C.BF.E5.90.8D.E7.99.BB.E5.BD.95"><span class="tocnumber">3.1.4.2</span> <span class="toctext">SASL匿名和匿名登录</span></a></li>
<li class="toclevel-4"><a href="#PAM.E9.AA.8C.E8.AF.81"><span class="tocnumber">3.1.4.3</span> <span class="toctext">PAM验证</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#.E8.AE.BF.E9.97.AE.E8.A7.84.E5.88.99"><span class="tocnumber">3.1.5</span> <span class="toctext">访问规则</span></a>
<ul>
<li class="toclevel-4"><a href="#ACL.E5.AE.9A.E4.B9.89"><span class="tocnumber">3.1.5.1</span> <span class="toctext">ACL定义</span></a></li>
<li class="toclevel-4"><a href="#.E8.AE.BF.E9.97.AE.E6.9D.83.E9.99.90"><span class="tocnumber">3.1.5.2</span> <span class="toctext">访问权限</span></a></li>
<li class="toclevel-4"><a href="#.E4.BD.BF.E7.94.A8ACL.E9.99.90.E5.88.B6.E6.89.93.E5.BC.80.E7.9A.84.E4.BC.9A.E8.AF.9D"><span class="tocnumber">3.1.5.3</span> <span class="toctext">使用ACL限制打开的会话</span></a></li>
<li class="toclevel-4"><a href="#.E4.BD.BF.E7.94.A8ACL.E9.99.90.E5.88.B6.E5.88.B0.E4.B8.80.E4.B8.AA.E8.BF.9C.E7.A8.8BXMPP.E6.9C.8D.E5.8A.A1.E5.99.A8.E7.9A.84.E5.A4.9A.E4.B8.AA.E8.BF.9E.E6.8E.A5"><span class="tocnumber">3.1.5.4</span> <span class="toctext">使用ACL限制到一个远程XMPP服务器的多个连接</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#.E6.95.B4.E5.BD.A2"><span class="tocnumber">3.1.6</span> <span class="toctext">整形</span></a></li>
<li class="toclevel-3"><a href="#.E7.BC.BA.E7.9C.81.E8.AF.AD.E8.A8.80"><span class="tocnumber">3.1.7</span> <span class="toctext">缺省语言</span></a></li>
<li class="toclevel-3"><a href="#CAPTCHA"><span class="tocnumber">3.1.8</span> <span class="toctext">CAPTCHA</span></a></li>
<li class="toclevel-3"><a href="#STUN"><span class="tocnumber">3.1.9</span> <span class="toctext">STUN</span></a></li>
<li class="toclevel-3"><a href="#.E5.8C.85.E5.90.AB.E5.85.B6.E5.AE.83.E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6"><span class="tocnumber">3.1.10</span> <span class="toctext">包含其它配置文件</span></a></li>
<li class="toclevel-3"><a href="#.E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6.E4.B8.AD.E7.9A.84.E5.AE.8F.E9.80.89.E9.A1.B9"><span class="tocnumber">3.1.11</span> <span class="toctext">配置文件中的宏选项</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#.E6.95.B0.E6.8D.AE.E5.BA.93.E5.92.8CLDAP.E9.85.8D.E7.BD.AE"><span class="tocnumber">3.2</span> <span class="toctext">数据库和LDAP配置</span></a>
<ul>
<li class="toclevel-3"><a href="#MySQL"><span class="tocnumber">3.2.1</span> <span class="toctext">MySQL</span></a>
<ul>
<li class="toclevel-4"><a href="#.E9.A9.B1.E5.8A.A8.E7.BC.96.E8.AF.91"><span class="tocnumber">3.2.1.1</span> <span class="toctext">驱动编译</span></a></li>
<li class="toclevel-4"><a href="#.E6.95.B0.E6.8D.AE.E5.BA.93.E8.BF.9E.E6.8E.A5"><span class="tocnumber">3.2.1.2</span> <span class="toctext">数据库连接</span></a></li>
<li class="toclevel-4"><a href="#.E9.AA.8C.E8.AF.81_2"><span class="tocnumber">3.2.1.3</span> <span class="toctext">验证</span></a></li>
<li class="toclevel-4"><a href="#.E5.AD.98.E5.82.A8"><span class="tocnumber">3.2.1.4</span> <span class="toctext">存储</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#Microsoft_SQL_Server"><span class="tocnumber">3.2.2</span> <span class="toctext">Microsoft SQL Server</span></a>
<ul>
<li class="toclevel-4"><a href="#.E9.A9.B1.E5.8A.A8.E7.BC.96.E8.AF.91_2"><span class="tocnumber">3.2.2.1</span> <span class="toctext">驱动编译</span></a></li>
<li class="toclevel-4"><a href="#.E6.95.B0.E6.8D.AE.E5.BA.93.E8.BF.9E.E6.8E.A5_2"><span class="tocnumber">3.2.2.2</span> <span class="toctext">数据库连接</span></a></li>
<li class="toclevel-4"><a href="#.E9.AA.8C.E8.AF.81_3"><span class="tocnumber">3.2.2.3</span> <span class="toctext">验证</span></a></li>
<li class="toclevel-4"><a href="#.E5.AD.98.E5.82.A8_2"><span class="tocnumber">3.2.2.4</span> <span class="toctext">存储</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#PostgreSQL"><span class="tocnumber">3.2.3</span> <span class="toctext">PostgreSQL</span></a>
<ul>
<li class="toclevel-4"><a href="#.E9.A9.B1.E5.8A.A8.E7.BC.96.E8.AF.91_3"><span class="tocnumber">3.2.3.1</span> <span class="toctext">驱动编译</span></a></li>
<li class="toclevel-4"><a href="#.E6.95.B0.E6.8D.AE.E5.BA.93.E8.BF.9E.E6.8E.A5_3"><span class="tocnumber">3.2.3.2</span> <span class="toctext">数据库连接</span></a></li>
<li class="toclevel-4 tocsection-59"><a href="#.E9.AA.8C.E8.AF.81_4"><span class="tocnumber">3.2.3.3</span> <span class="toctext">验证</span></a></li>
<li class="toclevel-4 tocsection-60"><a href="#.E5.AD.98.E5.82.A8_3"><span class="tocnumber">3.2.3.4</span> <span class="toctext">存储</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-61"><a href="#ODBC.E5.85.BC.E5.AE.B9"><span class="tocnumber">3.2.4</span> <span class="toctext">ODBC兼容</span></a>
<ul>
<li class="toclevel-4 tocsection-62"><a href="#.E9.A9.B1.E5.8A.A8.E7.BC.96.E8.AF.91_4"><span class="tocnumber">3.2.4.1</span> <span class="toctext">驱动编译</span></a></li>
<li class="toclevel-4 tocsection-63"><a href="#.E6.95.B0.E6.8D.AE.E5.BA.93.E8.BF.9E.E6.8E.A5_4"><span class="tocnumber">3.2.4.2</span> <span class="toctext">数据库连接</span></a></li>
<li class="toclevel-4 tocsection-64"><a href="#.E9.AA.8C.E8.AF.81_5"><span class="tocnumber">3.2.4.3</span> <span class="toctext">验证</span></a></li>
<li class="toclevel-4 tocsection-65"><a href="#.E5.AD.98.E5.82.A8_4"><span class="tocnumber">3.2.4.4</span> <span class="toctext">存储</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-66"><a href="#LDAP"><span class="tocnumber">3.2.5</span> <span class="toctext">LDAP</span></a>
<ul>
<li class="toclevel-4 tocsection-67"><a href="#.E8.BF.9E.E6.8E.A5"><span class="tocnumber">3.2.5.1</span> <span class="toctext">连接</span></a></li>
<li class="toclevel-4 tocsection-68"><a href="#.E9.AA.8C.E8.AF.81_6"><span class="tocnumber">3.2.5.2</span> <span class="toctext">验证</span></a></li>
<li class="toclevel-4 tocsection-69"><a href="#.E7.A4.BA.E4.BE.8B_2"><span class="tocnumber">3.2.5.3</span> <span class="toctext">示例</span></a>
<ul>
<li class="toclevel-5 tocsection-70"><a href="#.E6.99.AE.E9.80.9A.E7.A4.BA.E4.BE.8B"><span class="tocnumber">3.2.5.3.1</span> <span class="toctext">普通示例</span></a></li>
<li class="toclevel-5 tocsection-71"><a href="#Active_Directory"><span class="tocnumber">3.2.5.3.2</span> <span class="toctext">Active Directory</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-72"><a href="#.E6.A8.A1.E5.9D.97.E9.85.8D.E7.BD.AE"><span class="tocnumber">3.3</span> <span class="toctext">模块配置</span></a>
<ul>
<li class="toclevel-3 tocsection-73"><a href="#.E6.A8.A1.E5.9D.97.E4.B8.80.E8.A7.88"><span class="tocnumber">3.3.1</span> <span class="toctext">模块一览</span></a></li>
<li class="toclevel-3 tocsection-74"><a href="#.E9.80.9A.E7.94.A8.E9.80.89.E9.A1.B9"><span class="tocnumber">3.3.2</span> <span class="toctext">通用选项</span></a>
<ul>
<li class="toclevel-4 tocsection-75"><a href="#iqdisc"><span class="tocnumber">3.3.2.1</span> <span class="toctext">iqdisc</span></a></li>
<li class="toclevel-4 tocsection-76"><a href="#host"><span class="tocnumber">3.3.2.2</span> <span class="toctext">host</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-77"><a href="#mod_announce"><span class="tocnumber">3.3.3</span> <span class="toctext">mod_announce</span></a></li>
<li class="toclevel-3 tocsection-78"><a href="#mod_disco"><span class="tocnumber">3.3.4</span> <span class="toctext">mod_disco</span></a></li>
<li class="toclevel-3 tocsection-79"><a href="#mod_echo"><span class="tocnumber">3.3.5</span> <span class="toctext">mod_echo</span></a></li>
<li class="toclevel-3 tocsection-80"><a href="#mod_http_bind"><span class="tocnumber">3.3.6</span> <span class="toctext">mod_http_bind</span></a></li>
<li class="toclevel-3 tocsection-81"><a href="#mod_http_fileserver"><span class="tocnumber">3.3.7</span> <span class="toctext">mod_http_fileserver</span></a></li>
<li class="toclevel-3 tocsection-82"><a href="#mod_irc"><span class="tocnumber">3.3.8</span> <span class="toctext">mod_irc</span></a></li>
<li class="toclevel-3 tocsection-83"><a href="#mod_last"><span class="tocnumber">3.3.9</span> <span class="toctext">mod_last</span></a></li>
<li class="toclevel-3 tocsection-84"><a href="#mod_muc"><span class="tocnumber">3.3.10</span> <span class="toctext">mod_muc</span></a></li>
<li class="toclevel-3 tocsection-85"><a href="#mod_muc_log"><span class="tocnumber">3.3.11</span> <span class="toctext">mod_muc_log</span></a></li>
<li class="toclevel-3 tocsection-86"><a href="#mod_offline"><span class="tocnumber">3.3.12</span> <span class="toctext">mod_offline</span></a></li>
<li class="toclevel-3 tocsection-87"><a href="#mod_ping"><span class="tocnumber">3.3.13</span> <span class="toctext">mod_ping</span></a></li>
<li class="toclevel-3 tocsection-88"><a href="#mod_privacy"><span class="tocnumber">3.3.14</span> <span class="toctext">mod_privacy</span></a></li>
<li class="toclevel-3 tocsection-89"><a href="#mod_private"><span class="tocnumber">3.3.15</span> <span class="toctext">mod_private</span></a></li>
<li class="toclevel-3 tocsection-90"><a href="#mod_proxy65"><span class="tocnumber">3.3.16</span> <span class="toctext">mod_proxy65</span></a></li>
<li class="toclevel-3 tocsection-91"><a href="#mod_pubsub"><span class="tocnumber">3.3.17</span> <span class="toctext">mod_pubsub</span></a></li>
<li class="toclevel-3 tocsection-92"><a href="#mod_register"><span class="tocnumber">3.3.18</span> <span class="toctext">mod_register</span></a></li>
<li class="toclevel-3 tocsection-93"><a href="#mod_roster"><span class="tocnumber">3.3.19</span> <span class="toctext">mod_roster</span></a></li>
<li class="toclevel-3 tocsection-94"><a href="#mod_service_log"><span class="tocnumber">3.3.20</span> <span class="toctext">mod_service_log</span></a></li>
<li class="toclevel-3 tocsection-95"><a href="#mod_shared_roster"><span class="tocnumber">3.3.21</span> <span class="toctext">mod_shared_roster</span></a></li>
<li class="toclevel-3 tocsection-96"><a href="#mod_sic"><span class="tocnumber">3.3.22</span> <span class="toctext">mod_sic</span></a></li>
<li class="toclevel-3 tocsection-97"><a href="#mod_stats"><span class="tocnumber">3.3.23</span> <span class="toctext">mod_stats</span></a></li>
<li class="toclevel-3 tocsection-98"><a href="#mod_time"><span class="tocnumber">3.3.24</span> <span class="toctext">mod_time</span></a></li>
<li class="toclevel-3 tocsection-99"><a href="#mod_vcard"><span class="tocnumber">3.3.25</span> <span class="toctext">mod_vcard</span></a></li>
<li class="toclevel-3 tocsection-100"><a href="#mod_vcard_ldap"><span class="tocnumber">3.3.26</span> <span class="toctext">mod_vcard_ldap</span></a></li>
<li class="toclevel-3 tocsection-101"><a href="#mod_vcard_xupdate"><span class="tocnumber">3.3.27</span> <span class="toctext">mod_vcard_xupdate</span></a></li>
<li class="toclevel-3 tocsection-102"><a href="#mod_version"><span class="tocnumber">3.3.28</span> <span class="toctext">mod_version</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-103"><a href="#.E7.AE.A1.E7.90.86ejabberd.E6.9C.8D.E5.8A.A1.E5.99.A8"><span class="tocnumber">4</span> <span class="toctext">管理ejabberd服务器</span></a>
<ul>
<li class="toclevel-2 tocsection-104"><a href="#ejabberdctl"><span class="tocnumber">4.1</span> <span class="toctext">ejabberdctl</span></a>
<ul>
<li class="toclevel-3 tocsection-105"><a href="#ejabberdctl.E5.91.BD.E4.BB.A4"><span class="tocnumber">4.1.1</span> <span class="toctext">ejabberdctl命令</span></a></li>
<li class="toclevel-3 tocsection-106"><a href="#Erlang.E8.BF.90.E8.A1.8C.E6.97.B6.E7.B3.BB.E7.BB.9F"><span class="tocnumber">4.1.2</span> <span class="toctext">Erlang运行时系统</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-107"><a href="#ejabberd.E5.91.BD.E4.BB.A4"><span class="tocnumber">4.2</span> <span class="toctext">ejabberd命令</span></a>
<ul>
<li class="toclevel-3 tocsection-108"><a href="#ejabberd.E5.91.BD.E4.BB.A4.E6.B8.85.E5.8D.95"><span class="tocnumber">4.2.1</span> <span class="toctext">ejabberd命令清单</span></a></li>
<li class="toclevel-3 tocsection-109"><a href="#.E4.BB.A5AccessCommands.E9.99.90.E5.88.B6.E6.89.A7.E8.A1.8C"><span class="tocnumber">4.2.2</span> <span class="toctext">以AccessCommands限制执行</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-110"><a href="#Web.E7.AE.A1.E7.90.86"><span class="tocnumber">4.3</span> <span class="toctext">Web管理</span></a></li>
<li class="toclevel-2 tocsection-111"><a href="#.E7.89.B9.E8.AE.BE.E5.91.BD.E4.BB.A4"><span class="tocnumber">4.4</span> <span class="toctext">特设命令</span></a></li>
<li class="toclevel-2 tocsection-112"><a href="#.E4.BF.AE.E6.94.B9.E8.AE.A1.E7.AE.97.E6.9C.BA.E4.B8.BB.E6.9C.BA.E5.90.8D"><span class="tocnumber">4.5</span> <span class="toctext">修改计算机主机名</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-113"><a href="#ejabberd.E5.AE.89.E5.85.A8"><span class="tocnumber">5</span> <span class="toctext">ejabberd安全</span></a>
<ul>
<li class="toclevel-2 tocsection-114"><a href="#.E9.98.B2.E7.81.AB.E5.A2.99.E8.AE.BE.E7.BD.AE"><span class="tocnumber">5.1</span> <span class="toctext">防火墙设置</span></a></li>
<li class="toclevel-2 tocsection-115"><a href="#epmd"><span class="tocnumber">5.2</span> <span class="toctext">epmd</span></a></li>
<li class="toclevel-2 tocsection-116"><a href="#Erlang_Cookie"><span class="tocnumber">5.3</span> <span class="toctext">Erlang Cookie</span></a></li>
<li class="toclevel-2 tocsection-117"><a href="#Erlang.E8.8A.82.E7.82.B9.E5.90.8D"><span class="tocnumber">5.4</span> <span class="toctext">Erlang节点名</span></a></li>
<li class="toclevel-2 tocsection-118"><a href="#.E6.95.8F.E6.84.9F.E6.96.87.E4.BB.B6.E5.AE.89.E5.85.A8"><span class="tocnumber">5.5</span> <span class="toctext">敏感文件安全</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-119"><a href="#.E9.9B.86.E7.BE.A4"><span class="tocnumber">6</span> <span class="toctext">集群</span></a>
<ul>
<li class="toclevel-2 tocsection-120"><a href="#.E5.A6.82.E4.BD.95.E5.B7.A5.E4.BD.9C"><span class="tocnumber">6.1</span> <span class="toctext">如何工作</span></a>
<ul>
<li class="toclevel-3 tocsection-121"><a href="#Router"><span class="tocnumber">6.1.1</span> <span class="toctext">Router</span></a></li>
<li class="toclevel-3 tocsection-122"><a href="#Local_Router"><span class="tocnumber">6.1.2</span> <span class="toctext">Local Router</span></a></li>
<li class="toclevel-3 tocsection-123"><a href="#Session_Manager"><span class="tocnumber">6.1.3</span> <span class="toctext">Session Manager</span></a></li>
<li class="toclevel-3 tocsection-124"><a href="#s2s_Manager"><span class="tocnumber">6.1.4</span> <span class="toctext">s2s Manager</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-125"><a href="#.E9.9B.86.E7.BE.A4.E9.85.8D.E7.BD.AE"><span class="tocnumber">6.2</span> <span class="toctext">集群配置</span></a></li>
<li class="toclevel-2 tocsection-126"><a href="#.E6.9C.8D.E5.8A.A1.E8.B4.9F.E8.BD.BD.E5.9D.87.E8.A1.A1"><span class="tocnumber">6.3</span> <span class="toctext">服务负载均衡</span></a>
<ul>
<li class="toclevel-3 tocsection-127"><a href="#.E7.BB.84.E4.BB.B6.E8.B4.9F.E8.BD.BD.E5.9D.87.E8.A1.A1"><span class="tocnumber">6.3.1</span> <span class="toctext">组件负载均衡</span></a></li>
<li class="toclevel-3 tocsection-128"><a href="#.E5.9F.9F.E8.B4.9F.E8.BD.BD.E5.9D.87.E8.A1.A1.E6.9C.BA.E5.88.B6"><span class="tocnumber">6.3.2</span> <span class="toctext">域负载均衡机制</span></a></li>
<li class="toclevel-3 tocsection-129"><a href="#.E8.B4.9F.E8.BD.BD.E5.9D.87.E8.A1.A1.E6.B0.B4.E6.A1.B6"><span class="tocnumber">6.3.3</span> <span class="toctext">负载均衡水桶</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-130"><a href="#.E8.B0.83.E8.AF.95"><span class="tocnumber">7</span> <span class="toctext">调试</span></a>
<ul>
<li class="toclevel-2 tocsection-131"><a href="#.E6.97.A5.E5.BF.97.E6.96.87.E4.BB.B6"><span class="tocnumber">7.1</span> <span class="toctext">日志文件</span></a></li>
<li class="toclevel-2 tocsection-132"><a href="#.E8.B0.83.E8.AF.95.E6.8E.A7.E5.88.B6.E5.8F.B0"><span class="tocnumber">7.2</span> <span class="toctext">调试控制台</span></a></li>
<li class="toclevel-2 tocsection-133"><a href="#Watchdog.E8.AD.A6.E5.91.8A"><span class="tocnumber">7.3</span> <span class="toctext">Watchdog警告</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-134"><a href="#.E9.99.84.E5.BD.95_A_.E5.9B.BD.E9.99.85.E5.8C.96.E5.92.8C.E6.9C.AC.E5.9C.B0.E5.8C.96"><span class="tocnumber">8</span> <span class="toctext">附录 A 国际化和本地化</span></a></li>
<li class="toclevel-1 tocsection-135"><a href="#.E9.99.84.E5.BD.95_B_.E5.8F.91.E8.A1.8C.E5.A4.87.E6.B3.A8"><span class="tocnumber">9</span> <span class="toctext">附录 B 发行备注</span></a></li>
<li class="toclevel-1 tocsection-136"><a href="#.E9.99.84.E5.BD.95_C_.E9.B8.A3.E8.B0.A2"><span class="tocnumber">10</span> <span class="toctext">附录 C 鸣谢</span></a></li>
<li class="toclevel-1 tocsection-137"><a href="#.E9.99.84.E5.BD.95_D_.E7.89.88.E6.9D.83.E4.BF.A1.E6.81.AF"><span class="tocnumber">11</span> <span class="toctext">附录 D 版权信息</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id=".E7.BB.AA.E8.AE.BA">绪论</span></h2>
<p>ejabberd是一个用<a rel="nofollow" class="external text" href="http://www.erlang.org/">Erlang/OTP</a>语言写的自由和开源的即时消息服务器.
</p><p>ejabberd是跨平台,分布式, 容错, 并基于开放标准的实时通讯系统.
</p><p>ejabberd的设计坚若磐石，是一个功能服丰富的XMPP服务器.
</p><p>ejabberd同时适合小规模布署和超大规模布署, 无论它们是否需要可伸缩性.
</p>
<h3> <span class="mw-headline" id=".E5.85.B3.E9.94.AE.E5.8A.9F.E8.83.BD">关键功能</span></h3>
<p>ejabberd是:
</p>
<ul><li> 跨平台的: ejabberd可以运行在Microsoft Windows和Unix派生系统，例如Linux, FreeBSD和NetBSD.
</li><li> 分布式的: 你可以在一个集群的机器上运行ejabberd，并且所有的机器都服务于同一个或一些Jabbe域. 当你需要更大容量的时候，你可以简单地增加一个廉价节点到你的集群里. 因此, 你不需要买一个昂贵的高端机器来支持上万个并发用户.
</li><li> 容错: 你可以布署一个ejabberd集群，这样一个正常运行的服务的所有必需信息将被复制到所有节点. 这意味着如果其中一个节点崩溃了, 其他节点将无中断的继续运行. 另外, 也可以‘不停机’增加或更换节点.
</li><li> 易于管理: ejabberd建立于开源的Erlang. 所以你不需要安装外部服数据库, 外部web服务器, 除此以外因为每个东西都已经包含在里面, 并且处于开箱可用状态. 其他管理上的好处包括:
<ul><li> 详尽的文档.
</li><li> 便捷的安装程序，包括在Linux, Mac OS X, 以及Windows系统下.
</li><li> Web管理.
</li><li> 共享名册组.
</li><li> 命令行管理工具.
</li><li> 可外部集成的验证机制.
</li><li> 发送匿名消息的能力. 
</li></ul>
</li><li> 国际化: ejabberd领导国际化. 非常适合全球化. 相关功能包括:
<ul><li> 翻译成25种语言.
</li><li> 支持<a rel="nofollow" class="external text" href="http://www.ietf.org/rfc/rfc3490.txt">IDNA</a>. 
</li></ul>
</li><li> 开放标准: ejabberd是的一个完全支持XMPP标准的开源Jabber服务器.
<ul><li> 完全兼容XMPP.
</li><li> 基于XML的协议.
</li><li> 支持的<a rel="nofollow" class="external text" href="http://www.ejabberd.im/protocols">协议</a>很多.
</li></ul>
</li></ul>
<h3> <span class="mw-headline" id=".E9.A2.9D.E5.A4.96.E5.8A.9F.E8.83.BD">额外功能</span></h3>
<p>而且, ejabberd广泛支持的其他先进特性:
</p>
<ul><li> 模块化
<ul><li> 只装在你想要的模块.
</li><li> 在你自己的自定义模块扩展ejabberd. 
</li></ul>
</li><li> 安全性
<ul><li> 支持c2s和s2s连接的SASL和STARTTLS.
</li><li> 支持s2s连接的STARTTLS和Dialback.
</li><li> 可通过HTTPS安全访问的Web管理. 
</li></ul>
</li><li> 数据库
<ul><li> 快速布署的内部数据库(Mnesia).
</li><li> 原生的MySQL支持.
</li><li> 原生的PostgreSQL支持.
</li><li> 支持ODBC数据存储.
</li><li> 支持Microsoft SQL Server. 
</li></ul>
</li><li> 验证
<ul><li> 内部验证.
</li><li> PAM, LDAP 和 ODBC.
</li><li> 外部验证脚本. 
</li></ul>
</li><li> 其他
<ul><li> 支持虚拟主机.
</li><li> XML流压缩 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0138.html">XEP-0138</a>).
</li><li> 统计 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0039.html">XEP-0039</a>).
</li><li> 支持IPv6的c2s和s2s连接.
</li><li> 支持集群和HTML日志的<a href="/XEP-0045" title="XEP-0045">多用户聊天</a>模块.
</li><li> 基于用户vCards的用户目录.
</li><li> 支持<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0163.html">基于PubSub的个人事件</a>的<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0060.html">发行-订阅</a>组件.
</li><li> 支持web客户端: <a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0025.html">HTTP轮询</a>和<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0206.html">HTTP绑定(BOSH)</a>服务.
</li><li> IRC网关.
</li><li> 组件支持: 安装特定网关之后和外部网络的接口，如 AIM, ICQ 和 MSN.
</li></ul>
</li></ul>
<h2> <span class="mw-headline" id=".E5.AE.89.E8.A3.85Installing_ejabberd">安装Installing ejabberd</span></h2>
<h3> <span class="mw-headline" id=".E7.94.A8ejabberd.E4.BA.8C.E8.BF.9B.E5.88.B6.E5.AE.89.E8.A3.85.E5.8C.85.E5.AE.89.E8.A3.85">用ejabberd二进制安装包安装</span></h3>
<p>最简单的安装ejabberd即时消息服务器的方法可能是使用ProcessOne发布的二进制安装包. 已发布的ejabberd版本的二进制安装包在 ProcessOne ejabberd 下载页可以找到: <a rel="nofollow" class="external free" href="http://www.process-one.net/en/ejabberd/downloads">http://www.process-one.net/en/ejabberd/downloads</a>
</p><p>安装包将布署和配置一个完整的不需要任何依赖的ejabberd服务器.
</p><p>在 *nix 系统里, 记住启动之前把二进制安装包文件的属性设置成可执行的. 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre><span class="kw2">chmod</span> +x ejabberd<span class="nu0">-2.0</span>.0_1-linux-x86-installer.bin
.<span class="sy0">/</span>ejabberd<span class="nu0">-2.0</span>.0_1-linux-x86-installer.bin</pre></div></div>
<p>ejabberd可以任何时候手工启动, 或在系统启动时由操作系统自动启动.
</p><p>要手动启动和停止, 可使用安装包建立的桌面快捷方式. 如果机器没有图形系统, 使用在ejabberd安装目录下的 ’bin’ 目录脚本 ’start’ 和 ’stop’.
</p><p>Windows安装包把ejabberd安装成了系统服务, 同时有一个快捷方式可以启动一个调试控制台给有经验的管理员使用. 如果你想ejabberd在开机时自动启动, 进入Windows服务设置界面并把ejabberd设置成自动启动. 注意Windows服务还是一个开发中的特性, 例如它不能读取ejabberdctl.cfg文件.
</p><p>在一个 *nix 系统, 如果你想ejabberd在开机时启动成为一个服务, 从 ’bin’目录拷贝 ejabberd.init 到类似 /etc/init.d/ejabberd (取决于你的操作系统的版本). 新建一个系统用户 ejabberd; 它将用于启动该服务的脚本. 然后你可以以root身份调用 /etc/inid.d/ejabberd 来启动服务.
</p><p>如果ejabberd不能在Windows里正确地启动, 尝试用启动菜单或桌面的快捷方式启动它. 如果window显式错误14001, 解决方案是安装: "Microsoft Visual C++ 2005 SP1 Redistributable Package". 你可以从 <a rel="nofollow" class="external free" href="http://www.microsoft.com/">http://www.microsoft.com/</a> 下载它. 然后卸载并再次安装ejabberd.
</p><p>如果ejabberd不能正确启动并且生成一个崩溃的dump, 表示有严重问题. 在Windows下你可以尝试使用 bin/live.bat 脚本启动ejabberd, 或在其它操作系统执行命令 bin/ejabberdctl live . 用这个办法你可以看到Erlang提供的错误消息并且辨别出确切的问题.
</p><p>ejabberdctl管理脚本位于 bin 目录. 关于ejabberdctl和用于微调Erlang运行时系统的可配置选项，详见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#ejabberdctl" title="Ejabberd2:安装和操作指南">4.1</a> 章.
</p>
<h3> <span class="mw-headline" id=".E7.94.A8.E6.93.8D.E4.BD.9C.E7.B3.BB.E7.BB.9F.E7.89.B9.E5.AE.9A.E7.9A.84.E5.8C.85.E5.AE.89.E8.A3.85ejabberd">用操作系统特定的包安装ejabberd</span></h3>
<p>一些操作系统提供了特定的适应系统体系结构和库的ejabberd包. 它经常也会检查依赖的包并执行基本的配置任务，类似新建初始管理帐号. 例如Debian和Gentoo. 更多信息请查找你的操作系统提供的资源.
</p><p>那些包经常新建一个脚本，类似 /etc/init.d/ejabberd，在开机时启动和停止 ejabberd 服务.
</p>
<h3> <span class="mw-headline" id=".E7.94.A8CEAN.E5.AE.89.E8.A3.85ejabberd">用CEAN安装ejabberd</span></h3>
<p><a rel="nofollow" class="external text" href="http://cean.process-one.net/">CEAN</a> (Comprehensive Erlang Archive Network) 是一个存放了很多Erlang程序二进制包的仓库，包括了ejabberd和它所有的依赖包. 这些二进制包可用于多种不同的系统结构, 所以对于二进制安装包和操作系统的ejabberd包来说，这是一个备选.
</p><p>根据你如何处理你的CEAN安装而定，你需要新建自己的 ejabberd 启动脚本. 缺省的ejabberdctl脚本位于 ejabberd 的 priv 目录并且用作一个示例.
</p>
<h3> <span class="mw-headline" id=".E4.BB.8E.E6.BA.90.E7.A0.81.E5.AE.89.E8.A3.85ejabberd">从源码安装ejabberd</span></h3>
<p>发布ejabberd稳定版的规范方式是源码包. 从源码编译ejabberd在 *nix 系统是非常容易的, 只要你的系统拥有所有的依赖包.
</p>
<h4> <span class="mw-headline" id=".E9.9C.80.E6.B1.82">需求</span></h4>
<p>为了在一个‘类Unix’ 操作系统编译ejabberd, 你需要:
</p>
<ul><li> GNU Make
</li><li> GCC
</li><li> Libexpat 1.95 或更高版本
</li><li> Erlang/OTP R10B-9 或更高版本. 推荐的版本是 R12B-5. 对 R13 的支持是实验性质的.
</li><li> OpenSSL 0.9.6 或更高版本, 用于 STARTTLS, SASL 和 SSL 加密. 可选的, 高度推荐.
</li><li> Zlib 1.2.3 或更高版本, 用于支持流压缩 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0138.html">XEP-0138</a>). 可选的.
</li><li> Erlang mysql library. 可选的. 用于支持 MySQL 验证或存储. 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#MySQL" title="Ejabberd2:安装和操作指南">3.2.1</a> 节.
</li><li> Erlang pgsql library. 可选的. 用于支持 PostgreSQL 验证或存储. 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#PostgreSQL" title="Ejabberd2:安装和操作指南">3.2.3</a> 节.
</li><li> PAM library. 可选的. 用于F 可插拔的验证模块 (PAM). 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#PAM.E9.AA.8C.E8.AF.81" title="Ejabberd2:安装和操作指南">3.1.4</a> 节.
</li><li> GNU Iconv 1.8 或更高版本, 用于 IRC 网关 (mod_irc). 可选的. 在系统里不需要 GNU Libc. 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#mod_irc" title="Ejabberd2:安装和操作指南">3.3.8</a> 节.
</li><li> ImageMagick’s 转换程序. 可选的. 用于 CAPTCHA 挑战. 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#CAPTCHA" title="Ejabberd2:安装和操作指南">3.1.8</a> 节.
</li><li> exmpp 0.9.2 或更高版本. 可选的. 用于以 <a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0227.html">XEP-0227</a> XML文件格式导入/导出用户数据.
</li></ul>
<h4> <span class="mw-headline" id=".E4.B8.8B.E8.BD.BD.E6.BA.90.E7.A0.81">下载源码</span></h4>
<p>ejabberd的发布版本在 ProcessOne ejabberd 下载页: <a rel="nofollow" class="external free" href="http://www.process-one.net/en/ejabberd/downloads">http://www.process-one.net/en/ejabberd/downloads</a>
</p><p>另外, 最新的开发源码可使用命令行从 Git 仓库获得:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>git clone git:<span class="sy0">//</span>git.process-one.net<span class="sy0">/</span>ejabberd<span class="sy0">/</span>mainline.git ejabberd
<span class="kw3">cd</span> ejabberd
git checkout <span class="re5">-b</span> <span class="nu0">2.1</span>.x origin<span class="sy0">/</span><span class="nu0">2.1</span>.x</pre></div></div>
<h4> <span class="mw-headline" id=".E7.BC.96.E8.AF.91">编译</span></h4>
<p>编译ejabberd可执行以下命令:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>.<span class="sy0">/</span>configure
<span class="kw2">make</span></pre></div></div>
<p>编译配置脚本允许很多选项. 要获得所有选项列表执行以下命令:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>.<span class="sy0">/</span>configure <span class="re5">--help</span></pre></div></div>
<p>一些你可能有兴趣修改的选项如下:
</p><p><b>--prefix=/</b>
</p><p>指定运行make install命令时文件将要拷贝的路径.
</p><p><b>--enable-user[=USER]</b>
</p><p>允许普通系统用户执行ejabberdctl脚本 (参见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#ejabberd" title="Ejabberd2:安装和操作指南">4.1</a> 节), 读取配置, 读写 spool 目录, 读写 log 目录. 这个帐号的用户和组必须在运行make install之前就存在于机器上. 这个帐号不需要一个暴露的 HOME 目录, 因为缺省将使用 /var/lib/ejabberd/ .
</p><p><b>--enable-pam</b>
</p><p>允许PAM验证方法 (参见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#PAM.E9.AA.8C.E8.AF.81" title="Ejabberd2:安装和操作指南">3.1.4</a> 节).
</p><p><b>--enable-odbc or --enable-mssql</b>
</p><p>如果你想使用外部数据库则需要这个选项. 详见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E6.95.B0.E6.8D.AE.E5.BA.93.E5.92.8CLDAP.E9.85.8D.E7.BD.AE" title="Ejabberd2:安装和操作指南">3.2</a> 节.
</p><p><b>--enable-full-xml</b>
</p><p>允许使用基于XML的优化. 例如它将使用 CDATA 来逃逸 XMPP 流中的字符串. 只有你确定你的XMPP客户端有一个全兼容的XML分析器才使用这个选项.
</p><p><b>--disable-transient-supervisors</b>
</p><p>对临时进程禁止使用Erlang/OTP监督.
</p>
<h4> <span class="mw-headline" id=".E5.AE.89.E8.A3.85">安装</span></h4>
<p>安装ejabberd到目标目录, 执行以下命令:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre><span class="kw2">make</span> <span class="kw2">install</span></pre></div></div>
<p>注意安装ejabberd的时候你可能需要系统管理员的权限.
</p><p>缺省的新建文件和目录如下:
</p>
<pre><b>/etc/ejabberd/</b>
   配置文件目录:
   <b>ejabberd.cfg</b>
       ejabberd配置文件
   <b>ejabberdctl.cfg</b>
       管理脚本配置文件
   <b>inetrc</b>
       网络DNS配置文件
</pre>
<pre><b>/lib/ejabberd/</b>
   <b>ebin/</b>
       Erlang二进制文件(*.beam) 
   <b>include/</b>
       Erlang头文件(*.hrl) 
   <b>priv/</b>
       运行时需要的其他文件
       <b>bin/</b>
           可执行程序
       <b>lib/</b>
           二进制系统文件(*.so) 
       <b>msgs/</b>
           翻译文件(*.msgs) 
</pre>
<pre><b>/sbin/ejabberdctl</b>
   管理脚本(见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#ejabberdctl" title="Ejabberd2:安装和操作指南">4.1</a> 节) 
</pre>
<pre><b>/share/doc/ejabberd/</b>
   ejabberd文档
</pre>
<pre><b>/var/lib/ejabberd/</b>
   Spool目录:
   <b>.erlang.cookie</b>
       Erlang cookie文件(见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#_Erlang_Cookie" title="Ejabberd2:安装和操作指南">5.3</a> 节) 
   <b>acl.DCD, ...</b>
       Mnesia数据库spool文件(*.DCD, *.DCL, *.DAT) 
</pre>
<pre><b>/var/log/ejabberd/</b>
   日志目录(见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E6.97.A5.E5.BF.97.E6.96.87.E4.BB.B6" title="Ejabberd2:安装和操作指南">7.1</a> 节):
   <b>ejabberd.log</b>
       ejabberd服务日志
   <b>erlang.log</b>
       Erlang/OTP系统日志
</pre>
<h4> <span class="mw-headline" id=".E5.90.AF.E5.8A.A8">启动</span></h4>
<p>你可以使用ejabberdctl命令行管理脚本来启动和停止ejabberd. 如果你提供了配置选项 --enable-user=USER (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E7.BC.96.E8.AF.91" title="Ejabberd2:安装和操作指南">2.4.3</a> 节), 你可以以那个系统帐号或root的身份执行ejabberdctl.
</p><p>用法示例:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>ejabberdctl start
&#160;
ejabberdctl status
The node ejabberd<span class="sy0">@</span>localhost is started with status: started
ejabberd is running <span class="kw1">in</span> that node
&#160;
ejabberdctl stop</pre></div></div>
<p>如果ejabberd无法启动并生成一个崩溃dump, 表示有严重问题. 你可以尝试使用命令ejabberdctl live启动ejabberd来查看由Erlang提供的出错信息并识别出确切的问题.
</p><p>关于ejabberdctl和微调Erlang运行时系统的可配置选项，详见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#ejabberdctl" title="Ejabberd2:安装和操作指南">4.1</a> 节.
</p><p>如果你希望ejabberd在开机时以服务身份启动, 拷贝 ejabberd.init 到类似 /etc/init.d/ejabberd 目录(取决于你的操作系统版本). 新建一个系统用户ejabberd; 它将被启动该服务的脚本使用. 然后你可以以root身份在开机时调用 /etc/inid.d/ejabberd 来启动该服务.
</p>
<h4> <span class="mw-headline" id="BSD.E7.9A.84.E5.85.B7.E4.BD.93.E8.AF.B4.E6.98.8E">BSD的具体说明</span></h4>
<p>在BSD系统编译ejabberd的命令为:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">gmake</span></pre></div></div>
<h4> <span class="mw-headline" id="Sun_Solaris.E7.9A.84.E5.85.B7.E4.BD.93.E8.AF.B4.E6.98.8E">Sun Solaris的具体说明</span></h4>
<p>你需要一个GNU install, 但是Solaris里没有带. 如果你的Solaris系统是为 <a rel="nofollow" class="external text" href="http://www.blastwave.org/">blastwave.org</a> 包仓库配置的，这将很容易安装. 确保 /opt/csw/bin 目录在你的 PATH 参数里，然后运行:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>pkg-get <span class="re5">-i</span> fileutils</pre></div></div>
<p>如果那个软件名为 ginstall, 修改 ejabberd Makefile 脚本以适应你的系统, 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre><span class="kw2">cat</span> Makefile <span class="sy0">|</span> <span class="kw2">sed</span> s<span class="sy0">/</span><span class="kw2">install</span><span class="sy0">/</span>ginstall<span class="sy0">/</span> <span class="sy0">&gt;</span> Makefile.gi</pre></div></div>
<p>最终这样安装ejabberd:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre><span class="kw2">gmake</span> <span class="re5">-f</span> Makefile.gi ginstall</pre></div></div>
<h4> <span class="mw-headline" id="Microsoft_Windows.E7.9A.84.E5.85.B7.E4.BD.93.E8.AF.B4.E6.98.8E">Microsoft Windows的具体说明</span></h4>
<h5> <span class="mw-headline" id=".E9.9C.80.E6.B1.82_2">需求</span></h5>
<p>要在一个Microsoft Windows系统里编译ejabberd, 你需要:
</p>
<ul><li> MS Visual C++ 6.0 Compiler
</li><li> <a rel="nofollow" class="external text" href="http://www.erlang.org/download.html">Erlang/OTP R11B-5</a>
</li><li> <a rel="nofollow" class="external text" href="http://sourceforge.net/project/showfiles.php?group_id=10127&amp;package_id=11277">Expat 2.0.0或更高版本</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.gnu.org/software/libiconv/">GNU Iconv 1.9.2 (可选的)</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.slproweb.com/products/Win32OpenSSL.html">Shining Light OpenSSL 0.9.8d或更高版本(使能SSL连接)</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.zlib.net/">Zlib 1.2.3或更高版本</a>
</li></ul>
<h5> <span class="mw-headline" id=".E7.BC.96.E8.AF.91_2">编译</span></h5>
<p>我们假定你将把很多库文件尽可能放在 C:\sdk\ 目录，这样更容易跟踪为了安装ejabberd都需要些什么.
</p><p>1. 安装 Erlang emulator (例如, 在 C:\sdk\erl5.5.5).
</p><p>2. 安装 Expat 库文件到 C:\sdk\Expat-2.0.0 目录.
</p><p>拷贝文件 C:\sdk\Expat-2.0.0\Libs\libexpat.dll 到你的Windows系统目录(例如, C:\WINNT 或 C:\WINNT\System32)
</p><p>3. 编译和安装 Iconv 库到目录 C:\sdk\GnuWin32.
</p><p>拷贝文件 C:\sdk\GnuWin32\bin\lib*.dll 到你的Windows系统目录(更多安装指引可在iconv分发版的 README.woe32 文件找到 ).
</p><p>注意: 也可以不拷贝 libexpat.dll 和 iconv.dll 到Windows系统目录, 而是把目录 C:\sdk\Expat-2.0.0\Libs 和 C:\sdk\GnuWin32\bin 加到 PATH 环境变量去.
</p><p>4. 安装 OpenSSL 到 C:\sdk\OpenSSL 目录并增加 C:\sdk\OpenSSL\lib\VC 到你的环境变量或拷贝二进制文件到你的系统目录.
</p><p>5. 安装 ZLib 到 C:\sdk\gnuWin32 目录. 拷贝 C:\sdk\GnuWin32\bin\zlib1.dll 到你的系统目录. 如果你修改了你的 path ，它应该在安装 libiconv 之后已经设置好了.
</p><p>6. 确保你能从你的路径访问Erlang二进制文件. 例如: set PATH=%PATH%;"C:\sdk\erl5.6.5\bin"
</p><p>7. 取决于你如果结束实际的库文件安装，你可能需要在文件configure.erl中检查和调整路径.
</p><p>8. 在目录ejabberd\src中运行:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      configure.bat
      nmake <span class="re5">-f</span> Makefile.win32</pre></div></div>
<p>9. 编辑文件 ejabberd\src\ejabberd.cfg 并运行 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      werl <span class="re5">-s</span> ejabberd <span class="re5">-name</span> ejabberd</pre></div></div>
<h3> <span class="mw-headline" id=".E6.96.B0.E5.BB.BAXMPP.E7.AE.A1.E7.90.86.E5.B8.90.E5.8F.B7">新建XMPP管理帐号</span></h3>
<p>你需要一个XMPP帐号并赋予他管理权限来进行ejabberd Web管理:
</p><p>1. 在你的ejabberd服务器注册一个XMPP帐号, 例如admin1@example.org. 有两个办法来注册一个XMPP帐号:
</p>
<dl><dd>1.1. 使用ejabberdctl (见 4.1 节):
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>            ejabberdctl register admin1 example.org FgT5bk3</pre></div></div>
<dl><dd>1.2. 使用一个XMPP客户端进行带内注册(见 3.3.18 节). 
</dd></dl>
<p>2. 编辑ejabberd配置文件来给你创建的XMPP帐号赋予管理权限:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>      {acl, admins, {user, &quot;admin1&quot;, &quot;example.org&quot;}}.
      {access, configure, [{allow, admins}]}.</pre></div></div>
<p>你可以赋予管理权限给多个XMPP帐号, 也可以赋予权限给其他XMPP服务器.
</p><p>3. 重启ejabberd以装载新配置.
</p><p>4. 用你的浏览器打开Web管理界面(<a rel="nofollow" class="external free" href="http://server:port/admin/">http://server:port/admin/</a>). 确保键入了完整的JID作为用户名(在这个例子里是: admin1@example.org. 你需要加一个后缀的原因是因为ejabberd支持虚拟主机.
</p>
<h3> <span class="mw-headline" id=".E5.8D.87.E7.BA.A7ejabberd">升级ejabberd</span></h3>
<p>要升级一个ejabberd安装到一个新版本, 简单地卸载这个旧版本, 然后安装新版本就可以了. 当然, 重要的是配置文件和Mnesia数据库spool目录不能删除.
</p><p>在它需要的时候ejabberd在启动时会自动更新Mnesia数据表. 如果你也使用一个外部数据库来存储一些模块, 检查新的ejabberd版本的发布备注(release notes)是否指出也需要更新那些表.
</p>
<h2> <span class="mw-headline" id=".E9.85.8D.E7.BD.AEejabberd">配置ejabberd</span></h2>
<h3> <span class="mw-headline" id=".E5.9F.BA.E6.9C.AC.E9.85.8D.E7.BD.AE">基本配置</span></h3>
<p>配置文件将在你第一次启动ejabberd时装载. 从该文件获得的内容将被解析并存储到内部的ejabberd数据库. 以后的配置将从数据库装载，并且任何配置文件里的命令都会被添加到数据库里.
</p><p>注意 ejabberd永远不编辑配置文件. 所以, 使用Web管理修改的配置被存储在数据库, 而不是反射到配置文件. 如果你想那些修改在ejabberd重启后还有效, 你可以同时也修改配置文件, 或删除它的所有内容.
</p><p>配置文件包含一系列Erlang条款. 以‘%’ 标志开始的行被忽略. 每个条款是一组元素，第一个元素是一个选项的名称, 任何更多的元素则是该选项的值. 如果配置文件不包含类似‘hosts’选项, 旧的存储在数据库的主机名(s)将被启用.
</p><p>你可以重写存储在数据库的值，通过在配置文件的开始部分增加下面几行:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>override_global.
override_local.
override_acls.</pre></div></div>
<p>有了这些行，旧的全局选项(在一个集群的所有ejabberd节点之间分享), 本地选项(特有的用于本地ejabberd节点的) 以及 ACLs 将在新配置添加之前被移除.
</p>
<h4> <span class="mw-headline" id=".E4.B8.BB.E6.9C.BA.E5.90.8D">主机名</span></h4>
<p>选项 hosts 定义了包含一个或多个ejabberd将为其提供服务的域名的列表.
</p><p>语法是:
</p><p><b>{hosts, [HostName, ...]}.</b>
</p><p>示例:
</p>
<ul><li> 服务一个域:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 服务多个域:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;example.net&quot;</span>, <span class="st0">&quot;example.com&quot;</span>, <span class="st0">&quot;jabber.somesite.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id=".E8.99.9A.E6.8B.9F.E4.B8.BB.E6.9C.BA">虚拟主机</span></h4>
<p>每个虚拟主机的选项可以被独立定义，使用 host_config 选项.
</p><p>语法是:
</p><p><b>{host_config, HostName, [Option, ...]}</b>
</p><p>示例:
</p>
<ul><li> 域example.net使用内部验证方法，同时域example.com使用运行在域localhost的LDAP服务器来进行验证:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;example.net&quot;</span>, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>auth_method,   internal<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;example.com&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#123;</span>auth_method,   ldap<span class="br0">&#125;</span>,
                                    <span class="br0">&#123;</span>ldap_servers,  <span class="br0">&#91;</span><span class="st0">&quot;localhost&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
                                    <span class="br0">&#123;</span>ldap_uids,     <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;uid&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
                                    <span class="br0">&#123;</span>ldap_rootdn,   <span class="st0">&quot;dc=localdomain&quot;</span><span class="br0">&#125;</span>,
                                    <span class="br0">&#123;</span>ldap_rootdn,   <span class="st0">&quot;dc=example,dc=com&quot;</span><span class="br0">&#125;</span>,
                                    <span class="br0">&#123;</span>ldap_password, <span class="st0">&quot;&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 域example.net使用ODBC来进行验证，同时域example.com使用运行在域localhost和otherhost的LDAP服务器:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;example.net&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#123;</span>auth_method, odbc<span class="br0">&#125;</span>,
                                    <span class="br0">&#123;</span>odbc_server, <span class="st0">&quot;DSN=ejabberd;UID=ejabberd;PWD=ejabberd&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;example.com&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#123;</span>auth_method,   ldap<span class="br0">&#125;</span>,
                                    <span class="br0">&#123;</span>ldap_servers,  <span class="br0">&#91;</span><span class="st0">&quot;localhost&quot;</span>, <span class="st0">&quot;otherhost&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
                                    <span class="br0">&#123;</span>ldap_uids,     <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;uid&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
                                    <span class="br0">&#123;</span>ldap_rootdn,   <span class="st0">&quot;dc=localdomain&quot;</span><span class="br0">&#125;</span>,
                                    <span class="br0">&#123;</span>ldap_rootdn,   <span class="st0">&quot;dc=example,dc=com&quot;</span><span class="br0">&#125;</span>,
                                    <span class="br0">&#123;</span>ldap_password, <span class="st0">&quot;&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>为了给一个虚拟主机指定特定的ejabberd模块, 你可能先为常规模块定义全局模块选项, 之后增加指定的模块给特定的虚拟主机. 为此, 把定义host_config的每个选项改成通用语法
</p><p><b>{OptionName, OptionValue}</b>
</p><p>使用这个语法:
</p><p><b>{{add, OptionName}, OptionValue}</b>
</p><p>在这个例子里，三个虚拟主机有一些相同的模块, 但是特定的虚拟主机也有不同的模块:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>%% 这个ejabberd服务器有三个虚拟主机:
<span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;one.example.org&quot;</span>, <span class="st0">&quot;two.example.org&quot;</span>, <span class="st0">&quot;three.example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
%% 这些是所有主机通用模块的配置
<span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  <span class="br0">&#123;</span>mod_roster,     <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span>mod_configure,  <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span>mod_disco,      <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span>mod_private,    <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span>mod_time,       <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span>mod_last,       <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span>mod_version,    <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
%% 增加一些模块给 vhost one:
<span class="br0">&#123;</span>host_config, <span class="st0">&quot;one.example.org&quot;</span>,
 <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="br0">&#123;</span>add, modules<span class="br0">&#125;</span>, <span class="br0">&#91;</span>
                    <span class="br0">&#123;</span>mod_echo,       <span class="br0">&#91;</span><span class="br0">&#123;</span>host, <span class="st0">&quot;echo-service.one.example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
                    <span class="br0">&#123;</span>mod_http_bind,  <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
                    <span class="br0">&#123;</span>mod_logxml,     <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
                   <span class="br0">&#93;</span>
  <span class="br0">&#125;</span>
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
%% 只增加一个模块给 vhost two:
<span class="br0">&#123;</span>host_config, <span class="st0">&quot;two.example.org&quot;</span>,
 <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="br0">&#123;</span>add, modules<span class="br0">&#125;</span>, <span class="br0">&#91;</span>
                    <span class="br0">&#123;</span>mod_echo,       <span class="br0">&#91;</span><span class="br0">&#123;</span>host, <span class="st0">&quot;mirror.two.example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
                   <span class="br0">&#93;</span>
  <span class="br0">&#125;</span>
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id=".E7.9B.91.E5.90.AC.E7.AB.AF.E5.8F.A3">监听端口</span></h4>
<p>选项 listen 定义ejabberd将监听哪些端口, 地址和网络协议，以及什么服务将运行在它们上面. 这个列表的每个元素是一组以下的元素:
</p>
<ul><li> 端口号. 还有可选的IP地址和/或一个传输协议.
</li><li> 监听这个端口的模块.
</li><li> TCP socke和监听中的模块的选项. 
</li></ul>
<p>这个选项的语法是:
</p><p><b>{listen, [Listener, ...]}.</b>
</p><p>定义一个 listener 有很多语法.
</p><p><b>{PortNumber, Module, [Option, ...]}</b>
</p><p><b>{{PortNumber, IPaddress}, Module, [Option, ...]}</b>
</p><p><b>{{PortNumber, TransportProtocol}, Module, [Option, ...]}</b>
</p><p><b>{{PortNumber, IPaddress, TransportProtocol}, Module, [Option, ...]}</b>
</p>
<h5> <span class="mw-headline" id=".E7.AB.AF.E5.8F.A3.E5.8F.B7.2CIP.E5.9C.B0.E5.9D.80.E5.92.8C.E4.BC.A0.E8.BE.93.E5.8D.8F.E8.AE.AE">端口号,IP地址和传输协议</span></h5>
<p>端口号定义哪个端口监听链入的连接. 它可能是一个Jabber/XMPP标准端口(见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E9.98.B2.E7.81.AB.E5.A2.99.E8.AE.BE.E5.AE.9A" title="Ejabberd2:安装和操作指南">5.1</a> 节) 或任何其他合法的端口号.
</p><p>IP地址可能被表达为一个字符串或一个十进制或十六进制的 Erlang 组. socket 将只监听那个网络接口. 也可能指定一个通用地址, 这样ejabberd将监听所有地址. 取决于IP地址的类型, 将使用IPv4或IPv6. 当没有指定IP地址时, 它将监听所有IPv4网络地址.
</p><p>一些IP地址的示例值:
</p>
<ul><li> "0.0.0.0" 监听所有IPv4网络接口. 这是当没有指定IP地址时的缺省值.
</li><li> "::" 监听所有IPv6网络接口
</li><li> "10.11.12.13" 监听IPv4地址 10.11.12.13
</li><li> "::FFFF:127.0.0.1" 是IPv6地址&#160;::FFFF:127.0.0.1/128
</li><li> {10, 11, 12, 13} 是IPv4地址 10.11.12.13
</li><li> {0, 0, 0, 0, 0, 65535, 32512, 1} 是IPv6地址&#160;::FFFF:127.0.0.1/128
</li><li> {16#fdca, 16#8ab6, 16#a243, 16#75ef, 0, 0, 0, 1} 是IPv6地址 FDCA:8AB6:A243:75EF::1/128 
</li></ul>
<p>传输协议可能是 tcp 或 udp. 缺省是 tcp.
</p>
<h5> <span class="mw-headline" id=".E7.9B.91.E5.90.AC.E7.9A.84.E6.A8.A1.E5.9D.97">监听的模块</span></h5>
<p>可用的模块, 它们的目的以及允许使用哪些选项:
</p><p><b>ejabberd_c2s</b>
</p>
<dl><dd>处理c2s连接.
</dd><dd>选项: access, certfile, max_fsm_queue, max_stanza_size, shaper, starttls, starttls_required, tls, zlib 
</dd></dl>
<p><b>ejabberd_s2s_in</b>
</p>
<dl><dd>处理链入的s2s连接.
</dd><dd>选项: max_stanza_size 
</dd></dl>
<p><b>ejabberd_service</b>
</p>
<dl><dd>和一个<a rel="nofollow" class="external text" href="http://www.ejabberd.im/tutorials-transports">外部组件</a>的接口(定义于Jabber组件协议(<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0114.html">XEP-0114</a>).
</dd><dd>选项: access, hosts, max_fsm_queue, shaper, service_check_from 
</dd></dl>
<p><b>ejabberd_stun</b>
</p>
<dl><dd>处理STUN绑定请求，定义于 <a rel="nofollow" class="external text" href="http://tools.ietf.org/html/rfc5389">RFC 5389</a>.
</dd><dd>选项: certfile 
</dd></dl>
<p><b>ejabberd_http</b>
</p>
<dl><dd>处理链入的HTTP连接.
</dd><dd>选项: captcha, certfile, http_bind, http_poll, request_handlers, tls, web_admin
</dd></dl>
<h5> <span class="mw-headline" id=".E9.80.89.E9.A1.B9">选项</span></h5>
<p>这是每个监听的模块允许使用的选项的详细描述:
</p><p><b>{access, AccessName}</b>
</p>
<dl><dd>这个选项定义访问的端口. 缺省值是 all. 
</dd></dl>
<p><b>{backlog, Value}</b>
</p>
<dl><dd>这个backlog值定义等待中的连接的队列可以达到的最大长度. 如果服务器想处理很多的新链入连接，这个值需要增加。因为如果队列里没有足够的空间(ejabberd不能立刻接受它们)，这些新连接可能被抛弃. 缺省值是 5. 
</dd></dl>
<p><b>{certfile, Path}</b>
</p>
<dl><dd>包含缺省的SSL证书的文件的完整路径. 为一个给定的域定义一个证书文件, 使用全局选项 domain_certfile. 
</dd></dl>
<p><b>{service_check_from, true|false}</b>
</p>
<dl><dd>这个选项只能被用于ejabberd_service. 它被用于禁止控制一个从外部组件发送的包的from字段. 这个选项要么是 true 要么是 false. 缺省值是 true ，它遵循 <a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0114.html">XEP-0114</a>. 
</dd></dl>
<p><b>{hosts, [Hostname, ...], [HostOption, ...]}</b>
</p>
<dl><dd>连接到ejabberd_service的外部Jabber组件可能服务一个或多个hostnames. 所以你可以为这个组件定义选项 HostOption&#160;; 目前只允许的选项是当组件尝试连接到ejabberd时必需提供的密码: {password, Secret}. 注意你不能在不同的服务里定义同一个 ejabberd_service 组件: 为每个服务增加一个 ejabberd_service , 示例如下. 
</dd></dl>
<p><b>captcha</b>
</p>
<dl><dd>简单的web页面，允许一个用户填一个 CAPTCHA 挑战(见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#CAPTCHA" title="Ejabberd2:安装和操作指南">3.1.8</a> 节). 
</dd></dl>
<p><b>http_bind</b>
</p>
<dl><dd>这个选项允许支持HTTP绑定(<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0124.html">XEP-0124</a>和<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0206.html">XEP-0206</a>) . HTTP绑定允许通过HTTP请求，从那些不允许从5222端口链出socket的防火墙后面访问ejabberd.
</dd><dd>记住你也必须安装和激活mod_http_bind模块.
</dd><dd>如果HTTP绑定激活了, 它将可以使用 <a rel="nofollow" class="external free" href="http://server:port/http-bind/">http://server:port/http-bind/</a>. 注意对HTTP绑定的支持也需要XMPP客户端. 也要注意HTTP绑定对一个基于web的XMPP客户端的主机也是很有意义的，例如<a rel="nofollow" class="external text" href="http://jwchat.sourceforge.net/">JWChat</a> (检查教程来给ejabberd安装JWChat，以及一个 <a rel="nofollow" class="external text" href="http://www.ejabberd.im/jwchat-localserver">内嵌的本地web服务器</a> 或 <a rel="nofollow" class="external text" href="http://www.ejabberd.im/jwchat-apache">Apache</a>). 
</dd></dl>
<p><b>http_poll</b>
</p>
<dl><dd>这个选项允许支持HTTP轮询(<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0025.html">XEP-0025</a>). HTTP轮询允许通过HTTP请求，从那些不允许从5222端口链出socket的防火墙后面访问ejabberd.
</dd><dd>如果激活了HTTP轮询, 它可以用 <a rel="nofollow" class="external free" href="http://server:port/http-poll/">http://server:port/http-poll/</a>. 注意对HTTP轮询的支持也需要XMPP客户端. 也要注意HTTP轮询对一个基于web的XMPP客户端的主机是很有意义的，例如<a rel="nofollow" class="external text" href="http://jwchat.sourceforge.net/">JWChat</a>.
</dd><dd>在没有链入的POST请求时一个客户端会话保持激活状态的最大时间段，可以用全局选项 http_poll_timeout 配置. 缺省值为5分钟. 这个选项可在 ejabberd.cfg 文件里定义, 时间的单位为秒: {http_poll_timeout, 300}. 
</dd></dl>
<p><b>{max_fsm_queue, Size}</b>
</p>
<dl><dd>这个选项指定在一个FSM(有限状态机)队列里元素的最大数量. 大概来说, 在这这些队列的每个消息展示一个准备发送到它想要的外发的流的XML节. 如果队列大小达到限制(因为, 例如, 节的接收者太慢), 这个FSM和相应的连接(如果有)将被终止并且记录一个出错信息. 这个选项的合理的值依赖于你的硬件配置. 无论如何, 把这个大小设为1000个元素以上应该没什么感觉. 这个选项可被指定给 ejabberd_service 和 ejabberd_c2s listeners, 或也可以全局地指定给 ejabberd_s2s_out. 如果这个选项没有指定给 ejabberd_service 或 ejabberd_c2s listeners, 则使用全局配置的值. 允许的值为整数和 ’undefined’. 缺省值为: ’undefined’. 
</dd></dl>
<p><b>{max_stanza_size, Size}</b>
</p>
<dl><dd>这个选项指定一个XML节的近似最大字节数. 近似的, 是因为它计算的精度是以一个被读数据块来的. 例如 {max_stanza_size, 65536}. 缺省值是无穷大. 推荐的值对于c2s连接是 65536，对于s2s连接 是 131072 . s2s 最大节数必须总是比 c2s 的限制更高. 谨慎修改此值，因为如果设置得太小可能导致意料之外的断链. 
</dd></dl>
<p><b>{request_handlers, [ {Path, Module}, ...]}</b>
</p>
<dl><dd>指定一个或多个 handlers 来伺服HTTP请求. Path是一个字符串列表; 所以以那个 Path 启动的 URIs 将被 Module 伺服. 例如, 你希望 mod_foo to 伺服以 /a/b/ 开头的URIs, 同时你也希望 mod_http_bind 伺服 URIs /http-bind/, 使用这个选项: {request_handlers, [{["a", "b"], mod_foo}, {["http-bind"], mod_http_bind}]} 
</dd></dl>
<p><b>{service_check_from, true|false}</b>
</p>
<dl><dd>通过使能这个选项, ejabberd 允许组件发送的包的’from’属性可以是任何随意的域. 注意 <a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0114.html">XEP-0114</a> 要求域必须和组件的主机名吻合. 只有你确保自己需要的情况下才应该激活这个选项. 缺省值是: false. 
</dd></dl>
<p><b>{shaper, none|ShaperName}</b>
</p>
<dl><dd>这个选项为端口定义一个塑型者 shaper (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#Shapers" title="Ejabberd2:安装和操作指南">3.1.6</a> 节). 缺省值是 none. 
</dd></dl>
<p><b>starttls</b>
</p>
<dl><dd>这个选项定义 STARTTLS 加密可以用于连接某端口. 你应该也设置 certfile 选项. 你可以使用全局选项 domain_certfile为一个特定的域定义一个证书文件. 
</dd></dl>
<p><b>starttls_required</b>
</p>
<dl><dd>这个选项指定在连接到某端口时 STARTTLS 加密是必需的. 不允许不加密的连接. 你应该也设置 certfile 选项. 你可以使用全局选项 domain_certfile为一个特定的域定义一个证书文件. 
</dd></dl>
<p><b>tls</b>
</p>
<dl><dd>这个选项指定某端口的通讯在连接之后将立刻使用SSL加密. 这是一个早期的Jabber软件使用的传统加密方法, 通常是在端口 5223 ，用于客户端－服务器通讯. 但是这个方法今天已经被藐视和不推荐了. 可取的加密方法是在端口5222使用 STARTTLS , 定义于 <a href="/RFC3920" title="RFC3920">RFC 3920: XMPP核心</a>, 这个方法在 ejabberd 里可以使用 starttls 选项来激活. 如果这个选项被设置了, 你应该同时设置 certfile 选项. 选项 tls 也可用于 ejabberd_http 以支持 HTTPS. 
</dd></dl>
<p><b>web_admin</b>
</p>
<dl><dd>这个选项激活为ejabberd管理激活 Web Admin ，可在 <a rel="nofollow" class="external free" href="http://server:port/admin/">http://server:port/admin/</a> 访问. 登录和密码就是某个你在‘configure’ access rule里授权了的已注册用户的用户名和密码. 
</dd></dl>
<p><b>zlib</b>
</p>
<dl><dd>这个选项指定在某端口的连接可使用 Zlib 流压缩(定义于 <a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0138.html">XEP-0138</a>). 
</dd></dl>
<p>有一些额外的全局选项(listen之外的)可以在ejabberd配置文件指定:
</p><p><b>{s2s_use_starttls, true|false}</b>
</p>
<dl><dd>这个选项定义是否为s2s连接使用 STARTTLS . 
</dd></dl>
<p><b>{s2s_certfile, Path}</b>
</p>
<dl><dd>一个包含SSL证书的文件的全路径. 
</dd></dl>
<p><b>{domain_certfile, Domain, Path}</b>
</p>
<dl><dd>包含一个特定域的SSL证书的文件的全路径. 
</dd></dl>
<p><b>{outgoing_s2s_options, Methods, Timeout}</b>
</p>
<dl><dd>指定用哪个地址尝试连接, 以什么顺序, 以及连接超时时间(以毫秒计). 缺省第一次尝试连接使用IPv4地址, 如果失败它将尝试使用IPv6, 超时时间为 10000 毫秒. 
</dd></dl>
<p><b>{s2s_dns_options, [ {Property, Value}, ...]}</b>
</p>
<dl><dd>指定用于DNS解析的 properties. 允许的 Properties 有: 以秒计的缺省值为10的 timeout 和缺省值为2的重试次数. 
</dd></dl>
<p><b>{s2s_default_policy, allow|deny}</b>
</p>
<dl><dd>对于链入和链出到其他XMPP服务器的s2s连接的缺省策略. 缺省值是 allow. 
</dd></dl>
<p><b>{{s2s_host, Host}, allow|deny}</b>
</p>
<dl><dd>指定是否允许一个特定远程主机的链入和链出s2s连接. 这允许限制 ejabberd 只和少数信任的服务器建立s2s连接, 或禁止一些特定的服务器. 
</dd></dl>
<p><b>{s2s_max_retry_delay, Seconds}</b>
</p>
<dl><dd>连接失败后重试连接的最大允许延迟时间. 以秒计算. 这个缺省值是 300 秒 (5分钟). 
</dd></dl>
<p><b>{max_fsm_queue, Size}</b>
</p>
<dl><dd>这个选项指定FSM(有限状态机)的队列里元素的最大数量. 大概来说, 在这些队列里每个消息展示一个准备发送到它想要的外发的流的XML节. 如果队列大小达到限制(因为, 例如, 节的接收者太慢), 这个FSM和相应的连接(如果有)将被终止并且记录一个出错信息. 这个选项的合理的值依赖于你的硬件配置. 无论如何, 把这个大小设为1000个元素以上应该没什么感觉. 这个选项可被指定给 ejabberd_service 和 ejabberd_c2s listeners, 或也可以全局地指定给 ejabberd_s2s_out. 如果这个选项没有指定给 ejabberd_service 或 ejabberd_c2s listeners, 则使用全局配置的值. 允许的值为整数和 ’undefined’. 缺省值为: ’undefined’.  
</dd></dl>
<p><b>{route_subdomains, local|s2s}</b>
</p>
<dl><dd>定义 ejabberd 是必须直接把节从本地路由到子域 subdomains(兼容 <a href="/RFC3920" title="RFC3920">RFC 3920: XMPP核心</a>), 还是使用S2S到外部服务器 (兼容 <a rel="nofollow" class="external text" href="http://tools.ietf.org/html/draft-saintandre-rfc3920bis-09#section-11.3">RFC 3920 bis</a>).
</dd></dl>
<h5> <span class="mw-headline" id=".E7.A4.BA.E4.BE.8B">示例</span></h5>
<p>例如, 以下简单配置定义:
</p>
<ul><li> 有三个域. 缺省证书文件是 server.pem. 然而, 连接到域example.com的c2s和s2s使用文件example_com.pem.
</li><li> 端口 5222 使用 STARTTLS 监听 c2s 连接, 同时允许简单连接用于旧的客户端.
</li><li> 端口 5223 使用旧的 SSL 监听 c2s 连接 .
</li><li> 端口 5269 使用 STARTTLS 监听 s2s 连接. 这个socket设为IPv6而不是IPv4.
</li><li> 端口 3478 监听通过 UDP 发出的 STUN 请求 .
</li><li> 端口 5280 监听 HTTP 请求, 并伺服 HTTP 轮询服务.
</li><li> 端口 5281 监听 HTTP 请求, 并使用 HTTPS 伺服 Web Admin (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#Web.E7.AE.A1.E7.90.86" title="Ejabberd2:安装和操作指南">4.3</a> 节). 这个socket只监听来自IP地址127.0.0.1的连接.
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;example.com&quot;</span>, <span class="st0">&quot;example.org&quot;</span>, <span class="st0">&quot;example.net&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>listen,
 <span class="br0">&#91;</span>
  <span class="br0">&#123;</span><span class="nu0">5222</span>, ejabberd_c2s, <span class="br0">&#91;</span>
                        <span class="br0">&#123;</span>access, c2s<span class="br0">&#125;</span>,
                        <span class="br0">&#123;</span>shaper, c2s_shaper<span class="br0">&#125;</span>,
                        starttls, <span class="br0">&#123;</span>certfile, <span class="st0">&quot;/etc/ejabberd/server.pem&quot;</span><span class="br0">&#125;</span>,
                        <span class="br0">&#123;</span>max_stanza_size, <span class="nu0">65536</span><span class="br0">&#125;</span>
                       <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5223</span>, ejabberd_c2s, <span class="br0">&#91;</span>
                        <span class="br0">&#123;</span>access, c2s<span class="br0">&#125;</span>,
                        <span class="br0">&#123;</span>shaper, c2s_shaper<span class="br0">&#125;</span>,
                        tls, <span class="br0">&#123;</span>certfile, <span class="st0">&quot;/etc/ejabberd/server.pem&quot;</span><span class="br0">&#125;</span>,
                        <span class="br0">&#123;</span>max_stanza_size, <span class="nu0">65536</span><span class="br0">&#125;</span>
                       <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="br0">&#123;</span><span class="nu0">5269</span>, <span class="st0">&quot;::&quot;</span><span class="br0">&#125;</span>, ejabberd_s2s_in, <span class="br0">&#91;</span>
                                   <span class="br0">&#123;</span>shaper, s2s_shaper<span class="br0">&#125;</span>,
                                   <span class="br0">&#123;</span>max_stanza_size, <span class="nu0">131072</span><span class="br0">&#125;</span>
                                  <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="br0">&#123;</span><span class="nu0">3478</span>, udp<span class="br0">&#125;</span>, ejabberd_stun, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5280</span>, ejabberd_http, <span class="br0">&#91;</span>
                         http_poll
                        <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="br0">&#123;</span><span class="nu0">5281</span>, <span class="st0">&quot;127.0.0.1&quot;</span><span class="br0">&#125;</span>, ejabberd_http, <span class="br0">&#91;</span>
                                        web_admin,
                                        tls, <span class="br0">&#123;</span>certfile, <span class="st0">&quot;/etc/ejabberd/server.pem&quot;</span><span class="br0">&#125;</span>,
                                       <span class="br0">&#93;</span><span class="br0">&#125;</span>
 <span class="br0">&#93;</span>
<span class="br0">&#125;</span>.
<span class="br0">&#123;</span>s2s_use_starttls, true<span class="br0">&#125;</span>.
<span class="br0">&#123;</span>s2s_certfile, <span class="st0">&quot;/etc/ejabberd/server.pem&quot;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>domain_certfile, <span class="st0">&quot;example.com&quot;</span>, <span class="st0">&quot;/etc/ejabberd/example_com.pem&quot;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>在这个例子, 定义了以下配置:
</p>
<ul><li> 端口 5222 (所有IPv4地址)和端口5223 (SSL, IP 192.168.0.1 和 fdca:8ab6:a243:75ef::1)监听c2s连接 ，并禁止名为 ‘bad’的用户.
</li><li> 端口 5269 (所有IPv4地址)为了允许安全通讯而使用STARTTLS监听s2s连接. 远程XMPP服务器的链入和链出连接被禁止, 只有两个服务器可以连接: "jabber.example.org" 和 "example.com".
</li><li> 端口 5280 在所有的IPv4地址伺服 Web Admin 和 HTTP Polling 服务. 注意它也可能在不同端口伺服它们. <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#Web.E7.AE.A1.E7.90.86" title="Ejabberd2:安装和操作指南">4.3</a> 节的第二个例子展示了怎样确切的做法.
</li><li> 除了管理员，所有用户的通讯流量限制为 1,000 Bytes/second
</li><li> <a rel="nofollow" class="external text" href="http://www.ejabberd.im/pyaimt">AIM 网关</a> aim.example.org 被连接到localhost IP 地址(127.0.0.1 and&#160;::1)的 5233 端口 ， 连接密码为‘aimsecret’.
</li><li> ICQ 网关 JIT (icq.example.org and sms.example.org) 被以密码‘jitsecret’连接到端口 5234 .
</li><li> <a rel="nofollow" class="external text" href="http://www.ejabberd.im/pymsnt">MSN 网关</a> msn.example.org 被以密码‘msnsecret’连接到端口 5235 .
</li><li> <a rel="nofollow" class="external text" href="http://www.ejabberd.im/yahoo-transport-2">Yahoo! 网关</a> yahoo.example.org 被以密码‘yahoosecret’连接到端口 5236 .
</li><li> <a rel="nofollow" class="external text" href="http://www.ejabberd.im/jabber-gg-transport">Gadu-Gadu 网关</a> gg.example.org  被以密码‘ggsecret’连接到端口 5237 .
</li><li> <a rel="nofollow" class="external text" href="http://www.ejabberd.im/jmc">Jabber Mail 组件</a> jmc.example.org 被以密码‘jmsecret’连接到端口 5238 .
</li><li> 服务自定义允许特别的选项用来逃避对从这个组件发送的包里检查from属性. 这个组件可以从服务器以任何用户的身份发送包, 或者甚至以任何服务器的身份.
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>acl, blocked, <span class="br0">&#123;</span>user, <span class="st0">&quot;bad&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>access, c2s, <span class="br0">&#91;</span><span class="br0">&#123;</span>deny, blocked<span class="br0">&#125;</span>,
               <span class="br0">&#123;</span>allow, all<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>shaper, normal, <span class="br0">&#123;</span>maxrate, <span class="nu0">1000</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>access, c2s_shaper, <span class="br0">&#91;</span><span class="br0">&#123;</span>none, admin<span class="br0">&#125;</span>,
                      <span class="br0">&#123;</span>normal, all<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>listen,
 <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="nu0">5222</span>, ejabberd_c2s, <span class="br0">&#91;</span>
                        <span class="br0">&#123;</span>access, c2s<span class="br0">&#125;</span>,
                        <span class="br0">&#123;</span>shaper, c2s_shaper<span class="br0">&#125;</span>
                       <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="br0">&#123;</span><span class="nu0">5223</span>, <span class="br0">&#123;</span><span class="nu0">192</span>, <span class="nu0">168</span>, <span class="nu0">0</span>, <span class="nu0">1</span><span class="br0">&#125;</span><span class="br0">&#125;</span>, ejabberd_c2s, <span class="br0">&#91;</span>
                                            <span class="br0">&#123;</span>access, c2s<span class="br0">&#125;</span>,
                                            ssl, <span class="br0">&#123;</span>certfile, <span class="st0">&quot;/path/to/ssl.pem&quot;</span><span class="br0">&#125;</span>
                                           <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="br0">&#123;</span><span class="nu0">5223</span>, <span class="br0">&#123;</span><span class="nu0">16</span>#fdca, <span class="nu0">16</span>#8ab6, <span class="nu0">16</span>#a243, <span class="nu0">16</span>#75ef, <span class="nu0">0</span>, <span class="nu0">0</span>, <span class="nu0">0</span>, <span class="nu0">1</span><span class="br0">&#125;</span><span class="br0">&#125;</span>,
   ejabberd_c2s, <span class="br0">&#91;</span>
                  <span class="br0">&#123;</span>access, c2s<span class="br0">&#125;</span>,
                  ssl, <span class="br0">&#123;</span>certfile, <span class="st0">&quot;/path/to/ssl.pem&quot;</span><span class="br0">&#125;</span>
                 <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5269</span>, ejabberd_s2s_in, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="br0">&#123;</span><span class="nu0">5280</span>, <span class="br0">&#123;</span><span class="nu0">0</span>, <span class="nu0">0</span>, <span class="nu0">0</span>, <span class="nu0">0</span><span class="br0">&#125;</span><span class="br0">&#125;</span>, ejabberd_http, <span class="br0">&#91;</span>
                                         http_poll,
                                         web_admin
                                        <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="br0">&#123;</span><span class="nu0">5233</span>, <span class="br0">&#123;</span><span class="nu0">127</span>, <span class="nu0">0</span>, <span class="nu0">0</span>, <span class="nu0">1</span><span class="br0">&#125;</span><span class="br0">&#125;</span>, ejabberd_service, <span class="br0">&#91;</span>
                                              <span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;aim.example.org&quot;</span><span class="br0">&#93;</span>,
                                                 <span class="br0">&#91;</span><span class="br0">&#123;</span>password, <span class="st0">&quot;aimsecret&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
                                             <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="br0">&#123;</span><span class="nu0">5233</span>, <span class="st0">&quot;::1&quot;</span><span class="br0">&#125;</span>, ejabberd_service, <span class="br0">&#91;</span>
                                     <span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;aim.example.org&quot;</span><span class="br0">&#93;</span>,
                                        <span class="br0">&#91;</span><span class="br0">&#123;</span>password, <span class="st0">&quot;aimsecret&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
                                    <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5234</span>, ejabberd_service, <span class="br0">&#91;</span><span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;icq.example.org&quot;</span>, <span class="st0">&quot;sms.example.org&quot;</span><span class="br0">&#93;</span>,
                             <span class="br0">&#91;</span><span class="br0">&#123;</span>password, <span class="st0">&quot;jitsecret&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5235</span>, ejabberd_service, <span class="br0">&#91;</span><span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;msn.example.org&quot;</span><span class="br0">&#93;</span>,
                             <span class="br0">&#91;</span><span class="br0">&#123;</span>password, <span class="st0">&quot;msnsecret&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5236</span>, ejabberd_service, <span class="br0">&#91;</span><span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;yahoo.example.org&quot;</span><span class="br0">&#93;</span>,
                             <span class="br0">&#91;</span><span class="br0">&#123;</span>password, <span class="st0">&quot;yahoosecret&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5237</span>, ejabberd_service, <span class="br0">&#91;</span><span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;gg.example.org&quot;</span><span class="br0">&#93;</span>,
                             <span class="br0">&#91;</span><span class="br0">&#123;</span>password, <span class="st0">&quot;ggsecret&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5238</span>, ejabberd_service, <span class="br0">&#91;</span><span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;jmc.example.org&quot;</span><span class="br0">&#93;</span>,
                             <span class="br0">&#91;</span><span class="br0">&#123;</span>password, <span class="st0">&quot;jmcsecret&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5239</span>, ejabberd_service, <span class="br0">&#91;</span><span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;custom.example.org&quot;</span><span class="br0">&#93;</span>,
                             <span class="br0">&#91;</span><span class="br0">&#123;</span>password, <span class="st0">&quot;customsecret&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
                            <span class="br0">&#123;</span>service_check_from, false<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
 <span class="br0">&#93;</span>
<span class="br0">&#125;</span>.
<span class="br0">&#123;</span>s2s_use_starttls, true<span class="br0">&#125;</span>.
<span class="br0">&#123;</span>s2s_certfile, <span class="st0">&quot;/path/to/ssl.pem&quot;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>s2s_default_policy, deny<span class="br0">&#125;</span>.
<span class="br0">&#123;</span><span class="br0">&#123;</span>s2s_host,<span class="st0">&quot;jabber.example.org&quot;</span><span class="br0">&#125;</span>, allow<span class="br0">&#125;</span>.
<span class="br0">&#123;</span><span class="br0">&#123;</span>s2s_host,<span class="st0">&quot;example.com&quot;</span><span class="br0">&#125;</span>, allow<span class="br0">&#125;</span>.</pre></div></div>
<p>注意, 对基于 jabberd14 或 WPJabber 的服务，你不得不做一个网关日志并通过它们本身做 XDB&#160;: 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre> &lt;!--
     You have to add elogger and rlogger entries here when using ejabberd.
     In this case the transport will do the logging.
  --&gt;
&#160;
  &lt;log id<span class="sy0">=</span><span class="re2">'logger'&gt;</span>
    &lt;host/&gt;
    &lt;logtype/&gt;
    &lt;format&gt;%d: <span class="re0"><span class="br0">&#91;</span>%t<span class="br0">&#93;</span></span> <span class="br0">&#40;</span>%h<span class="br0">&#41;</span>:&#160;%s&lt;/format&gt;
    &lt;file&gt;/var/log/jabber/service.log&lt;/file&gt;
  &lt;/log&gt;
&#160;
  &lt;!--
     Some XMPP server implementations do not provide
     XDB services <span class="br0">&#40;</span>for example, jabberd2 and ejabberd<span class="br0">&#41;</span>.
     xdb_file.so is loaded in to handle all XDB requests.
  --&gt;
&#160;
  &lt;xdb id<span class="sy0">=</span><span class="st0">&quot;xdb&quot;</span>&gt;
    &lt;host/&gt;
    &lt;load&gt;
      &lt;!-- this is a lib of wpjabber or jabberd14 --&gt;
      &lt;xdb_file&gt;/usr/lib/jabber/xdb_file.so&lt;/xdb_file&gt;
      &lt;/load&gt;
    &lt;xdb_file xmlns<span class="sy0">=</span><span class="st0">&quot;jabber:config:xdb_file&quot;</span>&gt;
      &lt;spool&gt;&lt;jabberd:cmdline flag<span class="sy0">=</span><span class="re2">'s'&gt;/var/spool/jabber&lt;/jabberd:cmdline&gt;&lt;/spool&gt;</span>
    &lt;/xdb_file&gt;
  &lt;/xdb&gt;</pre></div></div>
<h4> <span class="mw-headline" id=".E9.AA.8C.E8.AF.81">验证</span></h4>
<p>选项 auth_method 定义了用于验证用户的验证方法. 语法是:
</p><p><b>{auth_method, [Method, ...]}.</b>
</p><p>ejabberd支持以下验证方法:
</p>
<ul><li> internal (缺省) — 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E5.86.85.E9.83.A8" title="Ejabberd2:安装和操作指南">3.1.4.</a> 节
</li><li> external — 有<a rel="nofollow" class="external text" href="http://www.ejabberd.im/extauth">一些示例验证代码</a>.
</li><li> ldap — 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#LDAP" title="Ejabberd2:安装和操作指南">3.2.5.</a> 节
</li><li> odbc — 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#MySQL" title="Ejabberd2:安装和操作指南">3.2.1</a>, <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#PostgreSQL" title="Ejabberd2:安装和操作指南">3.2.3</a>, <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#_Microsoft_SQL_Server" title="Ejabberd2:安装和操作指南">3.2.2</a> 和 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#ODBC.E5.85.BC.E5.AE.B9" title="Ejabberd2:安装和操作指南">3.2.4.</a> 节
</li><li> anonymous — 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#SASL.E5.8C.BF.E5.90.8D.E5.92.8C.E5.8C.BF.E5.90.8D.E7.99.BB.E5.BD.95" title="Ejabberd2:安装和操作指南">3.1.4.</a> 节
</li><li> pam — 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#SASL.E5.8C.BF.E5.90.8D.E5.92.8C.E5.8C.BF.E5.90.8D.E7.99.BB.E5.BD.95" title="Ejabberd2:安装和操作指南">3.1.4.</a> 节
</li></ul>
<p>只有internal 和 odbc 方法支持新建帐号.
</p>
<h5> <span class="mw-headline" id=".E5.86.85.E9.83.A8">内部</span></h5>
<p>ejabberd使用它的内部Mnesia数据库作为缺省的验证方法. 这个值 internal 将允许内部验证方法.
</p><p>例子:
</p>
<ul><li> 在example.org使用内部验证, 在example.net使用LDAP验证:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;example.org&quot;</span>, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>auth_method, <span class="br0">&#91;</span>internal<span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;example.net&quot;</span>, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>auth_method, <span class="br0">&#91;</span>ldap<span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 在所有虚拟主机使用内部验证:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>auth_method, internal<span class="br0">&#125;</span>.</pre></div></div>
<h5> <span class="mw-headline" id="SASL.E5.8C.BF.E5.90.8D.E5.92.8C.E5.8C.BF.E5.90.8D.E7.99.BB.E5.BD.95">SASL匿名和匿名登录</span></h5>
<p>这个值 anonymous 将允许内部验证方法.
</p><p>匿名验证方法可以由以下选项配置. 记住你可以用 host_config 选项设置虚拟主机个别特有的选项(见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E8.99.9A.E6.8B.9F.E4.B8.BB.E6.9C.BA" title="Ejabberd2:安装和操作指南">3.1.2</a> 节). 注意关于<a rel="nofollow" class="external text" href="http://support.process-one.net/doc/display/MESSENGER/Anonymous+users+support">SASL匿名和匿名登录配置</a>也有一个详细的教程 .
</p><p><b>{allow_multiple_connections, false|true}</b>
</p>
<dl><dd>这个选项只用于匿名模式已经被允许的时候. 设置它为 true 意味着在匿名登录模式里，如果使用不同的资源来连接，同样的用户名可以被使用多次. 这个选项只在非常特殊的情况下有用. 缺省值是 false. 
</dd></dl>
<p><b>{anonymous_protocol, sasl_anon | login_anon | both}</b>
</p>
<dl><dd>sasl_anon 意味着将使用 SASL 匿名方法. login_anon 意味着将使用匿名登录方法. both 意味着SASL匿名和匿名登录都允许. 
</dd></dl>
<p>那些选项为每个虚拟主机定义的选项 host_config 参数 (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E8.99.9A.E6.8B.9F.E4.B8.BB.E6.9C.BA" title="Ejabberd2:安装和操作指南">3.1.2</a> 节).
</p><p>例子:
</p>
<ul><li> 在所有虚拟主机上允许匿名登录:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>auth_method, <span class="re0"><span class="br0">&#91;</span>anonymous<span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>anonymous_protocol, login_anon<span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 类似前例, 但限于 public.example.org:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;public.example.org&quot;</span>, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>auth_method, <span class="br0">&#91;</span>anonymous<span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
                                           <span class="br0">&#123;</span>anonymous_protocol, login_anon<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 在一个虚拟主机允许匿名登录和内部验证:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;public.example.org&quot;</span>, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>auth_method, <span class="br0">&#91;</span>internal,anonymous<span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
                                           <span class="br0">&#123;</span>anonymous_protocol, login_anon<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 在一个虚拟主机允许SASL匿名:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;public.example.org&quot;</span>, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>auth_method, <span class="br0">&#91;</span>anonymous<span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
                                           <span class="br0">&#123;</span>anonymous_protocol, sasl_anon<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 在一个虚拟主机允许SASL匿名和匿名登录:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;public.example.org&quot;</span>, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>auth_method, <span class="br0">&#91;</span>anonymous<span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
                                           <span class="br0">&#123;</span>anonymous_protocol, both<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 在一个虚拟主机允许SASL匿名, 匿名登录, 和内部验证:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;public.example.org&quot;</span>, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>auth_method, <span class="br0">&#91;</span>internal,anonymous<span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
                                           <span class="br0">&#123;</span>anonymous_protocol, both<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h5> <span class="mw-headline" id="PAM.E9.AA.8C.E8.AF.81">PAM验证</span></h5>
<p>ejabberd支持通过可插拔的验证模块(PAM)来验证. PAM 目前在 AIX, FreeBSD, HP-UX, Linux, Mac OS X, NetBSD 和 Solaris里都支持. PAM 验证缺省是被禁止的, 所以你不得不使用 PAM support enabled 选项来配置并编译ejabberd:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>.<span class="sy0">/</span>configure <span class="re5">--enable-pam</span> <span class="sy0">&amp;&amp;</span> <span class="kw2">make</span> <span class="kw2">install</span></pre></div></div>
<p>选项:
</p><p><b>{pam_service, Name}</b>
</p>
<dl><dd>这个选项定义了PAM服务名. 缺省是 "ejabberd". 更多信息请参考你的操作系统的 PAM 文档. 
</dd></dl>
<p>例子:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>auth_method, <span class="re0"><span class="br0">&#91;</span>pam<span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>pam_service, <span class="st0">&quot;ejabberd&quot;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>虽然很容易在ejabberd里配置PAM支持, PAM本身介绍了一些安全问题:
</p>
<ul><li> 为执行PAM验证，ejabberd使用名为 epam 的外部C程序. 缺省的, 它位于 /var/lib/ejabberd/priv/bin/ 目录. 在这个例子里，如果你的PAM模块要求root权限(例如pam_unix.so)，你不得不把它设为root可执行. 你也不得不为ejabberd赋予访问这个文件的权限，并移除所有其他权限. 以root权限执行以下命令:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw2">chown</span> root:ejabberd <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>ejabberd<span class="sy0">/</span>priv<span class="sy0">/</span>bin<span class="sy0">/</span>epam
      <span class="kw2">chmod</span> <span class="nu0">4750</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>ejabberd<span class="sy0">/</span>priv<span class="sy0">/</span>bin<span class="sy0">/</span>epam</pre></div></div>
<ul><li> 确保你已在你的系统安装了最新版本的PAM. 一些旧版本的PAM模块会导致内存溢出. 如果你不能使用最新版本, 你可以定期杀掉(1) epam 进程以减少它的内存消耗: ejabberd将立刻重启这个进程.
</li><li> epam程序在验证失败时尝试关闭延迟. 然而, 一些PAM模块忽略这个行为并依靠它们自己的配置选项. 你可以新建一个配置文件ejabberd.pam. 这个例子展示如何在pam_unix.so模块关闭延迟:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      #%PAM<span class="nu0">-1.0</span>
      auth        sufficient  pam_unix.so likeauth nullok nodelay
      account     sufficient  pam_unix.so</pre></div></div>
<dl><dd>这不是一个已准备好使用的配置文件: 当你建立你自己的PAM配置时，你必须示意使用它. 注意如果你想在PAM配置文见里设置在验证失败时禁止延迟, 你不得不限制访问这个文件, 这样恶意用户就不能使用你的配置来执行暴力攻击.
</dd></dl>
<ul><li> 你可能希望只允许特定用户登录访问. pam_listfile.so 模块提供这个功能.
</li><li> 如果你使用 pam_winbind 来对一个Windows Active Directory授权, 那么 /etc/nssswitch.conf 必须被配置成使用winbind.
</li></ul>
<h4> <span class="mw-headline" id=".E8.AE.BF.E9.97.AE.E8.A7.84.E5.88.99">访问规则</span></h4>
<h5> <span class="mw-headline" id="ACL.E5.AE.9A.E4.B9.89">ACL定义</span></h5>
<p>在ejabberd里访问控制是通过访问控制列表(ACLs)来实现的. 配置文件中ACLs的声明语法如下:
</p><p><b>{acl, ACLName, ACLValue}.</b>
</p><p>ACLValue 可以是以下之一:
</p><p><b>all</b>
</p>
<dl><dd>匹配所有JIDs. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, all, all<span class="br0">&#125;</span>.</pre></div></div>
<p><b>{user, Username}</b>
</p>
<dl><dd>匹配第一个虚拟主机，名字为 Username 的用户. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, admin, <span class="br0">&#123;</span>user, <span class="st0">&quot;yozhik&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<p><b>{user, Username, Server}</b>
</p>
<dl><dd>匹配JID为Username@Server加任何资源的用户. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, admin, <span class="br0">&#123;</span>user, <span class="st0">&quot;yozhik&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<p><b>{server, Server}</b>
</p>
<dl><dd>匹配从服务器Server来的任何JID. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, exampleorg, <span class="br0">&#123;</span>server, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<p><b>{resource, Resource}</b>
</p>
<dl><dd>匹配任何资源为Resource的JID. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, mucklres, <span class="br0">&#123;</span>resource, <span class="st0">&quot;muckl&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<p><b>{shared_group, Groupname}</b>
</p>
<dl><dd>匹配这个虚拟主机上的共享名册组Groupname的任何成员. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, techgroupmembers, <span class="br0">&#123;</span>shared_group, <span class="st0">&quot;techteam&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<p><b>{shared_group, Groupname, Server}</b>
</p>
<dl><dd>匹配虚拟主机Server上的共享名册组Groupname的任何成员. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, techgroupmembers, <span class="br0">&#123;</span>shared_group, <span class="st0">&quot;techteam&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<p><b>{user_regexp, Regexp}</b>
</p>
<dl><dd>匹配本地虚拟主机（们）上的任何名字符合Regexp的本地用户. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, tests, <span class="br0">&#123;</span>user_regexp, <span class="st0">&quot;^test[0-9]*$&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<p><b>{user_regexp, UserRegexp, Server}</b>
</p>
<dl><dd>匹配服务器Server上名字符合UserRegexp的任何用户. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, tests, <span class="br0">&#123;</span>user_Userregexp, <span class="st0">&quot;^test&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<p><b>{server_regexp, Regexp}</b>
</p>
<dl><dd>匹配来自符合server_regexp的服务器的任何JID. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, icq, <span class="br0">&#123;</span>server_regexp, <span class="st0">&quot;^icq\\.&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<p><b>{resource_regexp, Regexp}</b>
</p>
<dl><dd>匹配资源符合resource_regexp的任何JID. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, icq, <span class="br0">&#123;</span>resource_regexp, <span class="st0">&quot;^laptop\\.&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<p><b>{node_regexp, UserRegexp, ServerRegexp}</b>
</p>
<dl><dd>匹配任何名字符合ServerRegexp的服务器上的任何名字符合UserRegexp的用户. Example:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>acl, yohzik, <span class="br0">&#123;</span>node_regexp, <span class="st0">&quot;^yohzik$&quot;</span>, <span class="st0">&quot;^example.(com|org)$&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<p><b>{user_glob, Glob}</b>
<b>{user_glob, Glob, Server}</b>
<b>{server_glob, Glob}</b>
<b>{resource_glob, Glob}</b>
<b>{node_glob, UserGlob, ServerGlob}</b>
</p>
<dl><dd>这和上面一样. 然而, 它使用 shell glob 模式而不是 regexp. 这些模式能拥有以下特别的字符:
</dd></dl>
<dl><dd><b>*</b>
<dl><dd>匹配任何包含null字符的字符串. 
</dd></dl>
</dd><dd><b>   &#160;?</b>
<dl><dd>        匹配任何单个字符. 
</dd></dl>
</dd><dd><b>    [...]</b>
<dl><dd>匹配任何封闭的字符串. 字符范围由一对使用‘-’分割的字符串定义. 如果在 ‘[’之后的第一个字符是一个‘!’, 匹配任何不封闭的字符. 
</dd></dl>
</dd></dl>
<p>以下 ACLName 是预定义的:
</p><p><b>all</b>
</p>
<dl><dd>匹配任何JID. 
</dd></dl>
<p><b>none</b>
</p>
<dl><dd>不匹配任何JID.
</dd></dl>
<h5> <span class="mw-headline" id=".E8.AE.BF.E9.97.AE.E6.9D.83.E9.99.90">访问权限</span></h5>
<p>一个允许或禁止访问不同服务的条目. 语法是:
</p><p><b>{access, AccessName, [ {allow|deny, ACLName}, ...]}.</b>
</p><p>当一个JID被检查到可以访问 Accessname, 服务器顺序检查是否那个 JID 匹配任何在列表里这一元组的第二个元素命名的 ACLs. 如果匹配, 返回第一个匹配的元组的第一个元素, 否则返回值‘deny’.
</p><p>如果你在一个虚拟主机定义了特定的访问权限, 记住全局定义的访问权限比它们拥有优先权. 这意味着, 当发生冲突的时候, 使用这个全局服务器上的赋予或禁止访问，而虚拟主机配置的访问控制无效.
</p><p>例子:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>access, configure, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow, admin<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>access, something, <span class="br0">&#91;</span><span class="br0">&#123;</span>deny, badmans<span class="br0">&#125;</span>,
                     <span class="br0">&#123;</span>allow, all<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>以下 AccessName 是预定义的:
</p><p><b>all</b>
</p>
<dl><dd>总是返回值‘allow’. 
</dd></dl>
<p><b>none</b>
</p>
<dl><dd>总是返回值‘deny’.
</dd></dl>
<h5> <span class="mw-headline" id=".E4.BD.BF.E7.94.A8ACL.E9.99.90.E5.88.B6.E6.89.93.E5.BC.80.E7.9A.84.E4.BC.9A.E8.AF.9D">使用ACL限制打开的会话</span></h5>
<p>特别的 access max_user_sessions 定义了每个用户的会话(已验证的连接)的最大数量. 如果一个用户尝试通过使用不同的资源打开更多的会话, 第一个打开的会话将被断掉连接. 这个 会话替换 的错误信息将被发送到断链的会话. 这个选项的值可能是一个数字, 或 infinity. 缺省值是 infinity.
</p><p>语法是:
</p><p><b>{access, max_user_sessions, [ {MaxNumber, ACLName}, ...]}.</b>
</p><p>这个例子对所有用户限制每用户会话数为5, 对管理员限制为 10:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>access, max_user_sessions, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span><span class="nu0">10</span>, admin<span class="br0">&#125;</span>, <span class="br0">&#123;</span><span class="nu0">5</span>, all<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.</pre></div></div>
<h5> <span class="mw-headline" id=".E4.BD.BF.E7.94.A8ACL.E9.99.90.E5.88.B6.E5.88.B0.E4.B8.80.E4.B8.AA.E8.BF.9C.E7.A8.8BXMPP.E6.9C.8D.E5.8A.A1.E5.99.A8.E7.9A.84.E5.A4.9A.E4.B8.AA.E8.BF.9E.E6.8E.A5">使用ACL限制到一个远程XMPP服务器的多个连接</span></h5>
<p>特别的 access max_s2s_connections 定义了可以建立多少个连接到一个特定的远程XMPP服务器. 缺省值是 infinity. 也可以使用 access max_s2s_connections_per_node.
</p><p>语法是:
</p><p><b>{access, max_s2s_connections, [ {MaxNumber, ACLName}, ...]}.</b>
</p><p>例子: 
</p>
<ul><li> 允许每个远程服务器最多3个连接:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>access, max_s2s_connections, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span><span class="nu0">3</span>, all<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id=".E6.95.B4.E5.BD.A2">整形</span></h4>
<p>整形允许你限制连接的通讯量. 语法是:
</p><p><b>{shaper, ShaperName, Kind}.</b>
</p><p>目前只支持一种整形 maxrate . 语法如下:
</p><p><b>{maxrate, Rate}</b>
</p><p>这里 Rate 代表最大允许每秒收到的字节数. 当一个连接超过了这个限制, ejabberd停止从socket读取，直到平均速率再次降到允许的最大值以下.
</p><p>例子:
</p>
<ul><li> 定义一个 shaper 名为 ‘normal’ ，限制流量速度为 1,000 bytes/second:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>shaper, normal, <span class="br0">&#123;</span>maxrate, <span class="nu0">1000</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
&lt;source&gt;
&#160;
* 定义一个 shaper 名为‘fast’，限制流量速度为 <span class="nu0">50</span>,<span class="nu0">000</span> bytes/second:
&#160;
&lt;source lang<span class="sy0">=</span><span class="st0">&quot;ini&quot;</span>&gt;
      <span class="br0">&#123;</span>shaper, fast, <span class="br0">&#123;</span>maxrate, <span class="nu0">50000</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id=".E7.BC.BA.E7.9C.81.E8.AF.AD.E8.A8.80">缺省语言</span></h4>
<p>这个选项 language 定义服务器能被XMPP客户端看到的字符串的缺省语言. 如果一个XMPP客户端不支持 xml:lang, 将使用这里定义的语言.
</p><p>这个选项的语法是:
</p><p><b>{language, Language}.</b>
</p><p>缺省值是 en. 为了让它生效，在ejabberd的 msgs 目录必须有一个翻译文件 Language.msg.
</p><p>例如, 设置俄语为缺省语言:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>language, <span class="st0">&quot;ru&quot;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>附录 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E9.99.84.E5.BD.95A_.E5.9B.BD.E9.99.85.E5.8C.96.E5.92.8C.E6.9C.AC.E5.9C.B0.E5.8C.96" title="Ejabberd2:安装和操作指南">A</a> 提供了关于国际化和本地化的更多细节.
</p>
<h4> <span class="mw-headline" id="CAPTCHA">CAPTCHA</span></h4>
<p>一些ejabberd模块可被配置成在特定的动作上要求 CAPTCHA 挑战. 如果客户端不支持 CAPTCHA Forms (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0158.html">XEP-0158</a>), 将提供一个web连接让用户用web浏览器填写挑战.
</p><p>提供了一个示例脚本使用 ImageMagick 的转换程序来生成图片 .
</p><p>配置选项为:
</p><p><b>{captcha_cmd, Path}</b>
</p>
<dl><dd>一个生成图片的脚本的全路径. 缺省值为空: "" 
</dd></dl>
<p><b>{captcha_host, Host}</b>
</p>
<dl><dd>发给用户的 URL 的 Host 部分. 你可以包含端口号. 发给用户的 URL 的格式为: <a rel="nofollow" class="external free" href="http://Host/captcha/">http://Host/captcha/</a> ,缺省值是第一个被配置的主机名. 
</dd></dl>
<p>另外, 必须允许一个 ejabberd_http 监听者拥有 captcha 选项. 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E7.9B.91.E5.90.AC.E7.9A.84.E6.A8.A1.E5.9D.97" title="Ejabberd2:安装和操作指南">3.1.3</a> 节.
</p><p>示例配置:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
<span class="br0">&#123;</span>captcha_cmd, <span class="st0">&quot;/lib/ejabberd/priv/bin/captcha.sh&quot;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>captcha_host, <span class="st0">&quot;example.org:5280&quot;</span><span class="br0">&#125;</span>.
&#160;
<span class="br0">&#123;</span>listen,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span><span class="nu0">5280</span>, ejabberd_http, <span class="br0">&#91;</span>
                         captcha,
                         ...
                        <span class="br0">&#93;</span>
  <span class="br0">&#125;</span>
&#160;
<span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="STUN">STUN</span></h4>
<p>ejabberd可以当作一个独立的 STUN 服务器 (<a rel="nofollow" class="external text" href="http://tools.ietf.org/html/rfc5389">RFC 5389</a>). 目前只支持绑定的使用. 在那个角色中，ejabberd 帮助客户端实现 Jingle ICE (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0176.html">XEP-0176</a>) 支持来发现它们的外部地址和端口.
</p><p>你应该配置 ejabberd_stun 监听模块，如 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E7.9B.91.E5.90.AC.E7.AB.AF.E5.8F.A3" title="Ejabberd2:安装和操作指南">3.1.3</a> 节所述. 如果定义了 certfile 选项, ejabberd 在同一个端口复用TCP连接和通过TCP连接的TLS . 很明显, certfile选项仅为tcp定义. 注意无论如何，支持 TCP 或 TLS over TCP ,对于绑定使用来说不是必需的，对于TURN功能是保留的. 只有udp传输可以随意配置.
</p><p>示例配置:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>listen,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span><span class="br0">&#123;</span><span class="nu0">3478</span>, udp<span class="br0">&#125;</span>, ejabberd_stun, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">3478</span>, ejabberd_stun, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5349</span>, ejabberd_stun, <span class="br0">&#91;</span><span class="br0">&#123;</span>certfile, <span class="st0">&quot;/etc/ejabberd/server.pem&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span>
<span class="br0">&#125;</span>.</pre></div></div>
<p>你也需要正确地配置 DNS SRV 记录，这样客户端可以很容易地发现一个为你的XMPP域服务的 STUN 服务器. 具体请参考<a rel="nofollow" class="external text" href="http://tools.ietf.org/html/rfc5389">RFC 5389</a>的<a rel="nofollow" class="external text" href="http://tools.ietf.org/html/rfc5389#section-9">DNS Discovery of a Server</a> 章节.
</p><p>示例 DNS SRV 配置:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>_stun._udp   IN SRV  <span class="nu0">0</span> <span class="nu0">0</span> <span class="nu0">3478</span> stun.example.com.
_stun._tcp   IN SRV  <span class="nu0">0</span> <span class="nu0">0</span> <span class="nu0">3478</span> stun.example.com.
_stuns._tcp  IN SRV  <span class="nu0">0</span> <span class="nu0">0</span> <span class="nu0">5349</span> stun.example.com.</pre></div></div>
<h4> <span class="mw-headline" id=".E5.8C.85.E5.90.AB.E5.85.B6.E5.AE.83.E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6">包含其它配置文件</span></h4>
<p>一个配置文件中的选项 include_config_file 代表 ejabberd 包含了其他配置文件to include other configuration files immediately.
</p><p>基本语法:
</p><p><b>{include_config_file, Filename}.</b>
</p><p>使用完整语法还可以指定子选项 suboptions&#160;:
</p><p><b>{include_config_file, Filename, [Suboption, ...]}.</b>
</p><p>filename 可使用绝对路径, 或使用和主 ejabberd 配置文件相关的相对路径. 不能使用通配符. 文件必须存在且可读.
</p><p>以下子选项 suboptions 为:
</p><p><b>{disallow, [Optionname, ...]}</b>
</p>
<dl><dd>不允许使用那些被包含文件中的选项. 满足这个条件的选项立刻变成不可接受. 缺省值为空列表: [] 
</dd></dl>
<p><b>{allow_only, [Optionname, ...]}</b>
</p>
<dl><dd>只允许使用这个被包含的配置文件中的选项. 不满足这个条件的选项立刻变成不可接受. 缺省值为: all 
</dd></dl>
<p>这是个基本例子:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>include_config_file, <span class="st0">&quot;/etc/ejabberd/additional.cfg&quot;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>在这个例子里, 被包含的文件不允许包含一个监听 listen 选项. 如果出现了这个选项, 该选项将不被接受. 这个文件在主配置文件所在目录的一个子目录中.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>include_config_file, <span class="st0">&quot;./example.org/additional_not_listen.cfg&quot;</span>, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>disallow, <span class="br0">&#91;</span>listen<span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.</pre></div></div>
<p>在这个例子, ejabberd.cfg 定义了一些 ACL 和 Access rules, 然后包含了另一个文件,里面含有其他 rules:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>acl, admin, <span class="br0">&#123;</span>user, <span class="st0">&quot;admin&quot;</span>, <span class="st0">&quot;localhost&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>access, announce, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow, admin<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>include_config_file, <span class="st0">&quot;/etc/ejabberd/acl_and_access.cfg&quot;</span>, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow_only, <span class="br0">&#91;</span>acl, access<span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.</pre></div></div>
<p>并且文件 acl_and_access.cfg 的内容可能是, 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>acl, admin, <span class="br0">&#123;</span>user, <span class="st0">&quot;bob&quot;</span>, <span class="st0">&quot;localhost&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>acl, admin, <span class="br0">&#123;</span>user, <span class="st0">&quot;jan&quot;</span>, <span class="st0">&quot;localhost&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id=".E9.85.8D.E7.BD.AE.E6.96.87.E4.BB.B6.E4.B8.AD.E7.9A.84.E5.AE.8F.E9.80.89.E9.A1.B9">配置文件中的宏选项</span></h4>
<p>在ejabberd配置文件中, 有可能为一个值定义一个宏 macro,晚些时候使用这个宏定义一个选项.
</p><p>一个宏 macro 可用以下语法定义:
</p><p><b>{define_macro, ’MACRO’, Value}.</b>
</p><p>MACRO 必须被一对单引号包住, 而且所有字母为大写; 检查以下例子. 值必须是任何合法的随意的 Erlang 条目.
</p><p>macro的第一个定义会被保留的, 同一个macro的其它定义被忽略.
</p><p>Macros 在包含了额外的配置文件之后会被处理, 所以有可能在知道用法之前就使用定义在被包含的配置文件里的 macros.
</p><p>不能使用定义在另一个macro里面的macro.
</p><p>有两个办法使用宏:
</p><p><b>’MACRO’</b>
</p>
<dl><dd>你可以把它当成一个 ejabberd 选项的值, 它将被替换成这个macro之前定义的值. 如果这个 macro 之前没有定义, 程序将崩溃并报错.
</dd></dl>
<p><b>{use_macro, ’MACRO’, Defaultvalue}</b>
</p>
<dl><dd>使用一个macro,即使它之前没有定义. 如果这个 macro 之前没有定义, 使用缺省值 defaultvalue. 这个用法看起来好像它已被定义并以以下方法使用:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>define_macro, 'MACRO', Defaultvalue<span class="br0">&#125;</span>.
    'MACRO'</pre></div></div>
<p>这个例子展示一个宏的基本使用:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>define_macro, 'LOG_LEVEL_NUMBER', <span class="nu0">5</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>loglevel, 'LOG_LEVEL_NUMBER'<span class="br0">&#125;</span>.</pre></div></div>
<p>结果被ejabberd解释执行的选项为: {loglevel, 5}.
</p><p>这个例子展示值可以是任意的Erlang条目:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>define_macro, 'USERBOB', <span class="br0">&#123;</span>user, <span class="st0">&quot;bob&quot;</span>, <span class="st0">&quot;localhost&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>acl, admin, 'USERBOB'<span class="br0">&#125;</span>.</pre></div></div>
<p>结果被ejabberd解释执行的选项为: {acl, admin, {user, "bob", "localhost"}}.
</p><p>这个复杂的例子:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>define_macro, 'NUMBER_PORT_C2S', <span class="nu0">5222</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>define_macro, 'PORT_S2S_IN', <span class="br0">&#123;</span><span class="nu0">5269</span>, ejabberd_s2s_in, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>listen,
 <span class="br0">&#91;</span>
  <span class="br0">&#123;</span>'NUMBER_PORT_C2S', ejabberd_c2s, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  'PORT_S2S_IN',
  <span class="br0">&#123;</span><span class="br0">&#123;</span>use_macro, 'NUMBER_PORT_HTTP', <span class="nu0">5280</span><span class="br0">&#125;</span>, ejabberd_http, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
 <span class="br0">&#93;</span>
<span class="br0">&#125;</span>.</pre></div></div>
<p>在解释执行之后结果为:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>listen,
 <span class="br0">&#91;</span>
  <span class="br0">&#123;</span><span class="nu0">5222</span>, ejabberd_c2s, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5269</span>, ejabberd_s2s_in, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span><span class="nu0">5280</span>, ejabberd_http, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
 <span class="br0">&#93;</span>
<span class="br0">&#125;</span>.</pre></div></div>
<h3> <span class="mw-headline" id=".E6.95.B0.E6.8D.AE.E5.BA.93.E5.92.8CLDAP.E9.85.8D.E7.BD.AE">数据库和LDAP配置</span></h3>
<p>ejabberd缺省使用它内部的 Mnesia 数据库. 然而, 也可能使用关系数据库或一个LDAP服务器来存储持久信息, 长时间存在的数据. ejabberd是非常弹性的: 你可以为不同的虚拟主机配置不同的验证方法, 你可以为相同的主机配置不同的验证机制(fallback), 你可以为模块设置不同的存储系统, 此外.
</p><p>ejabberd支持以下数据库:
</p>
<ul><li> <a rel="nofollow" class="external text" href="http://www.microsoft.com/sql/">Microsoft SQL Server</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.erlang.org/doc/apps/mnesia/index.html">Mnesia</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.mysql.com/">MySQL</a>
</li><li> <a rel="nofollow" class="external text" href="http://en.wikipedia.org/wiki/Open_Database_Connectivity">任何ODBC兼容数据库</a>
</li><li> <a rel="nofollow" class="external text" href="http://www.postgresql.org/">PostgreSQL</a>
</li></ul>
<p>以下 LDAP 服务器已经过ejabberd测试:
</p>
<ul><li> <a rel="nofollow" class="external text" href="http://www.microsoft.com/activedirectory/">Active Directory</a> (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#Active_Directory" title="Ejabberd2:安装和操作指南">3.2.5</a> 节)
</li><li> <a rel="nofollow" class="external text" href="http://www.openldap.org/">OpenLDAP</a>
</li><li> 通常任何LDAP兼容服务器都应该可以; 通知我们关于你以不在列表中的服务器的成功例子以便我们列在这里. 
</li></ul>
<p>关于虚拟主机，特别注意: 如果你在ejabberd.cfg (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E4.B8.BB.E6.9C.BA.E5.90.8D" title="Ejabberd2:安装和操作指南">3.1.1</a> 节) 定义了多个域, 你可能希望每个虚拟主机配置不同的数据库, 验证和存储, 这样在两个虚拟主机之间用户名就不会冲突和混淆. 为此, 下一节的选项描述了必须在每个虚拟主机的 host_config 内部配置 (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E8.99.9A.E6.8B.9F.E4.B8.BB.E6.9C.BA" title="Ejabberd2:安装和操作指南">3.1.2</a> 节). 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>host_config, <span class="st0">&quot;public.example.org&quot;</span>, <span class="br0">&#91;</span>
  <span class="br0">&#123;</span>odbc_server, <span class="br0">&#123;</span>pgsql, <span class="st0">&quot;localhost&quot;</span>, <span class="st0">&quot;database-public-example-org&quot;</span>, <span class="st0">&quot;ejabberd&quot;</span>, <span class="st0">&quot;password&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>,
  <span class="br0">&#123;</span>auth_method, <span class="re0"><span class="br0">&#91;</span>odbc<span class="br0">&#93;</span></span><span class="br0">&#125;</span>
<span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="MySQL">MySQL</span></h4>
<p>尽管这一节将描述当你想使用原生的 MySQL驱动时 ejabberd 的配置, 它将不描述MySQL的安装和数据库的建立. 查看MySQL文档和教程 <a rel="nofollow" class="external text" href="http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver">在ejabberd使用MySQL原生驱动</a> 获得关于这些话题的信息. 注意该教程中包含的关于ejabberd的配置和本节是重复的.
</p><p>而且, 目录 src/odbc 中的文件 mysql.sql 可能你会感兴趣. 这个文件包含ejabberd用于MySQL的schema. 该文件的结尾你可找到更新你的数据库架构schema的信息.
</p>
<h5> <span class="mw-headline" id=".E9.A9.B1.E5.8A.A8.E7.BC.96.E8.AF.91">驱动编译</span></h5>
<p>你可忽略此步骤，如果你已经使用ejabberd的二进制包安装了ejabberd，并使用了内含的MySQL支持.
</p>
<ol><li> 首先, 安装 <a rel="nofollow" class="external text" href="http://support.process-one.net/doc/display/CONTRIBS/Yxa">Erlang MySQL 库</a>. 确保被编译的文件在你的 Erlang 路径中; 你可以把它们放到和你的ejabberd .beam 文件相同的目录.
</li><li> 然后, 以允许支持 ODBC 的选项配置并安装 ejabberd (这也需要原生 MySQL 支持!). 为此, 使用以下命令:
</li></ol>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      .<span class="sy0">/</span>configure <span class="re5">--enable-odbc</span> <span class="sy0">&amp;&amp;</span> <span class="kw2">make</span> <span class="kw2">install</span></pre></div></div>
<h5> <span class="mw-headline" id=".E6.95.B0.E6.8D.AE.E5.BA.93.E8.BF.9E.E6.8E.A5">数据库连接</span></h5>
<p>实际的数据库访问使用选项 odbc_server 来定义. 它的值通常用来定义我们是否想使用 ODBC, 或两个可用的原生接口之一, PostgreSQL 或 MySQL.
</p><p>为使用原生 MySQL 接口, 你可以通过一组如以下格式的参数:
</p><p><b>{mysql, "Server", "Database", "Username", "Password"}</b>
</p><p>mysql是一个关键字应该被保持. 例如:
</p><p><b>{odbc_server, {mysql, "localhost", "test", "root", "password"}}.</b>
</p><p>可选的, 有可能定义MySQL使用的端口. 这个选项只是在非常少的情况下有用, 当你没有以缺省端口设置来运行MySQL时. mysql参数可能是以下格式:
</p><p><b>{mysql, "Server", Port, "Database", "Username", "Password"}</b>
</p><p>Port值应该是一个整数, 没有引号. 例如:
</p><p><b>{odbc_server, {mysql, "localhost", Port, "test", "root", "password"}}.</b>
</p><p>缺省的ejabberd为每个虚拟主机打开10个到数据库的连接. 使用这个选项来修改该值:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>odbc_pool_size, <span class="nu0">10</span><span class="br0">&#125;</span>.</pre></div></div>
<p>你可以配置一个时间间隔来做一个假的SQL请求以保持到数据库的连接激活. 缺省值为 ’undefined’, 所以没有做 keepalive 请求. 指定以秒计: 例如 28800 意味着 8 小时.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>odbc_keepalive_interval, undefined<span class="br0">&#125;</span>.</pre></div></div>
<p>如果到数据库的连接失败, ejabberd在重试之前等待30秒. 你可以这个选项修改这个间隔:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>odbc_start_interval, <span class="nu0">30</span><span class="br0">&#125;</span>.</pre></div></div>
<h5> <span class="mw-headline" id=".E9.AA.8C.E8.AF.81_2">验证</span></h5>
<p>这个选项值的名字可能被误导, 因为 auth_method 名字用于通过ODBC以及通过原生MySQL接口访问关系数据库. 无论如何, 第一个配置步骤是定义 odbc auth_method. 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>auth_method, <span class="re0"><span class="br0">&#91;</span>odbc<span class="br0">&#93;</span></span><span class="br0">&#125;</span>.</pre></div></div>
<h5> <span class="mw-headline" id=".E5.AD.98.E5.82.A8">存储</span></h5>
<p>MySQL也能被从多个ejabberd模块用于存储信息. 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E6.A8.A1.E5.9D.97.E4.B8.80.E8.A7.88" title="Ejabberd2:安装和操作指南">3.3.1</a> 节看哪个模块有一个带‘_odbc’的版本. 这个后缀代表这个模块可以被用于类似MySQL的关系数据库. 为激活你的数据库的存储, 只要确保你的数据库运行正常 (见前一节), 并把不带后缀或ldap模块变量换成带有 odbc 的模块变量. 注意在同一个装载的模块里你不能有多个变量!
</p>
<h4> <span class="mw-headline" id="Microsoft_SQL_Server">Microsoft SQL Server</span></h4>
<p>尽管本节将描述当你想使用Microsoft SQL Server时ejabberd的配置, 它不描述Microsoft SQL Server的安装和数据库创建. 查看MySQL文档和教程 <a rel="nofollow" class="external text" href="http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver">在ejabberd使用MySQL原生驱动</a> 获得关于这些话题的信息. 注意该教程中包含的关于ejabberd的配置和本节是重复的.
</p><p>而且, 目录 src/odbc 中的文件 mssql.sql 可能你会感兴趣. 这个文件包含ejabberd用于Microsoft SQL Server的schema. 该文件的结尾你可找到更新你的数据库架构schema的信息.
</p>
<h5> <span class="mw-headline" id=".E9.A9.B1.E5.8A.A8.E7.BC.96.E8.AF.91_2">驱动编译</span></h5>
<p>你可忽略此步骤，如果你已经使用ejabberd的二进制包安装了ejabberd，并使用了内含的ODBC支持.
</p><p>如果你想以ODBC方式使用Microsoft SQL Server, 你需要以支持ODBC和允许Microsoft SQL Server选项来配置, 编译和安装 ejabberd. 为此, 使用以下命令:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>.<span class="sy0">/</span>configure <span class="re5">--enable-odbc</span> <span class="re5">--enable-mssql</span> <span class="sy0">&amp;&amp;</span> <span class="kw2">make</span> <span class="kw2">install</span></pre></div></div>
<h5> <span class="mw-headline" id=".E6.95.B0.E6.8D.AE.E5.BA.93.E8.BF.9E.E6.8E.A5_2">数据库连接</span></h5>
<p>一个Microsoft SQL Server数据库连接的配置和为一个ODBC兼容服务器的配置相同 (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#ODBC.E5.85.BC.E5.AE.B9" title="Ejabberd2:安装和操作指南">3.2.4</a> 节).
</p>
<h5> <span class="mw-headline" id=".E9.AA.8C.E8.AF.81_3">验证</span></h5>
<p>一个Microsoft SQL Server数据库验证的配置和为一个ODBC兼容服务器的配置相同 (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#ODBC.E5.85.BC.E5.AE.B9" title="Ejabberd2:安装和操作指南">3.2.4</a> 节).
</p>
<h5> <span class="mw-headline" id=".E5.AD.98.E5.82.A8_2">存储</span></h5>
<p>Microsoft SQL Server也可以被多个ejabberd模块用于存储信息. 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E6.A8.A1.E5.9D.97.E4.B8.80.E8.A7.88" title="Ejabberd2:安装和操作指南">3.3.1</a> 节看看哪个模块有一个带‘_odbc’的版本. 这个后缀代表这个模块可以被用于类似Microsoft SQL Server的关系数据库. 为激活你的数据库的存储, 只要确保你的数据库运行正常 (见前一节), 并把不带后缀或ldap模块变量换成带有 odbc 的模块变量. 注意在同一个装载的模块里你不能有多个变量!
</p>
<h4> <span class="mw-headline" id="PostgreSQL">PostgreSQL</span></h4>
<p>尽管本节将描述当你想使用原生的PostgreSQL驱动时ejabberd的配置, 它不描述PostgreSQL的安装和数据库创建. 查看PostgreSQL文档和教程 <a rel="nofollow" class="external text" href="http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver">在ejabberd使用MySQL原生驱动</a> 获得关于这些话题的信息. 注意该教程中包含的关于ejabberd的配置和本节是重复的.
</p><p>而且, 目录 src/odbc 中的文件 pg.sql 可能你会感兴趣. 这个文件包含ejabberd用于PostgreSQL的schema. 该文件的结尾你可找到更新你的数据库架构schema的信息.
</p>
<h5> <span class="mw-headline" id=".E9.A9.B1.E5.8A.A8.E7.BC.96.E8.AF.91_3">驱动编译</span></h5>
<p>你可忽略此步骤，如果你已经使用ejabberd的二进制包安装了ejabberd，并包含了对PostgreSQL的支持.
</p>
<ol><li> 首先, 从 <a rel="nofollow" class="external text" href="http://www.ejabberd.im/ejabberd-modules/">ejabberd-modules SVN 仓库</a>安装 Erlang pgsql 库. 确保被编译的文件在你的 Erlang 路径中; 你可以把它们放到和你的ejabberd .beam 文件相同的目录.
</li><li> 然后, 以允许支持 ODBC 的选项配置并安装 ejabberd (对于原生的 PostgreSQL 支持这也是必需的!). 为此, 使用以下命令:
</li></ol>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      .<span class="sy0">/</span>configure <span class="re5">--enable-odbc</span> <span class="sy0">&amp;&amp;</span> <span class="kw2">make</span> <span class="kw2">install</span></pre></div></div>
<h5> <span class="mw-headline" id=".E6.95.B0.E6.8D.AE.E5.BA.93.E8.BF.9E.E6.8E.A5_3">数据库连接</span></h5>
<p>实际的数据库访问使用选项 odbc_server 来定义. 它的值通常用来定义我们是否想使用 ODBC, 或两个可用的原生接口之一, PostgreSQL 或 MySQL.
</p><p>为使用原生 PostgreSQL 接口, 你可以通过一组如以下格式的参数:
</p><p><b>{pgsql, "Server", "Database", "Username", "Password"}</b>
</p><p>pgsql是一个关键字应该被保持. 例如:
</p><p><b>{odbc_server, {pgsql, "localhost", "database", "ejabberd", "password"}}.</b>
</p><p>可选的, 有可能定义PostgreSQL使用的端口. 这个选项只是在非常少的情况下有用, 当你没有以缺省端口设置来运行PostgreSQL时. pgsql参数可能是以下格式:
</p><p><b>{pgsql, "Server", Port, "Database", "Username", "Password"}</b>
</p><p>Port值应该是一个整数, 没有引号. 例如:
</p><p><b>{odbc_server, {pgsql, "localhost", 5432, "database", "ejabberd", "password"}}.</b>
</p><p>缺省的ejabberd为每个虚拟主机打开10个到数据库的连接. 使用这个选项来修改该值:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>odbc_pool_size, <span class="nu0">10</span><span class="br0">&#125;</span>.</pre></div></div>
<p>你可以配置一个时间间隔来做一个假的SQL请求以保持到数据库的连接激活. 缺省值为 ’undefined’, 所以没有做 keepalive 请求. 指定以秒计: 例如 28800 意味着 8 小时.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>odbc_keepalive_interval, undefined<span class="br0">&#125;</span>.</pre></div></div>
<h5> <span class="mw-headline" id=".E9.AA.8C.E8.AF.81_4">验证</span></h5>
<p>这个选项值的名字可能被误导, 因为 auth_method 名字用于通过ODBC以及通过原生PostgreSQL接口访问关系数据库. 无论如何, 第一个配置步骤是定义 odbc auth_method. 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>auth_method, <span class="re0"><span class="br0">&#91;</span>odbc<span class="br0">&#93;</span></span><span class="br0">&#125;</span>.</pre></div></div>
<h5> <span class="mw-headline" id=".E5.AD.98.E5.82.A8_3">存储</span></h5>
<p>PostgreSQL也能被多个ejabberd模块用于存储信息. 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E6.A8.A1.E5.9D.97.E4.B8.80.E8.A7.88" title="Ejabberd2:安装和操作指南">3.3.1</a> 节看哪个模块有一个带‘_odbc’的版本. 这个后缀代表这个模块可以被用于类似PostgreSQL的关系数据库. 为激活你的数据库的存储, 只要确保你的数据库运行正常 (见前一节), 并把不带后缀或ldap模块变量换成带有 odbc 的模块变量. 注意在同一个装载的模块里你不能有多个变量!
</p>
<h4> <span class="mw-headline" id="ODBC.E5.85.BC.E5.AE.B9">ODBC兼容</span></h4>
<p>尽管本节将描述当你想使用原生的ODBC 驱动时ejabberd的配置, 它不描述安装和数据库创建. 查看你的数据库的文档. 教程 <a rel="nofollow" class="external text" href="http://support.process-one.net/doc/display/MESSENGER/Using+ejabberd+with+MySQL+native+driver">在ejabberd使用MySQL原生驱动</a> 也会对你有所帮助. 注意该教程中包含的关于ejabberd的配置和本节是重复的.
</p>
<h5> <span class="mw-headline" id=".E9.A9.B1.E5.8A.A8.E7.BC.96.E8.AF.91_4">驱动编译</span></h5>
<p>你可忽略此步骤，如果你已经使用ejabberd的二进制包安装了ejabberd，并包含了对ODBC的支持.
</p>
<ol><li> 首先, 安装 <a rel="nofollow" class="external text" href="http://support.process-one.net/doc/display/CONTRIBS/Yxa">Erlang MySQL 库</a> . 确保被编译的文件在你的 Erlang 路径中; 你可以把它们放到和你的ejabberd .beam 文件相同的目录.
</li><li> 然后, 以允许支持 ODBC 的选项配置并安装 ejabberd. 为此, 使用以下命令:
</li></ol>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      .<span class="sy0">/</span>configure <span class="re5">--enable-odbc</span> <span class="sy0">&amp;&amp;</span> <span class="kw2">make</span> <span class="kw2">install</span></pre></div></div>
<h5> <span class="mw-headline" id=".E6.95.B0.E6.8D.AE.E5.BA.93.E8.BF.9E.E6.8E.A5_4">数据库连接</span></h5>
<p>实际的数据库访问使用选项 odbc_server 来定义. 它的值通常用来定义我们是否想使用 ODBC, 或两个可用的原生接口之一, PostgreSQL 或 MySQL.
</p><p>通过ODBC使用数据库, 你可以通过一个ODBC连接字符串作为odbc_server参数. 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>odbc_server, <span class="st0">&quot;DSN=database;UID=ejabberd;PWD=password&quot;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>缺省的ejabberd为每个虚拟主机打开10个到数据库的连接. 使用这个选项来修改该值:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>odbc_pool_size, <span class="nu0">10</span><span class="br0">&#125;</span>.</pre></div></div>
<p>你可以配置一个时间间隔来做一个假的SQL请求以保持到数据库的连接激活. 缺省值为 ’undefined’, 所以没有做 keepalive 请求. 指定以秒计: 例如 28800 意味着 8 小时.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>odbc_keepalive_interval, undefined<span class="br0">&#125;</span>.</pre></div></div>
<h5> <span class="mw-headline" id=".E9.AA.8C.E8.AF.81_5">验证</span></h5>
<p>第一个配置步骤是定义 odbc auth_method. 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>auth_method, <span class="re0"><span class="br0">&#91;</span>odbc<span class="br0">&#93;</span></span><span class="br0">&#125;</span>.</pre></div></div>
<h5> <span class="mw-headline" id=".E5.AD.98.E5.82.A8_4">存储</span></h5>
<p>一个ODBC兼容数据库也能被多个ejabberd模块用于存储信息. 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E6.A8.A1.E5.9D.97.E4.B8.80.E8.A7.88" title="Ejabberd2:安装和操作指南">3.3.1</a> 节看哪个模块有一个带‘_odbc’的版本. 这个后缀代表这个模块可以被用于ODBC兼容的关系数据库. 为激活你的数据库的存储, 只要确保你的数据库运行正常 (见前一节), 并把不带后缀或ldap模块变量换成带有 odbc 的模块变量. 注意在同一个装载的模块里你不能有多个变量!
</p>
<h4> <span class="mw-headline" id="LDAP">LDAP</span></h4>
<p>ejabberd拥有内建的LDAP支持. 你可以通过LDAP服务器验证用户并使用LDAP目录作为vCard存储器. 共享名册还不支持.
</p><p>通常ejabberd把LDAP看作一个只读存储: 它可能察看数据, 但不能新建账号或修改存储在LDAP里的vCard. 然而, 修改密码是可能的，如果允许 mod_register 模块并且LDAP服务器支持<a rel="nofollow" class="external text" href="http://tools.ietf.org/html/rfc3062">RFC 3062</a>.
</p>
<h5> <span class="mw-headline" id=".E8.BF.9E.E6.8E.A5">连接</span></h5>
<p>参数:
</p><p><b>{ldap_servers, [Servers, ...]}</b>
</p>
<dl><dd>你的LDAP服务器的IP地址或DNS名的列表 . 这个选项时必需的. 
</dd></dl>
<p><b>{ldap_encrypt, none|tls}</b>
</p>
<dl><dd>到LDAP服务器的连接的加密类型. 允许的值为: none, tls. 这个值 tls 允许使用SSL加密LDAP连接. 注意 STARTTLS 加密是不支持的. 缺省值为: none. 
</dd></dl>
<p><b>{ldap_tls_verify, false|soft|hard}</b>
</p>
<dl><dd>这个选项指定当允许TLS时是否验证LDAP服务器证书. 当选项值为 hard，如果证书非法，ejabberd 不继续往下走. 当选项值为 soft，即使检查失败ejabberd仍继续下去. 缺省值为 false，它意味着不执行检查. 
</dd></dl>
<p><b>{ldap_port, Number}</b>
</p>
<dl><dd>连接到你的LDAP服务器的端口. 如果禁止加密,缺省端口为389; 如果允许加密则为636. 如果你配置了一个值, 它存储在 ejabberd的数据库里. 接着, 如果你从这个配置文件移除这个值, 之前存储在数据库的值将被缺省端口取代. 
</dd></dl>
<p><b>{ldap_rootdn, RootDN}</b>
</p>
<dl><dd>绑定的DN. 缺省值为"", 它表示匿名连接 ‘anonymous connection’. 
</dd></dl>
<p><b>{ldap_password, Password}</b>
</p>
<dl><dd>绑定密码 password. 缺省值为 "". 
</dd></dl>
<p>例子:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>auth_method, ldap<span class="br0">&#125;</span>.
<span class="br0">&#123;</span>ldap_servers, <span class="br0">&#91;</span><span class="st0">&quot;ldap.example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>ldap_port, <span class="nu0">389</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>ldap_rootdn, <span class="st0">&quot;cn=Manager,dc=domain,dc=org&quot;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>ldap_password, <span class="st0">&quot;secret&quot;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>注意目前的LDAP实现不支持SASL验证.
</p>
<h5> <span class="mw-headline" id=".E9.AA.8C.E8.AF.81_6">验证</span></h5>
<p>你可以通过LDAP目录验证用户. 可用的选项有:
</p><p><b>{ldap_base, Base}</b>
</p>
<dl><dd>LDAP存储用户的帐号的基础目录. 这个选项是必需的. 
</dd></dl>
<p><b>{ldap_uids, [ {ldap_uidattr} | {ldap_uidattr, ldap_uidattr_format}, ...]}</b>
</p>
<dl><dd>从中可以获得JID的LDAP属性的列表. 缺省属性为 [{"uid", "%u"}]. 属性的格式为: [{ldap_uidattr}] 或 [{ldap_uidattr, ldap_uidattr_format}]. 你可以使用多个逗号来分隔需要的属性. ldap_uidattr 和 ldap_uidattr_format 的值描述如下:
</dd></dl>
<dl><dd><b>ldap_uidattr</b>
<dl><dd>存有JID的user部分的LDAP属性. 缺省值为"uid". 
</dd></dl>
</dd><dd><b>ldap_uidattr_format</b>
<dl><dd>ldap_uidattr变量的格式. 这个格式必须包含一个并且只有一个 pattern 变量 "%u"，它将由JID的suer部分替换. 例如,"%u@example.org". 缺省值为 "%u". 
</dd></dl>
</dd></dl>
<p><b>{ldap_filter, Filter}</b>
</p>
<dl><dd><a rel="nofollow" class="external text" href="http://tools.ietf.org/html/rfc4515">RFC 4515</a> LDAP过滤器. 缺省的 Filter 值为: undefined. 例子: "(&amp;(objectClass=shadowAccount)(memberOf=Jabber Users))". 请, 不要忘记关闭括号并且不要用多余的空格. 在过滤器里你也必须不使用ldap_uidattr属性，因为这个属性将被LDAP filter自动取代. 
</dd></dl>
<p><b>{ldap_dn_filter, { Filter, FilterAttrs }}</b>
</p>
<dl><dd>应用于主过滤器返回的结果的过滤器. 这个filter执行额外的LDAP搜索以得到完整的结果. 当你无法在ldap_filter里定义所有filter rule时这是有用的. 你可以在Filter定义 "%u", "%d", "%s" and "%D" pattern 变量: "%u" 被用户的JID的user部分替代, "%d" 被相应的域(虚拟主机)替代, 所有 "%s" 变量被FilterAttrs属性值连续地替代，"%D" 被 Distinguished Name(DN) 替代. 缺省的，ldap_dn_filter 为 undefined. 例子:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>ldap_dn_filter, <span class="br0">&#123;</span><span class="st0">&quot;(&amp;(name=%s)(owner=%D)(user=%u@%d))&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;sn&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.</pre></div></div>
<dl><dd>因为这个filter做了额外的LDAP lookups, 只在最后排序时使用它: 如果可能，尝试在 ldap_filter里定义所有 filter rules . 
</dd></dl>
<p><b>{ldap_local_filter, Filter}</b>
</p>
<dl><dd>如果因为性能原因 (该 LDAP 服务器有很多注册用户)你不能使用 ldap_filter , 你可以使用这个本地 filter. local filter 在ejabberd检查一个属性, 而不是 LDAP, 所以限制了这个LDAP目录的负载. 缺省 filter 是: undefined. 示例值:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>ldap_local_filter, <span class="br0">&#123;</span>notequal, <span class="br0">&#123;</span><span class="st0">&quot;accountStatus&quot;</span>,<span class="br0">&#91;</span><span class="st0">&quot;disabled&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
    <span class="br0">&#123;</span>ldap_local_filter, <span class="br0">&#123;</span>equal, <span class="br0">&#123;</span><span class="st0">&quot;accountStatus&quot;</span>,<span class="br0">&#91;</span><span class="st0">&quot;enabled&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
    <span class="br0">&#123;</span>ldap_local_filter, undefined<span class="br0">&#125;</span>.</pre></div></div>
<h5> <span class="mw-headline" id=".E7.A4.BA.E4.BE.8B_2">示例</span></h5>
<h6> <span class="mw-headline" id=".E6.99.AE.E9.80.9A.E7.A4.BA.E4.BE.8B">普通示例</span></h6>
<p>让我们以 ldap.example.org 作为我们的 LDAP 服务器名. 我们在 "ou=Users,dc=example,dc=org" 目录使用他们的密码. 同时我们有 addressbook, 在 "ou=AddressBook,dc=example,dc=org" 目录它包含了用户的 emails 和他们的其他信息 . 到LDAP服务器的连接使用TLS加密, 并且使用自定义端口 6123. 相应的验证节应该看起来象这样:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>%% Authentication method
<span class="br0">&#123;</span>auth_method, ldap<span class="br0">&#125;</span>.
%% DNS name of our LDAP server
<span class="br0">&#123;</span>ldap_servers, <span class="br0">&#91;</span><span class="st0">&quot;ldap.example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
%% Bind to LDAP server as <span class="st0">&quot;cn=Manager,dc=example,dc=org&quot;</span> with password <span class="st0">&quot;secret&quot;</span>
<span class="br0">&#123;</span>ldap_rootdn, <span class="st0">&quot;cn=Manager,dc=example,dc=org&quot;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>ldap_password, <span class="st0">&quot;secret&quot;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>ldap_encrypt, tls<span class="br0">&#125;</span>.
<span class="br0">&#123;</span>ldap_port, <span class="nu0">6123</span><span class="br0">&#125;</span>.
%% Define the user's base
<span class="br0">&#123;</span>ldap_base, <span class="st0">&quot;ou=Users,dc=example,dc=org&quot;</span><span class="br0">&#125;</span>.
%% We want to authorize users from 'shadowAccount' object class only
<span class="br0">&#123;</span>ldap_filter, <span class="st0">&quot;(objectClass=shadowAccount)&quot;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>现在我们想使用用户的 LDAP-info 作为他们的 vCards. 在我们的 LDAP schema定义了四个属性: "mail" — email地址, "givenName" — 名, "sn" — 姓, "birthDay" — 生日. 我们也想用户搜索到每个其他人. 我们看如何设置:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_vcard_ldap,
   <span class="br0">&#91;</span>
   &#160;%% We use the same server and port, but want to bind anonymously because
   &#160;%% our LDAP server accepts anonymous requests to
   &#160;%% <span class="st0">&quot;ou=AddressBook,dc=example,dc=org&quot;</span> subtree.
    <span class="br0">&#123;</span>ldap_rootdn, <span class="st0">&quot;&quot;</span><span class="br0">&#125;</span>,
    <span class="br0">&#123;</span>ldap_password, <span class="st0">&quot;&quot;</span><span class="br0">&#125;</span>,
   &#160;%% define the addressbook's base
    <span class="br0">&#123;</span>ldap_base, <span class="st0">&quot;ou=AddressBook,dc=example,dc=org&quot;</span><span class="br0">&#125;</span>,
   &#160;%% uidattr: user's part of JID is located in the <span class="st0">&quot;mail&quot;</span> attribute
   &#160;%% uidattr_format: common format for our emails
    <span class="br0">&#123;</span>ldap_uids, <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;mail&quot;</span>, <span class="st0">&quot;%u@mail.example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
   &#160;%% We have to define empty filter here, because entries in addressbook does not
   &#160;%% belong to shadowAccount object class
    <span class="br0">&#123;</span>ldap_filter, <span class="st0">&quot;&quot;</span><span class="br0">&#125;</span>,
   &#160;%% Now we want to define vCard pattern
    <span class="br0">&#123;</span>ldap_vcard_map,
     <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;NICKNAME&quot;</span>, <span class="st0">&quot;%u&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,&#160;% just use user's part of JID as his nickname
      <span class="br0">&#123;</span><span class="st0">&quot;GIVEN&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;givenName&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;FAMILY&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;sn&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;FN&quot;</span>, <span class="st0">&quot;%s,&#160;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;sn&quot;</span>, <span class="st0">&quot;givenName&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,&#160;% example: <span class="st0">&quot;Smith, John&quot;</span>
      <span class="br0">&#123;</span><span class="st0">&quot;EMAIL&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;mail&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;BDAY&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;birthDay&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
   &#160;%% Search form
    <span class="br0">&#123;</span>ldap_search_fields,
     <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;User&quot;</span>, <span class="st0">&quot;%u&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Name&quot;</span>, <span class="st0">&quot;givenName&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Family Name&quot;</span>, <span class="st0">&quot;sn&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Email&quot;</span>, <span class="st0">&quot;mail&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Birthday&quot;</span>, <span class="st0">&quot;birthDay&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
   &#160;%% vCard fields to be reported
   &#160;%% Note that JID is always returned with search results
    <span class="br0">&#123;</span>ldap_search_reported,
     <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;Full Name&quot;</span>, <span class="st0">&quot;FN&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Nickname&quot;</span>, <span class="st0">&quot;NICKNAME&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Birthday&quot;</span>, <span class="st0">&quot;BDAY&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
  <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>注意 mod_vcard_ldap 模块在LDAP搜索用户的信息之前会先检查用户是否存在.
</p>
<h6> <span class="mw-headline" id="Active_Directory">Active Directory</span></h6>
<p>Active Directory 只是一个预定义属性的LDAP-服务器. 示范配置如下:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>auth_method, ldap<span class="br0">&#125;</span>.
<span class="br0">&#123;</span>ldap_servers, <span class="br0">&#91;</span><span class="st0">&quot;office.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.   &#160;% List of LDAP servers
<span class="br0">&#123;</span>ldap_base, <span class="st0">&quot;DC=office,DC=org&quot;</span><span class="br0">&#125;</span>.&#160;% Search base of LDAP directory
<span class="br0">&#123;</span>ldap_rootdn, <span class="st0">&quot;CN=Administrator,CN=Users,DC=office,DC=org&quot;</span><span class="br0">&#125;</span>.&#160;% LDAP manager
<span class="br0">&#123;</span>ldap_password, <span class="st0">&quot;*******&quot;</span><span class="br0">&#125;</span>.&#160;% Password to LDAP manager
<span class="br0">&#123;</span>ldap_uids, <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;sAMAccountName&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>ldap_filter, <span class="st0">&quot;(memberOf=*)&quot;</span><span class="br0">&#125;</span>.
&#160;
<span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_vcard_ldap,
   <span class="br0">&#91;</span><span class="br0">&#123;</span>ldap_vcard_map,
     <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;NICKNAME&quot;</span>, <span class="st0">&quot;%u&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;GIVEN&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;givenName&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;MIDDLE&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;initials&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;FAMILY&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;sn&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;FN&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;displayName&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;EMAIL&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;mail&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;ORGNAME&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;company&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;ORGUNIT&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;department&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;CTRY&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;c&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;LOCALITY&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;l&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;STREET&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;streetAddress&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;REGION&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;st&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;PCODE&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;postalCode&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;TITLE&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;title&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;URL&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;wWWHomePage&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;DESC&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;description&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;TEL&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;telephoneNumber&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
    <span class="br0">&#123;</span>ldap_search_fields,
     <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;User&quot;</span>, <span class="st0">&quot;%u&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Name&quot;</span>, <span class="st0">&quot;givenName&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Family Name&quot;</span>, <span class="st0">&quot;sn&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Email&quot;</span>, <span class="st0">&quot;mail&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Company&quot;</span>, <span class="st0">&quot;company&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Department&quot;</span>, <span class="st0">&quot;department&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Role&quot;</span>, <span class="st0">&quot;title&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Description&quot;</span>, <span class="st0">&quot;description&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Phone&quot;</span>, <span class="st0">&quot;telephoneNumber&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
    <span class="br0">&#123;</span>ldap_search_reported,
     <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;Full Name&quot;</span>, <span class="st0">&quot;FN&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Nickname&quot;</span>, <span class="st0">&quot;NICKNAME&quot;</span><span class="br0">&#125;</span>,
      <span class="br0">&#123;</span><span class="st0">&quot;Email&quot;</span>, <span class="st0">&quot;EMAIL&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
  <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h3> <span class="mw-headline" id=".E6.A8.A1.E5.9D.97.E9.85.8D.E7.BD.AE">模块配置</span></h3>
<p>选项 modules 定义ejabberd启动后将被装载的模块的列表. 列表中的每个条目是一个组，第一个元素是一个模块的名称，第二个是一个模块列表的选项.
</p><p>语法是:
</p><p><b>{modules, [ {ModuleName, ModuleOptions}, ...]}.</b>
</p><p>例子:
</p>
<ul><li> 在这个例子里只有模块 mod_echo 被装载宁且没有在方括号内定义该模块的选项:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        <span class="br0">&#123;</span>mod_echo,      <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 在第二个例子里不带选项地装载了模块 mod_echo, mod_time, 和 mod_version. 特别注意, 除了最后一个条目, 所有条目都以一个逗号结尾:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        <span class="br0">&#123;</span>mod_echo,      <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span>mod_time,      <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span>mod_version,   <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id=".E6.A8.A1.E5.9D.97.E4.B8.80.E8.A7.88">模块一览</span></h4>
<p>下表列出ejabberd里的所有模块.
</p>
<table border="1" cellspacing="0">
<tr>
<th>模块 </th>
<th>功能	</th>
<th>依赖
</th></tr>
<tr>
<td>mod_adhoc	</td>
<td>特定命令 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0050.html">XEP-0050</a>)	</td>
<td>
</td></tr>
<tr>
<td>mod_announce	</td>
<td>管理公告	</td>
<td>推荐 mod_adhoc
</td></tr>
<tr>
<td>mod_caps	</td>
<td>实体能力 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0115.html">XEP-0115</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_configure	</td>
<td>使用特定命令配置服务器	</td>
<td>mod_adhoc
</td></tr>
<tr>
<td>mod_disco	</td>
<td>服务发现 (<a href="/XEP-0030" title="XEP-0030">XEP-0030</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_echo	</td>
<td>XMPP节回音	 </td>
<td>
</td></tr>
<tr>
<td>mod_irc	        </td>
<td>IRC网关	 </td>
<td>
</td></tr>
<tr>
<td>mod_last	</td>
<td>最后活动 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0012.html">XEP-0012</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_last_odbc	</td>
<td>最后活动 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0012.html">XEP-0012</a>)	</td>
<td>支持的数据库 (*)
</td></tr>
<tr>
<td>mod_muc	</td>
<td>多用户聊天 (<a href="/XEP-0045" title="XEP-0045">XEP-0045</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_muc_log	</td>
<td>多用户聊天室记录	</td>
<td>mod_muc
</td></tr>
<tr>
<td>mod_offline	</td>
<td>离线消息存储 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0160.html">XEP-0160</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_offline_odbc	</td>
<td>离线消息存储 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0160.html">XEP-0160</a>)	</td>
<td>支持的数据库 (*)
</td></tr>
<tr>
<td>mod_ping	</td>
<td>XMPP Ping 和定期保持连接 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0199.html">XEP-0199</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_privacy	</td>
<td>禁止通讯 (<a href="/RFC3921" title="RFC3921">XMPP IM</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_privacy_odbc	</td>
<td>禁止通讯 ((<a href="/RFC3921" title="RFC3921">XMPP IM</a>)	</td>
<td>支持的数据库 (*)
</td></tr>
<tr>
<td>mod_private	</td>
<td>私有XML存储 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0049.html">XEP-0049</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_private_odbc	</td>
<td>私有XML存储 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0049.html">XEP-0049</a>)	</td>
<td>支持的数据库 (*)
</td></tr>
<tr>
<td>mod_proxy65	</td>
<td>SOCKS5字节流 (<a href="/XEP-0065" title="XEP-0065">XEP-0065</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_pubsub	</td>
<td>发行-订阅 (<a href="/XEP-0060" title="XEP-0060">XEP-0060</a>), PEP (<a href="/XEP-0163" title="XEP-0163">XEP-0163</a>)	</td>
<td>mod_caps
</td></tr>
<tr>
<td>mod_pubsub_odbc	</td>
<td>发行-订阅 (<a href="/XEP-0060" title="XEP-0060">XEP-0060</a>), PEP (<a href="/XEP-0163" title="XEP-0163">XEP-0163</a>)	</td>
<td>支持的数据库 (*) 和 mod_caps
</td></tr>
<tr>
<td>mod_register	</td>
<td>I带内注册 (<a href="/XEP-0077" title="XEP-0077">XEP-0077</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_roster	</td>
<td>名册管理 (<a href="/RFC3921" title="RFC3921">XMPP IM</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_roster_odbc	</td>
<td>名册管理 (<a href="/RFC3921" title="RFC3921">XMPP IM</a>)	</td>
<td>支持的数据库 (*)
</td></tr>
<tr>
<td>mod_service_log	</td>
<td>拷贝用户消息到日志服务	 </td>
<td>
</td></tr>
<tr>
<td>mod_shared_roster	</td>
<td>共享名册管理	</td>
<td>mod_roster 或	mod_roster_odbc
</td></tr>
<tr>
<td>mod_sic	Server </td>
<td>IP检查 (<a href="/index.php?title=XEP-0279&amp;action=edit&amp;redlink=1" class="new" title="XEP-0279（尚未撰写）">XEP-0279</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_stats	</td>
<td>统计信息收集 (<a href="/index.php?title=XEP-0039&amp;action=edit&amp;redlink=1" class="new" title="XEP-0039（尚未撰写）">XEP-0039</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_time	</td>
<td>实体时间 (<a href="/index.php?title=XEP-0202&amp;action=edit&amp;redlink=1" class="new" title="XEP-0202（尚未撰写）">XEP-0202</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_vcard	</td>
<td>电子名片 (<a href="/XEP-0054" title="XEP-0054">XEP-0054</a>)	 </td>
<td>
</td></tr>
<tr>
<td>mod_vcard_ldap	</td>
<td>电子名片 (<a href="/XEP-0054" title="XEP-0054">XEP-0054</a>)	</td>
<td>LDAP服务器
</td></tr>
<tr>
<td>mod_vcard_odbc	</td>
<td>电子名片 (<a href="/XEP-0054" title="XEP-0054">XEP-0054</a>)	</td>
<td>支持的数据库 (*)
</td></tr>
<tr>
<td>mod_vcard_xupdate	</td>
<td>基于vCard的头像 (<a href="/XEP-0153" title="XEP-0153">XEP-0153</a>)	</td>
<td>mod_vcard 或 mod_vcard_odbc
</td></tr>
<tr>
<td>mod_version	</td>
<td>软件版本 (<a href="/index.php?title=XEP-0092&amp;action=edit&amp;redlink=1" class="new" title="XEP-0092（尚未撰写）">XEP-0092</a>)	 </td>
<td>
</td></tr></table>
<ul><li> (*) 这个模块需要数据库支持. 关于支持的数据库列表, 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E6.95.B0.E6.8D.AE.E5.BA.93.E5.92.8CLDAP.E9.85.8D.E7.BD.AE" title="Ejabberd2:安装和操作指南">3.2</a> 节. 
</li></ul>
<p>通过后缀你可以看到每个模块需要哪个数据库后端:
</p>
<ul><li> 没有后缀, 这意味着那个模块使用Erlang的内建数据库 Mnesia 作为后端.
</li><li> ‘_odbc’, 这意味着该模块需要一个支持的数据库 (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E6.95.B0.E6.8D.AE.E5.BA.93.E5.92.8CLDAP.E9.85.8D.E7.BD.AE" title="Ejabberd2:安装和操作指南">3.2</a> 节) 作为后端.
</li><li> ‘_ldap’, 这意味着该模块需要一个LDAP服务器作为后端. 
</li></ul>
<p>如果你想要, 有可能使用一个关系数据库来存储信息件. 你可以通过在ejabberd 配置文件修改模块名称带上_odbc 后缀来实现这点. 你可以为以下数据使用关系数据库:
</p>
<ul><li> 最后连接日期和时间: 使用 mod_last_odbc 取代 mod_last.
</li><li> 离线消息: 使用 mod_offline_odbc 取代 mod_offline.
</li><li> 名册: 使用 mod_roster_odbc 取代 mod_roster.
</li><li> 用户的VCARD: 使用 mod_vcard_odbc 取代 mod_vcard.
</li><li> 私有XML存储: 使用 mod_private_odbc 取代 mod_private.
</li><li> 用户黑名单规则: 使用 mod_privacy_odbc 取代 mod_privacy. 
</li></ul>
<p>你可以在ejabberd网站找到更多别人<a rel="nofollow" class="external text" href="http://www.ejabberd.im/contributions">捐献的模块</a>的信息. 请记住这些捐献可能不能用或它们有些bug和安全泄露. 所以, 使用他们是你们自己的风险!
</p>
<h4> <span class="mw-headline" id=".E9.80.9A.E7.94.A8.E9.80.89.E9.A1.B9">通用选项</span></h4>
<p>以下选项被多个模块使用. 所以, 它们被单列一节.
</p>
<h5> <span class="mw-headline" id="iqdisc">iqdisc</span></h5>
<p>很多模块为处理发到这个服务器或一个用户(例如. 给 example.org 或给 user@example.org)的不同namespaces的IQ queries定义了处理程序. 这个选项定义了这些queries的处理原则.
</p><p>语法是:
</p><p><b>{iqdisc, Value}</b>
</p><p>可能的值有:
</p><p><b>no_queue</b>
</p>
<dl><dd>一个拥有此处理原则的 namespace 的所有 queries 会被立即处理. 这也意味着在这个包完全处理完之前，不可以处理任何包. 如果一个query的处理可能消耗比较长的时间，今后将不推荐这个原则. 
</dd></dl>
<p><b>one_queue</b>
</p>
<dl><dd>在这种情况下，将为一个拥有此处理原则的 namespace建立一个独立的队列来处理它们. 另外, 这个队列的处理和其他包的队列是并行的. 这个原则是最推荐的. 
</dd></dl>
<p><b>{queues, N}</b>
</p>
<dl><dd>N个独立的队列被建立用来处理这些 queries. 因而 queries 被并行处理, 但是以一个可控的方法. 
</dd></dl>
<p><b>parallel</b>
</p>
<dl><dd>对每一个拥有此原则的包产生一个独立的Erlang进程. 所以, 所有这些包被并行处理. 尽管Erlang进程的产生成本相对较低, 这可能中断服务器的正常工作, 因为Erlang模拟器对进程数量有限制 (缺省为32000). 
</dd></dl>
<p>例子:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_time, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>iqdisc, no_queue<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h5> <span class="mw-headline" id="host">host</span></h5>
<p>这个选项定义一个ejabberd 模块提供的服务的 Jabber ID.
</p><p>语法是:
</p><p><b>{host, HostName}</b>
</p><p>如果你在 HostName 里包含了关键字 "@HOST@" , 它在启动时被替换为真实的虚拟主机字符串.
</p><p>这个例子配置了 echo 模块以 Jabber ID mirror.example.org来提供它的回音服务:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_echo, <span class="br0">&#91;</span><span class="br0">&#123;</span>host, <span class="st0">&quot;mirror.example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>无论如何, 如果有多个虚拟主机并且这个模块在所有虚拟主机中都被激活, 必须使用"@HOST@" 关键字:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_echo, <span class="br0">&#91;</span><span class="br0">&#123;</span>host, <span class="st0">&quot;mirror.@HOST@&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_announce">mod_announce</span></h4>
<p>本模块允许配置用户广播公告并设定本日消息 (MOTD). 被配置的用户可以在一个XMPP客户端使用Ad-hoc命令或发送消息给指定的JIDs来执行这些动作.
</p><p>特定命令被列于服务发现. 要使用此功能, 必须激活 mod_adhoc 模块.
</p><p>可以发送消息的特定 JIDs 清单如下. 在每个条目的第一个 JID 将只应用于指定的虚拟主机 example.org, 而括号里的 JID 将应用于ejabberd的所有虚拟主机.
</p><p><b>example.org/announce/all (example.org/announce/all-hosts/all)</b>
</p>
<dl><dd>消息将被发送给所有注册用户. 如果用户在线并连接了多个资源, 只有高优先级的资源将收到消息. 如果注册用户没有连接, 消息将离线存储，假定激活了离线存储 (见  [[Ejabberd2:安装和操作指南#mod_offline|3.3.12] 节). 
</dd></dl>
<p><b>example.org/announce/online (example.org/announce/all-hosts/online)</b>
</p>
<dl><dd>消息被发送到所有已连接的用户. 如果用户在线且连接了多个资源, 所有资源将接收到消息. 
</dd></dl>
<p><b>example.org/announce/motd (example.org/announce/all-hosts/motd)</b>
</p>
<dl><dd>该消息被设置为每日消息 (MOTD) 并在用户登录时被发送给用户. 另外这个消息会被发送给所有连接的用户 (类似 announce/online). 
</dd></dl>
<p><b>example.org/announce/motd/update (example.org/announce/all-hosts/motd/update)</b>
</p>
<dl><dd>该消息被设置为每日消息 (MOTD) 并在用户登录时被发送给用户. 这个消息不发送给任何当前已连接的用户. 
</dd></dl>
<p><b>example.org/announce/motd/delete (example.org/announce/all-hosts/motd/delete)</b>
</p>
<dl><dd>任何发送到此JID的消息移除现有的每日消息 (MOTD). 
</dd></dl>
<p>选项:
</p><p><b>{access, AccessName}</b>
</p>
<dl><dd>这个选项指定谁被允许发送公告并设置每日消息 (缺省的, 没有人能发送这类消息). 
</dd></dl>
<p>例子:
</p>
<ul><li> 只有管理员能发送公告:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>access, announce, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow, admins<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_adhoc, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span>mod_announce, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>access, announce<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 管理员以及 direction 可发送公告:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>acl, direction, <span class="br0">&#123;</span>user, <span class="st0">&quot;big_boss&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>acl, direction, <span class="br0">&#123;</span>user, <span class="st0">&quot;assistant&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>acl, admins, <span class="br0">&#123;</span>user, <span class="st0">&quot;admin&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>access, announce, <span class="br0">&#91;</span><span class="br0">&#123;</span>allow, admins<span class="br0">&#125;</span>,
                          <span class="br0">&#123;</span>allow, direction<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_adhoc, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span>mod_announce, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>access, announce<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>注意 mod_announce 在大的布署里可能是资源敏感的，因为它可能广播非常多的消息. 对于拥有成百上千用户的ejabberd实例，这个模块应该被禁止.
</p>
<h4> <span class="mw-headline" id="mod_disco">mod_disco</span></h4>
<p>这个模块增加多服务发现 (<a href="/XEP-0030" title="XEP-0030">XEP-0030</a>) 的支持. 激活本模块, 你的服务器上的服务可以被XMPP客户端发现. 注意ejabberd没有模块支持被取代的 Jabber Browsing (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0011.html">XEP-0011</a>) 和 Agent Information (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0094.html">XEP-0094</a>). 于是,如果你想它们能发现你提供的服务，XMPP客户端需要支持这个比较新的发现协议.
</p><p>选项:
</p><p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这定义服务发现的IQ queries的处理原则 (<a rel="nofollow" class="external free" href="http://jabber.org/protocol/disco#items">http://jabber.org/protocol/disco#items</a> 和 <a rel="nofollow" class="external free" href="http://jabber.org/protocol/disco#info">http://jabber.org/protocol/disco#info</a>)  (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#iqdisc" title="Ejabberd2:安装和操作指南">3.3.2</a>). 
</dd></dl>
<p><b>{extra_domains, [Domain, ...]}</b>
</p>
<dl><dd>使用这个选项, 你可以指定一个增加到服务发现条目列表中的附加域的列表. 
</dd></dl>
<p><b>{server_info, [ {Modules, Field, [Value, ...]}, ... ]}</b>
</p>
<dl><dd>指定关于本服务器的额外的信息, 参见 XMPP服务的联系地址 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0157.html">XEP-0157</a>). Modules 可以是关键字‘all’, 这种情况下信息被汇报给所有服务; 或是一个 ejabberd 模块的列表, 这种情况下信息仅被指定给那些模块提供的服务. 可以指定任意的 Field 和 Value , 不只是联系地址. 
</dd></dl>
<p>例子:
</p>
<ul><li> 提供一个链接到jabber.org上的Jabber用户目录:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_disco, <span class="br0">&#91;</span><span class="br0">&#123;</span>extra_domains, <span class="br0">&#91;</span><span class="st0">&quot;users.jabber.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 提供一个链接到其他服务器的网关:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_disco, <span class="br0">&#91;</span><span class="br0">&#123;</span>extra_domains, <span class="br0">&#91;</span><span class="st0">&quot;icq.example.com&quot;</span>,
                                      <span class="st0">&quot;msn.example.com&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 提供一个链接到一些友好的服务器:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_disco, <span class="br0">&#91;</span><span class="br0">&#123;</span>extra_domains, <span class="br0">&#91;</span><span class="st0">&quot;example.org&quot;</span>,
                                      <span class="st0">&quot;example.com&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 使用这个配置, 所有服务在主服务器显示滥用地址, 回复地址, 并同时在主服务器和vJUD服务显示管理员地址:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_disco, <span class="br0">&#91;</span><span class="br0">&#123;</span>server_info, <span class="br0">&#91;</span>
            <span class="br0">&#123;</span>all,
             <span class="st0">&quot;abuse-addresses&quot;</span>,
             <span class="br0">&#91;</span><span class="st0">&quot;mailto:abuse@shakespeare.lit&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="re0"><span class="br0">&#91;</span>mod_muc<span class="br0">&#93;</span></span>,
             <span class="st0">&quot;Web chatroom logs&quot;</span>,
             <span class="br0">&#91;</span><span class="st0">&quot;http://www.example.org/muc-logs&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="re0"><span class="br0">&#91;</span>mod_disco<span class="br0">&#93;</span></span>,
             <span class="st0">&quot;feedback-addresses&quot;</span>,
             <span class="br0">&#91;</span><span class="st0">&quot;http://shakespeare.lit/feedback.php&quot;</span>, <span class="st0">&quot;mailto:feedback@shakespeare.lit&quot;</span>, <span class="st0">&quot;xmpp:feedback@shakespeare.lit&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="re0"><span class="br0">&#91;</span>mod_disco, mod_vcard<span class="br0">&#93;</span></span>,
             <span class="st0">&quot;admin-addresses&quot;</span>,
             <span class="br0">&#91;</span><span class="st0">&quot;mailto:xmpp@shakespeare.lit&quot;</span>, <span class="st0">&quot;xmpp:admins@shakespeare.lit&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
        <span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_echo">mod_echo</span></h4>
<p>本模块简单地对任何XMPP包发出回音给发送者. ejabberd和XMPP客户端调试可能对这个镜子感兴趣.
</p><p>选项:
</p><p><b>{host, HostName}</b>
</p>
<dl><dd>这个选项定义服务的Jabber ID. 如果 host 选项没指定, Jabber ID 将是前缀‘echo.’加该虚拟主机的 hostname . 关键字 "@HOST@" 在启动时被替换成真实的虚拟主机名. 
</dd></dl>
<p>例子: 镜子, 镜子, 在墙上, 他们谁是最美丽的?
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_echo, <span class="br0">&#91;</span><span class="br0">&#123;</span>host, <span class="st0">&quot;mirror.example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_http_bind">mod_http_bind</span></h4>
<p>本模块实现了定义于 <a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0124.html">XEP-0124</a> 和 <a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0206.html">XEP-0206</a>的 XMPP over Bosh (正式的名字是 HTTP Binding). 它在这个将被伺服的服务上以一个可配置的资源扩展了ejabberd的HTTP服务， .
</p><p>要使用 HTTP-Binding, 激活这个模块:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_http_bind, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
  ...
<span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>并增加 http_bind 到 HTTP 服务. 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>listen, 
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span><span class="nu0">5280</span>, ejabberd_http, <span class="br0">&#91;</span>
                         http_bind,
                         http_poll,
                         web_admin
                        <span class="br0">&#93;</span>
  <span class="br0">&#125;</span>,
  ...
<span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>使用这个配置, module 将伺服发送给 <a rel="nofollow" class="external free" href="http://example.org:5280/http-bind/">http://example.org:5280/http-bind/</a> 的请求. 记住这个页面不是被设计给web浏览器使用的, 它是被支持XMPP over Bosh的XMPP客户端使用的.
</p><p>如果你想以不同的URI路径设置服务或使用一个不同的模块, 你可以使用选项request_handlers手工配置它. 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>listen, 
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span><span class="nu0">5280</span>, ejabberd_http, <span class="br0">&#91;</span>
                         <span class="br0">&#123;</span>request_handlers, <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="br0">&#91;</span><span class="st0">&quot;http-bind&quot;</span><span class="br0">&#93;</span>, mod_http_bind<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
                         http_poll,
                         web_admin
                        <span class="br0">&#93;</span>
  <span class="br0">&#125;</span>,
  ...
<span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>选项:
</p><p><b>{max_inactivity, Seconds}</b>
</p>
<dl><dd>以秒数定义最大闲置时间. 缺省值为30秒. 例如, 设置成50秒:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#123;</span>modules,
     <span class="br0">&#91;</span>
      ...
      <span class="br0">&#123;</span>mod_http_bind, <span class="re0"><span class="br0">&#91;</span> <span class="br0">&#123;</span>max_inactivity, <span class="nu0">50</span><span class="br0">&#125;</span> <span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
      ...
    <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_http_fileserver">mod_http_fileserver</span></h4>
<p>这个简单的模块从本地磁盘通过HTTP提供文件服务.
</p><p>选项:
</p><p><b>{docroot, Path}</b>
</p>
<dl><dd>伺服文件的目录. 
</dd></dl>
<p><b>{accesslog, Path}</b>
</p>
<dl><dd>使用一个类似Apache格式的日志文件. 如果没指定本选项则不记录日志. 
</dd></dl>
<p><b>{directory_indices, [Index, ...]}</b>
</p>
<dl><dd>包含一个或多个目录的索引文件, 类似 Apache的 DirectoryIndex 变量. 当一个web请求去到一个目录而不是常规的文件, 那些目录的 indices 被顺序装载, 并且返回被发现的第一个. 
</dd></dl>
<p><b>{custom_headers, [ {Name, Value}, ...]}</b>
</p>
<dl><dd>表明自定义的HTTP头将被包含在所有应答中. 缺省值是: [] 
</dd></dl>
<p><b>{content_types, [ {Name, Type}, ...]}</b>
</p>
<dl><dd>指定内容类型的扩展. 已经定义了很多 content types , 使用本选项你可以增加新的定义, 修改或删除现存的. 要删除现有定义, 简单的以一个值定义它: ‘undefined’. 
</dd></dl>
<p><b>{default_content_type, Type}</b>
</p>
<dl><dd>指定 content type 使用未知的扩展. 缺省是‘application/octet-stream’. 
</dd></dl>
<p>这个实例配置将从本地目录 /var/www 在地址 <a rel="nofollow" class="external free" href="http://example.org:5280/pub/archive/">http://example.org:5280/pub/archive/</a> 提供文件服务. 在这个例子定义了一个新的 content type ogg, png 重新定义了, 而 jpg 定义被删除了. 要使用本模块你必须激活它:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_http_fileserver, <span class="br0">&#91;</span>
                         <span class="br0">&#123;</span>docroot, <span class="st0">&quot;/var/www&quot;</span><span class="br0">&#125;</span>, 
                         <span class="br0">&#123;</span>accesslog, <span class="st0">&quot;/var/log/ejabberd/access.log&quot;</span><span class="br0">&#125;</span>,
                         <span class="br0">&#123;</span>directory_indices, <span class="br0">&#91;</span><span class="st0">&quot;index.html&quot;</span>, <span class="st0">&quot;main.htm&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
                         <span class="br0">&#123;</span>custom_headers, <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;X-Powered-By&quot;</span>, <span class="st0">&quot;Erlang/OTP&quot;</span><span class="br0">&#125;</span>,
                                           <span class="br0">&#123;</span><span class="st0">&quot;X-Fry&quot;</span>, <span class="st0">&quot;It's a widely-believed fact!&quot;</span><span class="br0">&#125;</span>
                                          <span class="br0">&#93;</span><span class="br0">&#125;</span>,
                         <span class="br0">&#123;</span>content_types, <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;.ogg&quot;</span>, <span class="st0">&quot;audio/ogg&quot;</span><span class="br0">&#125;</span>,
                                          <span class="br0">&#123;</span><span class="st0">&quot;.png&quot;</span>, <span class="st0">&quot;image/png&quot;</span><span class="br0">&#125;</span>,
                                          <span class="br0">&#123;</span><span class="st0">&quot;.jpg&quot;</span>, undefined<span class="br0">&#125;</span>
                                         <span class="br0">&#93;</span><span class="br0">&#125;</span>,
                         <span class="br0">&#123;</span>default_content_type, <span class="st0">&quot;text/html&quot;</span><span class="br0">&#125;</span>
                        <span class="br0">&#93;</span>
  <span class="br0">&#125;</span>,
  ...
<span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>并且在HTTP服务里把它定义为一个处理器:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>listen, 
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span><span class="nu0">5280</span>, ejabberd_http, <span class="br0">&#91;</span>
                         ...
                         <span class="br0">&#123;</span>request_handlers, <span class="br0">&#91;</span>
                                             ...
                                             <span class="br0">&#123;</span><span class="br0">&#91;</span><span class="st0">&quot;pub&quot;</span>, <span class="st0">&quot;archive&quot;</span><span class="br0">&#93;</span>, mod_http_fileserver<span class="br0">&#125;</span>,
                                             ...
                                            <span class="br0">&#93;</span>
                         <span class="br0">&#125;</span>,
                         ...
                        <span class="br0">&#93;</span>
  <span class="br0">&#125;</span>,
  ...
<span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_irc">mod_irc</span></h4>
<p>本模块是一个 IRC 网关用于加入IRC服务器的频道.
</p><p>最终用户信息:
</p>
<ul><li> 一个支持‘groupchat 1.0’或 Multi-User Chat (<a href="/XEP-0045" title="XEP-0045">XEP-0045</a>)的XMPP客户端需要加入IRC频道.
</li><li> 一个IRC频道可能被以近似相同的方式加入一个XMPP多用户聊天室. 不同处是房间名将变成‘channel%irc.example.org’，在这个情况下 irc.example.org 是伺服‘channel’的IRC服务器. 并且当然这个主机应该指向IRC网关而不是多用户聊天服务.
</li><li> 你可以注册你的昵称，通过发送‘IDENTIFY password’到 nickserver!irc.example.org@irc.jabberserver.org.
</li><li> 键入你的密码，通过发送‘LOGIN nick password’到 nickserver!irc.example.org@irc.jabberserver.org.
</li><li> IRC网关提供 Ad-Hoc Commands (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0050.html">XEP-0050</a>) 来加入一个频道, 并设定自定义的 IRC 用户名和编码.
</li><li> 当使用一个流行的XMPP服务器, 可能它没有到一些IRC服务器的连接存在，因为它们限制从一个IP来的连接的数量. 
</li></ul>
<p>选项:
</p><p><b>{host, HostName}</b>
</p>
<dl><dd>这个选项定义该服务的 Jabber ID. 如果 host 选项未定义, Jabber ID 将是该虚拟主机的 hostname 加上前缀‘irc.’. 关键字 "@HOST@" 在启动时被替换成真实的虚拟主机名. 
</dd></dl>
<p><b>{access, AccessName}</b>
</p>
<dl><dd>这个选项可被用于定义谁能使用 IRC 网关 (缺省值: all). 
</dd></dl>
<p><b>{default_encoding, Encoding}</b>
</p>
<dl><dd>设置缺省的 IRC 编码. 缺省值: "koi8-r" 
</dd></dl>
<p>例子:
</p>
<ul><li> 在第一个例子里, IRC网关在你的所有带有前缀‘irc.’的虚拟主机上可用. 进一步的, 任何人可以使用这个这个网关. 缺省编码设为 "iso8859-15".
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_irc, <span class="br0">&#91;</span><span class="br0">&#123;</span>access, all<span class="br0">&#125;</span>, <span class="br0">&#123;</span>default_encoding, <span class="st0">&quot;iso8859-15&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 在下一个例子，IRC网关对于那些拥有前缀irc-t.net的JIDs可用. 而且, 这个网关只可以被example.org的两个用户以及example.com上的所有用户使用:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>acl, paying_customers, <span class="br0">&#123;</span>user, <span class="st0">&quot;customer1&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>acl, paying_customers, <span class="br0">&#123;</span>user, <span class="st0">&quot;customer2&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>acl, paying_customers, <span class="br0">&#123;</span>server, <span class="st0">&quot;example.com&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>access, irc_users, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow, paying_customers<span class="br0">&#125;</span>, <span class="br0">&#123;</span>deny, all<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_irc, <span class="br0">&#91;</span><span class="br0">&#123;</span>access, irc_users<span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>host, <span class="st0">&quot;irc.example.net&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_last">mod_last</span></h4>
<p>本模块增加对最后活动(<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0012.html">XEP-0012</a>)的支持. 它可被用于发现什么时候离线用户最后一次访问服务器, 并知道在这台服务器上一个连接的用户的最后活动, 或查询ejabberd服务器的运行时间.
</p><p>选项:
</p><p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这是为 最后活动(jabber:iq:last) IQ queries 定义处理原则(见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#iqdisc" title="Ejabberd2:安装和操作指南">3.3.2</a> 节).
</dd></dl>
<h4> <span class="mw-headline" id="mod_muc">mod_muc</span></h4>
<p>本模块提供一个多用户聊天(<a href="/XEP-0045" title="XEP-0045">XEP-0045</a>)服务. 用户可以发现现有房间, 加入或新建房间. 房间的房客可以公开或私下聊天.
</p><p>多用户聊天的一些功能:
</p>
<ul><li> 发送公开或私有消息给房间房客.
</li><li> 邀请其他用户到一个房间.
</li><li> 设定一个房间的标题.
</li><li> 建立密码保护房间.
</li><li> 踢人或拉黑名单. 
</li></ul>
<p>这个MUC服务允许任何Jabber ID注册一个昵称, 这样没有别人可以在该MUC服务的任何房间使用那个昵称. 为了注册一个昵称, 在你的XMPP客户端打开服务发现并注册到该MUC服务.
</p><p>本模块支持集群和负载均衡. 一个模块可被每个集群节点启动. 在特定的时间房间分布于所有可用的MUC模块实例上. 多用户聊天模块是集群的但房间本身不是集群的，也不是容错的: 如果管理那些房间的节点挂了, 那些房间就消失了并且它们将在第一次尝试连接得到的可用节点上重建.
</p><p>Module 选项:
</p><p><b>{host, HostName}</b>
</p>
<dl><dd>这个选项定义服务的Jabber ID. 如果 host 选项未指定, 该Jabber ID将是虚拟主机的hostname加上前缀‘conference.’. 关键字 "@HOST@" 在启动时被替换为真实的虚拟主机名. 
</dd></dl>
<p><b>{access, AccessName}</b>
</p>
<dl><dd>你可以指定谁有权使用多用户聊天服务. 缺省每个人都被允许使用它. 
</dd></dl>
<p><b>{access_create, AccessName}</b>
</p>
<dl><dd>为配置在多用户聊天服务里谁被允许创建新房间 , 可使用这个选项. 缺省任何本地ejabberd服务器的帐号都被允许新建房间. 
</dd></dl>
<p><b>{access_persistent, AccessName}</b>
</p>
<dl><dd>为配置谁被允许修改持久 ’persistent’房间的选项. 缺省任何本地ejabberd服务器的帐号被允许修改那个选项. 
</dd></dl>
<p><b>{access_admin, AccessName}</b>
</p>
<dl><dd>这个选项指定谁被允许管理多用户聊天服务. 缺省值为 none, 它意味着只有房间创建者可以管理他的房间. 管理员们可以发送一个普通消息给服务 JID, 并且它将被作为一个服务消息显示在所有房间. 管理员们可以发送一个 groupchat 消息给一个激活的房间的JID, 并且该消息将被显示为一个服务消息. 
</dd></dl>
<p><b>{history_size, Size}</b>
</p>
<dl><dd>当用户进入房间时被发送给用户的一个当前讨论的短小历史. 使用此选项你可以定义保持的历史数据数量，用来在用户加入房间时发送给他们. 这个值是一个整数. 设定这个值为 0 禁止历史功能并且, 导致一个结果, 没东西保留在内存里. 这个缺省值是 20. 这个值是全局的并且因而会影响服务的所有房间. 
</dd></dl>
<p><b>{max_users, Number}</b>
</p>
<dl><dd>这个选项定义是服务级别的, 每房间允许的最大用户数. 它可以低于每个房间的配置但是不能在单个的房间配置里增加. 缺省值为200. 
</dd></dl>
<p><b>{max_users_admin_threshold, Number}</b>
</p>
<dl><dd>这个选项定义，当房间允许的最大房客数量达到之后，被允许进入房间的服务管理员或房间所有者的数量. 缺省限制为 5. 
</dd></dl>
<p><b>{max_user_conferences, Number}</b>
</p>
<dl><dd>这个选项定义给定用户能加入的房间的最大数量. 缺省值为 10. 这个选项被用于阻止可能的滥用. 注意这是个软限制: 一些用户有时候可以在集群配置里加入更多的会议. 
</dd></dl>
<p><b>{max_room_id, Number}</b>
</p>
<dl><dd>这个选项定义,当新建一个房间时,Room ID 字符串的可以有的最大长度. 缺省值是不限制: infinite. 
</dd></dl>
<p><b>{max_room_name, Number}</b>
</p>
<dl><dd>这个选项定义,当配置一个房间时,Room Name 字符串的可以有的最大长度. 缺省值是不限制: infinite. 
</dd></dl>
<p><b>{max_room_desc, Number}</b>
</p>
<dl><dd>这个选项定义,当配置一个房间时,Room Description 字符串的可以有的最大长度. 缺省值是不限制: infinite.     
</dd></dl>
<p><b>{min_message_interval, Number}</b>
</p>
<dl><dd>这个选项定义,在一个房客发送的两个消息之间的最小间隔时间,以秒计. 这个选项是全局的并且检查所有房间. 可使用一个十进制值. 当这个选项没定义时, 消息速率是不限制的. 这个功能可用来保护MUC服务不被房客滥用并限制服务广播的消息数量. 对于这个最小消息间隔时间,一个比较好的值是0.4秒. 如果一个房客试图更快地发送消息, 发回一个错误并解释这个消息已被抛弃并描述为什么消息不被接受的原因. 
</dd></dl>
<p><b>{min_presence_interval, Number}</b>
</p>
<dl><dd>这个选项定义一个给定房客的两次出席信息变更之间的最小时间，以秒计. 这个选项是全局的并且会对所有房间生效. 可以用一个十进制数值. 当这个选项没有定义的时候, 没有限制. 这个选项可被用于保护一个MUC服务不被房客滥用. 如果一个房客试图在指定的间隔时间内更多次的变更出席信息, 这个出席信息被 ejabberd 缓存并只有在间隔延迟过期后最新的出席信息被广播给房间里的所有房客. 中间的出席信息包被安静的抛弃. 一个好的选项值是4秒. 
</dd></dl>
<p><b>{default_room_options, [ {OptionName, OptionValue}, ...]}</b>
</p>
<dl><dd>这个选项允许定义期望的缺省房间选项. 注意一个房间的创建者可以在任何时候使用一个有MUC能力的XMPP客户端修改他自己的房间的选项. 可用的房间选项和缺省值有:
</dd></dl>
<dl><dd>    <b>{allow_change_subj, true|false}</b>
<dl><dd>允许房客修改标题. 
</dd></dl>
</dd><dd>    <b>{allow_private_messages, true|false}</b>
<dl><dd>房客可以发送私有消息给其他房客. 
</dd></dl>
</dd><dd>    <b>{allow_query_users, true|false}</b>
<dl><dd>房客可发送 IQ queries 给其他房客. 
</dd></dl>
</dd><dd>    <b>{allow_user_invites, false|true}</b>
<dl><dd>允许房客发送邀请. 
</dd></dl>
</dd><dd>    <b>{allow_visitor_nickchange, true|false}</b>
<dl><dd>允许游客修改昵称. 
</dd></dl>
</dd><dd>    <b>{allow_visitor_status, true|false}</b>
<dl><dd>允许游客在出席信息更新里发送status状态文本. I如果不允许, 在广播出席信息更新给房间里所有的房客时这个 status 文本被剥离. 
</dd></dl>
</dd><dd>    <b>{anonymous, true|false}</b>
<dl><dd>这个房间是匿名的: 房客看不到其他房客的真实JIDs. 注意房间主持人们总是看得见房客的真实JIDs. 
</dd></dl>
</dd><dd>    <b>{logging, false|true}</b>
<dl><dd>公开消息被使用mod_muc_log记录. 
</dd></dl>
</dd><dd>    <b>{max_users, 200}</b>
<dl><dd>房间里房客的最大数量. 
</dd></dl>
</dd><dd>    <b>{members_by_default, true|false}</b>
<dl><dd>进入房间的房客缺省成为参与者, 所以他们有发言权 ’voice’. 
</dd></dl>
</dd><dd>    <b>{members_only, false|true}</b>
<dl><dd>只有房间成员可以进入. 
</dd></dl>
</dd><dd>    <b>{moderated, true|false}</b>
<dl><dd>只有拥有发言权 ’voice’的房客可以发送公开消息. 
</dd></dl>
</dd><dd>    <b>{password, "roompass123"}</b>
<dl><dd>房间密码. 你可能希望也激活下一个选项. 
</dd></dl>
</dd><dd>    <b>{password_protected, false|true}</b>
<dl><dd>要求密码才能进入房间. 
</dd></dl>
</dd><dd>    <b>{persistent, false|true}</b>
<dl><dd>即使最后一个房客离开，房间仍持久存在. 
</dd></dl>
</dd><dd>    <b>{public, true|false}</b>
<dl><dd>房间在MUC服务列表里是公开的, 所以它是可发现的. 
</dd></dl>
</dd><dd>    <b>{public_list, true|false}</b>
<dl><dd>参与者名单是公开的, 不需要进入房间就能拿到. 
</dd></dl>
</dd><dd>    <b>{title, "Room Title"}</b>
<dl><dd>一个自然语言的房间称谓. 
</dd></dl>
</dd></dl>
<dl><dd>所有房间选项能被设定为 true 或 false, 除了 password 和 title 是字符串, 以及 max_users 是整数. 
</dd></dl>
<p>例子:
</p>
<ul><li> 在第一个例子里，每个人都允许使用多用户聊天服务. 每个人也将能创建房间但只有用户admin@example.org被允许管理任何房间. 在这个例子里他也是一个全局的管理员. 当admin@example.org发送一个消息，例如‘Tomorrow, the XMPP server will be moved to new hardware. This will involve service breakdowns around 23:00 UMT. We apologise for this inconvenience.’ 给 conference.example.org, 这个消息将被显示在所有激活的房间里. 在这个例子里历史功能被禁止了.
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>acl, admin, <span class="br0">&#123;</span>user, <span class="st0">&quot;admin&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>access, muc_admin, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow, admin<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_muc, <span class="br0">&#91;</span><span class="br0">&#123;</span>access, all<span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>access_create, all<span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>access_admin, muc_admin<span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>history_size, <span class="nu0">0</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 在第二个例子里多用户聊天服务只允许在我们的域和其他的服务器上注册了的付费客户访问. 当然管理员也是允许访问房间的. 而且, 他是唯一被授权可以建立并管理房间的. 当admin@example.org发送一个消息，例如‘Tomorrow, the Jabber server will be moved to new hardware. This will involve service breakdowns around 23:00 UMT. We apologise for this inconvenience.’ 给 conference.example.org, 它将被显示在所有激活的房间里. 没有使用 history_size 选项, 这意味着这个功能被激活但缺省值为20个历史消息，将被发送给用户们.
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>acl, paying_customers, <span class="br0">&#123;</span>user, <span class="st0">&quot;customer1&quot;</span>, <span class="st0">&quot;example.net&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>acl, paying_customers, <span class="br0">&#123;</span>user, <span class="st0">&quot;customer2&quot;</span>, <span class="st0">&quot;example.com&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>acl, paying_customers, <span class="br0">&#123;</span>user, <span class="st0">&quot;customer3&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>acl, admin, <span class="br0">&#123;</span>user, <span class="st0">&quot;admin&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>access, muc_admin, <span class="br0">&#91;</span><span class="br0">&#123;</span>allow, admin<span class="br0">&#125;</span>,
                            <span class="br0">&#123;</span>deny, all<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>access, muc_access, <span class="br0">&#91;</span><span class="br0">&#123;</span>allow, paying_customers<span class="br0">&#125;</span>,
                            <span class="br0">&#123;</span>allow, admin<span class="br0">&#125;</span>,
                            <span class="br0">&#123;</span>deny, all<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_muc, <span class="br0">&#91;</span><span class="br0">&#123;</span>access, muc_access<span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>access_create, muc_admin<span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>access_admin, muc_admin<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 在以下例子里, MUC使用了反滥用选项. 一个房客每0.4秒不能发送超过一个消息并且不能超过每4秒之内变更一次出席信息. Room IDs 和 Room Names 的长度被限制为 20 个字符, 而 Room Description 限制为 300 个字符. 没有定义 ACLs, 但一些用户限制可能被加入:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_muc, <span class="br0">&#91;</span><span class="br0">&#123;</span>min_message_interval, <span class="nu0">0.4</span><span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>min_presence_interval, <span class="nu0">4</span><span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>max_room_id, <span class="nu0">20</span><span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>max_room_name, <span class="nu0">20</span><span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>max_room_desc, <span class="nu0">300</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 这个例子展示如何使用 default_room_options 来确保新建房间缺省拥有的选项.
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_muc, <span class="br0">&#91;</span><span class="br0">&#123;</span>access, muc_access<span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>access_create, muc_admin<span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>default_room_options,
                    <span class="br0">&#91;</span>
                     <span class="br0">&#123;</span>allow_change_subj, false<span class="br0">&#125;</span>,
                     <span class="br0">&#123;</span>allow_query_users, true<span class="br0">&#125;</span>,
                     <span class="br0">&#123;</span>allow_private_messages, true<span class="br0">&#125;</span>,
                     <span class="br0">&#123;</span>members_by_default, false<span class="br0">&#125;</span>,
                     <span class="br0">&#123;</span>title, <span class="st0">&quot;New chatroom&quot;</span><span class="br0">&#125;</span>,
                     <span class="br0">&#123;</span>anonymous, false<span class="br0">&#125;</span>
                    <span class="br0">&#93;</span><span class="br0">&#125;</span>,
                   <span class="br0">&#123;</span>access_admin, muc_admin<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_muc_log">mod_muc_log</span></h4>
<p>本模块允许可选的把多用户聊天 (MUC)的公开谈话记录转为HTML. 一旦你激活了这个模块, 用户可以使用有MUC能力的XMPP客户端加入一个房间, 并且如果他们有足够的权限, 他们可以请求一个配置表单来设定配置并允许房间记录.
</p><p>功能:
</p>
<ul><li> 每页顶端加上房间细节: room 称谓, JID, 作者, 标题以及配置.
</li><li> 房间JID 在生成的HTML里是一个链接，可用来加入该房间(使用 <a rel="nofollow" class="external text" href="http://xmpp.org/rfcs/rfc5122.html">XMPP URI</a>).
</li><li> 标题和房间配置变更会被跟踪和显示.
</li><li> 加入, 离开, 修改昵称, 踢人, 拉黑名单和‘/me’被跟踪和显示, 包括原因(如果有).
</li><li> 生成的 HTML 文件是 XHTML 1.0 Transitional 和 CSS 兼容的.
</li><li> 时间戳是自参考的链接.
</li><li> 快速浏览的链接在顶上: 前一天, 下一天, 上.
</li><li> CSS被用于style定义, 可以使用一个自定义的 CSS 文件.
</li><li> 消息和标题里的URLs被转换为超链接.
</li><li> 时间戳上的时区被显示在记录文件里.
</li><li> 可在每一个页的顶部增加一个自定义链接. 
</li></ul>
<p>选项:
</p><p><b>{access_log, AccessName}</b>
</p>
<dl><dd>这个选项限制哪个房客被允许激活和禁止房间记录. 缺省值为 muc_admin. 注意对于为了这个缺省设定生效，你需要有一个用于 muc_admin 的 access rule . 
</dd></dl>
<p><b>{cssfile, false|URL}</b>
</p>
<dl><dd>使用这个选项你可以设置是否该HTML文件应该使用一个自定义的CSS文件或他们需要使用嵌入的CSS文件. 被允许的值有 false 和一个指向某CSS文件的URL. 使用第一个值, HTML文件将包含一个嵌入的CSS代码. 使用后一个, 你可以指定自定义CSS文件的URL (例如: "<a rel="nofollow" class="external free" href="http://example.com/my.css">http://example.com/my.css</a>"). 缺省的值是 false. 
</dd></dl>
<p><b>{dirname, room_jid|room_name}</b>
</p>
<dl><dd>允许配置房间目录的名字. 被允许的值有 room_jid 和 room_name. 使用前者的值, 房间目录名将是完整的房间JID. 使用后者, 房间目录名将只是房间的名字, 不包括 MUC服务名. 缺省值是room_jid. 
</dd></dl>
<p><b>{dirtype, subdirs|plain}</b>
</p>
<dl><dd>新建目录的类型可使用此选项指定. 允许的值有 subdirs 和 plain. 使用前者, 子目录以每年和月新建. 使用后者, 记录文件名包含完整的日期, 并且没有子目录. 缺省值是 subdirs. 
</dd></dl>
<p><b>{file_format, html|plaintext}</b>
</p>
<dl><dd>定义日志文件的格式: html 存储成HTML格式, plaintext 存储成纯文本. 缺省值为 html. 
</dd></dl>
<p><b>{outdir, Path}</b>
</p>
<dl><dd>这个选项是应该被存储的HTML文件的目录的全路径. 确保ejabberd守候进程对那个目录有写权限. 缺省值为 "www/muc". 
</dd></dl>
<p><b>{spam_prevention true|false}</b>
</p>
<dl><dd>为了阻止垃圾, spam_prevention 选项增加了一个特别的属性给链接来阻止它们通过搜索引擎来索引. 缺省值为 true, 它意味着 nofollow 属性将被加到用户提交的链接里. 
</dd></dl>
<p><b>{timezone, local|universal}</b>
</p>
<dl><dd>记录的时区可使用本选项配置. 允许的值有 local 和 universal. 使用前者, 将使用Erlang通过操作系统获得的本地时间. 使用后者, 将使用GMT/UTC 时间. 缺省值为 local. 
</dd></dl>
<p><b>{top_link, {URL, Text}}</b>
</p>
<dl><dd>使用本选项你可以定制化每个日志文件的右上角的链接. 缺省值是 {"/", "Home"}. 
</dd></dl>
<p>例子:
</p>
<ul><li> 在第一个例子里，任何房间所有者能激活记录, 并将使用一个自定义的CSS文件 (<a rel="nofollow" class="external free" href="http://example.com/my.css">http://example.com/my.css</a>). 记录文件的名字将包含完整日期, 并且将没有子目录. 记录文件将被存储在 /var/www/muclogs, 且时区将是GMT/UTC. 最后, 顶端链接将是 &lt;a href="<a rel="nofollow" class="external free" href="http://www.jabber.ru/">http://www.jabber.ru/</a>"&gt;Jabber.ru&lt;/a&gt;.
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>access, muc, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow, all<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_muc_log, <span class="br0">&#91;</span>
                       <span class="br0">&#123;</span>access_log, muc<span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>cssfile, <span class="st0">&quot;http://example.com/my.css&quot;</span><span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>dirtype, plain<span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>dirname, room_jid<span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>outdir, <span class="st0">&quot;/var/www/muclogs&quot;</span><span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>timezone, universal<span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>spam_prevention, true<span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>top_link, <span class="br0">&#123;</span><span class="st0">&quot;http://www.jabber.ru/&quot;</span>, <span class="st0">&quot;Jabber.ru&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>
                      <span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 在第二个例子里只有admin1@example.org和admin2@example.net可以激活记录, 并且将使用嵌入的CSS文件. 记录名将只包含日期(数字), 且每年和月将有子目录. 这个记录文件将被存储在 /var/www/muclogs, 且将使用本地时间. 最后, 顶端链接将是缺省的 &lt;a href="/"&gt;Home&lt;/a&gt;.
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>acl, admins, <span class="br0">&#123;</span>user, <span class="st0">&quot;admin1&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>acl, admins, <span class="br0">&#123;</span>user, <span class="st0">&quot;admin2&quot;</span>, <span class="st0">&quot;example.net&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>access, muc_log, <span class="br0">&#91;</span><span class="br0">&#123;</span>allow, admins<span class="br0">&#125;</span>,
                         <span class="br0">&#123;</span>deny, all<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_muc_log, <span class="br0">&#91;</span>
                       <span class="br0">&#123;</span>access_log, muc_log<span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>cssfile, false<span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>dirtype, subdirs<span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>outdir, <span class="st0">&quot;/var/www/muclogs&quot;</span><span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>timezone, local<span class="br0">&#125;</span>
                      <span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_offline">mod_offline</span></h4>
<p>本模块实现离线消息存储 (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0160.html">XEP-0160</a>). 这意味着所有被发送给一个离线用户的消息将被存储在服务器上直到那个用户再次上线. 所以它非常类似邮件的工作. 注意 ejabberdctl 有一个命令删除过期的消息 (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#ejabberdctl" title="Ejabberd2:安装和操作指南">4.1</a> 节).
</p><p><b>{access_max_user_messages, AccessName}</b>
</p>
<dl><dd>这个选项定义哪个 access rule 将被强迫用来限制一个用户所拥有的离线消息的最大数量(配额). 当一个用户有太多离线消息, 任何收到的新消息将被抛弃, 并且将返回一个 资源约束 错误给发送者. 缺省值为 max_user_offline_messages. 接着你可以用类似max_user_sessions的语法定义一个 access rule (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E7.94.A8ACL.E9.99.90.E5.88.B6.E6.89.93.E5.BC.80.E7.9A.84.E4.BC.9A.E8.AF.9D" title="Ejabberd2:安装和操作指南">3.1.5</a> 节). 
</dd></dl>
<p>这个例子允许强力用户拥有大到 5000 个离线消息, 管理员达到 2000, 所有其他用户达到 100.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>acl, admin, <span class="br0">&#123;</span>user, <span class="st0">&quot;admin1&quot;</span>, <span class="st0">&quot;localhost&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>acl, admin, <span class="br0">&#123;</span>user, <span class="st0">&quot;admin2&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>acl, poweruser, <span class="br0">&#123;</span>user, <span class="st0">&quot;bob&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>acl, poweruser, <span class="br0">&#123;</span>user, <span class="st0">&quot;jane&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
&#160;
<span class="br0">&#123;</span>access, max_user_offline_messages, <span class="re0"><span class="br0">&#91;</span> <span class="br0">&#123;</span><span class="nu0">5000</span>, poweruser<span class="br0">&#125;</span>, <span class="br0">&#123;</span><span class="nu0">2000</span>, admin<span class="br0">&#125;</span>, <span class="br0">&#123;</span><span class="nu0">100</span>, all<span class="br0">&#125;</span> <span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
&#160;
<span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_offline,  <span class="re0"><span class="br0">&#91;</span> <span class="br0">&#123;</span>access_max_user_messages, max_user_offline_messages<span class="br0">&#125;</span> <span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_ping">mod_ping</span></h4>
<p>这个模块实现对XMPP Ping (<a href="/index.php?title=XEP-0199&amp;action=edit&amp;redlink=1" class="new" title="XEP-0199（尚未撰写）">XEP-0199</a>) 和 定期保持连接 的支持. 当本模块激活时，ejabberd正确应答 ping 请求, 如协议所述.
</p><p>配置选项:
</p><p><b>{send_pings, true|false}</b>
</p>
<dl><dd>如果这个选项设为 true, 服务器在一个给定的间隔时间 ping_interval发送 pings 给已连接的不活跃的客户端. 这对于保持活着的客户端连接或检查可用性是有用的. 缺省这个选项是禁止的. 
</dd></dl>
<p><b>{ping_interval, Seconds}</b>
</p>
<dl><dd>多久发送一次 ping 给已连接的用户, 如果前一个选项被激活. 如果一个客户端连接在这个间隔内没有发送或接收任何节, 一个 ping 请求被发送给客户端. 缺省值为60秒. 
</dd></dl>
<p><b>{timeout_action, none|kill}</b>
</p>
<dl><dd>当一个客户端在32秒内不回答一个服务器的ping请求时，服务器做什么. 缺省是什么也不做. 
</dd></dl>
<p>这个例子激活了 Ping 应答, 配置该模块发送 pings 给4分钟内不活跃的客户端连接, 并且如果一个客户端在32秒内不回答 ping , 它的连接将被关闭:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_ping,  <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>send_pings, true<span class="br0">&#125;</span>, <span class="br0">&#123;</span>ping_interval, <span class="nu0">240</span><span class="br0">&#125;</span>, <span class="br0">&#123;</span>timeout_action, kill<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_privacy">mod_privacy</span></h4>
<p>本模块实现定义于<a href="/RFC3921" title="RFC3921">XMPP IM</a>第十章的禁止通讯 (也被称为隐私规则) . 如果最终用户在他们的XMPP客户端也支持它, 他们将能够:
</p>
<ul><li> 收到某人的隐私列表privacy lists.
</li><li> 增加, 删除, 和修改某人的隐私列表privacy lists.
</li><li> 设置, 修改, 或减少激活的列表active lists.
</li><li> 设置, 修改, 或减少缺省列表default list (即, 缺省那个列表是激活的).
</li><li> 允许或禁止消息，基于JID, group, 或 订阅类型subscription type (或全局的).
</li><li> 允许或禁止入站的出席信息通知，基于JID, group, 或 订阅类型subscription type (或全局的).
</li><li> 允许或禁止出站的出席信息通知，基于JID, group, 或 订阅类型subscription type (或全局的).
</li><li> 允许或禁止IQ节，基于JID, group, 或 订阅类型subscription type (或全局的).
</li><li> 允许或禁止所有通讯，基于JID, group, 或 订阅类型subscription type (或全局的).
</li></ul>
<dl><dd>(从 <a rel="nofollow" class="external free" href="http://xmpp.org/rfcs/rfc3921.html#privacy">http://xmpp.org/rfcs/rfc3921.html#privacy</a>) 
</dd></dl>
<p>选项:
</p><p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这为禁止通讯(jabber:iq:privacy) IQ queries (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#iqdisc" title="Ejabberd2:安装和操作指南">3.3.2</a> 节)定义处理原则 .
</dd></dl>
<h4> <span class="mw-headline" id="mod_private">mod_private</span></h4>
<p>本模块增加对私有XML存储(<a href="/index.php?title=XEP-0049&amp;action=edit&amp;redlink=1" class="new" title="XEP-0049（尚未撰写）">XEP-0049</a>)的支持:
</p>
<dl><dd>使用这个方法, XMPP实体能存储私有数据到服务器并在任何必要的时候获得它. 存储的数据可以是任何东西, 只要它是合法的XML. 对这个namespace的一个典型的用法是服务器端存储特定客户端的配置; 另一个是标签存储(<a href="/XEP-0048" title="XEP-0048">XEP-0048</a>). 
</dd></dl>
<p>选项:
</p><p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这为私有XML存储 (jabber:iq:private) IQ queries 定义处理原则(见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#iqdisc" title="Ejabberd2:安装和操作指南">3.3.2</a>).
</dd></dl>
<h4> <span class="mw-headline" id="mod_proxy65">mod_proxy65</span></h4>
<p>本模块实现SOCKS5字节流(<a href="/XEP-0065" title="XEP-0065">XEP-0065</a>). 它允许把ejabberd当作一个在两个XMPP客户端之间的文件传输代理.
选项:
</p><p><b>{host, HostName}</b>
</p>
<dl><dd>这个选项定义该服务的Jabber ID. 如果 host 选项没指定, Jabber ID将是该虚拟主机的hostname加上前缀‘proxy.’. 关键字 "@HOST@" 在启动时被替换为真实的虚拟主机名. 
</dd></dl>
<p><b>{name, Text}</b>
</p>
<dl><dd>定义服务的服务发现名称. 缺省是 "SOCKS5 Bytestreams". 
</dd></dl>
<p><b>{ip, IPTuple}</b>
</p>
<dl><dd>这个选项定义监听哪个网络接口. 缺省是该服务的DNS名解析到的一个IP地址, 或, 如果失败, 则是{127,0,0,1}. 
</dd></dl>
<p><b>{port, Number}</b>
</p>
<dl><dd>这个选项定义监听链入连接的端口. 缺省是 7777. 
</dd></dl>
<p><b>{hostname, HostName}</b>
</p>
<dl><dd>定义一个在建立和客户端的会话时服务声明的hostname. 当你在一个NAT后面运行这个服务的时候这是有用的. 缺省是 ip 选项的值. 例如: "proxy.mydomain.org", "200.150.100.50". 注意在流协商的时候不是所有客户端都懂得域名, 所以在这个选项设定域名时你应该思考两次. 
</dd></dl>
<p><b>{auth_type, anonymous|plain}</b>
</p>
<dl><dd>SOCKS5验证类型. 可能的值有 anonymous 和 plain. 缺省是 anonymous. 
</dd></dl>
<p><b>{access, AccessName}</b>
</p>
<dl><dd>为文件传输发起者定义 ACL. 缺省是 all. 
</dd></dl>
<p><b>{max_connections, Number}</b>
</p>
<dl><dd>每个文件传输的发起者的激活连接的最大数. 缺省不限制. 
</dd></dl>
<p><b>{shaper, none|ShaperName}</b>
</p>
<dl><dd>这个选项为文件传输端定义塑性shaper. 有最大带宽的Shaper将被选择. 缺省是 none. 
</dd></dl>
<p>例子:
</p>
<ul><li> 本模块最简单的配置:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_proxy65, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 更复杂的配置.
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>acl, proxy_users, <span class="br0">&#123;</span>server, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>access, proxy65_access, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow, proxy_users<span class="br0">&#125;</span>, <span class="br0">&#123;</span>deny, all<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>acl, admin, <span class="br0">&#123;</span>user, <span class="st0">&quot;admin&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>shaper, proxyrate, <span class="br0">&#123;</span>maxrate, <span class="nu0">10240</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.&#160;%% <span class="nu0">10</span> Kbytes/sec
      <span class="br0">&#123;</span>access, proxy65_shaper, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>none, admin<span class="br0">&#125;</span>, <span class="br0">&#123;</span>proxyrate, proxy_users<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_proxy65, <span class="br0">&#91;</span><span class="br0">&#123;</span>host, <span class="st0">&quot;proxy1.example.org&quot;</span><span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>name, <span class="st0">&quot;File Transfer Proxy&quot;</span><span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>ip, <span class="br0">&#123;</span><span class="nu0">200</span>,<span class="nu0">150</span>,<span class="nu0">100</span>,<span class="nu0">1</span><span class="br0">&#125;</span><span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>port, <span class="nu0">7778</span><span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>max_connections, <span class="nu0">5</span><span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>access, proxy65_access<span class="br0">&#125;</span>,
                       <span class="br0">&#123;</span>shaper, proxy65_shaper<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_pubsub">mod_pubsub</span></h4>
<p>本模块提供一个发行-订阅 服务 (<a href="/XEP-0060" title="XEP-0060">XEP-0060</a>). 在mod_pubsub里，功能可以使用插件来扩展. 实现PEP (基于Pubsub的个人信息事件) (<a href="/XEP-0163" title="XEP-0163">XEP-0163</a>) 的plugin, 在缺省的 ejabberd 配置文件中是被允许的, 并且它需要 mod_caps.
</p><p>选项:
</p><p><b>{host, HostName}</b>
</p>
<dl><dd>这个选项定义了该服务的Jabber ID. 如果 host 选项没定义, Jabber ID将是该虚拟主机的hostname加上前缀‘pubsub.’. 关键字 "@HOST@" 在启动时被替换成真实的虚拟主机名. 如果你使用了 mod_pubsub_odbc, 请确保前缀只包含一个点dot, 例如‘pubsub.’, 或 ‘publish.’,. 
</dd></dl>
<p><b>{access_createnode, AccessName}</b>
</p>
<dl><dd>这个选项使用 ACL 和 ACCESS来限制哪个用户被允许建立 pubsub 节点. 缺省本地ejabberd服务器的任何帐号被允许新建 pubsub 节点. 
</dd></dl>
<p><b>{max_items_node, MaxItems}</b>
</p>
<dl><dd>定义可被一个节点存储的条目的最大数量. 缺省值为 10. 
</dd></dl>
<p><b>{plugins, [ Plugin, ...]}</b>
</p>
<dl><dd>用于指定plugins使用哪个pubsub节点. 列表的第一个缺省被使用. 如果这个选项没定义, 缺省 plugins 列表为: ["flat"]. PubSub客户端能定义使用哪个plugin，当新建一个节点的时候: 增加 type=’plugin-name’ 属性到这个 create 节元素里. 
</dd></dl>
<p><b>{nodetree, Nodetree}</b>
</p>
<dl><dd>用于指定使用哪个节点树 nodetree. 如果没定义, 缺省使用 pubsub nodetree&#160;: "tree". 每个主机只能使用一个 nodetree , 且被所有节点 plugins 共享.
</dd></dl>
<dl><dd>"virtual" nodetree 不把节点存储在数据库里. 它使用tons of nodes存储资源到系统. 如果使用 "virtual" nodetree, 你只能允许那些节点 plugins: ["flat","pep"] 或 ["flat"]; 任何其他 plugins 配置将不工作. 同时, 所有节点将有缺省配置, 并且不能被修改. 使用 "virtual" nodetree 需要从一个干净的数据库启动, 如果你之前使用了缺省的 "tree" nodetree，它将不工作.
</dd></dl>
<dl><dd>"dag" nodetree 为 PubSub集合节点(<a href="/index.php?title=XEP-0248&amp;action=edit&amp;redlink=1" class="new" title="XEP-0248（尚未撰写）">XEP-0248</a>)提供实验性的支持. 在那种情况下你也应该增加 "dag" 节点 plugin 作为缺省值, 例如: {plugins, ["dag","flat","hometree","pep"]} 
</dd></dl>
<p><b>{ignore_pep_from_offline, false|true}</b>
</p>
<dl><dd>用于指定是否我们应该获取当我们连接时在我们的名册里处于离线状态的联系人的PEP最后发行条目. 值有 true 或 false. 如果不定义, pubsub 假定为 true，所以我们只能获取在线联系人的最后条目. 
</dd></dl>
<p><b>{last_item_cache, false|true}</b>
</p>
<dl><dd>指定是否 pubsub 应该缓存最后条目. 值为 true 或 false. 如果没定义, pubsub不缓存最后条目. 在没有那么多节点的系统上, 缓存最后条目加速了 pubsub 并允许增加用户连接频率. 开销主要是内存使用, 因为每个条目都存储在内存里. 
</dd></dl>
<p><b>{pep_mapping, [ {Key, Value}, ...]}</b>
</p>
<dl><dd>这允许定义一个 键-值 列表来在给定 PEP 名字空间选择定义节点 plugins . 以下例子将为每个拥有 tune namespace的PEP节点使用 node_tune 替代 node_pep&#160;:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>mod_pubsub, <span class="br0">&#91;</span><span class="br0">&#123;</span>pep_mapping, <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;http://jabber.org/protocol/tune&quot;</span>, <span class="st0">&quot;tune&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span></pre></div></div>
<p>配置例子使用 flat 节点作为缺省值, 并允许使用 flat, nodetree 和 pep 节点:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_pubsub, <span class="br0">&#91;</span>
                <span class="br0">&#123;</span>access_createnode, pubsub_createnode<span class="br0">&#125;</span>,
                <span class="br0">&#123;</span>plugins, <span class="br0">&#91;</span><span class="st0">&quot;flat&quot;</span>, <span class="st0">&quot;hometree&quot;</span>, <span class="st0">&quot;pep&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
               <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>使用 ODBC 数据库要求使用重复的plugins. 以下例子展示前一个配置加上 ODBC 之后的用法:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_pubsub_odbc, <span class="br0">&#91;</span>
                <span class="br0">&#123;</span>access_createnode, pubsub_createnode<span class="br0">&#125;</span>,
                <span class="br0">&#123;</span>plugins, <span class="br0">&#91;</span><span class="st0">&quot;flat_odbc&quot;</span>, <span class="st0">&quot;hometree_odbc&quot;</span>, <span class="st0">&quot;pep_odbc&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
               <span class="br0">&#93;</span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_register">mod_register</span></h4>
<p>本模块增加对带内注册(<a href="/XEP-0077" title="XEP-0077">XEP-0077</a>)的支持. 这个协议允许最终用户使用XMPP客户端做:
</p>
<ul><li> 在服务器注册一个新帐号.
</li><li> 在服务器上给一个现有帐号修改密码.
</li><li> 删除一个服务器上的现有帐号. 
</li></ul>
<p>选项:
</p><p><b>{access, AccessName}</b>
</p>
<dl><dd>这个选项可被配置来指定限制注册的 rules. 如果一个 rule 在请求的用户名返回‘deny’, 那个用户名的注册被禁止. (缺省没有限制). 
</dd></dl>
<p><b>{access_from, AccessName}</b>
</p>
<dl><dd>缺省的, ejabberd不允许从s2s或已有的c2s会话注册一个新帐号. 你可以修改它，通过在这个选项定义 access rule. 谨慎使用: 允许从s2s注册会导致流氓用户的不可控的大量帐号注册. 
</dd></dl>
<p><b>{welcome_message, Message}</b>
</p>
<dl><dd>设定一个欢迎信息发送给每一个新注册的帐号. 第一个字符串是标题, 第二个字符串是消息 body. 在body里你可以用字符: \n 设定一个新行
</dd></dl>
<p><b>{registration_watchers, [ JID, ...]}</b>
</p>
<dl><dd>这个选项定义一个 JIDs 列表，每次有人注册新帐号，他们将收到通知. 
</dd></dl>
<p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这为带内注册(jabber:iq:register) IQ queries (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#iqdisc" title="Ejabberd2:安装和操作指南">3.3.2</a> 节)定义处理原则. 
</dd></dl>
<p>这个模块也从服务器读取另一个全局定义的选项: {registration_timeout, Timeout}. 这个选项限制从一个给定IP或用户名发出的注册请求的频率. 所以, 一个用户在前一个注册之后，经过这个数量的秒数之前不能从相同IP地址或JID注册一个新帐号. Timeout被表示为秒数, 并且必须是一个整数. 要禁止此限制, 把整数替换成单词，类似: infinity. 缺省值为: 600 秒.
</p><p>例子:
</p>
<ul><li> 下个例子禁止注册太短的帐号名 prohibits:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>acl, shortname, <span class="br0">&#123;</span>user_glob, <span class="st0">&quot;?&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>acl, shortname, <span class="br0">&#123;</span>user_glob, <span class="st0">&quot;??&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
     &#160;%% The same using regexp:
     &#160;%%<span class="br0">&#123;</span>acl, shortname, <span class="br0">&#123;</span>user_regexp, <span class="st0">&quot;^..?$&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>access, register, <span class="br0">&#91;</span><span class="br0">&#123;</span>deny, shortname<span class="br0">&#125;</span>,
                          <span class="br0">&#123;</span>allow, all<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_register, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>access, register<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 这个配置禁止使用带内注册新建和删除帐号, 但允许现有帐号修改密码:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>access, register, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>deny, all<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_register, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>access, register<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 这个配置禁止所有带内注册功能: 新建, 删除帐号和修改密码:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
       &#160;%% <span class="br0">&#123;</span>mod_register, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>access, register<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 定义一个欢迎信息和两个注册观察者. 也定义一个注册超时为一小时:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>registration_timeout, <span class="nu0">3600</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_register,
         <span class="br0">&#91;</span>
          <span class="br0">&#123;</span>welcome_message, <span class="br0">&#123;</span><span class="st0">&quot;Welcome!&quot;</span>, <span class="st0">&quot;Hi.\nWelcome to this Jabber server.\n Check http://www.jabber.org\n\nBye&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>,
          <span class="br0">&#123;</span>registration_watchers, <span class="br0">&#91;</span><span class="st0">&quot;admin1@example.org&quot;</span>, <span class="st0">&quot;boss@example.net&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
         <span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_roster">mod_roster</span></h4>
<p>本模块实现名册管理，定义于 <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>: <a href="/RFC3921" title="RFC3921">XMPP IM</a>. 也支持 名册版本 (<a href="/index.php?title=XEP-0237&amp;action=edit&amp;redlink=1" class="new" title="XEP-0237（尚未撰写）">XEP-0237</a>).
</p><p>选项:
</p><p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这为名册管理 (jabber:iq:roster) IQ queries (see section [Ejabberd2:安装和操作指南[#iqdisc|3.3.2]] 节) 指定处理原则. 
</dd></dl>
<p><b>{versioning, false|true}</b>
</p>
<dl><dd>激活名册版本. 这个选项缺省是禁止的. 
</dd></dl>
<p><b>{store_current_id, false|true}</b>
</p>
<dl><dd>如果激活这个选项, 当前版本数量被存储在数据库. 如果被禁止, 版本数量在每次飞行计算. 激活这个选项同时减少ejabberd和数据库的负载. 任何情况下这个选项不影响客户端. 该选项只是当允许名册版本时有用. 该选项缺省是被禁止的. 重要: 如果你使用 mod_shared_roster, 你必须禁止这个选项. 
</dd></dl>
<p>这个示例配置允许使用当前id存储的名册版本:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>modules,
 <span class="br0">&#91;</span>
  ...
  <span class="br0">&#123;</span>mod_roster, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>versioning, true<span class="br0">&#125;</span>, <span class="br0">&#123;</span>store_current_id, true<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
  ...
 <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_service_log">mod_service_log</span></h4>
<p>本模块通过一个XMPP消息审计服务，例如Bandersnatch，增加了对最终用户的包进行记录的支持. 所有用户包被封装在一个 &lt;route/&gt; 元素里并发送给一个特定服务(们).
</p><p>选项:
</p><p><b>{loggers, [Names, ...]}</b>
</p>
<dl><dd>使用这个选项可以指定将接收包的一个 (列表之一) 服务(们). 
</dd></dl>
<p>例子s:
</p>
<ul><li> 这是把所有的用户包记录到运行在bandersnatch.example.com的Bandersnatch 服务，:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_service_log, <span class="br0">&#91;</span><span class="br0">&#123;</span>loggers, <span class="br0">&#91;</span><span class="st0">&quot;bandersnatch.example.com&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 这是把所有最终用户的包记录到运行在bandersnatch.example.com的Bandersnatch服务以及运行在bandersnatch.example.org的备份服务上:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_service_log, <span class="br0">&#91;</span><span class="br0">&#123;</span>loggers, <span class="br0">&#91;</span><span class="st0">&quot;bandersnatch.example.com&quot;</span>,
                                      <span class="st0">&quot;bandersnatch.example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_shared_roster">mod_shared_roster</span></h4>
<p>本模块允许你新建共享名册组. 这意味着你可以新建人员组，组里的成员从他们的名册里的其他组也可以看到成员. 这个功能的最大好处是最终用户不需要手工添加所有用户到他们的名册, 并且他们不能永久性地从共享名册组删除用户. 一个共享名册组可拥有来自任何XMPP服务器的成员, 但是出席信息from和to将只在创建该组的相同的虚拟主机的成员之间可用.
</p><p>共享名册组只可以通过Web管理编辑. 每个组有唯一标识符和以下参数:
</p><p><b>Name</b>
</p>
<dl><dd>组名, 它将被显示在名册里. 
</dd></dl>
<p><b>Description</b>
</p>
<dl><dd>组描述. 这个参数不影响任何东西. 
</dd></dl>
<p><b>Members</b>
</p>
<dl><dd>组成员的完整JIDs列表, 在Web管理 里面每行一个. 为了把虚拟主机上的所有注册用户设为成员, 你可以使用特殊的参数: @all@. 注意这个参数被设计用于一个只有几百用户的小服务器. 
</dd></dl>
<p><b>Displayed groups</b>
</p>
<dl><dd>那些成员将出现在名册上的组的列表. 
</dd></dl>
<p>例子:
</p>
<ul><li> 假设一个计算机俱乐部希望它的所有成员在他们的名册里看到所有其他成员. 为了达到这点, 他们需要建立一个共享名册组类似下表: 
</li></ul>
<table border="1" cellspacing="0">
<tr>
<td>Identification </td>
<td>Group ‘club_members’
</td></tr>
<tr>
<td>Name </td>
<td>俱乐部成员
</td></tr>
<tr>
<td>Description </td>
<td>来自计算机俱乐部的成员
</td></tr>
<tr>
<td>Members </td>
<td>
<table border="1" cellspacing="0">
<tr>
<td>member1@example.org
</td></tr>
<tr>
<td>member2@example.org
</td></tr>
<tr>
<td>member3@example.org
</td></tr></table>
</td></tr>
<tr>
<td>Displayed groups </td>
<td>club_members
</td></tr></table>
<ul><li> 在另一个情况下，我们有一个公司，它有三个部门: 管理部, 市场部和销售部. 所有组成员应该在他们的名册里看到其他成员. 另外, 所有经理应该在他们的名册里有所有市场部和销售部的人. 同时, 所有市场人员和全部销售队伍应该看到所有经理. 这个场景可由新建以下共享名册组来达到，如下表所示:
</li></ul>
<table border="1" cellspacing="0">
<tr>
<td>Identification </td>
<td>	 Group ‘management’</td>
<td>Group ‘marketing’</td>
<td>	 Group ‘sales’
</td></tr>
<tr>
<td>Name </td>
<td>管理部 </td>
<td>市场部 </td>
<td>销售部
</td></tr>
<tr>
<td>Description </td>
<td> </td>
<td> </td>
<td>
</td></tr>
<tr>
<td>Members </td>
<td>
<table border="1" cellspacing="0">
<tr>
<td>manager1@example.org
</td></tr>
<tr>
<td>manager2@example.org
</td></tr>
<tr>
<td>manager3@example.org
</td></tr>
<tr>
<td>manager4@example.org
</td></tr></table>
</td>
<td>
<table border="1" cellspacing="0">
<tr>
<td>marketeer1@example.org
</td></tr>
<tr>
<td>marketeer2@example.org
</td></tr>
<tr>
<td>marketeer3@example.org
</td></tr>
<tr>
<td>marketeer4@example.org
</td></tr></table>
</td>
<td>
<table border="1" cellspacing="0">
<tr>
<td>saleswoman1@example.org
</td></tr>
<tr>
<td>salesman1@example.org
</td></tr>
<tr>
<td>saleswoman2@example.org
</td></tr>
<tr>
<td>alesman2@example.org
</td></tr></table>
</td></tr>
<tr>
<td>Displayed groups </td>
<td>
<table border="1" cellspacing="0" width="100%">
<tr>
<td>管理
</td></tr>
<tr>
<td>市场
</td></tr>
<tr>
<td>销售
</td></tr></table>
</td>
<td>
<table border="1" cellspacing="0" width="100%">
<tr>
<td>管理
</td></tr>
<tr>
<td>市场
</td></tr></table>
</td>
<td>
<table border="1" cellspacing="0" width="100%">
<tr>
<td>管理
</td></tr>
<tr>
<td>销售
</td></tr></table>
</td></tr></table>
<h4> <span class="mw-headline" id="mod_sic">mod_sic</span></h4>
<p>本模块增加了对服务器IP检查 (<a href="/index.php?title=XEP-0279&amp;action=edit&amp;redlink=1" class="new" title="XEP-0279（尚未撰写）">XEP-0279</a>)的支持. 这个协议允许客户端发现它的外部IP地址.
</p><p>选项:
</p><p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这为urn:xmpp:sic:0 IQ queries (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#iqdisc" title="Ejabberd2:安装和操作指南">3.3.2</a> 节)定义了处理原则 .
</dd></dl>
<h4> <span class="mw-headline" id="mod_stats">mod_stats</span></h4>
<p>This module adds support for Statistics Gathering (XEP-0039). This protocol allows you to retrieve next statistics from your ejabberd deployment:
</p>
<ul><li> Total number of registered users on the current virtual host (users/total).
</li><li> Total number of registered users on all virtual hosts (users/all-hosts/total).
</li><li> Total number of online users on the current virtual host (users/online).
</li><li> Total number of online users on all virtual hosts (users/all-hosts/online). 
</li></ul>
<p>选项:
</p><p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这为统计信息收集 (<a rel="nofollow" class="external free" href="http://jabber.org/protocol/stats">http://jabber.org/protocol/stats</a>) IQ queries (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#iqdisc" title="Ejabberd2:安装和操作指南">3.3.2</a> 节) 定义了处理原则. 
</dd></dl>
<p>因为只有少量的客户端 (例如 Tkabber) 和软件库支持这个 XEP, 一些例子以 XML 方式给出 ，为了获得统计信息，你需要发送它. 它们是:
</p>
<ul><li> 你可以请求当前虚拟主机 (example.org)的在线用户数量:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="re1">&lt;iq</span> <span class="re0">to</span>=<span class="st0">'example.org'</span> <span class="re0">type</span>=<span class="st0">'get'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/stats'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;stat</span> <span class="re0">name</span>=<span class="st0">'users/online'</span><span class="re2">/&gt;</span>
        <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<ul><li> 你可以请求所有虚拟主机上注册用户的总数量:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>      <span class="re1">&lt;iq</span> <span class="re0">to</span>=<span class="st0">'example.org'</span> <span class="re0">type</span>=<span class="st0">'get'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/stats'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;stat</span> <span class="re0">name</span>=<span class="st0">'users/all-hosts/total'</span><span class="re2">/&gt;</span>
        <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id="mod_time">mod_time</span></h4>
<p>本模块功能支持实体时间 (<a href="/index.php?title=XEP-0202&amp;action=edit&amp;redlink=1" class="new" title="XEP-0202（尚未撰写）">XEP-0202</a>). 通过使用这个 XEP, 你能发现另一个实体所在位置的时间.
</p><p>选项:
</p><p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这为实体时间 (jabber:iq:time) IQ queries (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#iqdisc" title="Ejabberd2:安装和操作指南">3.3.2</a> 节)定义了处理原则 .
</dd></dl>
<h4> <span class="mw-headline" id="mod_vcard">mod_vcard</span></h4>
<p>本模块允许最终用户存储和接收他们的电子名片vCard, 以及接收别的用户的电子名片vCards, 定义于 vcard-temp (<a href="/XEP-0054" title="XEP-0054">XEP-0054</a>). 这个模块也实现了一个基于这些用户的vCards的简单的Jabber用户目录. 进一步的, 当收到请求时它允许服务器发送它自己的名片vCard.
</p><p>选项:
</p><p><b>{host, HostName}</b>
</p>
<dl><dd>这个选项定义该服务的Jabber ID. 如果 host 选项没定义, Jabber ID将是该虚拟主机的hostname加前缀‘vjud.’. 关键字 "@HOST@" 在启动时被替换成真实的虚拟主机名. 
</dd></dl>
<p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这为vcard-temp IQ queries (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#iqdisc" title="Ejabberd2:安装和操作指南">3.3.2</a> 节)定义了处理原则 . 
</dd></dl>
<p><b>{search, true|false}</b>
</p>
<dl><dd>这个选项定义是否允许搜索功能，如果禁止，选项 host 将被忽略，并且 Jabber用户目录服务将不出现在服务发现条目列表里. 缺省值为true. 
</dd></dl>
<p><b>{matches, infinity|Number}</b>
</p>
<dl><dd>使用这个选项, 搜索结果的数量将被限制. 如果这下选项的值设为 infinity, 所有搜索结果被汇报. 缺省值为 30. 
</dd></dl>
<p><b>{allow_return_all, false|true}</b>
</p>
<dl><dd>这个选项允许你指定是否输入字段为空来进行搜索操作应该返回所有已在他们的vCard中加入信息的用户. 缺省值为 false. 
</dd></dl>
<p><b>{search_all_hosts, true|false}</b>
</p>
<dl><dd>如果这个选项设为 true, 搜索操作将应用于所有虚拟主机. 反之只有当前主机将被搜索. 缺省值为 true. 这个选项在 mod_vcard 是可用的, 但是在 mod_vcard_odbc 是不可用的. 
</dd></dl>
<p>例子:
</p>
<ul><li> 在第一种情况下, 搜索结果被限制为20个条目, 当人们做空的搜索时，每个添加了信息到他们的vCard的用户将被列出 , 并且只有当前主机的用户会被返回:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_vcard, <span class="br0">&#91;</span><span class="br0">&#123;</span>search, true<span class="br0">&#125;</span>,
                     <span class="br0">&#123;</span>matches, <span class="nu0">20</span><span class="br0">&#125;</span>,
                     <span class="br0">&#123;</span>allow_return_all, true<span class="br0">&#125;</span>,
                     <span class="br0">&#123;</span>search_all_hosts, false<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 第二种情况不同在于，搜索结果是不限制的, 并且所有虚拟主机将被搜索而不是只有当前主机:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span>mod_vcard, <span class="br0">&#91;</span><span class="br0">&#123;</span>search, true<span class="br0">&#125;</span>,
                     <span class="br0">&#123;</span>matches, infinity<span class="br0">&#125;</span>,
                     <span class="br0">&#123;</span>allow_return_all, true<span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h4> <span class="mw-headline" id="mod_vcard_ldap">mod_vcard_ldap</span></h4>
<p>ejabberd能映射LDAP属性到vCard字段. 这个行为在 mod_vcard_ldap 模块实现. 本模块不依赖于验证方法 (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#LDAP" title="Ejabberd2:安装和操作指南">3.2.5</a> 节).
</p><p>经常的 ejabberd 对待 LDAP 像一个只读存储器: 它可能查看数据, 但是不能新建帐号或编辑存储在LDAP里的 vCard. 无论如何, 修改密码是可能的，如果 mod_register 模块激活了并且 LDAP 服务器支持 <a rel="nofollow" class="external text" href="http://tools.ietf.org/html/rfc3062">RFC 3062</a>.
</p><p>mod_vcard_ldap模块有它自己的可选参数. 第一组参数和设定验证方法时的顶极LDAP参数含义相同: ldap_servers, ldap_port, ldap_rootdn, ldap_password, ldap_base, ldap_uids, and ldap_filter. 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#LDAP" title="Ejabberd2:安装和操作指南">3.2.5</a> 节查看关于这些选项的详细信息. 如果这些选项中的一个没有设置, ejabberd将以相同哦功能名字查找顶极选项.
</p><p>第二组参数包括以下的 mod_vcard_ldap-专有 选项:
</p><p><b>{host, HostName}</b>
</p>
<dl><dd>这个选项定义该服务的Jabber ID. 如果 host 选项没定义, Jabber ID将是该虚拟主机的hostname加上前缀‘vjud.’. 关键字 "@HOST@" 在启动时被替换成真实的虚拟主机名. 
</dd></dl>
<p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这为 vcard-temp IQ queries (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#iqdisc" title="Ejabberd2:安装和操作指南">3.3.2</a> 节)定义了处理原则 . 
</dd></dl>
<p><b>{search, true|false}</b>
</p>
<dl><dd>这个选项指定是否搜索功能被允许(值: true) 或禁止(值: false). 如果禁止, 选项 host 将被忽略，并且Jabber用户目录服务将不出现在服务发现条目列表里. 缺省值为 true. 
</dd></dl>
<p><b>{matches, infinity|Number}</b>
</p>
<dl><dd>使用这个选项, 搜索结果的数量被限制. 如果该选项值设为 infinity, 所有结果被汇报. 缺省值为 30. 
</dd></dl>
<p><b>{ldap_vcard_map, [ {Name, Pattern, LDAPattributes}, ...]}</b>
</p>
<dl><dd>使用此选项，你可以设置一个表，映射LDAP属性到vCard字段. Name是 vCard 的类型名，定义于 <a rel="nofollow" class="external text" href="http://tools.ietf.org/html/rfc2426">RFC 2426</a>. Pattern是一个字符串，包含 pattern 变量 "%u", "%d" 或 "%s". LDAPattributes 是包含LDAP属性的列表. pattern变量 "%s" 将被从 List_of_LDAP_attributes顺序替换成 LDAP 属性值, "%u" 将被替换成一个JID的user部分, 而"%d" 将被替换成一个JID的domain部分. 缺省为:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;NICKNAME&quot;</span>, <span class="st0">&quot;%u&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;FN&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;displayName&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;LAST&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;sn&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;FIRST&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;givenName&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;MIDDLE&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;initials&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;ORGNAME&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;o&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;ORGUNIT&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;ou&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;CTRY&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;c&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;LOCALITY&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;l&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;STREET&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;street&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;REGION&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;st&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;PCODE&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;postalCode&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;TITLE&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;title&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;URL&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;labeleduri&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;DESC&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;description&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;TEL&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;telephoneNumber&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;EMAIL&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;mail&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;BDAY&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;birthDay&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;ROLE&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;employeeType&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;PHOTO&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;jpegPhoto&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span></pre></div></div>
<p><b>{ldap_search_fields, [ {Name, Attribute}, ...]}</b>
</p>
<dl><dd>这个选项定义搜索表单和参与搜索的LDAP属性. Name 是搜索表单字段的名字，它将使用翻译文件自动翻译 (查看 msgs/*.msg 找寻可用的单词). Attribute 是LDAP属性或 pattern "%u". 缺省值是:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;User&quot;</span>, <span class="st0">&quot;%u&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Full Name&quot;</span>, <span class="st0">&quot;displayName&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Given Name&quot;</span>, <span class="st0">&quot;givenName&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Middle Name&quot;</span>, <span class="st0">&quot;initials&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Family Name&quot;</span>, <span class="st0">&quot;sn&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Nickname&quot;</span>, <span class="st0">&quot;%u&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Birthday&quot;</span>, <span class="st0">&quot;birthDay&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Country&quot;</span>, <span class="st0">&quot;c&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;City&quot;</span>, <span class="st0">&quot;l&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Email&quot;</span>, <span class="st0">&quot;mail&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Organization Name&quot;</span>, <span class="st0">&quot;o&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Organization Unit&quot;</span>, <span class="st0">&quot;ou&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span></pre></div></div>
<p><b>{ldap_search_reported, [ {SearchField, VcardField}, ...]}</b>
</p>
<dl><dd>这个选项定义哪个搜索字段应该汇报. SearchField 是一个搜索表单的字段名，它将使用翻译文件自动翻译 (去 msgs/*.msg 查看可用的单词). VcardField 是vCard 字段名，定义于 ldap_vcard_map 选项. 缺省为:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>    <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;Full Name&quot;</span>, <span class="st0">&quot;FN&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Given Name&quot;</span>, <span class="st0">&quot;FIRST&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Middle Name&quot;</span>, <span class="st0">&quot;MIDDLE&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Family Name&quot;</span>, <span class="st0">&quot;LAST&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Nickname&quot;</span>, <span class="st0">&quot;NICKNAME&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Birthday&quot;</span>, <span class="st0">&quot;BDAY&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Country&quot;</span>, <span class="st0">&quot;CTRY&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;City&quot;</span>, <span class="st0">&quot;LOCALITY&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Email&quot;</span>, <span class="st0">&quot;EMAIL&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Organization Name&quot;</span>, <span class="st0">&quot;ORGNAME&quot;</span><span class="br0">&#125;</span>,
     <span class="br0">&#123;</span><span class="st0">&quot;Organization Unit&quot;</span>, <span class="st0">&quot;ORGUNIT&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span></pre></div></div>
<p>例子:
</p>
<ul><li> 假设 ldap.example.org 是我们的一个LDAP服务器的名字. 我们有用户，他们的密码在 "ou=Users,dc=example,dc=org" 目录. 同时我们也有地址簿 addressbook, 它包含用户的 emails 和他们的其他信息， 在 "ou=AddressBook,dc=example,dc=org" 目录. 相应的验证节应该看起来是这样:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>     &#160;%% 验证方法
      <span class="br0">&#123;</span>auth_method, ldap<span class="br0">&#125;</span>.
     &#160;%% 我们的LDAP服务器的DNS名
      <span class="br0">&#123;</span>ldap_servers, <span class="br0">&#91;</span><span class="st0">&quot;ldap.example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
     &#160;%% 我们想授权的用户仅为 'shadowAccount' object class
      <span class="br0">&#123;</span>ldap_filter, <span class="st0">&quot;(objectClass=shadowAccount)&quot;</span><span class="br0">&#125;</span>.</pre></div></div>
<dl><dt>现在我们想使用用户的 LDAP-信息 作为他们的 vCards. 我们在我们的 LDAP schema定义了四个属性</dt><dd> "mail" — emai地址, "givenName" — 名, "sn" — 姓, "birthDay" — 生日. 我们也想用户搜索到每个其他人. 让我们看一下如何设置:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>modules,
        ...
        <span class="br0">&#123;</span>mod_vcard_ldap,
         <span class="br0">&#91;</span>
         &#160;%% We use the same server and port, but want to bind anonymously because
         &#160;%% our LDAP server accepts anonymous requests to
         &#160;%% <span class="st0">&quot;ou=AddressBook,dc=example,dc=org&quot;</span> subtree.
          <span class="br0">&#123;</span>ldap_rootdn, <span class="st0">&quot;&quot;</span><span class="br0">&#125;</span>,
          <span class="br0">&#123;</span>ldap_password, <span class="st0">&quot;&quot;</span><span class="br0">&#125;</span>,
         &#160;%% define the addressbook's base
          <span class="br0">&#123;</span>ldap_base, <span class="st0">&quot;ou=AddressBook,dc=example,dc=org&quot;</span><span class="br0">&#125;</span>,
         &#160;%% uidattr: user's part of JID is located in the <span class="st0">&quot;mail&quot;</span> attribute
         &#160;%% uidattr_format: common format for our emails
          <span class="br0">&#123;</span>ldap_uids, <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;mail&quot;</span>,<span class="st0">&quot;%u@mail.example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
         &#160;%% We have to define empty filter here, because entries in addressbook does not
         &#160;%% belong to shadowAccount object class
          <span class="br0">&#123;</span>ldap_filter, <span class="st0">&quot;&quot;</span><span class="br0">&#125;</span>,
         &#160;%% Now we want to define vCard pattern
          <span class="br0">&#123;</span>ldap_vcard_map,
           <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;NICKNAME&quot;</span>, <span class="st0">&quot;%u&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,&#160;% just use user's part of JID as his nickname
            <span class="br0">&#123;</span><span class="st0">&quot;FIRST&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;givenName&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="st0">&quot;LAST&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;sn&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="st0">&quot;FN&quot;</span>, <span class="st0">&quot;%s,&#160;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;sn&quot;</span>, <span class="st0">&quot;givenName&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,&#160;% example: <span class="st0">&quot;Smith, John&quot;</span>
            <span class="br0">&#123;</span><span class="st0">&quot;EMAIL&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;mail&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="st0">&quot;BDAY&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;birthDay&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
         &#160;%% Search form
          <span class="br0">&#123;</span>ldap_search_fields,
           <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;User&quot;</span>, <span class="st0">&quot;%u&quot;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="st0">&quot;Name&quot;</span>, <span class="st0">&quot;givenName&quot;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="st0">&quot;Family Name&quot;</span>, <span class="st0">&quot;sn&quot;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="st0">&quot;Email&quot;</span>, <span class="st0">&quot;mail&quot;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="st0">&quot;Birthday&quot;</span>, <span class="st0">&quot;birthDay&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
         &#160;%% vCard fields to be reported
         &#160;%% Note that JID is always returned with search results
          <span class="br0">&#123;</span>ldap_search_reported,
           <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;Full Name&quot;</span>, <span class="st0">&quot;FN&quot;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="st0">&quot;Nickname&quot;</span>, <span class="st0">&quot;NICKNAME&quot;</span><span class="br0">&#125;</span>,
            <span class="br0">&#123;</span><span class="st0">&quot;Birthday&quot;</span>, <span class="st0">&quot;BDAY&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
        <span class="br0">&#93;</span><span class="br0">&#125;</span>
        ...
      <span class="br0">&#125;</span>.</pre></div></div>
<dl><dd>注意 mod_vcard_ldap 模块在LDAP搜索用户的信息之前会先检查用户是否存在.
</dd></dl>
<ul><li> ldap_vcard_map 例子:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>ldap_vcard_map,
       <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;NICKNAME&quot;</span>, <span class="st0">&quot;%u&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span><span class="st0">&quot;FN&quot;</span>, <span class="st0">&quot;%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;displayName&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span><span class="st0">&quot;CTRY&quot;</span>, <span class="st0">&quot;Russia&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span><span class="st0">&quot;EMAIL&quot;</span>, <span class="st0">&quot;%u@%d&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span><span class="st0">&quot;DESC&quot;</span>, <span class="st0">&quot;%s\n%s&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;title&quot;</span>, <span class="st0">&quot;description&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
       <span class="br0">&#93;</span><span class="br0">&#125;</span>,</pre></div></div>
<ul><li> ldap_search_fields 例子:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>ldap_search_fields,
       <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;User&quot;</span>, <span class="st0">&quot;uid&quot;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span><span class="st0">&quot;Full Name&quot;</span>, <span class="st0">&quot;displayName&quot;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span><span class="st0">&quot;Email&quot;</span>, <span class="st0">&quot;mail&quot;</span><span class="br0">&#125;</span>
       <span class="br0">&#93;</span><span class="br0">&#125;</span>,</pre></div></div>
<ul><li> ldap_search_reported 例子:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>ldap_search_reported,
       <span class="br0">&#91;</span><span class="br0">&#123;</span><span class="st0">&quot;Full Name&quot;</span>, <span class="st0">&quot;FN&quot;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span><span class="st0">&quot;Email&quot;</span>, <span class="st0">&quot;EMAIL&quot;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span><span class="st0">&quot;Birthday&quot;</span>, <span class="st0">&quot;BDAY&quot;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span><span class="st0">&quot;Nickname&quot;</span>, <span class="st0">&quot;NICKNAME&quot;</span><span class="br0">&#125;</span>
       <span class="br0">&#93;</span><span class="br0">&#125;</span>,</pre></div></div>
<h4> <span class="mw-headline" id="mod_vcard_xupdate">mod_vcard_xupdate</span></h4>
<p>用户的客户端能在该用户的vCard存储一个头像. 基于vCard的头像 协议 (<a href="/XEP-0153" title="XEP-0153">XEP-0153</a>) 提供了一个方法给客户端来通知联系人他的头像的哈希值. 然而, 简单或小的客户端可能没有实现那个协议.
</p><p>如果本模块被激活, 所有出站的客户端出席信息节代替客户端自动获得头像哈希值. 所以, 联系人收到这个带有更新数据的出席信息节(见 <a href="/XEP-0153" title="XEP-0153">XEP-0153</a>)，就好像客户端自己把它插入进去的一样. 如果客户端已经在出席信息节里包含了这样的元素, 它被替换成 ejabberd 生成的元素.
</p><p>通过激活本模块, 每次 vCard 修改就重新进行一次哈希值计算, 每个由客户端发送的出席信息导致一次哈希值接收，以及一次出席信息节的重写. 因此, 激活本模块将在服务器发生一些计算开销，如果客户端频繁修改他们的出席信息的话.
</p>
<h4> <span class="mw-headline" id="mod_version">mod_version</span></h4>
<p>本模块实现软件版本(<a href="/index.php?title=XEP-0092&amp;action=edit&amp;redlink=1" class="new" title="XEP-0092（尚未撰写）">XEP-0092</a>). 所以, 当被查询时它应答 ejabberd 的版本.
</p><p>选项:
</p><p><b>{show_os, true|false}</b>
</p>
<dl><dd>是否应该显示操作系统. 缺省值是 true. 
</dd></dl>
<p><b>{iqdisc, Discipline}</b>
</p>
<dl><dd>这为软件版本(jabber:iq:version) IQ queries (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#iqdisc" title="Ejabberd2:安装和操作指南">3.3.2</a> 节)定义了处理原则 .
</dd></dl>
<h2> <span class="mw-headline" id=".E7.AE.A1.E7.90.86ejabberd.E6.9C.8D.E5.8A.A1.E5.99.A8">管理ejabberd服务器</span></h2>
<h3> <span class="mw-headline" id="ejabberdctl">ejabberdctl</span></h3>
<p>使用ejabberdctl命令行管理脚本，你可以执行ejabberdctl命令(详见下一节, <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#ejabberdctl.E5.91.BD.E4.BB.A4" title="Ejabberd2:安装和操作指南">4.1.1</a>) 和一些普通的 ejabberd 命令 (详见 [[<a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#ejabberd.E5.91.BD.E4.BB.A4" title="Ejabberd2:安装和操作指南">4.2</a>). 这意味着你可以在一个本地或远程ejabberd服务器(通过提供参数 --node NODENAME)上启动，停止以及执行一些其他的管理任务.
</p><p>ejabberdctl脚本可在文件 ejabberdctl.cfg 里配置. 这个文件包含每个可配置的选项的详细的信息. 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#Erlang.E8.BF.90.E8.A1.8C.E6.97.B6.E7.B3.BB.E7.BB.9F" title="Ejabberd2:安装和操作指南">4.1.2</a> 节.
</p><p>ejabberdctl脚本返回数字状态码. 成功显示为 0, 错误显示为 1, 其它码可被用于特定结果. 这可以由其他脚本使用，来自动决定一个命令是否成功, 例如使用: echo $?
</p>
<h4> <span class="mw-headline" id="ejabberdctl.E5.91.BD.E4.BB.A4">ejabberdctl命令</span></h4>
<p>不带任何参数执行 ejabberdctl时, 它显示可用的选项. 如果没有一个 ejabberd 服务器在运行, 可用的参数是:
</p><p><b>start</b>
</p>
<dl><dd>以后台模式启动ejabberd. 这是缺省方法. 
</dd></dl>
<p><b>debug</b>
</p>
<dl><dd>连接一个 Erlang shell 到一个已存在的 ejabberd 服务器. 这允许在ejabberd服务器上执行交互命令. 
</dd></dl>
<p><b>live</b>
</p>
<dl><dd>以live模式启动 ejabberd: shell 保持连接到已启动的服务器, 显示日志信息并允许执行交互命令. 
</dd></dl>
<p>如果已经有一个ejabberd服务器在系统里运行, ejabberdctl 展示以下 ejabberdctl 命令以及那台服务器上所有可用的 ejabberd 命令 (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#ejabberd.E5.91.BD.E4.BB.A4" title="Ejabberd2:安装和操作指南">4.2.1</a> 节).
</p><p>ejabberdctl命令如下:
</p><p><b>help</b>
</p>
<dl><dd>获得关于ejabberdctl或任何可用的命令的帮助. 试下 ejabberdctl help help. 
</dd></dl>
<p><b>status</b>
</p>
<dl><dd>检查ejabberd服务器的状态. 
</dd></dl>
<p><b>stop</b>
</p>
<dl><dd>停止ejabberd服务器. 
</dd></dl>
<p><b>restart</b>
</p>
<dl><dd>重启ejabberd服务器. 
</dd></dl>
<p><b>mnesia</b>
</p>
<dl><dd>获得关于Mnesia数据库的信息. 
</dd></dl>
<p>ejabberdctl脚本可被限制为需要验证并执行一些 ejabberd命令; 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E7.94.A8AccessCommands.E9.99.90.E5.88.B6.E6.89.A7.E8.A1.8C" title="Ejabberd2:安装和操作指南">4.2.2</a> 节. 增加这个选项到文件 ejabberd.cfg. 在这个例子没有限制:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>ejabberdctl_access_commands, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>如果账号 robot1@example.org 被注册到 ejabberd ，以密码 abcdef (使用 MD5 为 E8B501798950FC58AAD83C8C14978E), 并且 ejabberd.cfg 包含以下设定:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>acl, bots, <span class="br0">&#123;</span>user, <span class="st0">&quot;robot1&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>access, ctlaccess, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow, bots<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>ejabberdctl_access_commands, <span class="re0"><span class="br0">&#91;</span> <span class="br0">&#123;</span>ctlaccess, <span class="br0">&#91;</span>registered_users, register<span class="br0">&#93;</span>, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span> <span class="br0">&#93;</span></span><span class="br0">&#125;</span>.</pre></div></div>
<p>那么你可以在 shell 里做这个:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>$ ejabberdctl registered_users example.org
Error: no_auth_provided
$ ejabberdctl <span class="re5">--auth</span> robot1 example.org E8B501798950FC58AAD83C8C14978E registered_users example.org
robot1
testuser1
testuser2</pre></div></div>
<h4> <span class="mw-headline" id="Erlang.E8.BF.90.E8.A1.8C.E6.97.B6.E7.B3.BB.E7.BB.9F">Erlang运行时系统</span></h4>
<p>ejabberd是一个 Erlang/OTP 应用，运行在一个Erlang运行时系统内部. 这个系统是用环境变量和命令行参数来配置的. ejabberdctl管理脚本可能会使用其中的一些. 你可以在ejabberdctl.cfg文件里配置其中的一部分, 里面已包含了关于它们的详细描述. 本节描述所有环境变量和命令行参数的参考.
</p><p>环境变量:
</p><p><b>EJABBERD_CONFIG_PATH</b>
</p>
<dl><dd>ejabberd配置文件的路径. 
</dd></dl>
<p><b>EJABBERD_MSGS_PATH</b>
</p>
<dl><dd>翻译字符串的目录路径. 
</dd></dl>
<p><b>EJABBERD_LOG_PATH</b>
</p>
<dl><dd>ejabberd服务日志文件的路径. 
</dd></dl>
<p><b>EJABBERD_SO_PATH</b>
</p>
<dl><dd>二进制系统库的目录路径. 
</dd></dl>
<p><b>EJABBERD_DOC_PATH</b>
</p>
<dl><dd>ejabberd文档的目录路径. 
</dd></dl>
<p><b>EJABBERD_PID_PATH</b>
</p>
<dl><dd>ejabberd启动时建立的PID文件的路径. 
</dd></dl>
<p><b>HOME</b>
</p>
<dl><dd>ejabberd的家Home目录的路径. 这个路径用于读取文件 .erlang.cookie. 
</dd></dl>
<p><b>ERL_CRASH_DUMP</b>
</p>
<dl><dd>崩溃报告dump文件的路径. 
</dd></dl>
<p><b>ERL_INETRC</b>
</p>
<dl><dd>指示使用名字解析的哪个IP. 如果使用 -sname, 要么指定这个选项，要么指定 -kernel inetrc filepath. 
</dd></dl>
<p><b>ERL_MAX_PORTS</b>
</p>
<dl><dd>并发开放的Erlang端口的最大数量. 
</dd></dl>
<p><b>ERL_MAX_ETS_TABLES</b>
</p>
<dl><dd>ETS和Mnesia表的最大数量. 
</dd></dl>
<p>命令行参数:
</p><p><b>-sname ejabberd</b>
</p>
<dl><dd>这个Erlang节点将只使用主机名的第一部分来指定, 即，本域之外的其他Erlang节点不能够联系联络这个节点. 在大多数情况下这是可取的. 
</dd></dl>
<p><b>-name ejabberd</b>
</p>
<dl><dd>这个Erlang节点将被完全指定. 这只在如果你计划在不同的网络配置一个ejabberd集群时有用. 
</dd></dl>
<p><b>-kernel inetrc ’"/etc/ejabberd/inetrc"’</b>
</p>
<dl><dd>指出使用名字解析的哪个IP. 如果使用 -sname, 要么指定这个选项，要么指定 ERL_INETRC. 
</dd></dl>
<p><b>-kernel inet_dist_listen_min 4200 inet_dist_listen_min 4210</b>
</p>
<dl><dd>定义 epmd ( <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#epmd" title="Ejabberd2:安装和操作指南">5.2</a> 节)可以监听的第一个和最后一个端口. 
</dd></dl>
<p><b>-detached</b>
</p>
<dl><dd>启动Erlang系统并从系统控制台分离. 运行守护进程和后台进程时有用. 
</dd></dl>
<p><b>-noinput</b>
</p>
<dl><dd>确保Erlang系统不尝试读任何输入. 运行守护进程和后台进程时有用. 
</dd></dl>
<p><b>-pa /var/lib/ejabberd/ebin</b>
</p>
<dl><dd>指定Erlang二进制文件(*.beam)所在目录. 
</dd></dl>
<p><b>-s ejabberd</b>
</p>
<dl><dd>告诉Erlang运行时系统启动ejabberd应用. 
</dd></dl>
<p><b>-mnesia dir ’"/var/lib/ejabberd/"’</b>
</p>
<dl><dd>指定Mnesia数据库目录. 
</dd></dl>
<p><b>-sasl sasl_error_logger {file, "/var/log/ejabberd/erlang.log"}</b>
</p>
<dl><dd>Erlang/OTP系统日志文件的路径. 这里SASL意味着 系统架构支持库“System Architecture Support Libraries” 而不是 简单验证和安全层 “Simple Authentication and Security Layer”. 
</dd></dl>
<p><b>+K [true|false]</b>
</p>
<dl><dd>内核轮询. 
</dd></dl>
<p><b>-smp [auto|enable|disable]</b>
</p>
<dl><dd>SMP(多CPU)支持. 
</dd></dl>
<p><b>+P 250000</b>
</p>
<dl><dd>Erlang进程的最大数量. 
</dd></dl>
<p><b>-remsh ejabberd@localhost</b>
</p>
<dl><dd>在一个远程Erlang节点打开一个Erlang shell. 
</dd></dl>
<p><b>-hidden</b>
</p>
<dl><dd>到其他节点的连接是隐藏的(没有公开发布). 结果是这个节点不被认为是集群的一部分. 当启动一个临时的ctl或debug节点的时候这是很重要的. 
</dd></dl>
<p>注意当使用shell脚本的时候一些字符需要逃逸, 例如 " 和 {}. 你可在Erlang手册页 (erl -man erl)找到其他选项.
</p>
<h3> <span class="mw-headline" id="ejabberd.E5.91.BD.E4.BB.A4">ejabberd命令</span></h3>
<p>一个ejabberd命令是一个通过名字指定的抽象函数, 在ejabberd_commands 服务里注册并有一个已定义的编号和出入和输出类型. 那些命令能被定义在任何Erlang模块并使用任何合法的前端执行.
</p><p>ejabberd包含一个前端用来执行ejabberd命令: 脚本ejabberdctl. 其他可被安装以不同方式来执行ejabberd命令的已知的前端有: ejabberd_xmlrpc (XML-RPC 服务), mod_rest (HTTP POST 服务), mod_shcommands (ejabberd WebAdmin 页面).
</p>
<h4> <span class="mw-headline" id="ejabberd.E5.91.BD.E4.BB.A4.E6.B8.85.E5.8D.95">ejabberd命令清单</span></h4>
<p>ejabberd缺省包含了一些ejabberd命令. 当更多模块被安装, 在前端又会有新命令可以用.
</p><p>获得可用命令和它们的帮助的最容易的方法, 是使用ejabberdctl脚本:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>$ ejabberdctl <span class="kw3">help</span>
Usage: ejabberdctl <span class="br0">&#91;</span>--node nodename<span class="br0">&#93;</span> <span class="br0">&#91;</span>--auth user host password<span class="br0">&#93;</span> <span class="kw3">command</span> <span class="br0">&#91;</span>options<span class="br0">&#93;</span>
&#160;
Available commands <span class="kw1">in</span> this ejabberd node:
  backup <span class="kw2">file</span>                  Store the database to backup <span class="kw2">file</span>
  connected_users              List all established sessions
  connected_users_number       Get the number of established sessions
  ...</pre></div></div>
<p>最多人感兴趣的是:
</p><p><b>reopen_log</b>
</p>
<dl><dd>在日志文件改名之后重新打开它们. 如果在调用此命令之前旧文件没有被改名, 它们自动改名为 "*-old.log". 见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E6.97.A5.E5.BF.97.E6.96.87.E4.BB.B6" title="Ejabberd2:安装和操作指南">7.1</a> 节. 
</dd></dl>
<p><b>backup ejabberd.backup</b>
</p>
<dl><dd>存储内部的 Mnesia 数据库到一个二进制备份文件. 
</dd></dl>
<p><b>restore ejabberd.backup</b>
</p>
<dl><dd>立刻从一个二进制文件恢复内部的 Mnesia 数据库. 如果你有一个很大的数据库，这将消耗很多内存, 所以最好使用 install_fallback. 
</dd></dl>
<p><b>install_fallback ejabberd.backup</b>
</p>
<dl><dd>安装成fallback的二进制备份文件: 它将在下一次ejabberd启动的时候被用于恢复数据库. 这意味着, 在运行这个命令之后, 你不得不重启 ejabberd. 这个命令比restore需要更少的内存. 
</dd></dl>
<p><b>dump ejabberd.dump</b>
</p>
<dl><dd>Dump内部的 Mnesia 数据库到一个文本文件 dump. 
</dd></dl>
<p><b>load ejabberd.dump</b>
</p>
<dl><dd>立刻从一个文本文件dump恢复. 这不建议用于大数据库, 因为它将消耗很多时间, 内存和cpu. 在那种情况下，它适合使用 backup 和 install_fallback. 
</dd></dl>
<p><b>import_piefxis, export_piefxis, export_piefxis_host</b>
</p>
<dl><dd>这些选项可被用于迁移帐户，使用 <a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0227.html">XEP-0227</a> 格式的 XML文件 从/到 另外一个 Jabber/XMPP 服务器或转移一个虚拟主机的用户到另一个 ejabberd 安装环境. 也见于 <a rel="nofollow" class="external text" href="https://support.process-one.net/doc/display/MESSENGER/ejabberd+migration+kit">ejabberd迁移工具</a>. 
</dd></dl>
<p><b>import_file, import_dir</b>
</p>
<dl><dd>这些选项可被用于迁移使用jabberd1.4格式的XML文件的帐户, 从其他 Jabber/XMPP 服务器. 已经有 <a rel="nofollow" class="external text" href="http://www.ejabberd.im/migrate-to-ejabberd">从其他软件迁移到ejabberd</a>的教程. 
</dd></dl>
<p><b>delete_expired_messages</b>
</p>
<dl><dd>这个选项可被用于删除旧的离线消息. 当离线消息数量非常高的时候有用. 
</dd></dl>
<p><b>delete_old_messages days</b>
</p>
<dl><dd>删除指定天数之前的离线消息. 
</dd></dl>
<p><b>register user host password</b>
</p>
<dl><dd>在那个域以给定的密码注册一个帐号. 
</dd></dl>
<p><b>unregister user host</b>
</p>
<dl><dd>注销给定帐号.
</dd></dl>
<h4> <span class="mw-headline" id=".E4.BB.A5AccessCommands.E9.99.90.E5.88.B6.E6.89.A7.E8.A1.8C">以AccessCommands限制执行</span></h4>
<p>前端可能被配置成限制访问特定的命令. 在那种情况下, 必须提供验证信息. 在每个前端，AccessCommands 选项被定义在不同的地方. 但是所有情况下这个选项的语法都是相同的:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="re1">AccessCommands</span> <span class="sy0">=</span><span class="re2"> <span class="re0"><span class="br0">&#91;</span> <span class="br0">&#123;</span>Access, CommandNames, Arguments<span class="br0">&#125;</span>, ...<span class="br0">&#93;</span></span></span>
<span class="re1">Access</span> <span class="sy0">=</span><span class="re2"> atom<span class="br0">&#40;</span><span class="br0">&#41;</span></span>
<span class="re1">CommandNames</span> <span class="sy0">=</span><span class="re2"> all | <span class="re0"><span class="br0">&#91;</span>CommandName<span class="br0">&#93;</span></span></span>
<span class="re1">CommandName</span> <span class="sy0">=</span><span class="re2"> atom<span class="br0">&#40;</span><span class="br0">&#41;</span></span>
<span class="re1">Arguments</span> <span class="sy0">=</span><span class="re2"> <span class="re0"><span class="br0">&#91;</span> <span class="br0">&#123;</span>ArgumentName, ArgumentValue<span class="br0">&#125;</span>, ...<span class="br0">&#93;</span></span></span>
<span class="re1">ArgumentName</span> <span class="sy0">=</span><span class="re2"> atom<span class="br0">&#40;</span><span class="br0">&#41;</span></span>
<span class="re1">ArgumentValue</span> <span class="sy0">=</span><span class="re2"> any<span class="br0">&#40;</span><span class="br0">&#41;</span></span></pre></div></div>
<p>缺省值是不定义任何限制: []. 当执行一个命令时提供验证信息, 为一个被允许执行相应命令的本地XMPP帐号的 Username, Hostname 和 Password . 这意味着这个帐号必须在本地ejabberd已经注册, 因为这个信息将被验证. 可能提供纯文本密码或它的 MD5 哈希值.
</p><p>当定义了一个或多个访问限制，并且提供了验证信息, 每个限制被验证直到某人完全符合: 这个帐号和 Access rule匹配, 命令名字列于 CommandNames 之中, 并且提供的参数和Arguments不抵触.
</p><p>以下例子用来理解这个语法, 让我们假设那些选项:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>acl, bots, <span class="br0">&#123;</span>user, <span class="st0">&quot;robot1&quot;</span>, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>access, commaccess, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow, bots<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.</pre></div></div>
<p>访问限制的列表只允许 robot1@example.org 执行所有命令:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>commaccess, all, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#93;</span></span></pre></div></div>
<p>看看另一个限制列表 (相应的 ACL 和 ACCESS 没有显式):
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#91;</span>
 %% 这个 bot 能执行所有命令:
 <span class="br0">&#123;</span>bot, all, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
 %% 这个 bot 只能执行命令 'dump'. 不限制参数:
 <span class="br0">&#123;</span>bot_backups, <span class="re0"><span class="br0">&#91;</span>dump<span class="br0">&#93;</span>, <span class="br0">&#91;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>
 %% 这个 bot 可执行所有命令,
 %% 但是如果使用 'host' 参数, 它必须是 <span class="st0">&quot;example.org&quot;</span>:
 <span class="br0">&#123;</span>bot_all_example, all, <span class="br0">&#91;</span><span class="br0">&#123;</span>host, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
 %% 这个 bot 只能执行命令 'register',
 %% 并且如果使用参数 'host' , 它必须是 <span class="st0">&quot;example.org&quot;</span>:
 <span class="br0">&#123;</span>bot_reg_example, <span class="re0"><span class="br0">&#91;</span>register<span class="br0">&#93;</span></span>, <span class="br0">&#91;</span><span class="br0">&#123;</span>host, <span class="st0">&quot;example.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,
 %% 这个 bot 能执行命令 'register' 和 'unregister',
 %% 如果使用参数 host , 它必须是 <span class="st0">&quot;test.org&quot;</span>:
 <span class="br0">&#123;</span>_bot_reg_test, <span class="re0"><span class="br0">&#91;</span>register, unregister<span class="br0">&#93;</span></span>, <span class="br0">&#91;</span><span class="br0">&#123;</span>host, <span class="st0">&quot;test.org&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
<span class="br0">&#93;</span></pre></div></div>
<h3> <span class="mw-headline" id="Web.E7.AE.A1.E7.90.86">Web管理</span></h3>
<p>ejabberd Web管理允许使用web浏览器管理大部分ejabberd.
</p><p>这个功能缺省是激活的: 一个使用选项 web_admin (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#.E7.9B.91.E5.90.AC.E7.AB.AF.E5.8F.A3" title="Ejabberd2:安装和操作指南">3.1.3</a> 节)的 ejabberd_http 监听者被包含在监听的端口里. 然后你可以在你中意的wen浏览器里打开 <a rel="nofollow" class="external free" href="http://server:port/admin/">http://server:port/admin/</a> . 你将被要求键入一个拥有管理员权限的ejabberd用户的 username (全 Jabber ID) 和 password . 在验证之后你将看到一个页面类似 figure 4.1.
</p>
<dl><dd><i>webadmmain.png</i>
</dd><dd><i>Figure 4.1: Top page from the Web Admin</i>
</dd></dl>
<p>这里你可以编辑访问限制, 管理用户, 建立备份, 管理数据库, 允许/禁止 监听的端口, 查看服务器统计数据,…
</p><p>access rule 配置决定那些帐号可以访问Web管理以及修改它. access rule webadmin_view 仅被赋予查看权限: 那些帐号能以只读方式浏览Web管理.
</p><p>示例配置:
</p>
<ul><li> 你可以把Web管理伺服于和HTTP 轮询界面相同的端口. 在这个了例子里你应该把你的web浏览器指向 <a rel="nofollow" class="external free" href="http://example.org:5280/admin/">http://example.org:5280/admin/</a> 来管理所有虚拟主机或指向 <a rel="nofollow" class="external free" href="http://example.org:5280/admin/server/example.com/">http://example.org:5280/admin/server/example.com/</a> 来管理虚拟主机 example.com. 在你访问Web管理之前你需要键入从一个被允许配置ejabberd的已注册的用户那里得到的 username, JID 和 password . 在这个例子里你可键入 username ‘admin@example.net’ 来管理所有虚拟主机 (第一个 URL). 如果你以‘admin@example.com’登录到<a rel="nofollow" class="external free" href="http://example.org:5280/admin/server/example.com/">http://example.org:5280/admin/server/example.com/</a> ，你只能管理虚拟主机 example.com. 帐号‘reviewer@example.com’可以只读模式浏览虚拟主机.
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>acl, admins, <span class="br0">&#123;</span>user, <span class="st0">&quot;admin&quot;</span>, <span class="st0">&quot;example.net&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;example.com&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#123;</span>acl, admins, <span class="br0">&#123;</span>user, <span class="st0">&quot;admin&quot;</span>, <span class="st0">&quot;example.com&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>host_config, <span class="st0">&quot;example.com&quot;</span>, <span class="br0">&#91;</span><span class="br0">&#123;</span>acl, viewers, <span class="br0">&#123;</span>user, <span class="st0">&quot;reviewer&quot;</span>, <span class="st0">&quot;example.com&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>access, configure, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow, admins<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
      <span class="br0">&#123;</span>access, webadmin_view, <span class="re0"><span class="br0">&#91;</span><span class="br0">&#123;</span>allow, viewers<span class="br0">&#125;</span><span class="br0">&#93;</span></span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>listen,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span><span class="nu0">5280</span>, ejabberd_http, <span class="re0"><span class="br0">&#91;</span>http_poll, web_admin<span class="br0">&#93;</span></span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<ul><li> 因为安全的原因, 你可以在一个安全的连接上伺服Web管理, 在一个不同于HTTP轮询接口的端口上, 并把它绑定到内部的局域网IP. 这个Web管理将只能被浏览器从<a rel="nofollow" class="external free" href="https://192.168.1.1:5282/admin/">https://192.168.1.1:5282/admin/</a> 访问:
</li></ul>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre>      <span class="br0">&#123;</span>hosts, <span class="br0">&#91;</span><span class="st0">&quot;example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
&#160;
      <span class="br0">&#123;</span>listen,
       <span class="br0">&#91;</span>
        ...
        <span class="br0">&#123;</span><span class="nu0">5280</span>, ejabberd_http, <span class="br0">&#91;</span>
                               http_poll
                              <span class="br0">&#93;</span><span class="br0">&#125;</span>,
        <span class="br0">&#123;</span><span class="br0">&#123;</span><span class="nu0">5282</span>, <span class="st0">&quot;192.168.1.1&quot;</span><span class="br0">&#125;</span>, ejabberd_http, <span class="br0">&#91;</span>
                                                web_admin,
                                                tls, <span class="br0">&#123;</span>certfile, <span class="st0">&quot;/usr/local/etc/server.pem&quot;</span><span class="br0">&#125;</span>
                                               <span class="br0">&#93;</span><span class="br0">&#125;</span>,
        ...
       <span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<p>在ejabberd Web管理 特定的页面包含了一个连接到 ejabberd安装和操作指南 的相关章节. 为了显式这些链接, 本指南的一个 HTML 格式的拷贝必须安装在该系统上. 该文件缺省的放在 "/share/doc/ejabberd/guide.html". 该文档的目录可以被环境变量 EJABBERD_DOC_PATH 指定. 参见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#Erlang.E8.BF.90.E8.A1.8C.E6.97.B6.E7.B3.BB.E7.BB.9F" title="Ejabberd2:安装和操作指南">4.1.2</a> 节.
</p>
<h3> <span class="mw-headline" id=".E7.89.B9.E8.AE.BE.E5.91.BD.E4.BB.A4">特设命令</span></h3>
<p>如果你激活了 mod_configure 和 mod_adhoc, 你可以使用一个 XMPP 客户端在 ejabberd执行很多管理任务. 该客户端必须支持 Ad-Hoc Commands (<a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0050.html">XEP-0050</a>), 而你必须以一个拥有适当权限的帐号登录到该 XMPP 服务器.
</p>
<h3> <span class="mw-headline" id=".E4.BF.AE.E6.94.B9.E8.AE.A1.E7.AE.97.E6.9C.BA.E4.B8.BB.E6.9C.BA.E5.90.8D">修改计算机主机名</span></h3>
<p>ejabberd使用分布式的 Mnesia 数据库. 作为分布式数据库, Mnesia 强制它的文件一致性, 所以它在它里面存储Erlang节点名 (见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#Erlang.E8.8A.82.E7.82.B9.E5.90.8D" title="Ejabberd2:安装和操作指南">5.4</a> 节). 一个Erlang节点的名字包含了该计算机的hostname. 所以, 如果你修改ejabberd运行的机器的名字，或当你移动ejabberd到一个不同的机器上，那么Erlang节点名也修改了.
</p><p>你有两个办法在一个新节点名的 ejabberd 上使用旧的 Mnesia 数据库: 把旧节点名放入 ejabberdctl.cfg, 或转换数据库到为新节点名.
</p><p>那些例子步骤将备份, 转换并装载 Mnesia 数据库. 你需要要么有旧的 Mnesia spool 目录，要么有一个 Mnesia 的备份. 如果你已经有一个旧的数据库的备份文件, 你可以直接去步骤 5. 你也需要知道旧节点名和新节点名. 如果你不知道它们, 执行ejabberdctl或在ejabberd 日志文件里查找它们.
</p><p>在开始之前, 设置一些变量:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre><span class="re2">OLDNODE=</span>ejabberd<span class="sy0">@</span>oldmachine
<span class="re2">NEWNODE=</span>ejabberd<span class="sy0">@</span>newmachine
<span class="re2">OLDFILE=</span><span class="sy0">/</span>tmp<span class="sy0">/</span>old.backup
<span class="re2">NEWFILE=</span><span class="sy0">/</span>tmp<span class="sy0">/</span>new.backup</pre></div></div>
<p>1. 强制以旧节点名启动 ejabberd&#160;:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      ejabberdctl <span class="re5">--node</span> <span class="re1">$OLDNODE</span> start</pre></div></div>
<p>2. 生成一个备份文件:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      ejabberdctl <span class="re5">--node</span> <span class="re1">$OLDNODE</span> backup <span class="re1">$OLDFILE</span></pre></div></div>
<p>3. 停止旧节点:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      ejabberdctl <span class="re5">--node</span> <span class="re1">$OLDNODE</span> stop</pre></div></div>
<p>4. 确保在 Mnesia spool 目录没有文件 . 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      <span class="kw2">mkdir</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>ejabberd<span class="sy0">/</span>oldfiles
      <span class="kw2">mv</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>ejabberd<span class="sy0">/*</span>.<span class="sy0">*</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>ejabberd<span class="sy0">/</span>oldfiles<span class="sy0">/</span></pre></div></div>
<p>5. 启动 ejabberd. 不需要再指定任何节点名:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      ejabberdctl start</pre></div></div>
<p>6. 转换备份到新节点名:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      ejabberdctl mnesia_change_nodename <span class="re1">$OLDNODE</span> <span class="re1">$NEWNODE</span> <span class="re1">$OLDFILE</span> <span class="re1">$NEWFILE</span></pre></div></div>
<p>7. 安装备份文件作为一个fallback:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      ejabberdctl install_fallback <span class="re1">$NEWFILE</span></pre></div></div>
<p>8. 停止 ejabberd:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      ejabberdctl stop</pre></div></div>
<dl><dd>你可能在日志文件看到一个错误信息, 这是正常的, 不要担心:
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>      Mnesia(ejabberd@newmachine):
      ** ERROR ** (ignoring core)
      ** FATAL ** A fallback is installed and Mnesia must be restarted.
        Forcing shutdown after mnesia_down from ejabberd@newmachine...</pre></div></div>
<p>9. 现在你可以最后启动 ejabberd:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      ejabberdctl start</pre></div></div>
<p>10. 检查是否旧数据库的信息可用: accounts, rosters... 完成之后, 记住从公共目录删除临时备份文件.
</p>
<h2> <span class="mw-headline" id="ejabberd.E5.AE.89.E5.85.A8">ejabberd安全</span></h2>
<h3> <span class="mw-headline" id=".E9.98.B2.E7.81.AB.E5.A2.99.E8.AE.BE.E7.BD.AE">防火墙设置</span></h3>
<p>当你配置防火墙的时候，你需要注意以下 TCP 端口: 
</p>
<table border="1" cellspacing="0">
<tr>
<th>端口 </th>
<th>描述
</th></tr>
<tr>
<td>5222 </td>
<td>用于 Jabber/XMPP 客户端连接的标准端口, 纯文本或 STARTTLS.
</td></tr>
<tr>
<td>5223 </td>
<td>Jabber 客户端使用旧的 SSL 方法连接的标准端口 .
</td></tr>
<tr>
<td>5269 </td>
<td>用于 Jabber/XMPP 服务器连接的标准端口.
</td></tr>
<tr>
<td>4369 </td>
<td>EPMD (<a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#EPMD" title="Ejabberd2:安装和操作指南">5.2</a> 节) 监听Erlang节点名请求.
</td></tr>
<tr>
<td>端口范围 </td>
<td>用于两个Erlang节点之间的连接. 这个范围是可配置的(见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#EPMD" title="Ejabberd2:安装和操作指南">5.2</a> 节).
</td></tr></table>
<h3> <span class="mw-headline" id="epmd">epmd</span></h3>
<p><a rel="nofollow" class="external text" href="http://www.erlang.org/doc/man/epmd.html">epmd (Erlang端口映射守候进程)</a> 是一个包含在 Erlang/OTP 里的小的名字服务器，并且在建立分布式 Erlang 通讯时被 Erlang 程序使用. ejabberd 需要 epmd 来使用 ejabberdctl 并且使用集群的ejabberd 节点时也需要它. 这个小的程序是由Erlang自动启动的, 并且永不停止. 如果 ejabberd 停止了, 并且没有任何其他 Erlang 程序运行在系统上, 如果你想的话可以安全地停止 epmd.
</p><p>ejabberd 运行在一个Erlang节点内部. 为了和 ejabberd 通讯, 脚本 ejabberdctl 启动一个新的 Erlang 节点并连接到这个运行着 ejabberd 的Erlang节点. 为了这个通讯能工作, epmd 必须运行和在端口4369监听名字请求. 你应该在防火墙以这种方式禁止端口4369，即只允许你机器上的程序访问它.
</p><p>如果你建立了一个许多 ejabberd 实例的集群, 每个 ejabberd 实例被称为一个 ejabberd 节点. 那些 ejabberd 节点使用一个特别的 Erlang 通讯方法来建立集群, 那么 EPMD 再次需要监听端口 4369. 所以, 如果你计划计建立一个 ejabberd 节点的集群，你必须为这个集群涉及的机器打开端口 4369. 记住禁止这个端口使得它无法从互联网访问到.
</p><p>一旦一个Erlang节点使用EPMD和端口4369解析了另一个Erlang节点的节点名, 节点之间就直接通讯. 在这个情况下使用的端口缺省是随机的, 但是可以在文件 ejabberdctl.cfg里配置. Erlang命令行参数被内部使用, 例如:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>erl ... <span class="re5">-kernel</span> inet_dist_listen_min <span class="nu0">4370</span> inet_dist_listen_max <span class="nu0">4375</span></pre></div></div>
<h3> <span class="mw-headline" id="Erlang_Cookie">Erlang Cookie</span></h3>
<p>Erlang cookie 是一个数字和字母组成的字符串. 一个Erlang节点在启动时从命令行参数 -setcookie 读取cookie. 如果没有指定, 则从 $HOME/.erlang.cookie 读取cookie 文件. 如果这个文件不存在, 它会被立刻以一个随机的cookie建立. 两个Erlang节点只有它们有相同的cookie才会通讯 . 在Erlang节点上设置一个cookie允许你结构化你的Erlang网络并定义哪个节点被允许连接到哪个.
</p><p>感谢Erlang cookies, 你可以阻止对Erlang节点的错误访问, 例如当同一台机器上有许多Erlang节点运行不同程序的时候.
</p><p>设置一个安全cookie是一个简单的方法来增加非法访问你的Erlang节点的困难度. 然而, 对于阻止对Erlang节点的未授权访问或侵扰，cookie系统不是最终有效的. Erlang节点之间的通讯是未加密的, 所以 cookie 可能被网络上的探针读取. 推荐使得Erlang更加安全的方法是禁止端口4369.
</p>
<h3> <span class="mw-headline" id="Erlang.E8.8A.82.E7.82.B9.E5.90.8D">Erlang节点名</span></h3>
<p>一个Erlang节点可以拥有一个节点名. 这个名字可能很短 (如果用命令行参数 -sname 指定) 或很长 (如果用参数 -name 指定). 以 -sname 启动一个Erlang节点限制Erlang节点和LAN之间的通讯.
</p><p>使用选项 -sname 而不是 -name ，是一个简单增加对你的Erlang节点的未授权访问难度的方法. 然而, 对于阻止对Erlang节点的未授权访问或侵扰，它不是最终有效的. 因为有可能伪装你在另一个网络里使用一个修改过的 Erlang epmd. 推荐使得Erlang更加安全的方法是禁止端口4369.
</p>
<h3> <span class="mw-headline" id=".E6.95.8F.E6.84.9F.E6.96.87.E4.BB.B6.E5.AE.89.E5.85.A8">敏感文件安全</span></h3>
<p>ejabberd在文件系统里存储敏感数据要么使用纯文本要么是二进制文件. 文件系统许可应被设置为只允许适当的用户读, 写和执行那些文件和目录.
</p><p><b>ejabberd configuration file: /etc/ejabberd/ejabberd.cfg</b>
</p>
<dl><dd>包含外部组件的管理员的 JID 和密码. 备份文件可能也包含这个信息, 所以整个 /etc/ejabberd/ 目录的安全是必要的. 
</dd></dl>
<p><b>ejabberd service log: /var/log/ejabberd/ejabberd.log</b>
</p>
<dl><dd>包含客户端的IP地址. 如果 loglevel 设为 5, 它包含全部的会话和密码. 如果使用了一个 logrotate 系统, 可能有好几个日志文件拥有类似的信息, 所以整个 /var/log/ejabberd/ 目录的安全是必要的. 
</dd></dl>
<p><b>Mnesia database spool files in /var/lib/ejabberd/</b>
</p>
<dl><dd>这个文件存储二进制数据, 但是一些部分仍是可读的. 这个文件由 Mnesia 生成并且它们的许可不能被直接设置, 所以整个 /var/lib/ejabberd/ 目录的安全是必要的. 
</dd></dl>
<p><b>Erlang cookie file: /var/lib/ejabberd/.erlang.cookie</b>
</p>
<dl><dd>见 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#Erlang_Cookie" title="Ejabberd2:安装和操作指南">5.3</a> 节.
</dd></dl>
<h2> <span class="mw-headline" id=".E9.9B.86.E7.BE.A4">集群</span></h2>
<h3> <span class="mw-headline" id=".E5.A6.82.E4.BD.95.E5.B7.A5.E4.BD.9C">如何工作</span></h3>
<p>一个XMPP域是由一个或多个ejabberd节点伺服的. 这些节点可能运行在通过网络连接的不同的机器上. 它们都必须有能力连接到所有其他节点的4369端口, 并且必须有相同的 magic cookie (见 Erlang/OTP 文档, 换句话说，在所有节点上，文件 ~ejabberd/.erlang.cookie 必须是相同的 ). 这是必须的，因为所有节点交换关于已连接的用户, s2s连接, 已注册的服务, 等等…信息.
</p><p>每个 ejabberd 节点有意下模块:
</p>
<ul><li> router,
</li><li> local router,
</li><li> session manager,
</li><li> s2s manager. 
</li></ul>
<h4> <span class="mw-headline" id="Router">Router</span></h4>
<p>这个模块是每个节点的XMPP包的主router. 它基于它们的目标域来路由它们. 它使用一个全局路由表. 在这个路由表里搜索到包的目的地的域, 并且如果找到, 这个包就被路由到适当的进程. 如果没找到, 它被送到 s2s manager.
</p>
<h4> <span class="mw-headline" id="Local_Router">Local Router</span></h4>
<p>这个模块路由那些目的域等于服务器的主机名之一的包. 如果目的JID有一个非空的 user 部分, 它路由到 session manager, 反之则它的处理依赖于它的内容.
</p>
<h4> <span class="mw-headline" id="Session_Manager">Session Manager</span></h4>
<p>这个模块路由包到本地用户. 它通过一个出席信息表查找一个包必须被发送给哪个用户资源. 然后该包要么路由到适当的 c2s 进程, 要么存储在离线存储 offline storage, 或弹回.
</p>
<h4> <span class="mw-headline" id="s2s_Manager">s2s Manager</span></h4>
<p>这个模块路由包到其他 XMPP 服务器. 首先, 它检查是否已存在一个从该包的源域到目的域的s2s连接. 如果有, s2s manager 路由这个包到伺服这个连接的进程, 反之打开一个新的连接.
</p>
<h3> <span class="mw-headline" id=".E9.9B.86.E7.BE.A4.E9.85.8D.E7.BD.AE">集群配置</span></h3>
<p>假定你已经在一个机器named(第一个)上配置了 ejabberd , 并且你需要配置另外一个来做一个 ejabberd 集群. 那么按以下步骤做:
</p><p>1. 从第一台机器拷贝 ~ejabberd/.erlang.cookie 文件到第二台机器.
</p>
<dl><dd>(或者) 你也可以增加‘-setcookie content_of_.erlang.cookie’选项到以下所有‘erl’ 命令.
</dd></dl>
<p>2. 在第二台机器上，在ejabberd工作目录中，以 ejabberd 守候进程用户运行以下命令:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      erl <span class="re5">-sname</span> ejabberd \
          <span class="re5">-mnesia</span> <span class="kw2">dir</span> <span class="st0">'&quot;/var/lib/ejabberd/&quot;'</span> \
          <span class="re5">-mnesia</span> extra_db_nodes <span class="st0">&quot;['ejabberd@first']&quot;</span> \
          <span class="re5">-s</span> mnesia</pre></div></div>
<dl><dd>这将启动 Mnesia 服务于和 ejabberd@first 相同的数据库. 你可以运行命令 ‘mnesia:info().’检查它. 你应该看到许多远程表和行，类似以下:
</dd></dl>
<dl><dd>注意: 在你的系统里 Mnesia 目录可能是不同的. 要知道 ejabberd 期望在哪里找到 Mnesia 的缺省安装, 不带参数调用 ejabberdctl 然后它将显式一些帮助, 包括 Mnesia database spool 目录.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      running db nodes   = <span class="br0">&#91;</span>ejabberd<span class="sy0">@</span>first, ejabberd<span class="sy0">@</span>second<span class="br0">&#93;</span></pre></div></div>
<p>3. 现在在相同的‘erl’会话下运行以下命令:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-bash" style="font-family: monospace;"><pre>      mnesia:change_table_copy_type<span class="br0">&#40;</span>schema, node<span class="br0">&#40;</span><span class="br0">&#41;</span>, disc_copies<span class="br0">&#41;</span>.</pre></div></div>
<dl><dd>这将为该数据库建立本地磁盘存储.
</dd></dl>
<dl><dd>(或者) 在第二个节点通过Web管理修改scheme表的存储类型为‘RAM and disc copy’.
</dd></dl>
<p>4. 现在你可以增加更多表的复制到这个节点 ，使用‘mnesia:add_table_copy’ 或 ‘mnesia:change_table_copy_type’如上 (只是把 ‘schema’ 替换成其他表名，并且 ‘disc_copies’可以被替换成‘ram_copies’ 或 ‘disc_only_copies’).
</p>
<dl><dd>哪个表被复制，依赖于你的需要, 你可以从‘mnesia:info().’命令得到一些提示, 通过查看每个位于 ’first’的表的大小和缺省的存储类型.
</dd></dl>
<p>复制一个表使得这个节点的这个表的查询更加快速. 写入, 另一方面, 将更慢. 而且当然如果复制之一的机器挂了, 其他复制将被使用.
</p>
<dl><dd>看一下 <a rel="nofollow" class="external text" href="http://www.erlang.org/doc/apps/mnesia/Mnesia_chap5.html#5.3">Mnesia用户指南的 5.3 节(表 片段)</a>将有所帮助.
</dd></dl>
<dl><dd> (或者) 同之前的条目, 但用于不同的表.
</dd></dl>
<p>5. 运行‘init:stop().’ 或只是 ‘q().’ 退出 Erlang shell. 这可能要花些时间，如果 Mnesia 还没有从first传输和处理完所有数据.
</p><p>6. 现在在第二台机器上使用和第一台机器类似的配置运行 ejabberd: 你可能不需要重复‘acl’ 和 ‘access’ 选项，因为它们将从第一台机器获得; 并且 mod_irc 只应该在集群里的一台机器上激活. 
</p><p>你可以在其他机器上重复这些步骤来服务于这个域.
</p>
<h3> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E8.B4.9F.E8.BD.BD.E5.9D.87.E8.A1.A1">服务负载均衡</span></h3>
<h4> <span class="mw-headline" id=".E7.BB.84.E4.BB.B6.E8.B4.9F.E8.BD.BD.E5.9D.87.E8.A1.A1">组件负载均衡</span></h4>
<h4> <span class="mw-headline" id=".E5.9F.9F.E8.B4.9F.E8.BD.BD.E5.9D.87.E8.A1.A1.E6.9C.BA.E5.88.B6">域负载均衡机制</span></h4>
<p>ejabberd包含了一个机制来对插入一个ejabberd集群的组件进行负载均衡. 它意味着你可以在每一个ejabberd集群插入相同组件的一个或多个实例并且流量将自动分布.
</p><p>缺省的分布式机制尝试递送到组件的一个本地实例. 如果有多个本地实例可用, 随机地选取一个实例. 如果没有本地实例可用, 随机选取一个远程组件实例.
</p><p>如果你需要一个不同的行为, 你可以通过选项 domain_balancing 修改负载均衡行为. 这个选项的语法如下:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>domain_balancing, <span class="st0">&quot;component.example.com&quot;</span>, BalancingCriteria<span class="br0">&#125;</span>.</pre></div></div>
<p>多个负载均衡标准可用:
</p>
<ul><li> destination: 使用包的to属性的全JID.
</li><li> source: 使用包的from属性的全JID.
</li><li> bare_destination: 使用包的to属性的纯JID(没有资源).
</li><li> bare_source: 使用包的from属性的纯JID(没有资源). 
</li></ul>
<p>如果对应标准的这个值是相同的, 则集群中相同的组件实例将被使用.
</p>
<h4> <span class="mw-headline" id=".E8.B4.9F.E8.BD.BD.E5.9D.87.E8.A1.A1.E6.B0.B4.E6.A1.B6">负载均衡水桶</span></h4>
<p>当一个给定的组件有失败的风险的时候, 域均衡可能导致服务麻烦. 如果一个组件失败了，服务将无法正确工作，除非会话被重新均衡了.
</p><p>在这种情况下, 最好限制这个问题在由失败组件处理的这些会话. 这就是 domain_balancing_component_number 选项所做的, 使负载均衡机制不动态化, 而是粘在固定数目的组件实例上.
</p><p>语法是:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>domain_balancing_component_number, <span class="st0">&quot;component.example.com&quot;</span>, Number<span class="br0">&#125;</span>.</pre></div></div>
<h2> <span class="mw-headline" id=".E8.B0.83.E8.AF.95">调试</span></h2>
<h3> <span class="mw-headline" id=".E6.97.A5.E5.BF.97.E6.96.87.E4.BB.B6">日志文件</span></h3>
<p>一个ejabberd节点写两个日志文件:
</p><p><b>ejabberd.log</b>
</p>
<dl><dd>ejabberd 服务日志, 由 ejabberd 节点汇报的消息
</dd></dl>
<p><b>erlang.log</b>
</p>
<dl><dd>Erlang/OTP 系统日志, 由 Erlang/OTP 使用 SASL (系统架构支持库) 汇报的消息
</dd></dl>
<p>选项 loglevel 修改文件 ejabberd.log 的详细程度. 语法是:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>loglevel, Level<span class="br0">&#125;</span>.</pre></div></div>
<p>可能的 Level 有:
</p><p><b>0</b>
</p>
<dl><dd>没有ejabberd日志 (不推荐) 
</dd></dl>
<p><b>1</b>
</p>
<dl><dd>紧急
</dd></dl>
<p><b>2</b>
</p>
<dl><dd>错误
</dd></dl>
<p><b>3</b>
</p>
<dl><dd>警告
</dd></dl>
<p><b>4</b>
</p>
<dl><dd>信息
</dd></dl>
<p><b>5</b>
</p>
<dl><dd>调试
</dd></dl>
<p>例如, 缺省配置为:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>loglevel, <span class="nu0">4</span><span class="br0">&#125;</span>.</pre></div></div>
<p>日志文件持续增长, 所以推荐定期流转. 为了流转日志文件, 重命名这个文件然后重新打开它们. ejabberdctl命令reopen-log (请参考 <a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97#_ejabberdctl.E5.91.BD.E4.BB.A4" title="Ejabberd2:安装和操作指南">4.1.1</a> 节) 重新打开日志文件, 同时也重命名旧文件，如果你不重命名它们的话.
</p>
<h3> <span class="mw-headline" id=".E8.B0.83.E8.AF.95.E6.8E.A7.E5.88.B6.E5.8F.B0">调试控制台</span></h3>
<p>调试控制台是连接到一个已运行的 ejabberd 服务器的 Erlang shell. 使用这个 Erlang shell, 一个有经验的管理员可以执行复杂的任务.
</p><p>这个 shell 给予对ejabberd 服务器的完全控制, 所以使用它要非常小心. 在文章 <a rel="nofollow" class="external text" href="http://www.ejabberd.im/interconnect-erl-nodes">Erlang节点的互连</a> 里有一些简单和安全的例子
</p><p>要退出这个shell, 关闭窗口或键入: control+c control+c.
</p>
<h3> <span class="mw-headline" id="Watchdog.E8.AD.A6.E5.91.8A">Watchdog警告</span></h3>
<p>ejabberd包含了一个看门狗 watchdog 机制，当找出和内存使用有关的问题时，对开发者可能有用. 如果ejabberd服务器的一个进程消耗了超过配置阀值的内存, 一个消息将被发送到ejabberd配置文件中选项 watchdog_admins 定义的 XMPP 帐号.
</p><p>语法是:
</p><p><b>{watchdog_admins, [JID, ...]}.</b>
</p><p>消耗的内存以words衡量: 一个word在32位系统上是4字节bytes, 在64位系统上是8字节bytes. 这个阀值缺省是 1000000 words. 这个值可以用选项 watchdog_large_heap来配置, 或在一个会话中使用watchdog警报机器人.
</p><p>语法是:
</p><p><b>{watchdog_large_heap, Number}.</b>
</p><p>示例配置:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>watchdog_admins, <span class="br0">&#91;</span><span class="st0">&quot;admin2@localhost&quot;</span>, <span class="st0">&quot;admin2@example.org&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.
<span class="br0">&#123;</span>watchdog_large_heap, <span class="nu0">30000000</span><span class="br0">&#125;</span>.</pre></div></div>
<p>要移除watchdog管理员, 在选项里移除. 为了移除所有watchdog管理员, 设置该选项为空列表:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-ini" style="font-family: monospace;"><pre><span class="br0">&#123;</span>watchdog_admins, <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.</pre></div></div>
<h2> <span class="mw-headline" id=".E9.99.84.E5.BD.95_A_.E5.9B.BD.E9.99.85.E5.8C.96.E5.92.8C.E6.9C.AC.E5.9C.B0.E5.8C.96">附录 A 国际化和本地化</span></h2>
<p>ejabberd的源码支持本地化. 翻译者可编辑 <a rel="nofollow" class="external text" href="http://www.gnu.org/software/gettext/">gettext</a> .po 文件，使用任何可用的软件 (KBabel, Lokalize, Poedit...) 或一个简单的文本编辑器.
</p><p>接着gettext用来提取, 更新和导出那些 .po 文件成为能被ejabberd读取的 .msg 格式. 为执行那些管理任务, 在 src/ 目录执行 <i>make translations</i>. 可翻译的字符串被从源码提取出来生成文件 ejabberd.pot. 这个文件合并每个 .po 文件来生成更新的 .po 文件. 最后那些 .po 文件被导出成 .msg 文件, 那是个容易被 ejabberd 读取的格式.
</p><p>所有內建的模块都支持内部的IQ queries的xml:lang 属性 . Figure A.1, 例如, 展示了应答以下 query:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'5'</span>
    <span class="re0">to</span>=<span class="st0">'example.org'</span>
    <span class="re0">type</span>=<span class="st0">'get'</span>
    <span class="re0">xml:lang</span>=<span class="st0">'ru'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/disco#items'</span><span class="re2">/&gt;</span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<pre>   discorus.png
   Figure A.1: Service Discovery when xml:lang=’ru’
</pre>
<p>Web管理也支持 Accept-Language HTTP 头.
</p>
<pre>   webadmmainru.png
   Figure A.2: Web Admin showing a virtual host when the web browser provides the HTTP header ‘Accept-Language: ru’
</pre>
<h2> <span class="mw-headline" id=".E9.99.84.E5.BD.95_B_.E5.8F.91.E8.A1.8C.E5.A4.87.E6.B3.A8">附录 B 发行备注</span></h2>
<p>发行备注在 <a rel="nofollow" class="external text" href="http://www.process-one.net/en/ejabberd/release_notes/">ejabberd主页</a>
</p>
<h2> <span class="mw-headline" id=".E9.99.84.E5.BD.95_C_.E9.B8.A3.E8.B0.A2">附录 C 鸣谢</span></h2>
<p>感谢所有对本指南有贡献的人:
</p>
<ul><li> Alexey Shchepin (xmpp:aleksey@jabber.ru)
</li><li> Badlop (xmpp:badlop@jabberes.org)
</li><li> Evgeniy Khramtsov (xmpp:xram@jabber.ru)
</li><li> Florian Zumbiehl (xmpp:florz@florz.de)
</li><li> Michael Grigutsch (xmpp:migri@jabber.i-pobox.net)
</li><li> Mickael Remond (xmpp:mremond@process-one.net)
</li><li> Sander Devrieze (xmpp:s.devrieze@gmail.com)
</li><li> Sergei Golovan (xmpp:sgolovan@nes.ru)
</li><li> Vsevolod Pelipas (xmpp:vsevoload@jabber.ru)
</li></ul>
<h2> <span class="mw-headline" id=".E9.99.84.E5.BD.95_D_.E7.89.88.E6.9D.83.E4.BF.A1.E6.81.AF">附录 D 版权信息</span></h2>
<p>略...
</p><p>Ejabberd Installation and Operation Guide.
Copyright © 2003 — 2010 ProcessOne
</p><p>This document is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.
</p><p>This document is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
</p><p>You should have received a copy of the GNU General Public License along with this document; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
</p>
<!-- 
NewPP limit report
Preprocessor node count: 1913/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mediawiki:pcache:idhash:59-0!*!0!!zh-cn!*!* and timestamp 20160221164420 -->
</div><div class="printfooter">
来自“<a href="http://wiki.jabbercn.org/index.php?title=Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97&amp;oldid=3581">http://wiki.jabbercn.org/index.php?title=Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97&amp;oldid=3581</a>”</div>
		<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks"><a href="/%E7%89%B9%E6%AE%8A:%E9%A1%B5%E9%9D%A2%E5%88%86%E7%B1%BB" title="特殊:页面分类">2个分类</a>: <ul><li><a href="/%E5%88%86%E7%B1%BB:XMPP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%87%E6%A1%A3" title="分类:XMPP服务器文档">XMPP服务器文档</a></li><li><a href="/%E5%88%86%E7%B1%BB:%E5%B7%B2%E7%BF%BB%E8%AF%91" title="分类:已翻译">已翻译</a></li></ul></div></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>查看</h5>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97" title="查看内容页面 [c]" accesskey="c">页面</a></li>
				<li id="ca-talk" class="new"><a href="/index.php?title=%E8%AE%A8%E8%AE%BA:Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97&amp;action=edit&amp;redlink=1" title="关于内容页面的讨论 [t]" accesskey="t">讨论</a></li>
				<li id="ca-viewsource"><a href="/index.php?title=Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97&amp;action=edit" title="本页面已被保护。你可以查看其源代码。 [e]" accesskey="e">查看源代码</a></li>
				<li id="ca-history"><a href="/index.php?title=Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97&amp;action=history" title="本页面的早前修订版本 [h]" accesskey="h">历史</a></li>
			</ul>
		</div>
	</div>

	<div class="portlet" id="p-personal">
		<h5>个人工具</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/index.php?title=%E7%89%B9%E6%AE%8A:%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95&amp;returnto=Ejabberd2%3A%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97" title="我们希望您可以登入，但不强求 [o]" accesskey="o">登录/创建账户</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a title="访问首页" style="background-image: url(/skins/common/images/xmppcn.png);" href="/%E9%A6%96%E9%A1%B5"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>导航</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/%E9%A6%96%E9%A1%B5" title="访问首页 [z]" accesskey="z">首页</a></li>
				<li id="n-portal"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E7%A4%BE%E5%8C%BA%E4%B8%93%E9%A1%B5" title="关于本项目，你可以做什么，在哪里找到你需要的事物">社区专页</a></li>
				<li id="n-currentevents"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E6%96%B0%E9%97%BB%E5%8A%A8%E6%80%81" title="查看当前事件的背景信息">新闻动态</a></li>
				<li id="n-recentchanges"><a href="/%E7%89%B9%E6%AE%8A:%E6%9C%80%E8%BF%91%E6%9B%B4%E6%94%B9" title="本wiki的最近更改列表 [r]" accesskey="r">最近更改</a></li>
				<li id="n-randompage"><a href="/%E7%89%B9%E6%AE%8A:%E9%9A%8F%E6%9C%BA%E9%A1%B5%E9%9D%A2" title="随机进入一个页面 [x]" accesskey="x">随机页面</a></li>
				<li id="n-help"><a href="/%E5%B8%AE%E5%8A%A9:%E7%9B%AE%E5%BD%95" title="寻求帮助的地方">帮助</a></li>
			</ul>
		</div>
	</div>
	<div class="generated-sidebar portlet" id="p-XMPP.E8.B5.84.E6.BA.90">
		<h5>XMPP资源</h5>
		<div class='pBody'>
			<ul>
				<li id="n-XMPP.E5.85.AC.E5.85.B1.E6.9C.8D.E5.8A.A1"><a href="/XMPP%E5%85%AC%E5%85%B1%E6%9C%8D%E5%8A%A1">XMPP公共服务</a></li>
				<li id="n-XMPP.E5.AE.A2.E6.88.B7.E7.AB.AF.E8.BD.AF.E4.BB.B6"><a href="/XMPP%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6">XMPP客户端软件</a></li>
				<li id="n-XMPP.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.BD.AF.E4.BB.B6"><a href="/XMPP%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AF%E4%BB%B6">XMPP服务器软件</a></li>
				<li id="n-.E5.8F.8B.E6.83.85.E9.93.BE.E6.8E.A5"><a href="/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5">友情链接</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">搜索</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/index.php" id="searchform">
				<input type='hidden' name="title" value="特殊:搜索"/>
				<input type="search" name="search" title="在Jabber/XMPP中文翻译计划中搜索 [f]" accesskey="f" id="searchInput" />
				<input type="submit" name="go" value="提交" title="如果相同的标题存在的话便直接前往该页面" id="searchGoButton" class="searchButton" />&#160;
				<input type="submit" name="fulltext" value="搜索" title="搜索含这些文字的页面" id="mw-searchButton" class="searchButton" />
			</form>
		</div>
	</div>




<script src="http://yacy.jabbercn.org:8090/yacy/ui/js/jquery-1.3.2.min.js" type="text/javascript"></script>
<script>
   $(document).ready(function() {
      yconf = {
         url : 'http://yacy.jabbercn.org:8090/',
         theme : 'smoothness',
         title : 'XMPP搜索大全',
         logo     : 'http://yacy.jabbercn.org:8090/env/grafics/50-xmpp_logo.jpg',
         link     : 'http://wiki.jabbercn.org',
         urlmaskfilter : '.*',
         width : 500,
         height : 500
      };
      $.getScript(yconf.url+'/yacy/ui/js/yacyui-portalsearch.js', function(){});
   });
</script>
        <div id="p-search" class="portlet">
<h5>站外搜索</h5>
<div id="yacylivesearch" class="pBody">
   <form id="ysearch" method="get" accept-charset="UTF-8" action="http://yacy.jabbercn.org:8090/yacysearch.html">
      <input name="search" id="yquery" type="text" size="8" maxlength="80" value=""/>
      <input type="hidden" name="verify" value="false" />
      <input type="hidden" name="maximumRecords" value="10" />
      <input type="hidden" name="resource" value="local" />
      <input type="hidden" name="urlmaskfilter" value=".*" />
      <input type="hidden" name="prefermaskfilter" value="" />
      <input type="hidden" name="former" value="" />
      <input type="hidden" name="display" value="2" />
      <input type="hidden" name="nav" value="all" />
      <input type="submit" name="Enter" value="搜索" class="searchButton" />
   </form>
</div>
</div>



	<div class="portlet" id="p-tb">
		<h5>工具箱</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/%E7%89%B9%E6%AE%8A:%E9%93%BE%E5%85%A5%E9%A1%B5%E9%9D%A2/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97" title="所有链入本页的wiki页面列表 [j]" accesskey="j">链入页面</a></li>
				<li id="t-recentchangeslinked"><a href="/%E7%89%B9%E6%AE%8A:%E9%93%BE%E5%87%BA%E6%9B%B4%E6%94%B9/Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97" title="本页链入的页面的最近更改 [k]" accesskey="k">链出更改</a></li>
				<li id="t-specialpages"><a href="/%E7%89%B9%E6%AE%8A:%E7%89%B9%E6%AE%8A%E9%A1%B5%E9%9D%A2" title="所有特殊页面列表 [q]" accesskey="q">特殊页面</a></li>
				<li><a href="/index.php?title=Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97&amp;printable=yes" rel="alternate">可打印版</a></li>
				<li id="t-permalink"><a href="/index.php?title=Ejabberd2:%E5%AE%89%E8%A3%85%E5%92%8C%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97&amp;oldid=3581" title="本页面该修订版本的永久链接">永久链接</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-copyrightico">
		<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution-Noncommercial-Share Alike 3.0 Unported" width="88" height="31" /></a>
	</div>
	<div id="f-poweredbyico">
		<a href="http://www.mediawiki.org/"><img src="/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
	</div>
	<ul id="f-list">
		<li id="lastmod"> 本页面最后修订于2015年5月5日 (星期二) 11:37。</li>
		<li id="viewcount">此页面已被浏览过158,664次。</li>
		<li id="copyright">本站全部文字内容使用<a class="external" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Attribution-Noncommercial-Share Alike 3.0 Unported</a>授权。</li>
		<li id="privacy"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E9%9A%90%E7%A7%81%E6%9D%83%E6%94%BF%E7%AD%96" title="Jabber/XMPP中文翻译计划:隐私权政策">隐私权政策</a></li>
		<li id="about"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E5%85%B3%E4%BA%8E" title="Jabber/XMPP中文翻译计划:关于">关于Jabber/XMPP中文翻译计划</a></li>
		<li id="disclaimer"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E5%85%8D%E8%B4%A3%E5%A3%B0%E6%98%8E" title="Jabber/XMPP中文翻译计划:免责声明">免责声明</a></li>
	</ul>
</div>
</div>
<script>if(window.mw){
	mw.loader.load(["mediawiki.user", "mediawiki.util", "mediawiki.page.ready", "mediawiki.legacy.wikibits", "mediawiki.legacy.ajax", "mediawiki.legacy.mwsuggest"]);
}
</script>
<script>if(window.mw){
	mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"highlightbroken":1,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,
	"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"zh-cn","language":"zh-cn","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;mw.user.tokens.set({"editToken":"+\\","watchToken":false});;mw.loader.state({"user.options":"ready","user.tokens":"ready"});
	
	/* cache key: mediawiki:resourceloader:filter:minify-js:4:42c4e9caefe8ca663d220ee0c286ac74 */
}
</script><!-- Piwik -->
<script type="text/javascript">
/* <![CDATA[ */
var pkBaseURL = (("https:" == document.location.protocol) ? "https://rtp.rooyee.im/piwik/" : "http://rtp.rooyee.im/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 5);
piwikTracker.setDocumentTitle("Ejabberd2:安装和操作指南");
piwikTracker.setIgnoreClasses("image");

piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
/* ]]> */
</script><noscript><p><img src="http://rtp.rooyee.im/piwik/piwik.php?idsite=5" style="border:0" alt=""/></p></noscript>
<!-- /Piwik --><!-- Served in 0.042 secs. --></body></html>