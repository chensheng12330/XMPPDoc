<!DOCTYPE html>
<html lang="zh-cn" dir="ltr" class="client-nojs">
<head>
<title>RFC6121 - Jabber/XMPP中文翻译计划</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.18.2" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Jabber/XMPP中文翻译计划 (zh-cn)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.jabbercn.org/api.php?action=rsd" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/" />
<link rel="alternate" type="application/atom+xml" title="Jabber/XMPP中文翻译计划的Atom" href="/index.php?title=%E7%89%B9%E6%AE%8A:%E6%9C%80%E8%BF%91%E6%9B%B4%E6%94%B9&amp;feed=atom" />
<link rel="stylesheet" href="/load.php?debug=false&amp;lang=zh-cn&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cskins.monobook&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE50Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE55Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/skins/monobook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/skins/monobook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}a.new,#quickbar a.new{color:#ba0000}

/* cache key: mediawiki:resourceloader:filter:minify-css:4:c88e2bcd56513749bec09a7e29cb3ffa */</style>
<script src="/load.php?debug=false&amp;lang=zh-cn&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
	mw.config.set({"wgCanonicalNamespace": "", "wgCanonicalSpecialPageName": false, "wgNamespaceNumber": 0, "wgPageName": "RFC6121", "wgTitle": "RFC6121", "wgCurRevisionId": 3578, "wgArticleId": 748, "wgIsArticle": true, "wgAction": "view", "wgUserName": null, "wgUserGroups": ["*"], "wgCategories": ["XMPP相关RFC", "XMPP核心RFC", "已翻译"], "wgBreakFrames": false, "wgRestrictionEdit": [], "wgRestrictionMove": [], "wgSearchNamespaces": [0]});
}
</script><script>if(window.mw){
	mw.loader.load(["mediawiki.page.startup"]);
}
</script>
<style type="text/css">/*<![CDATA[*/
.source-text {border: 1px dashed #2f6fab; color: black; background-color: #f9f9f9;}
.source-text li, .source-text pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for text
 * CSS class: source-text, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-text .de1, .source-text .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-text  {font-family: monospace;}
.source-text .imp {font-weight: bold; color: red;}
.source-text li, .source-text li.li1 {font-weight: normal;}
.source-text li.li2 {font-weight: bold;}
.source-text .ln-xtra, .source-text li.ln-xtra, .source-text div.ln-xtra {background-color: #ffc;}
.source-text span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-xml {border: 1px dashed #2f6fab; color: black; background-color: #f9f9f9;}
.source-xml li, .source-xml pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for xml
 * CSS class: source-xml, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-xml .de1, .source-xml .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-xml  {font-family: monospace;}
.source-xml .imp {font-weight: bold; color: red;}
.source-xml li, .source-xml li.li1 {font-weight: normal;}
.source-xml li.li2 {font-weight: bold;}
.source-xml .co1 {color: #808080; font-style: italic;}
.source-xml .co2 {color: #404040; font-style: italic;}
.source-xml .co3 {color: #000000;}
.source-xml .co4 {color: #400000; font-weight: bold;}
.source-xml .es0 {color: #000099; font-weight: bold;}
.source-xml .br0 {color: #66cc66;}
.source-xml .sy0 {color: #66cc66;}
.source-xml .st0 {color: #ff0000;}
.source-xml .nu0 {color: #cc66cc;}
.source-xml .re0 {color: #000066;}
.source-xml .re1 {color: #000000; font-weight: bold;}
.source-xml .re2 {color: #000000; font-weight: bold;}
.source-xml .ln-xtra, .source-xml li.ln-xtra, .source-xml div.ln-xtra {background-color: #ffc;}
.source-xml span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-RFC6121 action-view skin-monobook">
<div id="globalWrapper">
<div id="column-content"><div id="content">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading">RFC6121</h1>
	<div id="bodyContent">
		<div id="siteSub">来自Jabber/XMPP中文翻译计划</div>
		<div id="contentSub"></div>
		<div id="jump-to-nav">跳转到： <a href="#column-one">导航</a>, <a href="#searchInput">搜索</a></div>
		<!-- start content -->
<div lang="zh-cn" dir="ltr" class="mw-content-ltr"><p><b>本文的英文原文来自<a rel="nofollow" class="external text" href="http://xmpp.org/rfcs/rfc6121.html">RFC 6121</a></b>
</p>
<table border="1" cellspacing="0" width="65%">
<tr>
<td>互联网工程任务组(IETF) </td>
<td> P. Saint-Andre
</td></tr>
<tr>
<td>申请讨论: 6121 </td>
<td> Cisco
</td></tr>
<tr>
<td>取代: 3921 </td>
<td> 2011年3月
</td></tr>
<tr>
<td>类别: 标准跟踪 </td>
<td>
</td></tr>
<tr>
<td>ISSN: 2070-1721 </td>
<td>
</td></tr></table>
<dl><dd><dl><dd><dl><dd><b>可扩展的消息和出席信息协议 (XMPP): 即时消息和出席信息</b>
</dd></dl>
</dd></dl>
</dd></dl>
<p><b>摘要</b>
</p>
<dl><dd>本文定义提供了遵循RFC2779要求的基本的即时消息(IM)和出席信息功能的可扩展的消息和出席信息协议(XMPP)的核心功能的扩展. 本文取代了 <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>.
</dd></dl>
<p><b>本文的状态</b>
</p>
<dl><dd>这是一个互联网标准跟踪文档.
</dd></dl>
<dl><dd>本文是互联网工程工作组(IETF)的一个成果. 它代表了IETF社区的一致意见. 它已经公开审核并由互联网工程控制组(IESG)批准发布了. 更多关于互联网标准的信息请参见<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc5741">RFC 5741</a>第2章.
</dd></dl>
<dl><dd>关于本文当前状态的信息, 任何错误, 以及如何对它提出反馈，请到 <a rel="nofollow" class="external free" href="http://www.rfc-editor.org/info/rfc6121">http://www.rfc-editor.org/info/rfc6121</a> .
</dd></dl>
<p><b>版权声明</b>
</p>
<dl><dd>Copyright (c) 2011 IETF Trust and the persons identified as the document authors. All rights reserved.
</dd></dl>
<dl><dd>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (<a rel="nofollow" class="external free" href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.
</dd></dl>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>目录</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#.E5.BA.8F.E8.AE.BA"><span class="tocnumber">1</span> <span class="toctext">序论</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#.E6.A6.82.E8.BF.B0"><span class="tocnumber">1.1</span> <span class="toctext">概述</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#.E5.8E.86.E5.8F.B2"><span class="tocnumber">1.2</span> <span class="toctext">历史</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#.E9.9C.80.E6.B1.82"><span class="tocnumber">1.3</span> <span class="toctext">需求</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#.E5.8A.9F.E8.83.BD.E6.B1.87.E6.80.BB"><span class="tocnumber">1.4</span> <span class="toctext">功能汇总</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#.E6.9C.AF.E8.AF.AD"><span class="tocnumber">1.5</span> <span class="toctext">术语</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#.E7.AE.A1.E7.90.86.E5.90.8D.E5.86.8C"><span class="tocnumber">2</span> <span class="toctext">管理名册</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#.E8.AF.AD.E6.B3.95.E5.92.8C.E8.AF.AD.E4.B9.89"><span class="tocnumber">2.1</span> <span class="toctext">语法和语义</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Ver.E5.B1.9E.E6.80.A7"><span class="tocnumber">2.1.1</span> <span class="toctext">Ver属性</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#.E5.90.8D.E5.86.8C.E6.9D.A1.E7.9B.AE"><span class="tocnumber">2.1.2</span> <span class="toctext">名册条目</span></a>
<ul>
<li class="toclevel-4 tocsection-11"><a href="#Approved.E5.B1.9E.E6.80.A7"><span class="tocnumber">2.1.2.1</span> <span class="toctext">Approved属性</span></a></li>
<li class="toclevel-4 tocsection-12"><a href="#Ask.E5.B1.9E.E6.80.A7"><span class="tocnumber">2.1.2.2</span> <span class="toctext">Ask属性</span></a></li>
<li class="toclevel-4 tocsection-13"><a href="#JID.E5.B1.9E.E6.80.A7"><span class="tocnumber">2.1.2.3</span> <span class="toctext">JID属性</span></a></li>
<li class="toclevel-4 tocsection-14"><a href="#Name.E5.B1.9E.E6.80.A7"><span class="tocnumber">2.1.2.4</span> <span class="toctext">Name属性</span></a></li>
<li class="toclevel-4 tocsection-15"><a href="#Subscription.E5.B1.9E.E6.80.A7"><span class="tocnumber">2.1.2.5</span> <span class="toctext">Subscription属性</span></a></li>
<li class="toclevel-4 tocsection-16"><a href="#Group.E5.B1.9E.E6.80.A7"><span class="tocnumber">2.1.2.6</span> <span class="toctext">Group属性</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-17"><a href="#.E5.90.8D.E5.86.8C.E8.8E.B7.E5.8F.96"><span class="tocnumber">2.1.3</span> <span class="toctext">名册获取</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="#.E5.90.8D.E5.86.8C.E7.BB.93.E6.9E.9C"><span class="tocnumber">2.1.4</span> <span class="toctext">名册结果</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#.E5.90.8D.E5.86.8C.E8.AE.BE.E7.BD.AE"><span class="tocnumber">2.1.5</span> <span class="toctext">名册设置</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#.E5.90.8D.E5.86.8C.E6.8E.A8.E9.80.81"><span class="tocnumber">2.1.6</span> <span class="toctext">名册推送</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-21"><a href="#.E7.99.BB.E9.99.86.E6.97.B6.E6.8E.A5.E6.94.B6.E5.90.8D.E5.86.8C"><span class="tocnumber">2.2</span> <span class="toctext">登陆时接收名册</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#.E6.B7.BB.E5.8A.A0.E4.B8.80.E4.B8.AA.E5.90.8D.E5.86.8C.E6.9D.A1.E7.9B.AE"><span class="tocnumber">2.3</span> <span class="toctext">添加一个名册条目</span></a>
<ul>
<li class="toclevel-3 tocsection-23"><a href="#.E8.AF.B7.E6.B1.82"><span class="tocnumber">2.3.1</span> <span class="toctext">请求</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#.E6.88.90.E5.8A.9F.E6.83.85.E6.99.AF"><span class="tocnumber">2.3.2</span> <span class="toctext">成功情景</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="#.E9.94.99.E8.AF.AF.E6.83.85.E6.99.AF"><span class="tocnumber">2.3.3</span> <span class="toctext">错误情景</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-26"><a href="#.E6.9B.B4.E6.96.B0.E4.B8.80.E4.B8.AA.E5.90.8D.E5.86.8C.E6.9D.A1.E7.9B.AE"><span class="tocnumber">2.4</span> <span class="toctext">更新一个名册条目</span></a>
<ul>
<li class="toclevel-3 tocsection-27"><a href="#.E8.AF.B7.E6.B1.82_2"><span class="tocnumber">2.4.1</span> <span class="toctext">请求</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="#.E6.88.90.E5.8A.9F.E6.83.85.E6.99.AF_2"><span class="tocnumber">2.4.2</span> <span class="toctext">成功情景</span></a></li>
<li class="toclevel-3 tocsection-29"><a href="#.E9.94.99.E8.AF.AF.E6.83.85.E6.99.AF_2"><span class="tocnumber">2.4.3</span> <span class="toctext">错误情景</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-30"><a href="#.E5.88.A0.E9.99.A4.E4.B8.80.E4.B8.AA.E5.90.8D.E5.86.8C.E6.9D.A1.E7.9B.AE"><span class="tocnumber">2.5</span> <span class="toctext">删除一个名册条目</span></a>
<ul>
<li class="toclevel-3 tocsection-31"><a href="#.E8.AF.B7.E6.B1.82_3"><span class="tocnumber">2.5.1</span> <span class="toctext">请求</span></a></li>
<li class="toclevel-3 tocsection-32"><a href="#.E6.88.90.E5.8A.9F.E6.83.85.E6.99.AF_3"><span class="tocnumber">2.5.2</span> <span class="toctext">成功情景</span></a></li>
<li class="toclevel-3 tocsection-33"><a href="#.E9.94.99.E8.AF.AF.E6.83.85.E6.99.AF_3"><span class="tocnumber">2.5.3</span> <span class="toctext">错误情景</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-34"><a href="#.E5.90.8D.E5.86.8C.E7.89.88.E6.9C.AC"><span class="tocnumber">2.6</span> <span class="toctext">名册版本</span></a>
<ul>
<li class="toclevel-3 tocsection-35"><a href="#.E6.B5.81.E7.89.B9.E6.80.A7"><span class="tocnumber">2.6.1</span> <span class="toctext">流特性</span></a></li>
<li class="toclevel-3 tocsection-36"><a href="#.E8.AF.B7.E6.B1.82_4"><span class="tocnumber">2.6.2</span> <span class="toctext">请求</span></a></li>
<li class="toclevel-3 tocsection-37"><a href="#.E6.88.90.E5.8A.9F.E6.83.85.E6.99.AF_4"><span class="tocnumber">2.6.3</span> <span class="toctext">成功情景</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-38"><a href="#.E7.AE.A1.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85"><span class="tocnumber">3</span> <span class="toctext">管理出席信息订阅</span></a>
<ul>
<li class="toclevel-2 tocsection-39"><a href="#.E8.AF.B7.E6.B1.82.E8.AE.A2.E9.98.85"><span class="tocnumber">3.1</span> <span class="toctext">请求订阅</span></a>
<ul>
<li class="toclevel-3 tocsection-40"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E5.87.BA.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82"><span class="tocnumber">3.1.1</span> <span class="toctext">客户端生成出站订阅请求</span></a></li>
<li class="toclevel-3 tocsection-41"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82"><span class="tocnumber">3.1.2</span> <span class="toctext">服务器处理出站订阅请求</span></a></li>
<li class="toclevel-3 tocsection-42"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82"><span class="tocnumber">3.1.3</span> <span class="toctext">服务器处理入站订阅请求</span></a></li>
<li class="toclevel-3 tocsection-43"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82"><span class="tocnumber">3.1.4</span> <span class="toctext">客户端处理入站订阅请求</span></a></li>
<li class="toclevel-3 tocsection-44"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E8.AE.A2.E9.98.85.E6.89.B9.E5.87.86"><span class="tocnumber">3.1.5</span> <span class="toctext">服务器处理出站订阅批准</span></a></li>
<li class="toclevel-3 tocsection-45"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E8.AE.A2.E9.98.85.E6.89.B9.E5.87.86"><span class="tocnumber">3.1.6</span> <span class="toctext">服务器处理入站订阅批准</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-46"><a href="#.E6.92.A4.E9.94.80.E8.A2.AB.E8.AE.A2.E9.98.85"><span class="tocnumber">3.2</span> <span class="toctext">撤销被订阅</span></a>
<ul>
<li class="toclevel-3 tocsection-47"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E6.92.A4.E9.94.80.E8.A2.AB.E8.AE.A2.E9.98.85"><span class="tocnumber">3.2.1</span> <span class="toctext">客户端生成撤销被订阅</span></a></li>
<li class="toclevel-3 tocsection-48"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E8.A2.AB.E8.AE.A2.E9.98.85.E6.92.A4.E9.94.80"><span class="tocnumber">3.2.2</span> <span class="toctext">服务器处理出站被订阅撤销</span></a></li>
<li class="toclevel-3 tocsection-49"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E8.A2.AB.E8.AE.A2.E9.98.85.E6.92.A4.E9.94.80"><span class="tocnumber">3.2.3</span> <span class="toctext">服务器处理入站被订阅撤销</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-50"><a href="#.E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85"><span class="tocnumber">3.3</span> <span class="toctext">取消订阅</span></a>
<ul>
<li class="toclevel-3 tocsection-51"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85"><span class="tocnumber">3.3.1</span> <span class="toctext">客户端生成取消订阅</span></a></li>
<li class="toclevel-3 tocsection-52"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85"><span class="tocnumber">3.3.2</span> <span class="toctext">服务器处理出站取消订阅</span></a></li>
<li class="toclevel-3 tocsection-53"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85"><span class="tocnumber">3.3.3</span> <span class="toctext">服务器处理入站取消订阅</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-54"><a href="#.E9.A2.84.E6.89.B9.E5.87.86.E8.A2.AB.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82"><span class="tocnumber">3.4</span> <span class="toctext">预批准被订阅请求</span></a>
<ul>
<li class="toclevel-3 tocsection-55"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E8.A2.AB.E8.AE.A2.E9.98.85.E9.A2.84.E6.89.B9.E5.87.86"><span class="tocnumber">3.4.1</span> <span class="toctext">客户端生成被订阅预批准</span></a></li>
<li class="toclevel-3 tocsection-56"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E8.A2.AB.E8.AE.A2.E9.98.85.E9.A2.84.E6.89.B9.E5.87.86"><span class="tocnumber">3.4.2</span> <span class="toctext">服务器处理被订阅预批准</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-57"><a href="#.E4.BA.A4.E6.8D.A2.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4</span> <span class="toctext">交换出席信息</span></a>
<ul>
<li class="toclevel-2 tocsection-58"><a href="#.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E5.8E.9F.E7.90.86"><span class="tocnumber">4.1</span> <span class="toctext">出席信息原理</span></a></li>
<li class="toclevel-2 tocsection-59"><a href="#.E5.88.9D.E5.A7.8B.E5.8C.96.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.2</span> <span class="toctext">初始化出席信息</span></a>
<ul>
<li class="toclevel-3 tocsection-60"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E5.88.9D.E5.A7.8B.E5.8C.96.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.2.1</span> <span class="toctext">客户端生成初始化出席信息</span></a></li>
<li class="toclevel-3 tocsection-61"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E5.88.9D.E5.A7.8B.E5.8C.96.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.2.2</span> <span class="toctext">服务器处理出站初始化出席信息</span></a></li>
<li class="toclevel-3 tocsection-62"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.88.9D.E5.A7.8B.E5.8C.96.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.2.3</span> <span class="toctext">服务器处理入站初始化出席信息</span></a></li>
<li class="toclevel-3 tocsection-63"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E5.88.9D.E5.A7.8B.E5.8C.96.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.2.4</span> <span class="toctext">客户端处理初始化出席信息</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-64"><a href="#.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B"><span class="tocnumber">4.3</span> <span class="toctext">出席信息探测</span></a>
<ul>
<li class="toclevel-3 tocsection-65"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E7.94.9F.E6.88.90.E5.87.BA.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B"><span class="tocnumber">4.3.1</span> <span class="toctext">服务器生成出站出席信息探测</span></a></li>
<li class="toclevel-3 tocsection-66"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B"><span class="tocnumber">4.3.2</span> <span class="toctext">服务器处理入站出席信息探测</span></a>
<ul>
<li class="toclevel-4 tocsection-67"><a href="#.E5.A4.84.E7.90.86.27id.27.E5.B1.9E.E6.80.A7"><span class="tocnumber">4.3.2.1</span> <span class="toctext">处理'id'属性</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-68"><a href="#.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E5.B9.BF.E6.92.AD"><span class="tocnumber">4.4</span> <span class="toctext">随后的出席信息广播</span></a>
<ul>
<li class="toclevel-3 tocsection-69"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E5.B9.BF.E6.92.AD"><span class="tocnumber">4.4.1</span> <span class="toctext">客户端生成随后的出席信息广播</span></a></li>
<li class="toclevel-3 tocsection-70"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.4.2</span> <span class="toctext">服务器处理随后的出站出席信息</span></a></li>
<li class="toclevel-3 tocsection-71"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.85.A5.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.4.3</span> <span class="toctext">服务器处理随后的入站出席信息</span></a></li>
<li class="toclevel-3 tocsection-72"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.4.4</span> <span class="toctext">客户端处理随后的出席信息</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-73"><a href="#.E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.5</span> <span class="toctext">离线出席信息</span></a>
<ul>
<li class="toclevel-3 tocsection-74"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.5.1</span> <span class="toctext">客户端生成离线出席信息</span></a></li>
<li class="toclevel-3 tocsection-75"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.5.2</span> <span class="toctext">服务器处理出站离线出席信息</span></a></li>
<li class="toclevel-3 tocsection-76"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.5.3</span> <span class="toctext">服务器处理入站离线出席信息</span></a></li>
<li class="toclevel-3 tocsection-77"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.5.4</span> <span class="toctext">客户端处理离线出席信息</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-78"><a href="#.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.6</span> <span class="toctext">定向出席信息</span></a>
<ul>
<li class="toclevel-3 tocsection-79"><a href="#.E6.80.BB.E5.88.99"><span class="tocnumber">4.6.1</span> <span class="toctext">总则</span></a></li>
<li class="toclevel-3 tocsection-80"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.6.2</span> <span class="toctext">客户端生成定向出席信息</span></a></li>
<li class="toclevel-3 tocsection-81"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.6.3</span> <span class="toctext">服务器处理出站定向出席信息</span></a></li>
<li class="toclevel-3 tocsection-82"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.6.4</span> <span class="toctext">服务器处理入站定向出席信息</span></a></li>
<li class="toclevel-3 tocsection-83"><a href="#.E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF"><span class="tocnumber">4.6.5</span> <span class="toctext">客户端处理入站定向出席信息</span></a></li>
<li class="toclevel-3 tocsection-84"><a href="#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B"><span class="tocnumber">4.6.6</span> <span class="toctext">服务器处理出席信息探测</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-85"><a href="#.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AF.AD.E6.B3.95"><span class="tocnumber">4.7</span> <span class="toctext">出席信息语法</span></a>
<ul>
<li class="toclevel-3 tocsection-86"><a href="#Type.E5.B1.9E.E6.80.A7"><span class="tocnumber">4.7.1</span> <span class="toctext">Type属性</span></a></li>
<li class="toclevel-3 tocsection-87"><a href="#.E5.AD.90.E5.85.83.E7.B4.A0"><span class="tocnumber">4.7.2</span> <span class="toctext">子元素</span></a>
<ul>
<li class="toclevel-4 tocsection-88"><a href="#Show.E5.85.83.E7.B4.A0"><span class="tocnumber">4.7.2.1</span> <span class="toctext">Show元素</span></a></li>
<li class="toclevel-4 tocsection-89"><a href="#Status.E5.85.83.E7.B4.A0"><span class="tocnumber">4.7.2.2</span> <span class="toctext">Status元素</span></a></li>
<li class="toclevel-4 tocsection-90"><a href="#Priority.E5.85.83.E7.B4.A0"><span class="tocnumber">4.7.2.3</span> <span class="toctext">Priority元素</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-91"><a href="#.E6.89.A9.E5.B1.95.E5.86.85.E5.AE.B9"><span class="tocnumber">4.7.3</span> <span class="toctext">扩展内容</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-92"><a href="#.E4.BA.A4.E6.8D.A2.E6.B6.88.E6.81.AF"><span class="tocnumber">5</span> <span class="toctext">交换消息</span></a>
<ul>
<li class="toclevel-2 tocsection-93"><a href="#.E4.B8.80.E5.AF.B9.E4.B8.80.E8.81.8A.E5.A4.A9.E4.BC.9A.E8.AF.9D"><span class="tocnumber">5.1</span> <span class="toctext">一对一聊天会话</span></a></li>
<li class="toclevel-2 tocsection-94"><a href="#.E6.B6.88.E6.81.AF.E8.AF.AD.E6.B3.95"><span class="tocnumber">5.2</span> <span class="toctext">消息语法</span></a>
<ul>
<li class="toclevel-3 tocsection-95"><a href="#To.E5.B1.9E.E6.80.A7"><span class="tocnumber">5.2.1</span> <span class="toctext">To属性</span></a></li>
<li class="toclevel-3 tocsection-96"><a href="#Type.E5.B1.9E.E6.80.A7_2"><span class="tocnumber">5.2.2</span> <span class="toctext">Type属性</span></a></li>
<li class="toclevel-3 tocsection-97"><a href="#Body.E5.85.83.E7.B4.A0"><span class="tocnumber">5.2.3</span> <span class="toctext">Body元素</span></a></li>
<li class="toclevel-3 tocsection-98"><a href="#Subject.E5.85.83.E7.B4.A0"><span class="tocnumber">5.2.4</span> <span class="toctext">Subject元素</span></a></li>
<li class="toclevel-3 tocsection-99"><a href="#Thread.E5.85.83.E7.B4.A0"><span class="tocnumber">5.2.5</span> <span class="toctext">Thread元素</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-100"><a href="#.E6.89.A9.E5.B1.95.E5.86.85.E5.AE.B9_2"><span class="tocnumber">5.3</span> <span class="toctext">扩展内容</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-101"><a href="#.E4.BA.A4.E6.8D.A2IQ.E8.8A.82"><span class="tocnumber">6</span> <span class="toctext">交换IQ节</span></a></li>
<li class="toclevel-1 tocsection-102"><a href="#.E7.A4.BA.E4.BE.8B.E4.BC.9A.E8.AF.9D"><span class="tocnumber">7</span> <span class="toctext">示例会话</span></a></li>
<li class="toclevel-1 tocsection-103"><a href="#.E5.A4.84.E7.90.86XML.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.A7.84.E5.88.99"><span class="tocnumber">8</span> <span class="toctext">处理XML节的服务器规则</span></a>
<ul>
<li class="toclevel-2 tocsection-104"><a href="#.E5.B8.B8.E8.A7.84.E4.BA.8B.E9.A1.B9"><span class="tocnumber">8.1</span> <span class="toctext">常规事项</span></a></li>
<li class="toclevel-2 tocsection-105"><a href="#.E6.97.A0.27to.27.E5.9C.B0.E5.9D.80"><span class="tocnumber">8.2</span> <span class="toctext">无'to'地址</span></a></li>
<li class="toclevel-2 tocsection-106"><a href="#.E8.BF.9C.E7.AB.AF.E5.9F.9F"><span class="tocnumber">8.3</span> <span class="toctext">远端域</span></a></li>
<li class="toclevel-2 tocsection-107"><a href="#.E6.9C.AC.E5.9C.B0.E5.9F.9F"><span class="tocnumber">8.4</span> <span class="toctext">本地域</span></a></li>
<li class="toclevel-2 tocsection-108"><a href="#.E6.9C.AC.E5.9C.B0.E7.94.A8.E6.88.B7"><span class="tocnumber">8.5</span> <span class="toctext">本地用户</span></a>
<ul>
<li class="toclevel-3 tocsection-109"><a href="#.E6.97.A0.E8.AF.A5.E7.94.A8.E6.88.B7"><span class="tocnumber">8.5.1</span> <span class="toctext">无该用户</span></a></li>
<li class="toclevel-3 tocsection-110"><a href="#.E6.9C.AC.E5.9C.B0.E9.83.A8.E5.88.86.40.E5.9F.9F.E9.83.A8.E5.88.86"><span class="tocnumber">8.5.2</span> <span class="toctext">本地部分@域部分</span></a>
<ul>
<li class="toclevel-4 tocsection-111"><a href="#.E5.8F.AF.E7.94.A8.E6.88.96.E5.B7.B2.E8.BF.9E.E6.8E.A5.E7.9A.84.E8.B5.84.E6.BA.90"><span class="tocnumber">8.5.2.1</span> <span class="toctext">可用或已连接的资源</span></a>
<ul>
<li class="toclevel-5 tocsection-112"><a href="#Message"><span class="tocnumber">8.5.2.1.1</span> <span class="toctext">Message</span></a></li>
<li class="toclevel-5 tocsection-113"><a href="#Presence"><span class="tocnumber">8.5.2.1.2</span> <span class="toctext">Presence</span></a></li>
<li class="toclevel-5 tocsection-114"><a href="#IQ"><span class="tocnumber">8.5.2.1.3</span> <span class="toctext">IQ</span></a></li>
</ul>
</li>
<li class="toclevel-4 tocsection-115"><a href="#.E6.97.A0.E5.8F.AF.E7.94.A8.E6.88.96.E5.B7.B2.E8.BF.9E.E6.8E.A5.E7.9A.84.E8.B5.84.E6.BA.90"><span class="tocnumber">8.5.2.2</span> <span class="toctext">无可用或已连接的资源</span></a>
<ul>
<li class="toclevel-5 tocsection-116"><a href="#Message_2"><span class="tocnumber">8.5.2.2.1</span> <span class="toctext">Message</span></a></li>
<li class="toclevel-5 tocsection-117"><a href="#Presence_2"><span class="tocnumber">8.5.2.2.2</span> <span class="toctext">Presence</span></a></li>
<li class="toclevel-5 tocsection-118"><a href="#IQ_2"><span class="tocnumber">8.5.2.2.3</span> <span class="toctext">IQ</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-119"><a href="#.E6.9C.AC.E5.9C.B0.E9.83.A8.E5.88.86.40.E5.9F.9F.E9.83.A8.E5.88.86.2F.E8.B5.84.E6.BA.90.E9.83.A8.E5.88.86"><span class="tocnumber">8.5.3</span> <span class="toctext">本地部分@域部分/资源部分</span></a>
<ul>
<li class="toclevel-4 tocsection-120"><a href="#.E8.B5.84.E6.BA.90.E5.8C.B9.E9.85.8D"><span class="tocnumber">8.5.3.1</span> <span class="toctext">资源匹配</span></a></li>
<li class="toclevel-4 tocsection-121"><a href="#.E6.97.A0.E8.B5.84.E6.BA.90.E5.8C.B9.E9.85.8D"><span class="tocnumber">8.5.3.2</span> <span class="toctext">无资源匹配</span></a>
<ul>
<li class="toclevel-5 tocsection-122"><a href="#Message_3"><span class="tocnumber">8.5.3.2.1</span> <span class="toctext">Message</span></a></li>
<li class="toclevel-5 tocsection-123"><a href="#Presence_3"><span class="tocnumber">8.5.3.2.2</span> <span class="toctext">Presence</span></a></li>
<li class="toclevel-5 tocsection-124"><a href="#IQ_3"><span class="tocnumber">8.5.3.2.3</span> <span class="toctext">IQ</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-3 tocsection-125"><a href="#.E6.B6.88.E6.81.AF.E9.80.92.E9.80.81.E8.A7.84.E5.88.99.E7.9A.84.E6.80.BB.E7.BB.93"><span class="tocnumber">8.5.4</span> <span class="toctext">消息递送规则的总结</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-126"><a href="#URIs.E7.9A.84.E5.A4.84.E7.90.86"><span class="tocnumber">9</span> <span class="toctext">URIs的处理</span></a></li>
<li class="toclevel-1 tocsection-127"><a href="#.E5.9B.BD.E9.99.85.E5.8C.96.E4.BA.8B.E9.A1.B9"><span class="tocnumber">10</span> <span class="toctext">国际化事项</span></a></li>
<li class="toclevel-1 tocsection-128"><a href="#.E5.AE.89.E5.85.A8.E4.BA.8B.E9.A1.B9"><span class="tocnumber">11</span> <span class="toctext">安全事项</span></a></li>
<li class="toclevel-1 tocsection-129"><a href="#.E4.B8.80.E8.87.B4.E6.80.A7.E9.9C.80.E6.B1.82"><span class="tocnumber">12</span> <span class="toctext">一致性需求</span></a></li>
<li class="toclevel-1 tocsection-130"><a href="#.E5.8F.82.E8.80.83"><span class="tocnumber">13</span> <span class="toctext">参考</span></a>
<ul>
<li class="toclevel-2 tocsection-131"><a href="#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8"><span class="tocnumber">13.1</span> <span class="toctext">规范引用</span></a></li>
<li class="toclevel-2 tocsection-132"><a href="#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE"><span class="tocnumber">13.2</span> <span class="toctext">参考文献</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-133"><a href="#.E9.99.84.E5.BD.95A._.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81"><span class="tocnumber">14</span> <span class="toctext">附录A. 订阅状态</span></a>
<ul>
<li class="toclevel-2 tocsection-134"><a href="#A.1._.E5.B7.B2.E5.AE.9A.E4.B9.89.E7.9A.84.E7.8A.B6.E6.80.81"><span class="tocnumber">14.1</span> <span class="toctext">A.1. 已定义的状态</span></a></li>
<li class="toclevel-2 tocsection-135"><a href="#A.2._.E5.87.BA.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86"><span class="tocnumber">14.2</span> <span class="toctext">A.2. 出站出席信息订阅节的服务器处理</span></a>
<ul>
<li class="toclevel-3 tocsection-136"><a href="#A.2.1._Subscribe"><span class="tocnumber">14.2.1</span> <span class="toctext">A.2.1. Subscribe</span></a></li>
<li class="toclevel-3 tocsection-137"><a href="#A.2.2._Unsubscribe"><span class="tocnumber">14.2.2</span> <span class="toctext">A.2.2. Unsubscribe</span></a></li>
<li class="toclevel-3 tocsection-138"><a href="#A.2.3._Subscribed"><span class="tocnumber">14.2.3</span> <span class="toctext">A.2.3. Subscribed</span></a></li>
<li class="toclevel-3 tocsection-139"><a href="#A.2.4._Unsubscribed"><span class="tocnumber">14.2.4</span> <span class="toctext">A.2.4. Unsubscribed</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-140"><a href="#A.3._.E5.85.A5.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86"><span class="tocnumber">14.3</span> <span class="toctext">A.3. 入站出席信息订阅节的服务器处理</span></a>
<ul>
<li class="toclevel-3 tocsection-141"><a href="#A.3.1._Subscribe"><span class="tocnumber">14.3.1</span> <span class="toctext">A.3.1. Subscribe</span></a></li>
<li class="toclevel-3 tocsection-142"><a href="#A.3.2._Unsubscribe"><span class="tocnumber">14.3.2</span> <span class="toctext">A.3.2. Unsubscribe</span></a></li>
<li class="toclevel-3 tocsection-143"><a href="#A.3.3._Subscribed"><span class="tocnumber">14.3.3</span> <span class="toctext">A.3.3. Subscribed</span></a></li>
<li class="toclevel-3 tocsection-144"><a href="#A.3.4._Unsubscribed"><span class="tocnumber">14.3.4</span> <span class="toctext">A.3.4. Unsubscribed</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-145"><a href="#.E9.99.84.E5.BD.95B._.E9.99.90.E5.88.B6.E9.80.9A.E8.AE.AF"><span class="tocnumber">15</span> <span class="toctext">附录B. 限制通讯</span></a></li>
<li class="toclevel-1 tocsection-146"><a href="#.E9.99.84.E5.BD.95C._vCards"><span class="tocnumber">16</span> <span class="toctext">附录C. vCards</span></a></li>
<li class="toclevel-1 tocsection-147"><a href="#.E9.99.84.E5.BD.95D._.E7.94.A8.E4.BA.8Ejabber:iq:roster.E7.9A.84XML_Schema"><span class="tocnumber">17</span> <span class="toctext">附录D. 用于jabber:iq:roster的XML Schema</span></a></li>
<li class="toclevel-1 tocsection-148"><a href="#.E9.99.84.E5.BD.95E._.E5.92.8CRFC_3921.E7.9A.84.E4.B8.8D.E5.90.8C"><span class="tocnumber">18</span> <span class="toctext">附录E. 和RFC 3921的不同</span></a></li>
<li class="toclevel-1 tocsection-149"><a href="#.E9.99.84.E5.BD.95F._.E8.87.B4.E8.B0.A2"><span class="tocnumber">19</span> <span class="toctext">附录F. 致谢</span></a></li>
<li class="toclevel-1 tocsection-150"><a href="#.E4.BD.9C.E8.80.85.E7.9A.84.E5.9C.B0.E5.9D.80"><span class="tocnumber">20</span> <span class="toctext">作者的地址</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id=".E5.BA.8F.E8.AE.BA">序论</span></h2>
<h3> <span class="mw-headline" id=".E6.A6.82.E8.BF.B0">概述</span></h3>
<p>可扩展的消息和出席信息协议(XMPP)是可扩展的标记语言<a href="/RFC6121#.E5.B8.B8.E8.A7.84.E5.A4.87.E6.B3.A8" title="RFC6121">XML</a>的一个应用范畴,它能使两个或更多网络实体之间的结构化并且可扩展的数据进行准实时的交换. 在<a href="/RFC6120" title="RFC6120">XMPP‑CORE</a>中定义的XMPP的核心特性提供了各种类型的准实时应用的积木, 通过发送由特定的XML命名空间(参考<a href="/RFC6121#.E5.B8.B8.E8.A7.84.E5.A4.87.E6.B3.A8" title="RFC6121">XML‑NAMES</a>)所限定的应用特有的数据,它们可被叠加在核心之上. 本文定义的XMPP扩展提供一个<a href="/RFC6121#.E6.8F.90.E7.A4.BA.E6.80.A7.E5.A4.87.E6.B3.A8" title="RFC6121">IMP‑REQS</a>所述的即时消息(IM)和出席信息应用所预期的基本功能.
</p>
<h3> <span class="mw-headline" id=".E5.8E.86.E5.8F.B2">历史</span></h3>
<p>XMPP的基本语法和语义最开始是由Jabber开源社区开发的, 主要是在1999年. 2002年, 根据 <a href="/RFC6121#.E6.8F.90.E7.A4.BA.E6.80.A7.E5.A4.87.E6.B3.A8" title="RFC6121">IMP‑REQS</a> ，XMPP工作组被允许基于Jabber协议开发一个适合IETF的即时消息和出席信息技术. 到了2004年10月, 发布了 <a href="/RFC3920" title="RFC3920">RFC3920</a> 和 <a href="/RFC3921" title="RFC3921">RFC3921</a> , 意味着那时候XMPP的主要定义完成了.
</p><p>从2004年开始，互联网社区已经获得了广泛的XMPP实现和布署经验, 包括XMPP标准基金会(XSF)主持下开展的正式的互操作性测试. 本文全面整合了从软件开发者和XMPP服务提供者得到的反馈, 包含了一系列向后兼容的修改，见 <a href="/RFC6121#.E9.99.84.E5.BD.95E:.E5.92.8CRFC3921.E7.9A.84.E4.B8.8D.E5.90.8C" title="RFC6121">附录E</a> . 结果是, 本文反映了互联网社区对于XMPP1.0的即时消息和出席信息特性的初步共识, 因此废止了<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>.
</p>
<h3> <span class="mw-headline" id=".E9.9C.80.E6.B1.82">需求</span></h3>
<p>传统上, IM应用组合了以下因素:
</p>
<dl><dd><ol><li> 关注的中心点是某人的联系人的列表或 "好友们" (在XMPP中这个列表被称为一个 "roster"(名册)).
</li><li> 使用这类应用的目标是和特定的联系人准实时地交换相关的短文本消息 -- 在章节<a href="/RFC6121#.E4.B8.80.E5.AF.B9.E4.B8.80.E8.81.8A.E5.A4.A9.E4.BC.9A.E8.AF.9D" title="RFC6121">5.1</a>描述的一对一形式的"聊天会话"中, 快速连续的相关消息的数量经常是很大的.
</li><li> 交换消息的催化剂是 "presence" -- 即, 关于特定联系人们的网络可用性的信息(这样就知道谁在线并且有空进行一对一的聊天会话).
</li><li> 出席信息仅提供给通过一个被称为"出席信息订阅"的明确协议被授权的联系人.
</li></ol>
</dd></dl>
<p>所以在高层上本文假定用户能完成下列用例:
</p>
<dl><dd><ul><li> 在某人的联系人列表中管理条目
</li><li> 和某人的联系人们交换消息
</li><li> 和某人的联系人们交换出席信息
</li><li> 管理对某人的联系人们发出和接受出席信息的订阅
</li></ul>
</dd></dl>
<p>这些功能性领域的详细定义被包含在 <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2779">RFC 2779</a> <a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">IMP‑REQS</a> 中, 关于深度需求感兴趣的读者可以参考那个文档. 尽管 XMPP IM 和这里定义的出席信息扩展满足了 <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2779">RFC 2779</a> 的需求, 它们不是特意为那个协议设计的, 因为在 <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2779">RFC 2779</a> 出现之前，Jabber开源社区就通过一个开放的开发流程进化出了基本协议. 尽管在XMP标准基金会的XEP系列中发表了一些其他功能领域的XMPP协议扩展(例如, <a href="/XEP-0045" title="XEP-0045">XEP-0045</a>定义的多用户文本聊天), 这类扩展未在本文中定义，因为它们未被 <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2779">RFC 2779</a> 授权.
</p>
<dl><dd>实现备注: <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2779">RFC 2779</a> 规定出席信息服务必须独立于IM服务，反之亦然; 即, 必须有可能使用本协议提供一个出席信息服务, 一个消息服务, 或同时提供两者. 尽管本文的文本假定实现和部署会希望提供统一的IM和出席信息服务, 对于一个XMPP服务来说，并不强制同时提供一个出席信息服务和一个消息服务, 并且协议使得为出席信息和为消息提供独立和特别的服务成为可能. (例如, 如果一个客户端尝试发送一个&lt;message/&gt;节, 一个只有出席信息的服务可能返回一个&lt;service-unavailable/&gt;节错误.)
</dd></dl>
<h3> <span class="mw-headline" id=".E5.8A.9F.E8.83.BD.E6.B1.87.E6.80.BB">功能汇总</span></h3>
<p>这个非规范性的章节提供一个对开发者友好的, 基于XMPP的IM和出席信息特性的功能汇总; 参考接下来的的章节来察看这些特性的规范性的定义.
</p><p><a href="/RFC6120" title="RFC6120">XMPP‑CORE</a> 定义了一个XMPP客户端如何连接到一个XMPP服务器. 特别是, 它定义了客户端在一个XMPP网络中被允许发送XML节(XMPP中的基本含意单位)给其他实体之前需要满足的前提条件. 这些前提条件包括，XML流的协商，XML流头的交换, 可选的通过传输层安全<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">TLS</a>的通道加密, 通过简单验证和安全层<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">SASL</a>强制验证, 和把资源绑定到客户端所在的流上. 关于这些前提条件的细节，读者可以参考 <a href="/RFC6120" title="RFC6120">XMPP‑CORE</a>, <a href="/RFC6120" title="RFC6120">XMPP‑CORE</a> 的知识假定已经在此.
</p>
<dl><dd>互操作性备注: <a href="/RFC3921" title="RFC3921">RFC3921</a> 定义了一个额外的前提条件: 一个即时消息和出席信息会话的正式建立. 实现和部署经验已经表明这个额外的步骤是不必要的. 无论如何, 为了向后兼容，一个实现可以仍提供那个特性. 这使得新软件节省一个回合而旧软件能够连接.
</dd></dl>
<p>满足了<a href="/RFC6120" title="RFC6120">XMPP‑CORE</a>中的前提条件之后, XMPP客户端就有了一个和一个XMPP服务器长连的XML流, 这使得该用户能控制客户端在该流上发送和接收基本上不限数量的XML节. 这样一个流可被用于交换消息, 分享出席信息, 并且准实时地进行结构化的 请求-应答 交互. 在XML流的协商之后, 即时消息和出席信息会话的典型流程如下:
</p>
<dl><dd><ol><li> 接收某人的名册. (见 <a href="/RFC6121#.E7.99.BB.E9.99.86.E6.97.B6.E6.8E.A5.E6.94.B6.E5.90.8D.E5.86.8C" title="RFC6121">章节2.2</a>.)
</li><li> 发送最初的出席信息给服务器用于广播给所有已订阅的联系人, 也就是从XMPP通讯角度来看的 "上线" . (见 <a href="/RFC6121#.E6.9C.80.E5.88.9D.E7.9A.84.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">章节4.2</a> .)
</li><li> 交换消息, 管理出席信息订阅, 执行名册更新, 以及在一般过程中，贯穿该会话生命周期的以特定语义生成的其他XML节. (见 章节 <a href="/RFC6121#.E4.BA.A4.E6.8D.A2.E6.B6.88.E6.81.AF" title="RFC6121">5</a>, <a href="/RFC6121#.E7.AE.A1.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85" title="RFC6121">3</a>, <a href="/RFC6121#.E7.AE.A1.E7.90.86.E5.90.8D.E5.86.8C" title="RFC6121">2</a>, 和 <a href="/RFC6121#.E4.BA.A4.E6.8D.A2IQ.E8.8A.82" title="RFC6121">6</a>.)
</li><li> 当需要的时候，通过发送unavailable出席信息并关闭下面的XML流来中止该会话. (见 <a href="/RFC6121#Unavailable.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">章节4.5</a>.)
</li></ol>
</dd></dl>
<h3> <span class="mw-headline" id=".E6.9C.AF.E8.AF.AD">术语</span></h3>
<p>本文中的关键字 "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", 和 "OPTIONAL" 的解释参见<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2119">RFC 2119</a> <a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">关键字</a> .
</p><p>本文继承了 <a href="/RFC6120" title="RFC6120">XMPP‑CORE</a> 中定义的术语.
</p><p>术语 "automated client" 和 "interactive client" 的含义和 <a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">TLS‑CERTS</a> 中定义的相同.
</p><p>为了方便, 本文借用了术语 "user" 来指代一个XMPP帐号的所有者; 无论如何, 帐号所有者不需要是自然人并且可以是机器人, 设备, 或其他自动化的应用.
</p><p>一些其他的术语, 类似 "interested resource", 在本文的正文中定义.
</p><p>接下来的"XML Notation"用在<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">IRI</a>中展示无法用纯ASCII文档表达的字符串, 本文的一些例子中使用了格式 "&amp;#x...." 作为一个符号设备来展示 <a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">UNICODE</a> 字符串(例如, 字符串 "&#x159;" 代表 Unicode 字符串 LATIN SMALL LETTER R WITH CARON); 这个格式在XMPP系统中绝对不会在网络上被发送.
</p><p>在例子中, 每一行已经被封装成便于阅读的样子, "[...]" 意味着省略, 并且使用了以下前缀(这些前缀不会在通讯中被发送):
</p>
<dl><dd><ul><li> C: = 客户端
</li><li> CC: = 联系人的客户端
</li><li> CS: = 联系人的服务器
</li><li> S: = 服务器
</li><li> UC: = 用户的客户端
</li><li> US: = 用户的服务器
</li></ul>
</dd></dl>
<p>读者需要注意这些例子不包括细节, 并且例子里的一些协议流程中, 展示的备用步骤不一定是由前一个步骤发送的确切的数据触发的; 本文或常用参考文档中的协议规范所用到的所有用例里面提供的例子都遵从上述规则. 所有例子都是虚构的并且交换的信息 (例如, 用户名和密码) 不代表任何现存的用户和服务器.
</p>
<h2> <span class="mw-headline" id=".E7.AE.A1.E7.90.86.E5.90.8D.E5.86.8C">管理名册</span></h2>
<p>在XMPP中， 一个用户的名册包含任意数量的特定联系人。一个用户的花名册由用户的服务器代替用户储存，从而使用户可以从任何资源设备访问花名册信息。当用户添加或修改名册条目时，如果无错误发生，服务器应该尽可能不加修改地存储那些数据，并且当一个授权的客户端请求名册时，服务器必须返回那些数据。
</p>
<dl><dd>安全警告: 因为用户的名册包含保密数据，因此服务器必须限制对这些数据的访问，只有经授权的实体(典型的为帐户拥有者)才有权利获取，修改和删除它。
</dd></dl>
<p><a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a> 假定用户只把他们的名册存储在该用户帐号注册并验证访问XMPP网络的那台服务器上. 本协议移出了对名册存储和帐号注册以及网络验证的耦合的限制, 结果是用户可以把他们的名册存储在另一个地方, 或者可以有多个名册存在不同的地方. 无论如何, 在没有实现和部署实践一个更弹性化的名册存储模型的情况下, 本协议保留了 <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a> 的术语 "client" 和 "server" (并把 "the roster" 替换成 "a roster"), 而不是造出一个新的术语代表 "某个用户存储某一个名册的地方". 未来的文档可能为非服务器名册或多名册管理提供规范性规则, 但这些规则超出了本文的范围. 
</p>
<h3> <span class="mw-headline" id=".E8.AF.AD.E6.B3.95.E5.92.8C.E8.AF.AD.E4.B9.89">语法和语义</span></h3>
<p>名册是用 &lt;iq/&gt; 节(见 <a href="/RFC6120" title="RFC6120">XMPP‑CORE</a> 的8.2.3节)管理的, 确切的说就是一个由'jabber:iq:roster'命名空间限定的&lt;query/&gt;子元素. 详细的语法和语义在接下来的章节中定义.
</p>
<h4> <span class="mw-headline" id="Ver.E5.B1.9E.E6.80.A7">Ver属性</span></h4>
<p>'ver'属性是一个标识名册信息的特定版本的字符串. 它的值必须仅由服务器生成并且必须由客户端不透明地处理. 服务器可以使用任何适当的方法来生成该版本ID, 类似名册数据的哈希值或一个严格递增的序列号.
</p><p>建议包含'ver'属性.
</p><p>对'ver'属性的使用的完整描述在 <a href="/RFC6121#.E5.90.8D.E5.86.8C.E7.89.88.E6.9C.AC.E6.8E.A7.E5.88.B6" title="RFC6121">章节2.6</a>.
</p>
<dl><dd>互操作性备注: &lt;query/&gt;元素的'ver'属性在 <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a> 中没有定义，在本协议中是新定义的.
</dd></dl>
<h4> <span class="mw-headline" id=".E5.90.8D.E5.86.8C.E6.9D.A1.E7.9B.AE">名册条目</span></h4>
<p>一个<a href="/RFC6121#.E5.90.8D.E5.86.8C.E8.AE.BE.E7.BD.AE" title="RFC6121">roster set</a>中的&lt;query/&gt;元素包含一个&lt;item/&gt;子元素, 而一个<a href="/RFC6121#.E5.90.8D.E5.86.8C.E7.BB.93.E6.9E.9C" title="RFC6121">roster result</a>典型地包含多个&lt;item/&gt;子元素. 每个&lt;item/&gt;元素描述了一个唯一的"名册条目"(又是也称为一个"联系人").
</p><p>&lt;item/&gt;元素的语法参见接下来的章节.
</p>
<h5> <span class="mw-headline" id="Approved.E5.B1.9E.E6.80.A7">Approved属性</span></h5>
<p>布尔值'approved'属性值为"true"被用于发送<a href="/RFC6121#.E9.A2.84.E6.89.B9.E5.87.86.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">章节3.4</a>所述的预批准信号(缺省为"false", 依据<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XML‑DATATYPES</a>).
</p><p>服务器应该包含该'approved'属性来通知客户端订阅预批准. 客户端不能(MUST NOT)在它发送给服务器的roster sets中包含'approved'属性, 但必须用类型为"subscribed"和"unsubscribed"的presence节来管理<a href="/RFC6121#.E9.A2.84.E6.89.B9.E5.87.86.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">章节3.4</a>所述的预批准.
</p>
<dl><dd>互操作性备注: &lt;item/&gt;元素的'approved'属性在 <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a> 中没有被定义,是在本协议中新出现的.
</dd></dl>
<h5> <span class="mw-headline" id="Ask.E5.B1.9E.E6.80.A7">Ask属性</span></h5>
<p>&lt;item/&gt;元素的'ask'属性值为"subscribe"被用于发布订阅子状态，包括<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">章节3.1.2</a>所述的"待处理"等等.
</p><p>服务器应该包含'ask'属性来通知客户端"待处理"子状态. 客户端不能(MUST NOT)在它发送给该服务器的roster sets中包含'ask'属性, 而必须使用类型为"subscribe"和"unsubscribe" 的presence节来管理<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">章节3.1.2</a>所述的这类子状态.
</p>
<h5> <span class="mw-headline" id="JID.E5.B1.9E.E6.80.A7">JID属性</span></h5>
<p>&lt;item/&gt;元素的'jid'属性指定唯一性地标识该名册条目的Jabber标识符(JID).
</p><p>'jid'属性是必需的，无论是客户端还是服务器添加, 更新, 删除, 或返回一个名册条目.
</p>
<h5> <span class="mw-headline" id="Name.E5.B1.9E.E6.80.A7">Name属性</span></h5>
<p>&lt;item/&gt;元素的'name'属性指定和该JID相关的"处理", 这是由该用户(不是该联系人)决定的. 尽管'name'属性的值可以代表一个自然人用户, 对该服务器来说它是不透明的. 无论如何, 'name'属性在多个XMPP扩展的上下文中可被服务器用于匹配目的(一个可能的比较方法是<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XMPP‑ADDR</a>所述的XMPP资源部分).
</p><p>对于客户端来说，当添加或更新一个名册条目的时候，包含'name'属性是可选的.
</p>
<h5> <span class="mw-headline" id="Subscription.E5.B1.9E.E6.80.A7">Subscription属性</span></h5>
<p>出席信息订阅的状态被放在&lt;item/&gt;元素的'subscription'属性中. 已定义的订阅相关的值如下:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>    none:
        该用户没有订阅一该联系人的出席信息, 并且联系人也没有订阅该用户的出席信息; 这是缺省值, 所以如果没有subscription属性，那么该状态被理解为&quot;none&quot; 
    to:
        该用户订阅了该联系人的出席信息, 但是联系人没有订阅用户的出席信息 
    from:
        该联系人订阅了该用户的出席信息, 但是该用户没有订阅联系人的出席信息
    both:
        该用户和该联系人互相订阅了对方的出席信息(也称为&quot;相互订阅&quot;)</pre></div></div>
<p>在一个<a href="/RFC6121#.E5.90.8D.E5.86.8C.E7.BB.93.E6.9E.9C" title="RFC6121">roster result</a>中, 除了 "none", "to", "from", 或 "both"值，该客户端必须忽略 'subscription'属性的（其他）值.
</p><p>在一个<a href="/RFC6121#.E5.90.8D.E5.86.8C.E6.8E.A8.E9.80.81" title="RFC6121">roster push</a>中,  除了 "none", "to", "from", "both", 或 "remove"值,该客户端必须忽略'subscription'属性的（其他）值.
</p><p>在一个<a href="/RFC6121#.E5.90.8D.E5.86.8C.E8.AE.BE.E7.BD.AE" title="RFC6121">roster set</a>中, 'subscription'属性的值可以包括 "remove", 它表示该条目已经从名册中移除了; 在一个 roster set 中，该服务器必须忽略除了"remove"之外'subscription'属性的所有值.
</p><p>包含'subscription'属性是可选的.
</p>
<h5> <span class="mw-headline" id="Group.E5.B1.9E.E6.80.A7">Group属性</span></h5>
<p>&lt;group/&gt;子元素指定一个类别或"桶" ，让客户端把名册条目分成组. 一个&lt;item/&gt;元素可以包含多个&lt;group/&gt;元素, 这意味着名册组不是排他的. 尽管&lt;group/&gt;元素的XML字符串元素可以意味着一个自然人用户, 它对于服务器是不透明的. 无论如何, 在各种XMPP扩展的上下文中, &lt;group/&gt;元素可以被服务器用于匹配的目的(一个可能的的比较方法用于XMPP资源部分，详见<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XMPP‑ADDR</a>).
</p><p>对于客户端来说，在添加或更新一个名册条目的时候包含&lt;group/&gt;元素是可选的. 如果一个<a href="/RFC6121#.E5.90.8D.E5.86.8C.E8.AE.BE.E7.BD.AE" title="RFC6121">roster set</a>不包含&lt;group/&gt;元素, 那么该条目被理解为不属于任何组.
</p>
<h4> <span class="mw-headline" id=".E5.90.8D.E5.86.8C.E8.8E.B7.E5.8F.96">名册获取</span></h4>
<p>一个 "roster get" 是一个客户端为了让服务器返回某名册而发出的请求; 在语法构成上它是一个从客户端到服务器的类型为"get"的IQ节，并且包含一个由'jabber:iq:roster'命名空间限定的&lt;query/&gt;元素, 这里的&lt;query/&gt;元素不能(MUST NOT)包含任何&lt;item/&gt;子元素.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'bv1bs71f'</span>
       <span class="re0">type</span>=<span class="st0">'get'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>发送一个roster get的预期结果是服务器返回一个roster result.
</p>
<h4> <span class="mw-headline" id=".E5.90.8D.E5.86.8C.E7.BB.93.E6.9E.9C">名册结果</span></h4>
<p>一个"roster result"是服务器对一个名册获取的应答; 在语法构成上它是一个从服务器到客户端的类型为"result"的IQ节，并且包含一个由'jabber:iq:roster'命名空间限定的&lt;query/&gt;元素. 
</p><p>该 &lt;query/&gt; 元素是一个名册结果，为每一个联系人包含一个 &lt;item/&gt; 元素并且因而可以包含多个&lt;item/&gt;元素.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'bv1bs71f'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/chamber'</span>
       <span class="re0">type</span>=<span class="st0">'result'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span> <span class="re0">ver</span>=<span class="st0">'ver7'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span>
    <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>如果该名册存在但是在名册中没有联系人, 那么该服务器必须返回一个IQ-result，包含一个&lt;query/&gt;子元素而不包含任何&lt;item/&gt;子元素(即, 服务器不能(MUST NOT)返回空的类型为"error"的&lt;iq/&gt;节).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'bv1bs71f'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/chamber'</span>
       <span class="re0">type</span>=<span class="st0">'result'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span> <span class="re0">ver</span>=<span class="st0">'ver9'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>如果该名册不存在, 那么该服务器必须返回一个节错误，条件为&lt;item-not-found/&gt;.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'bv1bs71f'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/chamber'</span>
       <span class="re0">type</span>=<span class="st0">'error'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;error</span> <span class="re0">type</span>=<span class="st0">'cancel'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;item-not-found</span>
          <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
    <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id=".E5.90.8D.E5.86.8C.E8.AE.BE.E7.BD.AE">名册设置</span></h4>
<p>一个"roster set"是一个客户端向服务器发出的编辑(即, 创建, 更新, 或删除)一个名册条目的请求; 在语法构成上它是一个从客户端到服务器的类型为"set"的IQ节，并且包含一个由'jabber:iq:roster'命名空间限定的&lt;query/&gt;元素. 
</p><p>以下规则适用于名册设置:
</p>
<dl><dd><ol><li> &lt;query/&gt;元素必须包含一个并且只含有一个&lt;item/&gt;元素.
</li><li> 服务器必须忽略'subscription'属性的除"remove"以外的任何值(见<a href="/RFC6121#.E8.AE.A2.E9.98.85.E5.B1.9E.E6.80.A7" title="RFC6121">章节2.1.2.5</a>).
</li></ol>
</dd></dl>
<dl><dd> 安全警告: 传统上, 名册设置的IQ节不包含'to'地址, 结果是所有名册设置都那个需要更新名册的帐号的某个已验证资源(全JID)发出. 此外, <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a> 要求一个服务器执行名册设置的特定情景的检查来忽略'to'地址; 无论如何, 本协议移除了那个特定情景, 这意味着一个名册设置可以包含一个和发送者不同的'to'地址. 所以, 处理一个名册设置的实体必须验证名册设置的发送者已被授权更新该名册, 如果没有授权则返回一个&lt;forbidden/&gt;错误.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'rs1'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span><span class="re2">/&gt;</span>
    <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id=".E5.90.8D.E5.86.8C.E6.8E.A8.E9.80.81">名册推送</span></h4>
<p>一个"roster push"是一个服务器向客户端发出的最新创建, 更新, 或删除的名册条目; 在语法构成上它是一个从服务器到客户端的类型为"set"的IQ节，并且包含一个由'jabber:iq:roster'命名空间限定的&lt;query/&gt;元素.
</p><p>以下规则适用于名册推送: 
</p>
<dl><dd><ol><li> 在一个名册推送中的&lt;query/&gt;元素必须包含且仅包含一个&lt;item/&gt;元素.
</li><li> 一个接收的客户端必须忽略这个节，除非它满足以下条件：没有'from'属性(即, 隐式地来自该用户帐号的纯JID)或它有一个值和该用户的纯JID&lt;user@domainpart&gt;匹配的'from'属性.
</li></ol>
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'a78b4q6ha463'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/chamber'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span><span class="re2">/&gt;</span>
    <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>作为<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>定义的IQ节语义的强制要求, 每个接收一个来自服务器的名册推送的资源应该应答一个类型为"result"或"error"的IQ节(然而, 大家知道很多现有的客户端不应答名册推送).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'a78b4q6ha463'</span>
       <span class="re0">type</span>=<span class="st0">'result'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span>
       <span class="re0">id</span>=<span class="st0">'a78b4q6ha463'</span>
       <span class="re0">type</span>=<span class="st0">'result'</span><span class="re2">/&gt;</span></pre></div></div>
<dl><dd> 安全警告: 传统上, 名册推送不包含'from'地址, 结果是所有名册推送都隐式地从该帐号本身的纯JID发出. 无论如何, 本协议允许非该用户的服务器实体来维护名册信息, 这意味着一个名册推送可以包含不同于该用户帐号的纯JID的'from'地址. 所以, 该客户端必须检查'from'地址来验证名册推送的发送者被售前更新名册. 如果该客户端从一个未授权实体接收到了一个名册推送, 它不能(MUST NOT)处理被推送的数据; 此外, 该客户端要么返回一个节错误&lt;service-unavailable/&gt;要么干脆拒绝返回一个节错误(后面那个行为覆盖了一个来自<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>的 必须-级 的要求, 目的是防止出席信息泄露).
</dd></dl>
<dl><dd> 实现备注: 对于名册推送的客户端处理没有错误情景; 如果服务器在对名册推送的应答中接收到了一个类型为"error"的IQ，那么它应该忽略那个错误.
</dd></dl>
<h3> <span class="mw-headline" id=".E7.99.BB.E9.99.86.E6.97.B6.E6.8E.A5.E6.94.B6.E5.90.8D.E5.86.8C">登陆时接收名册</span></h3>
<p>在通过一个服务器的验证并绑定一个资源之后(也就是成为一个<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>中定义的已连接资源), 一个客户端应该在发送初始的出席信息之前请求名册(无论如何, 因为接收名册不是对所有的资源都是必要的, 例如, 一个有限带宽的连接, 该客户端对名册的请求不是强制的). 在一个已连接的资源发送初始出席信息之后(见<a href="/RFC6121#.E5.88.9D.E5.A7.8B.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">章节4.2</a>), 它被称为一个"可用的资源". 如果一个已连接资源或可用资源请求名册, 它被成为一个"有兴趣的资源". 服务器必须发送名册推送到所有有兴趣的资源.
</p>
<dl><dd> 实现备注: 出席信息订阅请求被发送到可用的资源, 而和订阅状态改变相关的名册推送被发送到感兴趣的资源. 所以, 如果一个资源希望同时接收到订阅请求和名册推送, 它必须既发送初始出席信息又请求名册.
</dd></dl>
<p>一个客户端通过向服务器发送一个roster get来请求名册.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'hu2bac18'</span>
       <span class="re0">type</span>=<span class="st0">'get'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">/&gt;</span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'hu2bac18'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">type</span>=<span class="st0">'result'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span> <span class="re0">ver</span>=<span class="st0">'ver11'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
             <span class="re0">name</span>=<span class="st0">'Romeo'</span>
             <span class="re0">subscription</span>=<span class="st0">'both'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Friends</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'mercutio@example.com'</span>
             <span class="re0">name</span>=<span class="st0">'Mercutio'</span>
             <span class="re0">subscription</span>=<span class="st0">'from'</span><span class="re2">/&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'benvolio@example.net'</span>
             <span class="re0">name</span>=<span class="st0">'Benvolio'</span>
             <span class="re0">subscription</span>=<span class="st0">'both'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>如果服务器不处理该roster get, 它必须返回一个<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>所述的适当的节错误(如果是名册命名空间不被支持则返回 &lt;service-unavailable/&gt;，如果该服务器处理过程或返回该名册时遇到麻烦则返回 &lt;internal-server-error/&gt; ).
</p>
<h3> <span class="mw-headline" id=".E6.B7.BB.E5.8A.A0.E4.B8.80.E4.B8.AA.E5.90.8D.E5.86.8C.E6.9D.A1.E7.9B.AE">添加一个名册条目</span></h3>
<h4> <span class="mw-headline" id=".E8.AF.B7.E6.B1.82">请求</span></h4>
<p>任何时候, 一个客户端可以添加一个条目到名册. 只要发送一个包含一个新条目的roster set就可以做到.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'ph1xaz53'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span>
             <span class="re0">name</span>=<span class="st0">'Nurse'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Servants</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id=".E6.88.90.E5.8A.9F.E6.83.85.E6.99.AF">成功情景</span></h4>
<p>如果服务器成功地处理了关于该新条目的roster set(即, 如果没有错误发生), 它必须在该用户的名册中新增该条目并做如下处理.
</p><p>该服务器必须返回一个类型为"result"的IQ节给发送该roster set的已连接资源.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'ph1xaz53'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">type</span>=<span class="st0">'result'</span><span class="re2">/&gt;</span></pre></div></div>
<p>该服务器也必须发送一个包含了该新名册条目的roster push到该用户的所有感兴趣的资源, 包括生成了该roster set的资源.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">S: </span><span class="re1">&lt;iq</span> <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'a78b4q6ha463'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span> <span class="re0">ver</span>=<span class="st0">'ver13'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span>
             <span class="re0">name</span>=<span class="st0">'Nurse'</span>
             <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Servants</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
S: </span><span class="re1">&lt;iq</span> <span class="re0">to</span>=<span class="st0">'juliet@example.com/chamber'</span>
       <span class="re0">id</span>=<span class="st0">'x81g3bdy4n19'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span> <span class="re0">ver</span>=<span class="st0">'ver13'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span>
             <span class="re0">name</span>=<span class="st0">'Nurse'</span>
             <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Servants</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>作为在<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>中定义的IQ节语义的强制要求, 建议每个从该服务器接收到一个roster push的资源应答一个类型为"result"或"error"的IQ节(无论如何, 大家知道很多现有的客户端不应答roster pushes).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'a78b4q6ha463'</span>
       <span class="re0">type</span>=<span class="st0">'result'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span>
       <span class="re0">id</span>=<span class="st0">'x81g3bdy4n19'</span>
       <span class="re0">type</span>=<span class="st0">'result'</span><span class="re2">/&gt;</span></pre></div></div>
<h4> <span class="mw-headline" id=".E9.94.99.E8.AF.AF.E6.83.85.E6.99.AF">错误情景</span></h4>
<p>如果服务器未能成功处理roster set, 它必须返回一个节错误. 以下错误场景已被定义. 自然的, 可能会发生其他节错误, 例如，如果服务器在处理roster get(译者注：这里应该是roster set，疑为原文笔误)时发生了内部问题则返回 &lt;internal-server-error/&gt;, 或甚至服务器只允许通过类似web接口这样的非XMPP方法来修改名册则返回&lt;not-allowed/&gt;.
</p><p>如果roster set的发送者未被授权更新该名册(典型的情况是该帐号本身只有一个已验证的资源被授权)，则服务器必须返回一个&lt;forbidden/&gt;节错误给客户端.
</p><p>服务器必须返回一个&lt;bad-request/&gt;节错误给客户端，如果roster set包含以下任何违规情况:
</p>
<dl><dd><ol><li> &lt;query/&gt;元素包含不止一个&lt;item/&gt;子元素.
</li><li> &lt;item/&gt;元素包含不止一个&lt;group/&gt;元素, 但是有重复的groups (一个可能的用来确定重复的比较方法见于<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XMPP‑ADDR</a>中关于XMPP资源部分的描述).
</li></ol>
</dd></dl>
<p>服务器必须返回一个&lt;not-acceptable/&gt;节错误给客户端，如果roster set包含以下任何违规情况:
</p>
<dl><dd><ol><li> 'name'属性的长度大于一个服务器配置的限制.
</li><li> &lt;group/&gt;元素的XML字符数据长度为零(为了把一个条目从所有组移除, 客户端需要从roster set排除任何&lt;group/&gt;元素).
</li><li> &lt;group/&gt;元素的XML字符数据长度大于一个服务器配置的限制.
</li></ol>
</dd></dl>
<p>错误: Roster set由未授权实体初始化
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'ix7s53v2'</span>
       <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'ix7s53v2'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">type</span>=<span class="st0">'error'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;error</span> <span class="re0">type</span>=<span class="st0">'auth'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;forbidden</span> <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
    <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>错误: Roster set包含多个条目
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'nw83vcj4'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span>
             <span class="re0">name</span>=<span class="st0">'Nurse'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Servants</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'mother@example.com'</span>
             <span class="re0">name</span>=<span class="st0">'Mom'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Family</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'nw83vcj4'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">type</span>=<span class="st0">'error'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;error</span> <span class="re0">type</span>=<span class="st0">'modify'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;bad-request</span> <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
    <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>错误: Roster set包含的条目超长
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'yl491b3d'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span>
             <span class="re0">name</span>=<span class="st0">'[ ... some-very-long-handle ... ]'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Servants</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'yl491b3d'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">type</span>=<span class="st0">'error'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;error</span> <span class="re0">type</span>=<span class="st0">'modify'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;not-acceptable</span> <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>错误: Roster set包含重复的groups
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'tk3va749'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span>
             <span class="re0">name</span>=<span class="st0">'Nurse'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Servants</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Servants</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'tk3va749'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">type</span>=<span class="st0">'error'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;error</span> <span class="re0">type</span>=<span class="st0">'modify'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;bad-request</span> <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>错误: Roster set包含空group
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'fl3b486u'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span>
             <span class="re0">name</span>=<span class="st0">'Nurse'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'fl3b486u'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">type</span>=<span class="st0">'error'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;error</span> <span class="re0">type</span>=<span class="st0">'modify'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;not-acceptable</span> <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>错误: Roster set包含超长group名
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'qh3b4v19'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span>
             <span class="re0">name</span>=<span class="st0">'Nurse'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">[ ... some-very-long-group-name ... ]</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'qh3b4v19'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">type</span>=<span class="st0">'error'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;error</span> <span class="re0">type</span>=<span class="st0">'modify'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;not-acceptable</span> <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<dl><dd>互操作性备注: 如果&lt;item/&gt;元素的'jid'属性值和该用户的帐号的纯JID&lt;localpart@domainpart&gt;匹配,一些服务器会返回&lt;not-allowed/&gt;节错误给客户端.
</dd></dl>
<h3> <span class="mw-headline" id=".E6.9B.B4.E6.96.B0.E4.B8.80.E4.B8.AA.E5.90.8D.E5.86.8C.E6.9D.A1.E7.9B.AE">更新一个名册条目</span></h3>
<h4> <span class="mw-headline" id=".E8.AF.B7.E6.B1.82_2">请求</span></h4>
<p>更新一个现有的名册条目和新增一个名册条目是以相同方法完成的, 即, 发送一个roster set给服务器. 因为名册条目是原子的, 该条目必须如roster set提供的那样被准确地更新.
</p><p>关于为什么一个客户端可能更新一个名册条目有很多原因:
</p>
<dl><dd><ol><li> 新增一个组
</li><li> 删除一个组
</li><li> 修改操作
</li><li> 删除操作
</li></ol>
</dd></dl>
<p>考虑一个定义如下的名册条目:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>    <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
          <span class="re0">name</span>=<span class="st0">'Romeo'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Friends</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/item<span class="re2">&gt;</span></span></pre></div></div>
<p>在她的名册中拥有该用户的条目，她可能想把该条目添加到另一个组.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'di43b2x9'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
             <span class="re0">name</span>=<span class="st0">'Romeo'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Friends</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Lovers</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>有时候晚些时候, 该用户可能希望从原有的组移除该条目.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'lf72v157'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
             <span class="re0">name</span>=<span class="st0">'Romeo'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Lovers</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>该用户可能想从所有组移除该条目.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'ju4b62a5'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>该用户也可能想修改对该条目的操作.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'gb3sv487'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
             <span class="re0">name</span>=<span class="st0">'MyRomeo'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>该用户然后可能想完全移除该操作.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'o3bx66s5'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
             <span class="re0">name</span>=<span class="st0">''</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<dl><dd> 实现备注: 包含一个空的'name'属性等价于不包含'name'属性; 两个操作都是把name设为空字符串.
</dd></dl>
<h4> <span class="mw-headline" id=".E6.88.90.E5.8A.9F.E6.83.85.E6.99.AF_2">成功情景</span></h4>
<p>和添加一个名册条目一样, 如果该名册条目能被成功处理那么服务器必须在该用户的名册中更新该条目, 发送一个roster push到所有该用户的感兴趣资源, 并且发送一个IQ result给初始的资源; 详见<a href="/RFC6121#.E6.88.90.E5.8A.9F.E6.83.85.E6.99.AF" title="RFC6121">章节2.3</a>.
</p>
<h4> <span class="mw-headline" id=".E9.94.99.E8.AF.AF.E6.83.85.E6.99.AF_2">错误情景</span></h4>
<p><a href="/RFC6121#.E9.94.99.E8.AF.AF.E6.83.85.E6.99.AF" title="RFC6121">章节2.3.3</a>中错误情景的描述也适用于更新一个名册条目.
</p>
<h3> <span class="mw-headline" id=".E5.88.A0.E9.99.A4.E4.B8.80.E4.B8.AA.E5.90.8D.E5.86.8C.E6.9D.A1.E7.9B.AE">删除一个名册条目</span></h3>
<h4> <span class="mw-headline" id=".E8.AF.B7.E6.B1.82_3">请求</span></h4>
<p>任何时候, 一个客户端可以通过发送一个并把'subscription'属性值设为"remove"来把一个条目从他或她的名册中删除.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'hm4hs97y'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.com'</span>
             <span class="re0">subscription</span>=<span class="st0">'remove'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id=".E6.88.90.E5.8A.9F.E6.83.85.E6.99.AF_3">成功情景</span></h4>
<p>如同增加一个名册条目, 如果服务器能成功地处理roster set那么它必须在该用户的名册中更新该条目, 发送一个roster push到该用户的所有感兴趣的资源(其中的'subscription'属性值设为"remove"), 并发送一个IQ result给初始的资源; 详见<a href="/RFC6121#.E6.B7.BB.E5.8A.A0.E4.B8.80.E4.B8.AA.E5.90.8D.E5.86.8C.E6.9D.A1.E7.9B.AE" title="RFC6121">章节2.3</a>.
</p><p>另外, 该用户的服务器可能需要生成一个或更多subscription相关的presence节, 如下:
</p>
<dl><dd><ol><li> 如果该用户对该联系人有一个出席信息订阅, 那么该用户的服务器必须发送一个type为"unsubscribe"的presence节给该联系人(为了对该联系人的出席信息取消订阅).
</li><li> 如果该联系人对该用户有一个出席信息订阅, 那么该用户的服务器必须发送一个type为"unsubscribed"的presence节给该联系人(为了取消该联系人对该用户的订阅).
</li><li> 如果出席信息订阅是相互的, 那么该用户的服务器必须同时发送type为"unsubscribe"presence节和type为"unsubscribed"的的presence节给该联系人.
</li></ol>
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">S: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
             <span class="re0">id</span>=<span class="st0">'lm3ba81g'</span>
             <span class="re0">to</span>=<span class="st0">'nurse@example.com'</span>
             <span class="re0">type</span>=<span class="st0">'unsubscribe'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
S: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
             <span class="re0">id</span>=<span class="st0">'xb2c1v4k'</span>
             <span class="re0">to</span>=<span class="st0">'nurse@example.com'</span>
             <span class="re0">type</span>=<span class="st0">'unsubscribed'</span><span class="re2">/&gt;</span></pre></div></div>
<h4> <span class="mw-headline" id=".E9.94.99.E8.AF.AF.E6.83.85.E6.99.AF_3">错误情景</span></h4>
<p>如果'jid'属性的值指定的一个条目不在该名册中, 那么服务器必须返回一个 &lt;item-not-found/&gt; 节错误.
</p><p>错误: 未发现名册条目
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">id</span>=<span class="st0">'uj4b1ca8'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'[ ... non-existent-jid ... ]'</span>
             <span class="re0">subscription</span>=<span class="st0">'remove'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
S: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'uj4b1ca8'</span>
       <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
       <span class="re0">type</span>=<span class="st0">'error'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;error</span> <span class="re0">type</span>=<span class="st0">'modify'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item-not-found</span>
           <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h3> <span class="mw-headline" id=".E5.90.8D.E5.86.8C.E7.89.88.E6.9C.AC">名册版本</span></h3>
<h4> <span class="mw-headline" id=".E6.B5.81.E7.89.B9.E6.80.A7">流特性</span></h4>
<p>如果一个服务器支持名册版本, 那么它必须在流协商期间声明以下流特性.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;ver</span> <span class="re0">xmlns</span>=<span class="st0">'urn:xmpp:features:rosterver'</span><span class="re2">/&gt;</span></pre></div></div>
<p>名册版本流特性很少见所以永远不会是强制协商的.
</p>
<h4> <span class="mw-headline" id=".E8.AF.B7.E6.B1.82_4">请求</span></h4>
<p>如果一个客户端支持名册版本并且它所连接的服务器如前一节说的那样声明支持名册版本, 那么该客户端应该在它对名册请求中包含'ver'元素. 如果该服务器没有声明支持名册版本, 客户端不能(MUST NOT)包含'ver'属性. 如果客户端在它的roster get中包含了'ver'属性, 它就把该属性的值设成了它最后的名册缓存中的相关的版本ID.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">C: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net/home'</span>
       <span class="re0">id</span>=<span class="st0">'r1h3vzp7'</span>
       <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
       <span class="re0">type</span>=<span class="st0">'get'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span> <span class="re0">ver</span>=<span class="st0">'ver14'</span><span class="re2">/&gt;</span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>如果该客户端还未缓存该名册或该缓存遗失或被中断了, 但是该客户端希望引导名册版本的使用, 它必须把'ver'属性设为空字符串(即, ver="").
</p><p>自然的, 如果该客户端不支持名册版本或不希望引导名册版本的使用, 它将不包含'ver'属性.
</p>
<h4> <span class="mw-headline" id=".E6.88.90.E5.8A.9F.E6.83.85.E6.99.AF_4">成功情景</span></h4>
<p>无论名册从被客户端列举版本ID之后是否被修改过, 服务器必须要么如<a href="/RFC6121#.E5.90.8D.E5.86.8C.E7.BB.93.E6.9E.9C" title="RFC6121">章节2.1.4</a>(包含一个'ver'属性代表最后的版本)所述返回完整的名册,要么返回一个空的IQ-result(这样就表示任何名册的修改将通过roster pushes被发送, 如下所述). 通常, 除非返回完整名册 (1) 将比发送独立的roster pushes给客户端使用更少的带宽(例如, 如果名册只包含很少的条目) 或 (2) 服务器不能把版本ID关联到任何之前已经在文件中有的版本, 服务器应该发送一个空的IQ-result然后通过roster pushes发送修改(如果有的话).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">S: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
       <span class="re0">id</span>=<span class="st0">'r1h3vzp7'</span>
       <span class="re0">to</span>=<span class="st0">'romeo@example.net/home'</span>
       <span class="re0">type</span>=<span class="st0">'result'</span><span class="re2">/&gt;</span></pre></div></div>
<dl><dd>实现备注: 这个空的IQ-result不同于一个空的&lt;query/&gt;元素, 这和使用一个空名册是不同的.
</dd></dl>
<p>如果允许使用名册版本并且名册从被客户端列举版本ID之后未被修改过, 服务器将简单地不发送任何roster pushes给客户端(直到并且除非在该客户端会话的生命周期中一些相关的事件触发一个roster push).
</p><p>如果名册从被客户端列举版本ID之后被修改过, 那么该服务器必须为每一个从被客户端列举版本ID之后被修改过的条目发送一个roster push给该客户端. (我们把一个用于名册版本同步的被发送的roster push称为一个"暂时的roster push".)
</p>
<dl><dd>定义: 一个"roster modification"表示对名册数据的任何改变并将导致一个roster push到已连接客户端. 所以, 和服务器对名册处理相关的内部状态将不会导致一个roster push到已连接客户端因而不需要改变版本.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">S: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
       <span class="re0">id</span>=<span class="st0">'ah382g67'</span>
       <span class="re0">to</span>=<span class="st0">'romeo@example.net/home'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span> <span class="re0">ver</span>=<span class="st0">'ver34'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'tybalt@example.org'</span> <span class="re0">subscription</span>=<span class="st0">'remove'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
S: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
       <span class="re0">id</span>=<span class="st0">'b2gs90j5'</span>
       <span class="re0">to</span>=<span class="st0">'romeo@example.net/home'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span> <span class="re0">ver</span>=<span class="st0">'ver42'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'bill@example.org'</span> <span class="re0">subscription</span>=<span class="st0">'both'</span><span class="re2">/&gt;</span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
S: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
       <span class="re0">id</span>=<span class="st0">'c73gs419'</span>
       <span class="re0">to</span>=<span class="st0">'romeo@example.net/home'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span> <span class="re0">ver</span>=<span class="st0">'ver72'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'nurse@example.org'</span>
             <span class="re0">name</span>=<span class="st0">'Nurse'</span>
             <span class="re0">subscription</span>=<span class="st0">'to'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Servants</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
S: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
       <span class="re0">id</span>=<span class="st0">'dh361f35'</span>
       <span class="re0">to</span>=<span class="st0">'romeo@example.net/home'</span>
       <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
     <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span> <span class="re0">ver</span>=<span class="st0">'ver96'</span><span class="re2">&gt;</span>
       <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'juliet@example.org'</span>
             <span class="re0">name</span>=<span class="st0">'Juliet'</span>
             <span class="re0">subscription</span>=<span class="st0">'both'</span><span class="re2">&gt;</span>
         <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">VIPs</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
       <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
     <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
   <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>这些"暂时的roster pushes"可以作如下理解:
</p>
<dl><dd><ol><li> 想想客户端在它缓存的名册版本(假设是, "ver14")和新的名册版本(假设是, "ver96")之间有一个活跃的出席信息会话.
</li><li> 在此期间, 该客户端可能已经接收到一个和各种名册版本相关的roster pushes(它可能已经发生, 假设是, "ver51" 和 "ver79"). 无论如何, 这些roster pushes中的一些可能已经包含了同一个名册条目的中间更新(例如, 把对bill@example.org的订阅状态从"none"改为"to"又从"to"改为"both").
</li><li> 这个暂时的roster pushes将不包含所有中间步骤, 而只有在该客户端实际上离线的时候每个条目修改后的最终结果(这可能发生, 假设是, "ver34", "ver42", "ver72", 和 "ver96").
</li></ol>
</dd></dl>
<p>客户端必须和处理任何roster push一样处理一个"interim roster push"(实际上, 从客户端的视角不能说一个"暂时的"roster push和一个"live"的 roster push是不同的，因而当它没办法知道自己收到是否是暂时的roster pushes). 当重连后请求名册, 客户端应该请求和它在前一个会话中收到的最后的roster push相关的版本, 而不是它在前一个会话的开始时收到的roster result的相关版本.
</p><p>当名册版本被允许, 服务器必须在每一个roster push中包含更新的名册版本. Roster pushes必须按照变更的顺序产生并且在一个roster push中包含的版本必须是唯一的. 即使客户端未在它的roster gets或sets 中包含'ver'属性, 服务器也应该在它发送给客户端的所有roster pushes和results中包含'ver'属性.
</p>
<dl><dd>实现备注: 名册版本的指南和详细例子见<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0237</a>.
</dd></dl>
<h2> <span class="mw-headline" id=".E7.AE.A1.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85">管理出席信息订阅</span></h2>
<p>为了保护XMPP用户们的隐私, 出席信息仅向某个用户已经批准的其他实体披露. 当某个同意允许其他实体察看其出席信息时, 该实体被称为对该用户的出席信息有一个"订阅(subscription)". 一个对某用户的出席信息有订阅的实体或一个用户对其有出席信息订阅的实体被称为"联系人(contact)" (在本文中术语"联系人(contact)"在不严格的概念上也用于指代潜在的联系人或一个用户的名册中的任何条目).
</p><p>在XMPP中, 一个订阅是超越出席信息会话存在的; 实际上, 直到联系人取消订阅或用户撤销之前已授权的订阅之前它都会持续存在. (这个模式不同于会话初始协议(SIP)中对出新信息订阅的使用, 参见<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">SIP‑PRES</a>.)
</p><p>在XMPP中订阅的管理是通过发送包含特别定义的属性("subscribe", "unsubscribe", "subscribed", 和 "unsubscribed")的presence节来实现的.
</p>
<dl><dd>实现备注: 当一个服务器处理或生成一个类型为"subscribe", "subscribed", "unsubscribe", 或 "unsubscribed"的出站出席信息节, 该服务器必须在出站出席信息节中标记发送的实体的纯JID &lt;localpart@domainpart&gt;, 而不是全JID &lt;localpart@domainpart/resourcepart&gt;. 这个规则的强制性简化了出席信息订阅的模式并且有助于防止出席信息泄露; 关于出席信息泄露的信息, 参见<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>的安全事项.
</dd></dl>
<p>订阅状态在用户和联系人两边的名册中都可以被反映. 本章不覆盖每个和出席信息订阅相关的可能的情景, 而主要是讲述一个用户和一个联系人之间开启一个共同的订阅的协议流程. 关于订阅状态的完整细节可以在<a href="/RFC6121#.E9.99.84.E5.BD.95A._.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>中找到. 
</p>
<h3> <span class="mw-headline" id=".E8.AF.B7.E6.B1.82.E8.AE.A2.E9.98.85">请求订阅</span></h3>
<p>一个"订阅请求(subscription request)"是一个某用户为了得到永久性地订阅某个联系人出席信息的授权而发出的请求; 语法构成上它是一个'type'属性值为"subscribe"的presence节. 一个订阅请求由某用户客户端生成, 由(潜在的)联系人的服务器处理, 从表现上来看则是联系人通过联系人的客户端来处理. 以下章节描述其工作流程.
</p>
<dl><dd>实现备注: 出席信息订阅请求被发送到可用的资源, 然而和订阅状态变更相关的名册推送被发送到感兴趣的资源. 所以, 如果一个资源希望同时接收到订阅请求和名册推送, 它必须同时发送初始出席信息和请求名册.
</dd></dl>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E5.87.BA.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82">客户端生成出站订阅请求</span></h4>
<p>一个用户的客户端发送一个类型为"subscribe"并且指定了一个潜在联系人的纯JID&lt;contact@domainpart&gt;为'to'地址的presence节,生成一个订阅请求.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;presence</span> <span class="re0">id</span>=<span class="st0">'xk3h1v69'</span>
              <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">type</span>=<span class="st0">'subscribe'</span><span class="re2">/&gt;</span></pre></div></div>
<p>当一个用户发送一个出席信息订阅请求给一个潜在的即时消息和出席信息联系人, 其'to'属性的值必须是一个纯JID &lt;contact@domainpart&gt;而不是一个全JID &lt;contact@domainpart/resourcepart&gt;, 因为预期的结果是该用户从该联系人的所有资源接收出席信息, 而不仅是在'to'属性中指定的特定资源. 纯JIDs的使用也简化了该用户的服务器和联系人的服务器的订阅过程, 出席信息探测, 和出席信息通知.
</p><p>为了跟踪的目的, 客户端应该在一个出席信息订阅请求中包含一个'id'属性.
</p>
<dl><dd>实现备注: 很多XMPP客户端在生成一个出站出席信息订阅的时候向用户提示关于潜在联系人的信息(例如, "handle" 以及期望的名册组),因而在发送该出站出席信息订阅请求之前发送一个roster set. 这个行为是可选的, 因为客户端在上传用户提供的关于该联系人的信息之前可以先等待从服务器接收初始的roster push. 服务器必须以任何顺序处理roster set和出站出席信息订阅请求(即, 以客户端生成的任何顺序).
</dd></dl>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82">服务器处理出站订阅请求</span></h4>
<p>接收出站出席信息订阅请求之后, 该用户的服务器必须处理如下.
</p>
<dl><dd>在处理该请求之前, 该用户的服务器必须检查包含在'to'属性中的JID的语法(无论如何, 据信一些现有的实现不执行这个检查). 如果该JID的格式是&lt;contact@domainpart/resourcepart&gt;而不是&lt;contact@domainpart&gt;, 该用户的服务器应该把该请求当成是指向该联系人的纯JID并据此修改'to'地址. 该服务器也可以遵循<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XMPP‑ADDR</a>]定义的格式来检查该JID地址并可能返回一个&lt;jid-malformed/&gt;节错误.
</dd><dd>如果潜在的联系人位于和该用户相同的服务器上, 那么在处理该订阅请求和递送它到本地联系人的时候该服务器必须遵循<a href="/RFC6121#.E5.85.A5.E7.AB.99.E8.AE.A2.E9.98.85.E4.BF.A1.E6.81.AF.E8.AF.B7.E6.B1.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86" title="RFC6121">章节3.1.3</a>定义的规则.
</dd><dd>如果潜在的联系人位于一个远端服务器, 受本地服务策略的约束该用户的服务器必须接着按照核心XMPP节处理规则路由该节到那个远端的域. (这可能导致返回一个适当的节错误给该用户, 类似&lt;remote-server-timeout/&gt;.)
</dd></dl>
<p>如上所述, 在本地递送或远程路由该出席信息订阅请求之前, 该用户的服务器必须给该出站订阅请求标记该用户的纯JID &lt;user@domainpart&gt;.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">id</span>=<span class="st0">'xk3h1v69'</span>
              <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">type</span>=<span class="st0">'subscribe'</span><span class="re2">/&gt;</span></pre></div></div>
<p>如果该出席信息订阅请求不是本地递送或远程路由的(例如, 因为该请求格式异常, 该本地联系人不存在, 该远程服务器不存在, 尝试联系远端服务器超时, 或任何被该用户的服务器经历或确认的其他错误), 那么该用户的服务器必须返回一个适当的错误节给该用户. 例子如下.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">id</span>=<span class="st0">'xk3h1v69'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'error'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;error</span> <span class="re0">type</span>=<span class="st0">'modify'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;remote-server-not-found</span>
            <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>在本地递送或远程路由该出席信息订阅请求之后, 该用户的服务器必须接着发送一个roster push给所有该用户的感兴趣的资源, 包含带一个"none"订阅状态并且带一个表明订阅等待批准符号(一个值为"subscribe"的'ask'属性)的潜在联系人 .
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'b89c5r7ib574'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net/foo'</span>
        <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;item</span> <span class="re0">ask</span>=<span class="st0">'subscribe'</span>
              <span class="re0">jid</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
US: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'b89c5r7ib575'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net/bar'</span>
        <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;item</span> <span class="re0">ask</span>=<span class="st0">'subscribe'</span>
              <span class="re0">jid</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>如果一个远端联系人在可配置的时间内不批准或拒绝该订阅请求, 该用户的服务器应该基于一个实现特有的机制重新发送该订阅请求给该联系人(例如, 任何该用户的一个新资源可用的时候, 或在过了一个特定数量的时间之后); 这有助于从原有的订阅请求被路由到远程域发生的短暂的，无声的错误中恢复. 这样做的时候, 建议该服务器包含一个'id'属性，这样它能跟踪重发的订阅请求的应答.
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82">服务器处理入站订阅请求</span></h4>
<p>在处理入站出席信息订阅请求之前, 联系人的服务器应该检查包含在'to'属性中的JID的语法.如果该JID的格式是&lt;contact@domainpart/resourcepart&gt;而不是&lt;contact@domainpart&gt;, 该联系人的服务器应该把该请求当成是被指向该联系人的纯JID并据此修改'to'地址. 该服务器也可以遵循<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XMPP‑ADDR</a>]定义的格式来检查该JID地址并可能返回一个&lt;jid-malformed/&gt;节错误.
</p><p>处理入站出席信息订阅请求的时候, 联系人的服务器必须遵循以下规则:
</p>
<dl><dd><dl><dd>1. 首先, 联系人的服务器不能(MUST NOT)以联系人的身份批准订阅请求 -- 除非该来联系人已经 (a) 如<a href="/RFC6121#.E9.A2.84.E6.89.B9.E5.87.86.E8.A2.AB.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">章节3.4</a>所述预批准来自用户的订阅请求, (b) 配置它的账户自动批准订阅请求, 或 (c) 从它的服务器提供者那里接受了一个协议以允许自动批准(例如, 在一个企业部署之中通过一个雇佣协议). 否则, 如果一个订阅请求要求批准那么联系人的服务器必须递送那个请求到联系人的可用资源并由该联系人批准或拒绝.
</dd><dd>2. 如果联系人存在并且该用户已经有一个对该联系人的出席信息的订阅, 那么该联系人的服务器必须把一个类型为"subscribed"的presence节从该联系人的纯JID发送到该用户的纯JID以代表该联系人自动应答. 同样, 如果该联系人以前发送过一个类型为"subscribed"的presence节并且联系人的服务器假设对于该用户的出席信息订阅是"预批准的"(见<a href="/RFC6121#.E9.A2.84.E6.89.B9.E5.87.86.E8.A2.AB.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">章节3.4</a>), 那么该联系人的服务器也应该以该联系人的身份自动应答.
</dd></dl>
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
                  <span class="re0">id</span>=<span class="st0">'xk3h1v69'</span>
                  <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
                  <span class="re0">type</span>=<span class="st0">'subscribed'</span><span class="re2">/&gt;</span></pre></div></div>
<dl><dd><dl><dd>3. 另外, 如果在订阅请求被联系人的服务器接收到的时候该联系人有至少一个可用的资源, 那么该联系人的服务器必须依据<a href="/RFC6121#.E5.A4.84.E7.90.86XML.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.A7.84.E5.88.99" title="RFC6121">第八章</a>发送那个订阅请求给所有可用的资源. 作为获得该出席信息订阅请求的回执的一个方法, 该联系人的服务器可以从该联系人的纯JID发送一个类型为"unavailable"的presence节到该用户的纯JID(该用户的客户端不能(MUST NOT)假定这个回执提供了关于该联系人的出席信息, 因为它来自该联系人的纯JID并且在该订阅请求被批准之前就收到了).
</dd><dd>4. 另外, 如果在订阅请求被联系人的服务器接收到的时候该联系人没有可用的资源, 那么该联系人的服务器必须保持一个完整的包括该订阅请求的presence节的记录, 包括其中任何扩展的内容(见<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>的章节8.4), 并且在该联系人接下来有一个可用的资源的时候递送该请求. 无论何时该联系人建立了一个可用的资源该联系人的服务器必须继续递送该订阅请求, 直到该联系人要么批准要么拒绝该请求. (当该联系人接下来有一个可用的资源的时候,该联系人的服务器不能(MUST NOT)从任何给定用户递送多个订阅请求; 例如, 如果该用户发送多个订阅请求到该联系人而此时该联系人是离线的, 该联系人的服务器应该只存储那些请求中的一个, 比如第一个请求或最后一个请求, 并且当该联系人接下来有一个可用资源的时候必须只递送这些请求中的一个; 这有助于防止"垃圾订阅请求".)
</dd></dl>
</dd></dl>
<dl><dd>安全警告: 直到以及除非该联系人如<a href="/RFC6121#.E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">章节3.1.4</a>所述批准该订阅请求, 该联系人的服务器不能(MUST NOT)在该联系人的名册上添加该用户的条目.
</dd></dl>
<dl><dd>安全警告: 对于联系人的服务器存储完整的出席信息订阅请求的节的强制要求带来了一个应用程序资源衰竭攻击的可能性(见<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">DOS</a>的章节2.1.2), 例如, 由一个流氓服务器或一个协调好的用户群(例如, 一个 botnet) 攻击该联系人的服务器或特定联系人. 提醒服务器实现者们关注这类攻击的可能性并为对抗它提供工具, 比如允许服务管理员设置服务器整体或任何给定联系人存储的入站出席信息订阅请求的数量或大小的限制.
</dd></dl>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82">客户端处理入站订阅请求</span></h4>
<p>当一个可交互的客户端接收到一个订阅请求, 它必须把该请求展示给控制该客户端的自然人(即, 该 "联系人") 来批准, 除非该联系人被显式地配置成该客户端自动批准或拒绝如上所述的某些或全部订阅请求. 一个不是被自然人控制的自动客户端将有自己的应用特有的规则以批准或拒绝订阅请求.
</p><p>客户端通过发送一个类型为"subscribed"的presence节来批准一个订阅请求, 联系人的服务器会作<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E8.AE.A2.E9.98.85.E6.89.B9.E5.87.86" title="RFC6121">章节3.1.5</a>所述的处理，用户的服务器会作<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E8.AE.A2.E9.98.85.E6.89.B9.E5.87.86" title="RFC6121">章节3.1.6</a>所述的处理.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CC: </span><span class="re1">&lt;presence</span> <span class="re0">id</span>=<span class="st0">'h4v1c4kj'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'subscribed'</span><span class="re2">/&gt;</span></pre></div></div>
<p>客户端通过发送一个类型为"unsubscribed"的presence节来拒绝一个订阅请求, 联系人的服务器和用户的服务器都会作<a href="/index.php?title=RFC6121%E6%92%A4%E9%94%80%E8%A2%AB%E8%AE%A2%E9%98%85&amp;action=edit&amp;redlink=1" class="new" title="RFC6121撤销被订阅（尚未撰写）">章节3.2</a>所述的处理.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CC: </span><span class="re1">&lt;presence</span> <span class="re0">id</span>=<span class="st0">'tb2m1b59'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'unsubscribed'</span><span class="re2">/&gt;</span></pre></div></div>
<p>为了跟踪的目的, 客户端应该在一个订阅批准或订阅拒绝中包含一个'id'属性; 这个'id'属性不能(MUST NOT)镜像该订阅请求的'id'属性.
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E8.AE.A2.E9.98.85.E6.89.B9.E5.87.86">服务器处理出站订阅批准</span></h4>
<p>当联系人的客户端发送订阅批准的时候, 联系人的服务器必须以联系人的纯JID&lt;contact@domainpart&gt;标记这个出站的节并本地递送或远程路由该节到用户那里.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">id</span>=<span class="st0">'h4v1c4kj'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'subscribed'</span><span class="re2">/&gt;</span></pre></div></div>
<p>联系人的服务器接着必须发送一个updated roster push(更新名册推送)给所有联系人的感兴趣的资源, 其中的'subscription'属性值设为"from". (这里假定该联系人未曾订阅该用户; 如果是那种情况(译者注：即该联系人已经订阅该用户), 则'subscription'属性值将设置为"both", 如<a href="/RFC6121#.E9.99.84.E5.BD.95A:_.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>所述.)
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'a78b4q6ha463'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
        <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">subscription</span>=<span class="st0">'from'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
CS: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'x81g3bdy4n19'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com/chamber'</span>
        <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">subscription</span>=<span class="st0">'from'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>从联系人的视角来看, 现在存在一个来自用户的订阅, 这就是为什么'subscription'属性值要设为"from". (这里假定该联系人未曾订阅该用户; 如果是那种情况(译者注：即该联系人已经订阅该用户), 则'subscription'属性值将设置为"both", 如<a href="/RFC6121#.E9.99.84.E5.BD.95A:_.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>所述.)
</p><p>该联系人的服务器接着也必须从该联系人的可用资源发送当前的出席信息给给该用户.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">id</span>=<span class="st0">'pw72bc5j'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span>
              <span class="re0">id</span>=<span class="st0">'ux31da4q'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span></pre></div></div>
<p>为了订阅该用户的出席信息, 该联系人需要发送一个订阅请求给该用户. (XMPP客户端经常会自动发送订阅请求而不是要求联系人发起这个订阅请求, 因为假定期望的结束状态是一个双向订阅.) 自然, 当该联系人发送一个订阅请求给该用户, 这个订阅状态将不同于前面示例中展示的状态(见 <a href="/RFC6121#.E9.99.84.E5.BD.95A:_.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>) 并且角色将被反转.
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E8.AE.A2.E9.98.85.E6.89.B9.E5.87.86">服务器处理入站订阅批准</span></h4>
<p>当用户的服务器收到一个订阅批准, 它必须首先检查是否该联系人在该用户的名册中并且 subscription='none' 或 subscription='from' 以及 'ask' 标记设为 "subscribe" (即, 订阅状态为 "None + Pending Out", "None + Pending Out+In", 或 "From + Pending Out"; 见 <a href="/RFC6121#.E9.99.84.E5.BD.95A:_.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>). 如果这个检查成功了, 那么该用户的服务器必须:
</p>
<dl><dd>1. 递送入站订阅批准到该用户的所有感兴趣的资源(这有助于给该用户的客户端关于订阅批准的正确的上下文，使得它们能分辨由该用户的另一个资源生成的名册推送和从联系人收到的订阅批准的不同). 这一步必须在下一步的发送名册推送之前去做.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
                  <span class="re0">id</span>=<span class="st0">'h4v1c4kj'</span>
                  <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
                  <span class="re0">type</span>=<span class="st0">'subscribed'</span><span class="re2">/&gt;</span></pre></div></div>
<dl><dd>2. 发起一个roster push给该用户的所有感兴趣的资源, 包含一个该；联系人的更新的名册条目，其'subscription'属性值设为"to" (如果订阅状态是 "None + Pending Out" 或 "None + Pending Out+In") 或 "both" (如果订阅状态是 "From + Pending Out").
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    US: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'b89c5r7ib576'</span>
            <span class="re0">to</span>=<span class="st0">'romeo@example.net/foo'</span>
            <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
            <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'juliet@example.com'</span>
                  <span class="re0">subscription</span>=<span class="st0">'to'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
    US: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'b89c5r7ib577'</span>
            <span class="re0">to</span>=<span class="st0">'romeo@example.net/bar'</span>
            <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
            <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'juliet@example.com'</span>
                  <span class="re0">subscription</span>=<span class="st0">'to'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<dl><dd>3. 该用户的服务器也必须把从该联系人的每个可用资源收到的可用的出席信息节递送给该用户的每个可用资源.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    [ ... to resource1 ... ]
&#160;
    US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
                  <span class="re0">id</span>=<span class="st0">'pw72bc5j'</span>
                  <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
    [ ... to resource2 ... ]
&#160;
    US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
                  <span class="re0">id</span>=<span class="st0">'pw72bc5j'</span>
                  <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
    [ ... to resource1 ... ]
&#160;
    US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span>
                  <span class="re0">id</span>=<span class="st0">'ux31da4q'</span>
                  <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
    [ ... to resource2 ... ]
&#160;
    US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span>
                  <span class="re0">id</span>=<span class="st0">'ux31da4q'</span>
                  <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span></pre></div></div>
<dl><dd> 实现备注: 如果在收到入站订阅批准通知的时候该用户的帐号没有可用资源, 该用户的服务器可以保持该通知的记录(理想的是完整的出席信息节)并且等到该帐号有一个可用资源的时候再递送给它. 这一行为向用户提供了当用户离线的时候发生名册变更的原因的更完整的信息.
</dd></dl>
<p>另外 -- 就是, 如果该用户不存在, 如果该联系人不在该用户的名册中, 或如果该联系人在该用户的名册中但是订阅状态不在前述的检查中描述的情况之中 -- 那么该用户的服务器必须安静地忽略该订阅批准通知而不递送给该用户, 也不修改该用户的名册, 也不生成名册推送到该用户的感兴趣的资源.
</p><p>从该用户的角度来看, 现在存在一个到该联系人的出席信息的订阅(这就是为什么'subscription'属性值要设为"to").
</p>
<h3> <span class="mw-headline" id=".E6.92.A4.E9.94.80.E8.A2.AB.E8.AE.A2.E9.98.85">撤销被订阅</span></h3>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E6.92.A4.E9.94.80.E8.A2.AB.E8.AE.A2.E9.98.85">客户端生成撤销被订阅</span></h4>
<p>如果一个联系人想撤销它之前接受某个用户订阅的授权, 以撤销一个预批准的被订阅(<a href="/RFC6121#.E9.A2.84.E6.89.B9.E5.87.86.E8.A2.AB.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">章节3.4</a>), 或拒绝一个订阅请求, 它发送一个类型为"unsubscribed"的出席信息节.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CC: </span><span class="re1">&lt;presence</span> <span class="re0">id</span>=<span class="st0">'ij5b1v7g'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'unsubscribed'</span><span class="re2">/&gt;</span></pre></div></div>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E8.A2.AB.E8.AE.A2.E9.98.85.E6.92.A4.E9.94.80">服务器处理出站被订阅撤销</span></h4>
<p>在接收到出站被订阅撤销之后, 该联系人的服务器必须做如下处理.
</p>
<dl><dd><ol><li> 如果该用户的纯JID还不在该联系人的名册或在联系人名册中的状态是"None", "None + Pending Out", 或 "To", 该联系人的服务器不能(SHOULD NOT)路由或递送类型为"unsubscribed"的出席信息节给该用户，并且不能(MUST NOT)发送接下来所说的类型为"unavailable"的出席信息通知给该用户.
</li><li> 如果该用户的纯JID在该联系人的名册的状态为"None", "None + Pending Out", 或 "To" 并且 'approved' 标记被设为 "true" (所以代表了<a href="/RFC6121#.E9.A2.84.E6.89.B9.E5.87.86.E8.A2.AB.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">章节3.4</a>所述的订阅预批准), 该联系人的服务器必须移除该 预批准 并且不能(MUST NOT)路由或递送类型为"unsubscribed"的出席信息节给该用户.
</li><li> 否则, 按如下的示例, 该联系人的服务器必须同时路由或递送类型为"unavailable"的出席信息通知和类型为"unsubscribed"的出席信息节给该用户，并且必须发送一个名册推送给该联系人.
</li></ol>
</dd></dl>
<p>因为该用户仍然订阅了该联系人的出席信息(即, 在该联系人的服务器路由或递送类型为"unsubscribed"的出席信息给该用户之前), 该联系人的服务器必须从该联系人的所有在线资源发送一个类型为"unavailable"的出席信息节给该用户.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">id</span>=<span class="st0">'i8bsg3h3'</span>
              <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span>
              <span class="re0">id</span>=<span class="st0">'bvx2c9mk'</span>
              <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">/&gt;</span></pre></div></div>
<p>然后该联系人的服务器必须路由或递送类型为"unsubscribed"的出席信息节给该用户, 确保在出站被订阅取消要带上该联系人的纯JID&lt;contact@domainpart&gt;.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">id</span>=<span class="st0">'ij5b1v7g'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'unsubscribed'</span><span class="re2">/&gt;</span></pre></div></div>
<p>该联系人从的服务器必须发送一个带有更新的名册条目的名册推送给该联系人的所有感兴趣的资源, 这里订阅状态现在要么是"none"要么是"to" (见<a href="/RFC6121#.E9.99.84.E5.BD.95A_.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'pw3f2v175b34'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
        <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
CS: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'zu2y3f571v35'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com/chamber'</span>
        <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E8.A2.AB.E8.AE.A2.E9.98.85.E6.92.A4.E9.94.80">服务器处理入站被订阅撤销</span></h4>
<p>当用户的服务器接收到入站被订阅撤销后, 它必须首先检查该联系人是否在该用户的名册中并且 subscription='to' 或 subscription='both' (见<a href="/RFC6121#.E9.99.84.E5.BD.95A_.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>). 如果这个检查成功了, 那么该服务器必须:
</p>
<dl><dd>1. 递送该入站被订阅撤销到该用户的所有感兴趣的资源(这有助于给该用户的客户端正确的关于订阅被撤销的上下文，使得它们能区分由用户的另一个资源产生的名册推送和从该联系人收到的订阅被撤销). 这个动作必须在发送下一步所述的名册推送之前进行.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
                  <span class="re0">id</span>=<span class="st0">'ij5b1v7g'</span>
                  <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
                  <span class="re0">type</span>=<span class="st0">'unsubscribed'</span><span class="re2">/&gt;</span></pre></div></div>
<dl><dd>2. 发起一个名册推送给该用户的所有感兴趣的资源, 包含一个该联系人的更新的名册条目，其'subscription'属性值设为"none"(如果之前的订阅状态为"To"或"To + Pending In") 或"from"(如果订阅状态为"Both").
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    US: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'h37h3u1bv400'</span>
            <span class="re0">to</span>=<span class="st0">'romeo@example.net/foo'</span>
            <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
            <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'juliet@example.com'</span>
                  <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
    US: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'h37h3u1bv401'</span>
            <span class="re0">to</span>=<span class="st0">'romeo@example.net/bar'</span>
            <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
            <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'juliet@example.com'</span>
                  <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>该用户的服务器也必须递送类型为"unavailable"的入站出席信息节.
</p>
<dl><dd> 实现备注: 如果收到该入站被撤销订阅通知的时候，该用户的帐号没有可用的资源, 该用户的服务器可以保持一个通知记录(理想的情况是完整的出席信息节)，然后在该帐号下次有可用资源的时候递送该通知. 这一行为把该用户离线期间发生的名册变更的原因提供了更完整的信号给该用户.
</dd></dl>
<p>另外 -- 就是, 如果该用户不存在, 如果该联系人不在该用户的名册中, 或如果该联系人在该用户的名册中的订阅状态不是前述检查所描述的那些状态 -- 那么该用户的服务器必须安静地忽略该被取消订阅通知而不把它递送给该用户, 也不修改该用户的名册, 以及不生成名册推送给该用户的感兴趣的资源.
</p>
<h3> <span class="mw-headline" id=".E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85">取消订阅</span></h3>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85">客户端生成取消订阅</span></h4>
<p>如果一个用户想取消订阅一个联系人的出席信息, 它发送一个类型为"unsubscribe"的出席信息节.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;presence</span> <span class="re0">id</span>=<span class="st0">'ul4bs71n'</span>
              <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">type</span>=<span class="st0">'unsubscribe'</span><span class="re2">/&gt;</span></pre></div></div>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85">服务器处理出站取消订阅</span></h4>
<p>在接收到出站取消订阅之后, 该用户的服务器必须做如下处理.
</p>
<dl><dd><ol><li> 如果联系人和该用户在同一台服务器上, 那么当该服务器处理订阅请求时必须遵循<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85" title="RFC6121">3.3.3</a>定义的规则.
</li><li> 如果联系人位于远端服务器上, 按照本地服务策略，该用户的服务器必须接着把该节路由到那个远端域以满足核心XMPP节处理规则. (这可能导致返回适当的节错误给该用户, 类似&lt;remote-server-timeout/&gt;.)
</li></ol>
</dd></dl>
<p>如前所述, 在本地递送或远程路由取消订阅之前, 该用户的服务器必须在该节上标记该用户的纯JID&lt;user@domainpart&gt;.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">id</span>=<span class="st0">'ul4bs71n'</span>
              <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">type</span>=<span class="st0">'unsubscribe'</span><span class="re2">/&gt;</span></pre></div></div>
<p>该用户的服务器接着必须发送一个带有更新的名册条目的名册推送给该用户的所有感兴趣的资源, 这里的订阅状态就变成要么是"none"要么是"from" (见[[RFC6121#附录 A:订阅状态|附录A).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'h37h3u1bv402'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net/foo'</span>
        <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
US: </span><span class="re1">&lt;iq</span> <span class="re0">to</span>=<span class="st0">'romeo@example.net/bar'</span>
        <span class="re0">type</span>=<span class="st0">'set'</span>
        <span class="re0">id</span>=<span class="st0">'h37h3u1bv403'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85">服务器处理入站取消订阅</span></h4>
<p>当联系人的服务器收到取消订阅通知, 它必须首先检查该用户的纯JID是否在该联系人的名册中且subscription='from'或subscription='both' (即, 订阅状态为 "From", "From + Pending Out", 或 "Both"; 见<a href="/RFC6121#.E9.99.84.E5.BD.95_A:.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>). 如果这个检查成功了, 接着该联系人的服务器必须:
</p>
<dl><dd>1. 把入站取消订阅递送给该联系人的所有感兴趣的资源(这有助于向联系人的客户端们提供关于取消订阅的正确的上下文，这样它们就能区分是由联系人的另一个资源产生的名册推送还是从该用户收到的取消订阅). 这个动作必须发生在下面所说的发送名册推送步骤之前.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
                  <span class="re0">id</span>=<span class="st0">'ul4bs71n'</span>
                  <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
                  <span class="re0">type</span>=<span class="st0">'unsubscribe'</span><span class="re2">/&gt;</span></pre></div></div>
<dl><dd>2. 发起一个名册推送给该联系人的所有感兴趣的资源, 为该用户包含一个更新的条目并把'subscription'属性值设为"none" (如果之前的订阅状态是"From"或"From + Pending Out") 或"to" (如果之前的订阅状态是 "Both").
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    CS: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'tn2b5893g1s4'</span>
            <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
            <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
            <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
                  <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/iq<span class="re2">&gt;</span></span><span class="co3">
&#160;
    CS: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'sp3b56n27hrp'</span>
            <span class="re0">to</span>=<span class="st0">'juliet@example.com/chamber'</span>
            <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
            <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'romeo@example.net'</span>
                  <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<dl><dd>3. 从该联系人的每一个可用资源生成一个类型为"unavailable"的出站出席信息节给该用户.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
                  <span class="re0">id</span>=<span class="st0">'o5v91w49'</span>
                  <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
                  <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
    CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span>
                  <span class="re0">id</span>=<span class="st0">'n6b1c37k'</span>
                  <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
                  <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">/&gt;</span></pre></div></div>
<dl><dd>实现备注: 如果在收到入站取消订阅通知的时候该联系人的帐号没有可用资源, 该联系人的服务器可以保持一个通知记录(理想情况下是完整的出席信息节)并且接着在该帐号下次有一个可用资源的时候递送该通知. 这一行为为该用户提供了关于该用户离线时发生的名册变更的更完整的信息.
</dd></dl>
<p>另外 -- 就是, 如果该联系人不存在, 如果该用户不在该联系人的名册中, 或如果该用户的纯JID在该联系人的名册中并且订阅状态不同于前面检查所述的结果 -- 那么该联系人的服务器必须安静地忽略该取消订阅节，不递送给该联系人, 不修改联系人的名册, 也不生成名册推送给该联系人的所有感兴趣的资源. 无论如何, 如果该联系人的服务器持续跟踪一个从该用户到该联系人的入站出席信息订阅请求但是该用户仍不在该联系人的名册中(功能上相当于一个订阅状态"None + Pending In"，这里该联系人从未添加该用户到联系人的名册中), 那么该联系人的服务器必须简单地移除该入站出新信息订阅请求的记录(它无法从该联系人的名册中移除该用户，因为该用户从未被加入到该联系人的名册中).
</p>
<dl><dd>实现备注: 该用户的客户端不能(MUST NOT)依赖于从该联系人收到的取消订阅出席信息通知, 因为它必须考虑对该联系人的出席信息订阅, 以及关于该联系人的出席信息, 当它发送类型为"unsubscribe"的出席信息节或它收到由取消订阅请求触发的名册推送的时候为无或空.
</dd></dl>
<h3> <span class="mw-headline" id=".E9.A2.84.E6.89.B9.E5.87.86.E8.A2.AB.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82">预批准被订阅请求</span></h3>
<p>如果一个用户还未从一个联系人那里接收到订阅请求, 该用户可以"预批准"这样一个请求，这样它将被该用户的服务器自动地批准.
</p><p>对订阅预批准的支持在客户端和服务器上都是可选的. 如果一个服务器支持订阅预批准, 那么它必须在流协商时声明以下流特性.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;sub</span> <span class="re0">xmlns</span>=<span class="st0">'urn:xmpp:features:pre-approval'</span><span class="re2">/&gt;</span></pre></div></div>
<p>订阅预批准流特性只不过有一点用，所以永远不会强制协商.
</p>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E8.A2.AB.E8.AE.A2.E9.98.85.E9.A2.84.E6.89.B9.E5.87.86">客户端生成被订阅预批准</span></h4>
<p>如果客户端所连接的服务器声明了订阅预批准, 该客户端可以通过发送一个类型为"subscribed"的节给该联系人以生成一个订阅预批准.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;presence</span> <span class="re0">id</span>=<span class="st0">'pg81vx64'</span>
              <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">type</span>=<span class="st0">'subscribed'</span><span class="re2">/&gt;</span></pre></div></div>
<p>如果该服务器未声明支持订阅预批准, 该客户端不能(MUST NOT)尝试预批准来自潜在的或者实际的联系人的订阅请求. 
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E8.A2.AB.E8.AE.A2.E9.98.85.E9.A2.84.E6.89.B9.E5.87.86">服务器处理被订阅预批准</span></h4>
<p>在接收到类型为"subscribed"的出席信息节之后, 该用户的服务器如果支持订阅预批准，必须做如下处理.
</p>
<dl><dd><ol><li> 如果该联系人在该用户的名册中且状态为 "Both", "From", 或 "From + Pending Out", 该用户的服务器必须安静地忽略该节.
</li><li> 如果该联系人在该用户的名册中且状态为 "To + Pending In", "None + Pending In", 或 "None + Pending Out+In", 该用户的服务器必须如普通的订阅批准那样处理该节 (见<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E8.AE.A2.E9.98.85.E6.89.B9.E5.87.86" title="RFC6121">3.1.5</a>)，更新现有的名册条目的状态成为 "Both", "From", 或 "From + Pending Out" (分别的), 推送修改的名册条目到该用户的所有感兴趣的资源, 并路由该类型为"subscribed"的出席信息节到该联系人.
</li><li> 如果该联系人在该用户的名册中且状态为 "To", "None", 或 "None + Pending Out", 该用户的服务器必须把'approved'标记的值设置为"true"来记录订阅预批准, 然后推送修改的名册条目到该用户的所有感兴趣的资源. 无论如何, 该用户的服务器不能(MUST NOT)路由该类型为"subscribed"的出席信息节到该联系人.
</li><li> 如果该联系人还不在该用户的名册中, 那么该用户的服务器必须为该联系人创建一个名册条目且状态为"None"，并且把'approved'标记的值设为"true", 然后推送该名册条目到该用户的所有感兴趣的资源. 无论如何, 该用户的服务器不能(MUST NOT)路由该类型为"subscribed"的出席信息节到该联系人.
</li></ol>
</dd></dl>
<p>一个名册推送的示例如下.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'h3bs81vs763f'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net/bar'</span>
        <span class="re0">type</span>=<span class="st0">'set'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;item</span> <span class="re0">approved</span>=<span class="st0">'true'</span>
              <span class="re0">jid</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">subscription</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>当'approved'标记被设为"true", 该用户的服务器不能(MUST NOT)从该联系人递送一个类型为"subscribe"的出席信息节给该用户, 而是必须代表该用户自动应答这样一个节，即从该用户的纯JID返回一个类型为"subscribed"的出席信息节给该联系人的纯JID.
</p>
<dl><dd>实现备注: 服务器在已经从该联系人接收到了一个出席信息订阅请求之后是否维护一个订阅批准记录，对于实现或本地服务策略来说是个问题. 如果该服务器不维护这样一个记录, 在接收该订阅请求之后它将在该名册条目中不为该联系人包含'approved'属性(即, 在随后的名册推送和名册结果中). 如果该服务器维护这样一个记录, 它将在名册条目中总是为该联系人包含'approved'属性(设为"true"), 直到或除非该用户发送一个类型为"unsubscribed"的出席信息节到该联系人(或从名册中完全移除该联系人).
</dd></dl>
<dl><dd>实现备注: 客户端能通过发送一个类型为"unsubscribed"的出席信息节取消一个预批准, 更全面的描述在<a href="/RFC6121#.E6.92.A4.E9.94.80.E8.A2.AB.E8.AE.A2.E9.98.85" title="RFC6121">3.2</a>. 在这种情况下, 该用户的服务器将发送一个名册推送给该有用户的所有感兴趣的资源，而其'approved'属性是被移除的. (另一种选择是, 该客户端能简单地完全移除该名册条目.)
</dd></dl>
<h2> <span class="mw-headline" id=".E4.BA.A4.E6.8D.A2.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">交换出席信息</span></h2>
<h3> <span class="mw-headline" id=".E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E5.8E.9F.E7.90.86">出席信息原理</span></h3>
<p>出席信息是指在网络上通讯的一个实体的可用性. 在最基本的层面上, 出席信息是一个"on/off"的逻辑变量以标记一个实体可不可以通讯(也用术语"在线"和"离线"). 在XMPP中, 当客户端生成一个不带'type'属性的&lt;presence/&gt;节时就标记了一个实体的可用性, 当它的客户端生成一个'type'属性值为"unavailable"的&lt;presence/&gt;节时表示一个实体失去了可用性.
</p><p>XMPP出席信息典型地遵循一个"发布-订阅"或"观察者"模式, 这里,一个实体发送出席信息给它的服务器, 它的服务器接着广播那个信息给所有订阅了该实体的出席信息的联系人(在<a rel="nofollow" class="external text" href="http://xmpp.org/rfcs/rfc6121.html#IMP-MODEL">IMP‑MODEL</a>的术语中, 一个生成出席信息的实体就是一个"presentity"并且那些接收出席信息的实体们是"subscribers"). 一个客户端通过发送一个不带'to'地址的出席信息节给它的服务器来生成出席信息用于广播给所有已订阅的实体们, 这里的出席信息既没有'type'属性又没有值为"unavailable"的'type'属性. 这种出席信息被称为"广播出席信息". (一个客户端也可以发送"定向出席信息", 即, 一个带'to'地址的出席信息节; 这不太常见但是有时被用于发送出席信息给那些没有订阅该用户的出席信息的实体们; 见<a href="/RFC6121#.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.6.</a>)
</p><p>在一个客户端完成<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>定义的先决条件之后, 它能通过发送初始化出席信息在它的服务器建立一个"出席信息会话", 通过发送unavailable出席信息可以中止这个出席信息会话. 在它的出席信息会话期间, 一个已连接的资源(<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>中的术语)被称为一个"可用的资源".
</p><p>在XMPP中, 应用集合了消息和出席信息功能, 它的出席信息标记的可用性的缺省通讯类型是消息; 然而, 对于XMPP应用来说把消息和出席信息功能集合到一起并不是必要的, 它们能提供独立的不带消息的出席信息特性(另外, XMPP服务器们不会为了成功地路由message和IQ节而强制要求关于网络可用性的信息).
</p>
<dl><dd>提示备注: 在接下来的例子中, 用户是&lt;juliet@example.com&gt;, 她有两个可用的资源("balcony"和"chamber"), 而在她的名册中有三个联系人且订阅状态为"from"或"both": &lt;romeo@example.net&gt;, &lt;mercutio@example.com&gt;, 和&lt;benvolio@example.net&gt;.
</dd></dl>
<h3> <span class="mw-headline" id=".E5.88.9D.E5.A7.8B.E5.8C.96.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">初始化出席信息</span></h3>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E5.88.9D.E5.A7.8B.E5.8C.96.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">客户端生成初始化出席信息</span></h4>
<p>在完成<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>(必需的)中所述的前提条件并请求名册(推荐的)之后, 一个客户端通过发送"初始化出席信息"给它的服务器来标记它的通讯可用性, 即, 一个不带'to'地址(意思是由该服务器代表该客户端广播它)和'type'属性(表示该用户的可用性)的出席信息节.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;presence</span><span class="re2">/&gt;</span></pre></div></div>
<p>该初始化出席信息可以包含&lt;priority/&gt;元素, &lt;show/&gt;元素, 一个一个或多个&lt;status/&gt;元素实例, 以及扩展内容; 细节见<a href="/RFC6121#.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AF.AD.E6.B3.95" title="RFC6121">4.7</a>.
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E5.88.9D.E5.A7.8B.E5.8C.96.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">服务器处理出站初始化出席信息</span></h4>
<p>从一个客户端接收到初始化出席信息之后, 该用户的服务器必须从该用户的全JID&lt;user@domainpart/resourcepart&gt;发送该出席信息节给所有订阅了该用户的出席信息的联系人; 这些联系人的JID目前正在该用户的名册中且'subscription'属性值为"from"或"both".
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'mercutio@example.com'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'benvolio@example.net'</span><span class="re2">/&gt;</span></pre></div></div>
<p>该用户的服务器也必须从该用户的新的可用资源广播初始化出席信息给该用户的所有可用资源, 包括在第一个地方生成该出席信息通知的那个资源(即, 一个实体隐形地订阅了它自己的出席信息).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">[... to the &quot;balcony&quot; resource ...]
&#160;
US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
[... to the &quot;chamber&quot; resource ...]
&#160;
US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span><span class="re2">/&gt;</span></pre></div></div>
<p>在缺少关于该用户的联系人的出席信息的情况下, 该用户的服务器也必须代表该用户发送出席信息探测给该用户的联系人，如<a href="/RFC6121#.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B" title="RFC6121">4.3</a>所述.
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.88.9D.E5.A7.8B.E5.8C.96.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">服务器处理入站初始化出席信息</span></h4>
<p>在从该用户接收到出席信息之后, 该联系人的服务器必须递送该用户的出席信息节给该联系人的所有可用资源.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">[ ... to resource1 ... ]
&#160;
CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
[ ... to resource2 ... ]
&#160;
CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span></pre></div></div>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E5.88.9D.E5.A7.8B.E5.8C.96.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">客户端处理初始化出席信息</span></h4>
<p>当该联系人的客户端从该用户接收到出席信息之后, 对于可交互的客户端推荐以下行为:
</p>
<dl><dd><ol><li> 如果该用户的纯JID在该联系人的名册中, 在一个适当的名册接口中显示该出席信息.
</li><li> 如果该用户不在该联系人的名册中但是联系人正在交换message或IQ节, 为了那个通讯会话在该用户的接口中显示该出席信息(参见<a href="/RFC6121#.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.6</a>和<a href="/RFC6121#.E4.B8.80.E5.AF.B9.E4.B8.80.E8.81.8A.E5.A4.A9.E4.BC.9A.E8.AF.9D" title="RFC6121">5.1</a>).
</li><li> 其他情况下, 忽略出席信息并且不把它显示给该联系人.
</li></ol>
</dd></dl>
<h3> <span class="mw-headline" id=".E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B">出席信息探测</span></h3>
<p>一个"出席信息探测"是一个对某联系人的当前出席信息的请求, 由代表某个用户的服务器代表该用户发送; 语法上它是一个'type'属性值为"probe"的出席信息节. 在出席信息订阅的上下文中, 'from'地址的值必须是订阅的用户的纯JID而'to'地址的值必须是被订阅的联系人的纯JID, 因为出席信息订阅是基于纯JID的.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">id</span>=<span class="st0">'ign291v5'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'probe'</span><span class="re2">/&gt;</span></pre></div></div>
<dl><dd>互操作性备注: <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a> 定义了探测是从全JID发出的, 而不是从纯JID (规则的改变是因为订阅是基于纯JID的). 一些现存的实现仍然从全JID而不是纯JID发送.
</dd></dl>
<p>探测也能由一个从某个出席信息订阅上下文的外部接收到了出席信息的实体发送, 典型的是当该联系人已经发送了<a href="/RFC6121#.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.6</a>所述的定向出席信息的时候; 在这种情况下'from'或'to'地址的值可以是一个全JID而不是一个纯JID. 完整的讨论参见<a href="/RFC6121#.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.6</a>.
</p><p>出席信息探测不应该(SHOULD NOT)由一个客户端发送, 因为通常一个客户端不需要发送它们， 原因是从一个用户的联系人那里收集出席信息的任务是由该用户的服务器管理的. 无论如何, 如果一个用户的客户端生成了一个出站出席信息探测， 那么该用户的服务器应该路由这个探测(如果该联系人位于另一个服务器上)或处理这个探测(如果该联系人在同一台服务器上)并且不能(MUST NOT）从一个已连接的客户端使用该出席信息探测的回执来作为唯一的理由来返回一个节错误或流错误给该客户端.
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E7.94.9F.E6.88.90.E5.87.BA.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B">服务器生成出站出席信息探测</span></h4>
<p>当一个服务器需要查询一个用户的联系人的可用性的时候, 它从该用户的纯JID &lt;user@domainpart&gt;发送一个出席信息探测到该联系人的纯JID &lt;contact@domainpart&gt;.
</p>
<dl><dd>实现备注: 尽管出席信息探测是用来发送给联系人的(即, 一个用户所订阅的那些实体), 一个服务器可以发送出席信息探测给该用户在当前会话时收到了出席信息的某个实体的全JID.
</dd></dl>
<p>当用户在任何时候通过发送初始化出席信息来开始一个新的出席信息会话，该用户的服务器应该发送一个出席信息探测; 无论如何, 如果它认为关于该用户的联系人的出席信息是可靠的和最新的，该服务器可以选择在那个时间点不发送出席信息探测(例如, 因为该用户有另外一个可用资源或因为该用户在新的出席信息开始之前刚刚注销登陆). 另外, 如果一个服务器在一个可配置的时间段内没有从某个联系人收到出席信息或其他通讯，它可以定期发送出席信息探测给那个联系人; 这有助于防止看起来在线但是实际上没有在线的"幽灵"联系人.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">id</span>=<span class="st0">'ign291v5'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'probe'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">id</span>=<span class="st0">'xv291f38'</span>
              <span class="re0">to</span>=<span class="st0">'mercutio@example.com'</span>
              <span class="re0">type</span>=<span class="st0">'probe'</span><span class="re2">/&gt;</span></pre></div></div>
<p>自然的, 该用户的服务器不需要发送一个出席信息探测给一个联系人，如果该联系人的帐号位于该用户的同一台服务器, 因为该服务器本地就拥有该联系人的信息.
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B">服务器处理入站出席信息探测</span></h4>
<p>在接收到一个用户的服务器代表该用户发送到该联系人的纯JID的出席信息探测之后, 该联系人的服务器必须应答如下:
</p>
<dl><dd>1. 如果该联系人帐号不存在或该用户的纯JID在该联系人的名册中并且订阅状态不是"From", "From + Pending Out", 或"Both" (如<a href="/RFC6121#.E9.99.84.E5.BD.95A_.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>所述), 那么该联系人的服务器应该在对该出席信息探测的应答中返回一个类型为"unsubscribed"的出席信息节(这将触发一个协议流用于<a href="/RFC6121#.E6.92.A4.E9.94.80.E8.A2.AB.E8.AE.A2.E9.98.85" title="RFC6121">3.2</a>所述的撤销该用户对该联系人的订阅; 无论如何, 这不能(MUST NOT)导致<a href="/RFC6121#.E9.A2.84.E6.89.B9.E5.87.86.E8.A2.AB.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">3.4</a>所述的订阅预批准的撤销). 这里'from'地址必须是该联系人的纯JID, 因为指定一个全JID则等同于出席信息泄露<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>中所说的.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'mercutio@example.com'</span>
                  <span class="re0">id</span>=<span class="st0">'xv291f38'</span>
                  <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
                  <span class="re0">type</span>=<span class="st0">'unsubscribed'</span><span class="re2">/&gt;</span></pre></div></div>
<dl><dd>无论如何, 如果一个服务器从一个该服务器本身的已配置的域或其他信任的服务收到一个出席信息探测, 它可以提供关于该用户或那个实体的出席信息.
</dd><dd>2. 或者, 如果该联系人已经临时移动或永久移动到另一个地址, 那么该服务器应该返回一个类型为"error"的出席信息节并带上一个节错误条件&lt;redirect/&gt; (临时的) 或 &lt;gone/&gt; (永久的) 并包含该联系人的新地址.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'mercutio@example.com'</span>
                  <span class="re0">id</span>=<span class="st0">'xv291f38'</span>
                  <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
                  <span class="re0">type</span>=<span class="st0">'error'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;error</span> <span class="re0">type</span>=<span class="st0">'modify'</span><span class="re2">&gt;</span>
            <span class="re1">&lt;gone</span> <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">&gt;</span><span class="co3">
              xmpp:la-mer@example.com
            </span><span class="re1">&lt;/gone<span class="re2">&gt;</span></span>
          <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<dl><dd>3. 或者, 如果该联系人没有可用的资源, 那么该服务器应该通过发送给该用户一个类型为"unavailable"的出席信息节来应答该出席信息探测(尽管在这里更倾向于发送unavailable出席信息,因为它能导致对该探测的确定的回答; 但它不是强制性的,因为它极大地增加了该联系人的服务器生成的出席信息通知的数量). 这里的'from'地址是纯JID，因为没有该联系人相关的可用资源. 如果适当地遵循本地安全策略，该出席信息通知可以包含该服务器从该联系人收到的最近的unavailable出席信息节的全XML(包括原始节的'id'), 但是如果没有，那么该出席信息通知应该简单地表示该联系人是unavailable而没有任何原始提供的细节. 在任何情况下, 返回给该探测实体的出席信息节应该包含最近一次unavailable出席信息节被生成的时间信息(格式采用XMPP延迟递送扩展<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">DELAY</a>).
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'mercutio@example.com'</span>
                  <span class="re0">id</span>=<span class="st0">'xv291f38'</span>
                  <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
                  <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;delay</span> <span class="re0">xmlns</span>=<span class="st0">'urn:xmpp:delay'</span>
                 <span class="re0">stamp</span>=<span class="st0">'2002-09-10T23:41:07Z'</span><span class="re2">/&gt;</span>
        <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<dl><dd>4.  或者, 如果该联系人有至少一个可用资源, 那么该服务器必须通过向该用户发送该服务器从该联系人的每个可用资源收到的最近的没有'to'属性的出席信息节的全XML. 这里的'from'地址是每个可用资源的全JIDs.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">    CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net/foo'</span>
                  <span class="re0">id</span>=<span class="st0">'hzf1v27k'</span>
                  <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
    CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net/bar'</span>
                  <span class="re0">id</span>=<span class="st0">'ps6t1fu3'</span>
                  <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<dl><dd>实现备注: 通过"full XML"意味着从开始的&lt;presence&gt;标签到关闭的&lt;/presence&gt;标签之前的完整的节, 包括所有的元素和属性，要么由内容命名空间限定要么由扩展命名空间限定; 无论如何, 根据<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>,如果通过服务器-服务器流发送完整的节,该联系人的服务器将需要把内容命名空间从'jabber:client'转换成'jabber:server'.
</dd></dl>
<p>如果该联系人的服务器接收到一个地址指向该联系人的某个全JID的出席信息探测, 该服务器不能(MUST NOT)返回任何除了该探测的'to'地址之外的资源的出席信息. 规则 #1 和 #2 中对一个纯JID的探测同样适用于一个全JID探测的情况. 如果有一个匹配的全JID并且探测的实体通过一个出席信息订阅从而有权限察看该联系人的出席信息, 那么该服务器必须返回一个available出席信息通知, 它应该确切地只和那个available的资源通讯(没有详细信息，如&lt;show/&gt;, &lt;status/&gt;, &lt;priority/&gt;, 或出席信息扩展).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net/bar'</span>
              <span class="re0">to</span>=<span class="st0">'lobby@chat.example.com'</span><span class="re2">/&gt;</span></pre></div></div>
<dl><dd>实现备注: 关于前述处理定向出席信息的补充请参阅<a href="/RFC6121#.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.6</a>.
</dd></dl>
<h5> <span class="mw-headline" id=".E5.A4.84.E7.90.86.27id.27.E5.B1.9E.E6.80.A7">处理'id'属性</span></h5>
<p>和出席信息探测相关的'id'属性的处理在<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>中没有定义. 尽管"发送一个探测并接收到一个应答"的模式可能看起来像一个类似XMPP &lt;iq/&gt;节的 请求-应答 协议, 事实上它不是，因为对一个探测的应答可以包含多个出席信息节(分别对应该联系人当前活跃的每一个可用的资源). 基于这个原因, 如果该联系人当前有可用资源，那么该联系人的服务器应该保留当发送那些出席信息通知给探测实体的时候该联系人的原始出席信息节的'id'属性(如果有的话). 相比之下, 如果该联系人当前没有可用资源, 探测实体未被授权(通过出席信息订阅)察看该联系人的出席信息, 或发生了和该探测相关的错误, 那么该联系人的服务器在应答探测实体的时候应该镜像该用户的出席信息探测的'id'.
</p><p>以下示例展现这些不同之处.
</p><p>在第一个场景中, Juliet发送从她的"chamber"资源出席信息探测.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CC: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span> <span class="re0">id</span>=<span class="st0">'pres1'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">dnd</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">busy!</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>她也从她的"balcony"资源发送出席信息.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CC: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span> <span class="re0">id</span>=<span class="st0">'pres2'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">stepped away</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>Romeo的服务器接着发送一个探测给Juliet.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span> <span class="re0">id</span>=<span class="st0">'probe1'</span> <span class="re0">type</span>=<span class="st0">'probe'</span><span class="re2">/&gt;</span></pre></div></div>
<p>Juliet的服务器接着同时发送她的两个出席信息通知给Romeo, 保留她的客户端发送的节中的'id'属性.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span> <span class="re0">id</span>=<span class="st0">'pres1'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">dnd</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">busy!</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span> <span class="re0">id</span>=<span class="st0">'pres2'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">stepped away</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>在第二个场景中, 当Romeo的服务器发送探测的时候Juliet离线了.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">id</span>=<span class="st0">'probe2'</span>
              <span class="re0">type</span>=<span class="st0">'probe'</span><span class="re2">/&gt;</span></pre></div></div>
<p>Juliet的服务器应答一个unavailable通知, 镜像Rome的出席信息探测的'id'，因为从她的客户端已经发送的available通知的'id'被保留.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">id</span>=<span class="st0">'probe2'</span>
              <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">/&gt;</span></pre></div></div>
<h3> <span class="mw-headline" id=".E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E5.B9.BF.E6.92.AD">随后的出席信息广播</span></h3>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E5.B9.BF.E6.92.AD">客户端生成随后的出席信息广播</span></h4>
<p>在发送初始化出席信息之后, 在它的会话期间的任何时候该用户的客户端可以更新它的可用性并通过发送一个不带'to'地址并且没有'type'属性的出席信息节来广播.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;presence<span class="re2">&gt;</span></span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>该出席信息广播可以包含&lt;priority/&gt;元素, &lt;show/&gt;元素, 和一个或多个&lt;status/&gt;元素实例，同样的包括扩展内容; 详情参见<a href="/RFC6121#.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AF.AD.E6.B3.95" title="RFC6121">4.7</a>.
</p><p>无论如何, 一个用户应该发送一个出席信息更新只广播该用户的通讯可用性或该资源的通讯能力相关的信息. 和这些无关但是可能该用户的联系人同样感兴趣的信息应该通过其他方式来发送, 例如<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0163</a>所述的"发布-订阅"方法.
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">服务器处理随后的出站出席信息</span></h4>
<p>在接收到一个表达更新的可用性的出席信息节后, 该用户的服务器必须广播那个出席信息节的完整XML给该用户名册中并且订阅类型为"from"或"both"的联系人们.
</p>
<dl><dd>互操作性备注: <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>定义在发送随后的出席信息通知之前该用户的服务器将检查并确认没有从该联系人收到一个出席信息错误. 那个规则已经被移除，因为本协议使用类型为"unsubscribe"(而不是"error")的出席信息节来解决订阅同步问题, 部分也因为这类节使得该联系人在该用户的名册中的订阅状态变成了"none"或"to"(见<a href="/RFC6121#.E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85" title="RFC6121">3.3</a>和<a href="/RFC6121#.E9.99.84.E5.BD.95A._.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>), 所以没有了对错误检查的需要.
</dd></dl>
<dl><dd>互操作性备注: 如果订阅类型为"both", 一些现有的服务器实现根据该用户的服务器仅当该联系人在线时才发送随后的出席信息通知给一个联系人(就是说, 如果该用户的服务器在它发给该联系人的出席信息探测的应答中从未收到过该联系人在线的肯定的标示, 该用户的服务器不会从该用户向该联系人发送随后的出席信息通知). 这一行为被理解为节省带宽, 因为大部分出席信息订阅是双向的并且很多联系人在任何特定的时间都不在线.
</dd></dl>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'benvolio@example.net'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'mercutio@example.com'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<dl><dd>实现备注: 关于上述处理用于定向出席信息的补充规则参见<a href="/RFC6121#.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.6</a>.
</dd></dl>
<p>该用户的服务器也必须发送该出席信息节给该用户的所有可用资源(包括首先生成该出席信息的那个资源).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'juliet@example.com/chamber'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.85.A5.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">服务器处理随后的入站出席信息</span></h4>
<p>在从用户那接收到出席信息之后, 该联系人的服务器必须递送该用户的出席信息节到该联系人的所有可用资源.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">[ ... to resource1 ... ]
&#160;
CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
[ ... to resource2 ... ]
&#160;
CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">客户端处理随后的出席信息</span></h4>
<p>从联系人的客户端的视角来看, 初始化出席信息广播和随后的出席信息没有明显的不同, 所以联系人的客户端遵循<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.4.3</a>定义的入站出席信息处理的规则.
</p>
<h3> <span class="mw-headline" id=".E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">离线出席信息</span></h3>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">客户端生成离线出席信息</span></h4>
<p>在结束和一个服务器的出席信息会话之前, 用户的客户端应该通过发送"unavailable 出席信息"优雅地变更为离线, 即, 一个没有'to'属性并且有一个值为"unavailable"的'type'属性的出席信息节.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;presence</span> <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">/&gt;</span></pre></div></div>
<p>可选的, 该离线出席信息节可以包含一个或多个&lt;status/&gt;元素来定义为什么该用户不再在线的原因.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;presence</span> <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">going on vacation</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>无论如何, 该离线出席信息节不能(MUST NOT)包含&lt;priority/&gt;元素或&lt;show/&gt;元素, 因为这些元素只适用于可用资源.
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">服务器处理出站离线出席信息</span></h4>
<p>该用户的服务器不能(MUST NOT)依赖于从一个可用的资源接收到的unavailable出席信息, 因为该资源可能不优雅地离线了(例如, 如<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>所述，该资源的XML流因为任何原因带或未带流错误地被关闭了).
</p><p>如果一个可用的资源因为任何原因离线了(优雅或不优雅的), 该用户的服务器必须广播unavailable出席信息给所有在该用户的名册中的订阅状态为"from"或"both"的联系人.
</p>
<dl><dd>互操作性备注: <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a> 定义了该用户的服务器将检查并确认在发送unavailable出席信息通知之前它没有从该联系人收到一个出席信息错误.  那个规则已经被移除，因为本协议使用类型为"unsubscribe"(而不是"error")的出席信息节来解决订阅同步问题, 部分也因为这类节使得该联系人在该用户的名册中的订阅状态变成了"none"或"to"(见<a href="/RFC6121#.E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85" title="RFC6121">3.3</a>和<a href="/RFC6121#.E9.99.84.E5.BD.95A._.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>), 所以没有了对错误检查的需要.
</dd></dl>
<dl><dd>互操作性备注: 即使该用户的服务器不广播该用户随后的出席信息通知给离线的联系人们(如<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.4.2</a>所述), 它必须广播该用户的unavailable出席信息通知; 如果它不这么做, 由该联系人的服务器最后收到的出席信息将是该用户用于这个出席信息会话的初始化出席信息, 结果是该联系人将认为该用户在线.
</dd></dl>
<dl><dd>实现备注: 关于上述处理用于定向出席信息的补充规则参见<a href="/RFC6121#.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.6</a>.
</dd></dl>
<p>如果该unavailable通知优雅地被从该客户端接收到, 那么该服务器必须广播该出席信息节的完整XML.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">going on vacation</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'benvolio@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">going on vacation</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'mercutio@example.com'</span>
              <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">going on vacation</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>该用户的服务器也必须发送该unavailable通知给该用户的所有可用资源(以及最初生成该unavailable出席信息的那个资源).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'juliet@example.com/chamber'</span>
              <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">going on vacation</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>如果该服务器探测到那该用户已经不优雅地离线了, 那么该服务器必须代表该用户生成该unavailable出席信息广播.
</p>
<dl><dd>实现备注: 在该服务器广播或生成一个unavailable出席信息通知之后，该客户端发送的任何没有'type'属性且没有'to'属性的出席信息节，必须被该用户的服务器路由或递送到所有的订阅者(即, 必须等同于为一个新的出席信息会话出发了初始化出席信息).
</dd></dl>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">服务器处理入站离线出席信息</span></h4>
<p>在从用户接收到一个unavailable通知之后, 该联系人的服务器必须递送该用户的出席信息节给该联系人的所有可用资源.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">[ ... to resource1 ... ]
&#160;
CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">going on vacation</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
[ ... to resource2 ... ]
&#160;
CS: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
              <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
              <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">going on vacation</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<dl><dd>实现备注: 如果该联系人的服务器没有广播随后的出席信息通知给离线的用户们(如<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.4.2</a>), 它也必须注意到该用户是离线的并更新它的关于哪些实体在线的内部存储.
</dd></dl>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">客户端处理离线出席信息</span></h4>
<p>从联系人的客户端的视角来看, 在线出席信息广播和离线出席信息广播没有明显的差别, 所以通常联系人的客户端遵循定义的处理入站出席信息的规则<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.85.A5.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.4.3</a>.
</p><p>无论如何, 如果该联系人从该用户的纯JID(而不是某个可用资源的全JID)接收到一个unavailable通知, 该联系人的客户端应该视为该unavailable通知适用于所有资源.
</p>
<h3> <span class="mw-headline" id=".E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">定向出席信息</span></h3>
<p>本章是客户端和服务器处理出席信息通知和出席信息探测的规则的补充, 但是仅用于定向出席信息的特定场景. 
</p>
<h4> <span class="mw-headline" id=".E6.80.BB.E5.88.99">总则</span></h4>
<p>通常, 当一个客户端希望分享可用性信息给一个没有订阅它的出席信息的实体的时候，它会发送定向出席信息, 典型的是在一个临时基础上. 定向出席信息的常规使用包括<a href="/RFC6121#.E4.B8.80.E5.AF.B9.E4.B8.80.E8.81.8A.E5.A4.A9.E4.BC.9A.E8.AF.9D" title="RFC6121">5.1</a>所述的临时的一对一会话和<a href="/XEP-0045" title="XEP-0045">XEP-0045</a>所述的多用户聊天室.
</p><p>通过分享定向出席信息给另一个实体而建立的临时的关系比起通过出席信息订阅建立的永久关系来说是次要的. 所以, 建立, 修改, 或取消一个出席信息订阅的动作，必须优先于接下来的子章节定义的规则. 例如, 如果一个用户分享了定向出席信息给一个联系人，但是接着通过完成出席信息订阅"握手"来把该联系人加入到该用户的名册中, 那么该用户的服务器必须把该联系人视为如<a href="/RFC6121#.E7.AE.A1.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85" title="RFC6121">第三章</a>所述的任何一个普通的订阅者来处理, 例如, 发送随后的出席信息广播给该联系人. 另一个例子是, 如果该用户接着取消了该联系人对该用户的出席信息的订阅, 该用户的服务器必须如<a href="/RFC6121#.E6.92.A4.E9.94.80.E8.A2.AB.E8.AE.A2.E9.98.85" title="RFC6121">3.2</a>所述处理这个取消动作, 这包括发送unavailable出席信息给该联系人, 即使该用户曾经发送了定向出席信息给该联系人.
</p><p>XMPP服务器典型的实现定向出席信息的办法是通过保持一个用户在该用户的给定资源(全JID)的当前会话期间曾经对它们发送了定向出席信息的实体的列表(纯JIDs或全JIDs), 然后在该用户下线的时候清除这个列表(例如, 发送一个类型为"unavailable"的广播出席信息节). 该服务器必须从定向出席信息列表(或它的功能等价物)移除任何该用户曾经对它们发送过定向unavailable出席信息的实体并且应该移除任何发送了unavailable出席信息给该用户的实体.
</p>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E7.94.9F.E6.88.90.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">客户端生成定向出席信息</span></h4>
<p>大家知道, 定向出席信息是一个客户端生成的presence节，这个节的'to'属性值是另一个实体的纯JID或全JID，并且这个节要么没有'type'属性(表示可用性)要么'type'属性值为"unavailable".
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E7.AB.99.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">服务器处理出站定向出席信息</span></h4>
<p>当用户的服务器接收到一个定向出席信息节, 它应该根据以下规则处理它.
</p>
<dl><dd><ol><li> 如果该用户在已经发送初始化出席信息之后并且在发送unavailable出席信息广播之前(即, 在该用户的出席信息会话期间), 发送定向的可用或不可用出席信息给一个在该用户的名册中并且订阅状态为"from"或"both"的联系人, 该用户的服务器必须本地递送或远程路由那个出席信息节的完整XML给那个实体，但是应该不(SHOULD NOT)基于出席信息广播来修改该联系人的状态(即, 它应该在任何随后由该用户初始化的的出席信息广播中包含该联系人的JID).
</li><li> 如果该用户在已经发送初始化出席信息之后并且在发送unavailable出席信息广播之前(即, 在该用户的出席信息会话期间), 发送定向的可用或不可用出席信息给一个不在该用户的名册中并且订阅状态为"from"或"both"的联系人, 该用户的服务器必须本地递送或远程路由那个出席信息节的完整XML给那个实体，但是不能(MUST NOT)基于available出席信息广播来修改该联系人的状态(即, 它不能(MUST NOT)在任何随后由该用户初始化的available出席信息广播中包含该联系人的JID); 无论如何, 如果发送定向出席信息的用户的可用资源离线了, 该用户的服务器必须路由那个离线出席信息给该实体(如果该用户还未发送定向unavailable出席信息给那个实体).
</li><li> 如果该用户从未发送过初始化出席信息或在已经发送unavailable出席信息广播之后(即, 该资源已连接但不可用)发送定向出席信息, 该用户的服务器必须把该实体当作上面第二种情况下该用户发送定向出席信息的实体.
</li></ol>
</dd></dl>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">服务器处理入站定向出席信息</span></h4>
<p>从联系人的服务器的视角来看, 在出席信息广播和定向出席信息之间没有显著差别, 所以联系人的服务器遵循<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B" title="RFC6121">4.3.2</a>,<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.85.A5.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.4.3</a>和<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.5.3</a>定义的处理入站出席信息的规则.
</p>
<h4> <span class="mw-headline" id=".E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF">客户端处理入站定向出席信息</span></h4>
<p>从联系人的客户端的视角来看,在出席信息广播和定向出席信息之间没有显著差别, 所以联系人的客户端遵循定义的处理入站出席信息的规则<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.85.A5.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.4.3</a>(译者注：原文如此，疑为<a href="/RFC6121#.E5.AE.A2.E6.88.B7.E7.AB.AF.E5.A4.84.E7.90.86.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.4.4</a>之误).
</p>
<h4> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B">服务器处理出席信息探测</span></h4>
<p>如果一个用户的客户端发送了定向出席信息给另一个实体(例如, 一个一对一聊天伙伴或一个多用户聊天室), 在一段时间之后该实体或它的服务器可能想知道该用户是否仍然在线. 这个场景在多用户聊天室中特别常见, 该用户可能在很长一段时间内在该聊天室中是一个参加者. 如果该用户的客户端下线而没有(通过客户端或该客户端的服务器)通知该聊天室, 该用户的在该房间里的表现可能成为一个"幽灵"， 看起来是参加者但实际上已经不在该房间了. 为了查明这类"幽灵", 一些聊天室实现会发送出席信息探测给这些已经加入房间的用户.
</p><p>在定向出席信息的案例中, 探测的实体应该从接收到定向出席信息的那个JID(一个全JID或纯JID)发送探测. 该探测应该被发送到那个用户的全JID, 而不是那个用户的不带资源的纯JID, 因为伴随定向出席信息的临时"授权"是基于曾经发送定向出席信息给该探测实体的那个用户的全JID. 当该用户的服务器接收到一个探测, 它必须首先应用任何和出席信息订阅相关的逻辑，如<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B" title="RFC6121">4.3.2</a>所述. 如果该探测实体未订阅该用户的出席信息, 那么该服务器必须检查该用户是否曾经在当前会话中发送过定向出席信息给该实体; 如果是, 该服务器应该仅以纯粹的"available"或"unavailable"类型(即, 不包含子元素)应答这个探测并且只用于那个全JID(即, 不为任何可能与当前该用户的纯JID相关的其他资源).
</p>
<h3> <span class="mw-headline" id=".E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AF.AD.E6.B3.95">出席信息语法</span></h3>
<h4> <span class="mw-headline" id="Type.E5.B1.9E.E6.80.A7">Type属性</span></h4>
<p>缺少'type'属性代表相关实体是可以通讯的(见<a href="/RFC6121#.E5.88.9D.E5.A7.8B.E5.8C.96.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.2</a>和<a href="/RFC6121#.E9.9A.8F.E5.90.8E.E7.9A.84.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E5.B9.BF.E6.92.AD" title="RFC6121">4.4</a>).
</p><p>'type'属性值为"unavailable"代表相关实体不可通讯(见<a href="/RFC6121#.E7.A6.BB.E7.BA.BF.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.5</a>).
</p><p>XMPP出席信息节也用于协商和管理对其他实体的出席信息的订阅. 这些任务通过<a href="/RFC6121#.E7.AE.A1.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85" title="RFC6121">第三章</a>所述的类型为"subscribe", "unsubscribe", "subscribed", 和"unsubscribed"的出席信息节来完成.
</p><p>如果一个用户和联系人在不同的XMPP服务器上发生关系, 那些服务器为了确定对端服务器上的那个实体的可用性，也使用一个类型为"probe"的特殊的出席信息节; 详见<a href="/RFC6121#.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B" title="RFC6121">4.3</a>. 客户端不应(SHOULD NOT)发送类型为"probe"的出席信息节.
</p><p>'type'属性的值可以归纳如下:
</p>
<dl><dd><ul><li> error -- error发生在处理之前发送的出席信息节的时候; 如果出席信息节的类型为"error", 它必须包含一个&lt;error/&gt;子元素(参考 <a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>).
</li><li> probe -- 请求一个实体当前的出席信息; 应该只由一个服务器代表一个用户生成.
</li><li> subscribe -- 发送者希望订阅接收者的出席信息.
</li><li> subscribed -- 发送者已经允许接收者接收他们的出席信息.
</li><li> unavailable -- 发送者不再可通讯.
</li><li> unsubscribe -- 发送者取消订阅接收者的出席信息.
</li><li> unsubscribed -- 订阅请求已经被拒绝或撤销之前准许的被对方订阅.
</li></ul>
</dd></dl>
<p>如果'type'属性的值不是前述的任何一个, 接收方或一个中间的路由服务器应该返回一个节错误&lt;bad-request/&gt;.
</p>
<dl><dd> 实现备注: &lt;presence/&gt;元素的'type'属性没有缺省值.
</dd></dl>
<dl><dd> 实现备注: &lt;presence/&gt;元素的'type'属性没有"available"这个值.
</dd></dl>
<h4> <span class="mw-headline" id=".E5.AD.90.E5.85.83.E7.B4.A0">子元素</span></h4>
<p>根据缺省命名空间声明, 一个出席信息节是由'jabber:client'或'jabber:server'命名空间限定的, 它定义了明确的出席信息节的子元素, 特别是&lt;show/&gt;, &lt;status/&gt;, 和 &lt;priority/&gt; 元素. 这些子元素被用于提供关于一个实体的可用性的更详细的信息. 典型情况下这些子元素只在该出席信息节没有'type'属性的时候被包含, 尽管在接下来的文本里有一些例外.
</p>
<h5> <span class="mw-headline" id="Show.E5.85.83.E7.B4.A0">Show元素</span></h5>
<p>可选的&lt;show/&gt;元素定义了一个实体或它的一个特定资源的特定的可用性子状态. 一个出席信息节不能(MUST NOT)包含多于一个的&lt;show/&gt;元素. &lt;show/&gt;元素没有定义属性. &lt;show/&gt;元素不能(MUST NOT)包含混合内容(定义于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XML</a>3.2.2节). &lt;show/&gt;元素的XML字符数据不意味着它是用于展示给自然人用户看的. 该XML字符数据必须是以下之一(更多的可用性状态可以通过扩展内容元素来定义):
</p>
<dl><dd><ul><li> away -- 该实体或资源临时离开.
</li><li> chat -- 该实体或资源活跃并想聊天.
</li><li> dnd -- 该实体或资源忙(dnd = "Do Not Disturb"，免打扰).
</li><li> xa -- 该实体或资源要离开相当长时间(xa = "eXtended Away"，长时间离开).
</li></ul>
</dd></dl>
<p>如果&lt;show/&gt;元素未被提供, 该实体被假定在线并且可用.
</p><p>任何由接收者和代理路由服务器对可用性状态的特别处理取决于该实现(例如, 把可用性状态合并到节路由和递送逻辑中).
</p>
<h5> <span class="mw-headline" id="Status.E5.85.83.E7.B4.A0">Status元素</span></h5>
<p>可选的&lt;status/&gt;元素包含了自然人可读的定义实体可用性的自然语言描述的XML字符数据. 通常在出席信息节不包含'type'属性的时候被用于和show元素结合一起提供某个可用性状态的细节(例如, "In a meeting"，"开会中").
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
          <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">dnd</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
  <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">Wooing Juliet</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
<span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>&lt;status/&gt;元素没有定义属性, 除了从<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XML</a>继承的'xml:lang'属性. &lt;status/&gt;元素不能(MUST NOT)包含混合内容(定义于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XML</a>3.2.2节). &lt;status/&gt;元素可以包含多个实例, 但是只能在每个实例的都有一个'xml:lang'属性并且属性值为唯一的语言值(或者显式地，或者从一个元素的更高的XML级别的'xml:lang'值继承, 从发送者的视角来看，可能包括<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>描述的XML流头).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
          <span class="re0">id</span>=<span class="st0">'jx62vs97'</span>
          <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">dnd</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
  <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">Wooing Juliet</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
  <span class="re1">&lt;status</span> <span class="re0">xml:lang</span>=<span class="st0">'cs'</span><span class="re2">&gt;</span><span class="co3">Dvo</span><span class="co4">&amp;#x0159;</span><span class="co4">&amp;#x00ED;</span><span class="co3">m se Julii</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
<span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>一个类型为"unavailable"的出席信息节也可以包含一个&lt;status/&gt;元素来提供为什么该实体下线的详细原因.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
          <span class="re0">id</span>=<span class="st0">'oy6sb241'</span>
          <span class="re0">type</span>=<span class="st0">'unavailable'</span>
          <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">Busy IRL</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
<span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>&lt;status/&gt;子元素也可以在一个订阅相关的出席信息节中被发送(即, 类型为 "subscribe", "subscribed", "unsubscribe", 或 "unsubscribed") 以提供该动作的描述. 一个可交互的客户端可以展示这个&lt;status/&gt;信息给一个自然人用户(见<a href="/RFC6121#.E5.AE.89.E5.85.A8.E4.BA.8B.E9.A1.B9" title="RFC6121">第11章</a>).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
          <span class="re0">id</span>=<span class="st0">'uc51xs63'</span>
          <span class="re0">to</span>=<span class="st0">'nurse@example.com'</span>
          <span class="re0">type</span>=<span class="st0">'subscribe'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">Hi, Juliet told me to add you to my buddy list.</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
<span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<h5> <span class="mw-headline" id="Priority.E5.85.83.E7.B4.A0">Priority元素</span></h5>
<p>可选的&lt;priority/&gt;元素包含定义该资源优先级的非自然人可读的XML字符数据. 它的值必须是一个处于 -128 和 +127 之间的整数. 一个出席信息不能(MUST NOT)包含多个&lt;priority/&gt;元素. 没有为&lt;priority/&gt;定义属性. &lt;priority/&gt;元素不能(MUST NOT)包含混合内容(定义于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XML</a>3.2.2节).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;presence</span> <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">dnd</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
  <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">Wooing Juliet</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
  <span class="re1">&lt;status</span> <span class="re0">xml:lang</span>=<span class="st0">'cs'</span><span class="re2">&gt;</span><span class="co3">Dvo</span><span class="co4">&amp;#x0159;</span><span class="co4">&amp;#x00ED;</span><span class="co3">m se Julii</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
  <span class="re1">&lt;priority<span class="re2">&gt;</span></span><span class="co3">1</span><span class="re1">&lt;/priority<span class="re2">&gt;</span></span>
<span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>如果没有提供优先级, 处理的服务器或客户端必须视为优先级为零("0").
</p><p>该客户端的服务器可以覆写客户端提供的优先级的值(例如, 为了给正在递送给预期的帐号的纯JID的消息强加一个消息处理规则以用于该帐号的所有可用资源). 如果服务器这样做, 当它回应该客户端的出席信息给自己并发送出席信息通知给该用户的联系人们的时候，它必须以修改过的优先级来通讯(因为修改过的优先级的值典型的缺省是零, 以修改过的优先级的值来通讯可以不包含&lt;priority/&gt;子元素).
</p><p>关于即时消息和出席信息应用中节处理过程中优先级值的语法信息, 参见<a href="/RFC6121#.E5.A4.84.E7.90.86XML.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.A7.84.E5.88.99" title="RFC6121">第八章</a>.
</p>
<h4> <span class="mw-headline" id=".E6.89.A9.E5.B1.95.E5.86.85.E5.AE.B9">扩展内容</span></h4>
<p>如<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>所述, 一个XML节可以包含任何由不同于缺省命名空间限定的子元素; 这也适用于出席信息节.
</p><p>(以下例子中, 出席信息节包含定义于<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0115</a>的实体能力信息.)
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;c</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/caps'</span>
     <span class="re0">hash</span>=<span class="st0">'sha-1'</span>
     <span class="re0">node</span>=<span class="st0">'http://psi-im.org'</span>
     <span class="re0">ver</span>=<span class="st0">'q07IKJEyjvHSyhy//CH0CxmKi8w='</span><span class="re2">/&gt;</span>
<span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>包含在一个出席信息节中的任何扩展内容应该展示用于通讯的实体可用性的方方面面或提供和通讯相关的能力.
</p>
<h2> <span class="mw-headline" id=".E4.BA.A4.E6.8D.A2.E6.B6.88.E6.81.AF">交换消息</span></h2>
<p>一旦一个客户端如<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>所述，已经在一个服务器上通过了验证并绑定了一个资源到一个XML流，一个XMPP服务器将路由XML节到和从那个客户端. 一种可交换的节是 &lt;message/&gt; (如果, 也就是说, 消息功能在该服务器上是允许的). 交换消息是XMPP的一个基本用途，它发生在一个用户生成一个地址指向另一个实体的消息节的时候. 如<a href="/RFC6121#.E5.A4.84.E7.90.86XML.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.A7.84.E5.88.99" title="RFC6121">第八章</a>所定义的, 该发送者的服务器负责递送该消息到期望的接收者(如果该接收者在同一台本地服务器上)或路由该消息到该接收者的服务器(如果该接收者在一个远端服务器上). 所以一个消息节是被用来"推送"信息给另一个实体. 
</p>
<h3> <span class="mw-headline" id=".E4.B8.80.E5.AF.B9.E4.B8.80.E8.81.8A.E5.A4.A9.E4.BC.9A.E8.AF.9D">一对一聊天会话</span></h3>
<p>在实践中, 在自然人用户之间的即时消息活动倾向于以一个会话式的方式发生，我们称之为一个"聊天会话": 在一个比较短暂的时间内双方的多个比较快速的消息交换是有继承的.
</p><p>当一个自然人用户倾向于和一个联系人进行这样一种聊天会话(而不是发送一个单独的消息给某人却不期望获得应答), 由该用户的客户端生成的这个消息的类型应该是"chat"并且该联系人的客户端应该在随后的应答中保持那个消息类型. 该用户的客户端也应该在它的初始化消息中包含一个&lt;thread/&gt;元素, 这样该联系人的客户端也应该在那个会话的生命周期中保持它(参见<a href="/RFC6121#_Thread.E5.85.83.E7.B4.A0" title="RFC6121">5.2.5</a>).
</p><p>该用户的客户端应该在一个聊天会话中把初始消息的地址指向该联系人的纯JID &lt;contact@domainpart&gt; (而不是基于任何它可能之前从联系人那收到的出席信息通知的 &lt;show/&gt;, &lt;status/&gt;, 或 &lt;priority/&gt; 值来尝试猜测一个适当的全JID &lt;contact@domainpart/resourcepart&gt; ). 直到和除非该用户的客户端从该联系人收到一个应答, 它应该发送任何更多的消息给该联系人的纯JID. 该联系人的客户端应该把它的应答的地址指向该用户的全JID &lt;user@domainpart/resourcepart&gt;,即初始消息中提供的'from'地址. 一旦该用户的客户端从该联系人的全JID收到一个应答, 它应该把它随后的消息指向该联系人的全JID，即在该联系人的应答中提供的'from'地址, 从而"锁定"在那个全JID. 一个客户端应该在接收到一个来自对方节点控制的任何其他资源的&lt;message/&gt;或&lt;presence/&gt;节(或一个来自已锁定的资源的出席信息节)的时候"解除锁定"; 结果是, 它应该在聊天会话的下一个消息中指向对方节点的纯JID(从而"解锁"之前的"锁定")，直到它从对方的全JIDs收到一个消息.
</p><p>当双方参加一个一个聊天会话但是没有基于一个出席信息订阅来互相分享出席信息, 他们应该互相发送定向出席信息，这样双方能很容易地查询对方在该聊天会话期间是否下线. 然而, 一个客户端必须提供一个方法让一个用户能全局地禁止或只允许特定的实体进行这类出席信息分享. 更进一步的, 当出于某种原因相信该聊天会话结束了(例如, 如果, 在一段合理的时间之后, 双方没有交换随后的消息),一方应该发送定向unavailable出席信息给另一方 .
</p><p>聊天会话的例子参见<a href="/RFC6121#.E7.A4.BA.E4.BE.8B.E4.BC.9A.E8.AF.9D" title="RFC6121">第7章</a>.
</p>
<h3> <span class="mw-headline" id=".E6.B6.88.E6.81.AF.E8.AF.AD.E6.B3.95">消息语法</span></h3>
<p>以下章节描述&lt;message/&gt;节的语法. 
</p>
<h4> <span class="mw-headline" id="To.E5.B1.9E.E6.80.A7">To属性</span></h4>
<p>即时消息客户端通过在&lt;message/&gt;节中的'to'属性中提供预期的接收者的JID来为一个消息指定预期接收者.
</p><p>如果该消息在现有的聊天会话或已接收的消息的上下文之外被发送, 'to'地址的值的格式应该是&lt;localpart@domainpart&gt;而不是&lt;localpart@domainpart/resourcepart&gt; (见<a href="/RFC6121#.E4.B8.80.E5.AF.B9.E4.B8.80.E8.81.8A.E5.A4.A9.E4.BC.9A.E8.AF.9D" title="RFC6121">5.1</a>).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;message</span>
    <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
    <span class="re0">id</span>=<span class="st0">'ktx72v49'</span>
    <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
    <span class="re0">type</span>=<span class="st0">'chat'</span>
    <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">Art thou not Romeo, and a Montague?</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
<span class="re1">&lt;/message<span class="re2">&gt;</span></span></pre></div></div>
<p>如果该消息是作为对之前从格式&lt;localpart@domainpart/resourcepart&gt;收到的一个消息的应答来发送的(例如, 在一个如<a href="/RFC6121#.E4.B8.80.E5.AF.B9.E4.B8.80.E8.81.8A.E5.A4.A9.E4.BC.9A.E8.AF.9D" title="RFC6121">5.1</a>所述的一对一聊天会话的上下文中), 该'to'地址的值的格式应该是&lt;localpart@domainpart/resourcepart&gt;而不是&lt;localpart@domainpart&gt;， 除非发送者已经知道(例如, 通过出席信息)接收者的资源不再可用.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;message</span>
    <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
    <span class="re0">id</span>=<span class="st0">'sl3nx51f'</span>
    <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
    <span class="re0">type</span>=<span class="st0">'chat'</span>
    <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">Neither, fair saint, if either thee dislike.</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
<span class="re1">&lt;/message<span class="re2">&gt;</span></span></pre></div></div>
<h4> <span class="mw-headline" id="Type.E5.B1.9E.E6.80.A7_2">Type属性</span></h4>
<p>在即时消息应用中消息节的常用的包括: 单条消息; 在一对一聊天会话的上下文中发送的消息; 在一个多用户聊天室中发送的消息; 警告, 通知, 或其他给不期望应答的人的信息，错误. 这些用途通过'type'属性来区分. 建议包含'type'属性. 如果包含了它, 'type'属性必须是以下的值之一:
</p>
<dl><dd><ul><li> chat -- 该消息在一个一对一聊天会话的上下文中被发送. 典型的一个可交互的客户端将在一个界面上展示一个类型为"chat"的消息，这使得双方之间能够进行一对一聊天, 同时包括一个适当的会话历史. 关于一对一聊天会话的详细建议参见<a href="/RFC6121#.E4.B8.80.E5.AF.B9.E4.B8.80.E8.81.8A.E5.A4.A9.E4.BC.9A.E8.AF.9D" title="RFC6121">5.1</a>.
</li><li> error -- 该消息由一个从另一个实体接收到一个消息并在处理的时候发现了错误的实体生成(关于节错误语法的详情, 参考<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>). 接收到一个类型为"error"的消息的客户端应该展示一个适当的界面来通知原始的发送者关于这个错误的类型.
</li><li> groupchat -- 该消息在一个多用户聊天环境的上下文中被发送(类似<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">IRC</a>). 典型的一个接收的客户端将在一个界面展示一个类型为"groupchat"的消息，这使得多方可以进行多对多的聊天, 同时包含一个聊天室中的参与者的名册和适当的会话历史. 关于基于XMPP的群聊的详细信息, 参见<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0045</a>.
</li><li> headline -- 该消息提供一个警告, 一个通知, 或其他给那些不期望应答的人的临时信息(例如, 新闻头条, 运动更新, 准实时的市场数据, 或整合的内容). 因为不期望对该消息的回复, 典型的一个接收客户端将在一个界面展示一个类型为"headline"的消息以适当地把它们和独立消息, 聊天消息, 以及群聊消息区分开来(例如, 不向该接收者提供应答能力). 如果'to'地址是纯JID, 该接收服务器应该递送该消息给该接收者的所有非负出席信息优先级的可用资源并且必须递送该消息给那些资源中的至少一个资源; 如果该'to'地址是一个全JID并且有一个匹配的资源, 该服务器必须递送该消息给那个资源; 否则该服务器必须要么安静地忽略该消息要么返回一个错误(见<a href="/RFC6121#.E5.A4.84.E7.90.86XML.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.A7.84.E5.88.99" title="RFC6121">第8章</a>).
</li><li> normal -- 该消息是一个在一对一聊天会话或群聊上下文之外的被发送的独立消息, 并且它期望接收者应答. 典型的一个接收客户端将在一个界面展示一个类型为"normal"的消息，这使得接收方能够应答, 但没有会话历史. 'type'属性的缺省值是"normal".
</li></ul>
</dd></dl>
<p>一个IM应用应该支持所有前述的消息类型. 如果一个应用接收了一个没有'type'属性的消息或该应用不理解被提供的'type'属性的值, 它必须认为该消息的类型为"normal" (即, "normal" 是缺省的).
</p><p>不同消息类型的服务器处理指南参见<a href="/RFC6121#.E5.A4.84.E7.90.86XML.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.A7.84.E5.88.99" title="RFC6121">第8章</a>.
</p><p>尽管'type'属性是可选的, 出于礼貌在任何对一个消息的应答之中会镜像其类型; 更进一步, 一些专门的应用(例如, 一个多用户聊天服务)可以基于他们的自主判断来强制使用特定消息类型(例如, type='groupchat').
</p>
<h4> <span class="mw-headline" id="Body.E5.85.83.E7.B4.A0">Body元素</span></h4>
<p>&lt;body/&gt;元素包含自然人可读的XML字符数据以指定该消息的正文; 这个子元素通常会被包含但是可选的.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;message</span>
    <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
    <span class="re0">id</span>=<span class="st0">'b4vs9km4'</span>
    <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
    <span class="re0">type</span>=<span class="st0">'chat'</span>
    <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">Wherefore art thou, Romeo?</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
<span class="re1">&lt;/message<span class="re2">&gt;</span></span></pre></div></div>
<p>没有为&lt;body/&gt;元素定义属性, 除了'xml:lang'属性例外. 在一个消息节中可以包括多个&lt;body/&gt;元素实例用来为同一body提供替代版本, 但是每个实例只允许拥有一个'xml:lang'属性并且其值为一个唯一性的语言(要么显性的, 要么从更高层次的XML继承'xml:lang'值, 从发送者角度看是包含在<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>所述的XML流头中).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;message</span>
    <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
    <span class="re0">id</span>=<span class="st0">'z94nb37h'</span>
    <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
    <span class="re0">type</span>=<span class="st0">'chat'</span>
    <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">Wherefore art thou, Romeo?</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
  <span class="re1">&lt;body</span> <span class="re0">xml:lang</span>=<span class="st0">'cs'</span><span class="re2">&gt;</span><span class="co3">
     Pro</span><span class="co4">&amp;#x010D;</span><span class="co3">e</span><span class="co4">&amp;#x017D;</span><span class="co3"> jsi ty, Romeo?
   </span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
<span class="re1">&lt;/message<span class="re2">&gt;</span></span></pre></div></div>
<p>&lt;body/&gt;元素不能(MUST NOT)包含混合内容(定义于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XML</a>的3.2.2节).
</p>
<h4> <span class="mw-headline" id="Subject.E5.85.83.E7.B4.A0">Subject元素</span></h4>
<p>&lt;subject/&gt;元素包含自然人可读的XM字符数据以指定该消息的标题.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;message</span>
    <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
    <span class="re0">id</span>=<span class="st0">'c8xg3nf8'</span>
    <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
    <span class="re0">type</span>=<span class="st0">'chat'</span>
    <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;subject<span class="re2">&gt;</span></span><span class="co3">I implore you!</span><span class="re1">&lt;/subject<span class="re2">&gt;</span></span>
  <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">Wherefore art thou, Romeo?</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
<span class="re1">&lt;/message<span class="re2">&gt;</span></span></pre></div></div>
<p>没有为&lt;subject/&gt;元素定义属性, 从<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XML</a>继承的'xml:lang'属性例外. 可以包含多个&lt;subject/&gt;元素实例以提供同意标题的替代版本, 但是每个实例只允许拥有一个'xml:lang'属性并且其值为一个唯一性的语言(要么显性的, 要么从更高层次的XML继承'xml:lang'值, 从发送者角度看是包含在<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>所述的XML流头中).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;message</span>
    <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
    <span class="re0">id</span>=<span class="st0">'jk3v47gw'</span>
    <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
    <span class="re0">type</span>=<span class="st0">'chat'</span>
    <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;subject<span class="re2">&gt;</span></span><span class="co3">I implore you!</span><span class="re1">&lt;/subject<span class="re2">&gt;</span></span>
  <span class="re1">&lt;subject</span> <span class="re0">xml:lang</span>=<span class="st0">'cs'</span><span class="re2">&gt;</span>
    <span class="co4">&amp;#x00DA;</span><span class="co3">p</span><span class="co4">&amp;#x011B;</span><span class="co3">nliv</span><span class="co4">&amp;#x011B;</span><span class="co3"> pros</span><span class="co4">&amp;#x00ED;</span><span class="co3">m!
  </span><span class="re1">&lt;/subject<span class="re2">&gt;</span></span>
  <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">Wherefore art thou, Romeo?</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
  <span class="re1">&lt;body</span> <span class="re0">xml:lang</span>=<span class="st0">'cs'</span><span class="re2">&gt;</span><span class="co3">
     Pro</span><span class="co4">&amp;#x010D;</span><span class="co3">e</span><span class="co4">&amp;#x017E;</span><span class="co3"> jsi ty, Romeo?
   </span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
<span class="re1">&lt;/message<span class="re2">&gt;</span></span></pre></div></div>
<p>&lt;subject/&gt;元素不能(MUST NOT)包含混合内容(定义于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XML</a>的3.2.2节).
</p>
<h4> <span class="mw-headline" id="Thread.E5.85.83.E7.B4.A0">Thread元素</span></h4>
<p>XMPP &lt;thread/&gt;元素主要用于唯一性地标识一个由类型为'chat'的&lt;message/&gt;节实例化的两个实体之间的交谈线索或"聊天会话". 然而, XMPP &lt;thread/&gt;元素也可以被用于唯一性地标识一个由类型为'headline'或'normal'的&lt;message/&gt;节实例化的两个实体之间, 或由类型为'groupchat'的&lt;message/&gt;节实例化的在一个多用户聊天室上下文中的多个实体之间的类似线索. 它也可用于和自然人无关的会话的&lt;message/&gt;节, 类似一个游戏会话或一个插件之间的互动. &lt;thread/&gt;元素不被用于标识个别的消息, 只用于交谈或消息会话.
</p><p>&lt;thread/&gt;元素是可选的. 因为&lt;thread/&gt;元素标识了一个消息所属的特定交谈线索, 一个消息节不能(MUST NOT)多个&lt;thread/&gt;元素.
</p><p>&lt;thread/&gt;元素可以拥有一个'parent'属性以标识另一个线索，当前线索是那个线索的分支或子线索. 该'parent'属性必须遵循&lt;thread/&gt;元素本身的语法并且它的值必须和包含了该'parent'属性的那个&lt;thread/&gt;元素的XML字符数据不同.
</p>
<dl><dd>实现备注: 同时指定一个父线索和一个子线索的能力可能会因为重叠的线索而导致线索标识的冲突. 例如, 一个&lt;thread/&gt;元素可能包含XML字符数据"foo"以及一个值为"bar"的'parent'属性, 第二个&lt;thread/&gt;元素可能包含XML字符数据"bar"和一个值为"baz"的'parent'属性, 而第三个&lt;thread/&gt;元素可能包含XML字符数据"baz"和一个值再次为"foo"的'parent'属性. 如果处理这类重叠的线索标识之间的冲突取决于实现(例如, 要么它将线索标识符"链在一起"，在一个多级用户界面中把"foo"同时显示成"baz"的一个父线索和一个孙线索, 要么它将在一次只显示依赖的一层).
</dd></dl>
<p>&lt;thread/&gt;元素的值不是自然人可读的且必须被实体当成不透明的来处理; 从它那里不能获得语义, 并且对它只能做精确比较. &lt;thread/&gt;元素的值必须唯一地标识该交谈线索，在交谈伙伴之间或更更广泛(一个确保唯一性的办法是生成一个<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">UUID</a>所述的全局唯一标识符(UUID)).
</p>
<dl><dd>安全警告: 一个生成ThreadID的应用必须确保它不会泄露关于这个实体的身份信息(例如, 该XMPP应用正在运行的设备的MAC地址).
</dd></dl>
<p>&lt;thread/&gt;元素不能(MUST NOT)包含混合内容(定义于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XML</a>的3.2.2节).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;message</span>
    <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
    <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
    <span class="re0">type</span>=<span class="st0">'chat'</span>
    <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;subject<span class="re2">&gt;</span></span><span class="co3">I implore you!</span><span class="re1">&lt;/subject<span class="re2">&gt;</span></span>
  <span class="re1">&lt;subject</span> <span class="re0">xml:lang</span>=<span class="st0">'cs'</span><span class="re2">&gt;</span>
    <span class="co4">&amp;#x00DA;</span><span class="co3">p</span><span class="co4">&amp;#x011B;</span><span class="co3">nliv</span><span class="co4">&amp;#x011B;</span><span class="co3"> pros</span><span class="co4">&amp;#x00ED;</span><span class="co3">m!
  </span><span class="re1">&lt;/subject<span class="re2">&gt;</span></span>
  <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">Wherefore art thou, Romeo?</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
  <span class="re1">&lt;body</span> <span class="re0">xml:lang</span>=<span class="st0">'cs'</span><span class="re2">&gt;</span><span class="co3">
     Pro</span><span class="co4">&amp;#x010D;</span><span class="co3">e</span><span class="co4">&amp;#x017E;</span><span class="co3"> jsi ty, Romeo?
  </span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
  <span class="re1">&lt;thread</span> <span class="re0">parent</span>=<span class="st0">'e0ffe42b28561960c6b12b944a092794b9683a38'</span><span class="re2">&gt;</span><span class="co3">
    0e3141cd80894871a68e6fe6b1ec56fa
  </span><span class="re1">&lt;/thread<span class="re2">&gt;</span></span>
<span class="re1">&lt;/message<span class="re2">&gt;</span></span></pre></div></div>
<p>关于使用&lt;thread/&gt;元素的详细建议, 参考<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0201</a>.
</p>
<h3> <span class="mw-headline" id=".E6.89.A9.E5.B1.95.E5.86.85.E5.AE.B9_2">扩展内容</span></h3>
<p>如<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>所述, 一个XML节可以包含任何不同于缺省命名空间的命名空间所限定的子元素; 这也适用于message节. 处理扩展内容的指南参见<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>的8.4节中提供的路由服务器和最终接收者部分.
</p><p>(在下面的例子中, 该message节包含一个<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0071</a>定义的该消息的XHTML格式版本).
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;message</span>
    <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
    <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
    <span class="re0">type</span>=<span class="st0">'chat'</span>
    <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">Wherefore art thou, Romeo?</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
  <span class="re1">&lt;html</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/xhtml-im'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;body</span> <span class="re0">xmlns</span>=<span class="st0">'http://www.w3.org/1999/xhtml'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;p<span class="re2">&gt;</span></span><span class="co3">Wherefore </span><span class="re1">&lt;span</span> <span class="re0">style</span>=<span class="st0">'font-style: italic'</span><span class="re2">&gt;</span><span class="co3">art</span><span class="re1">&lt;/span<span class="re2">&gt;</span></span><span class="co3">
      thou, </span><span class="re1">&lt;span</span> <span class="re0">style</span>=<span class="st0">'color:red'</span><span class="re2">&gt;</span><span class="co3">Romeo</span><span class="re1">&lt;/span<span class="re2">&gt;</span></span><span class="co3">?</span><span class="re1">&lt;/p<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/body<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/html<span class="re2">&gt;</span></span>
<span class="re1">&lt;/message<span class="re2">&gt;</span></span></pre></div></div>
<h2> <span class="mw-headline" id=".E4.BA.A4.E6.8D.A2IQ.E8.8A.82">交换IQ节</span></h2>
<p>如<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>所述, IQ节提供一个结构化的 请求-应答 机制. 那一机制的基本语法(例如, 'id'属性是强制性的)定义于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>, 特定语法需要完成限定类型为"get"或"set"的IQ节的直接子元素的扩展命名空间的所有实例中定义的用例. 'jabber:client'和'jabber:server'命名空间不定义除了&lt;error/&gt;元素之外的所有节类型的任何IQ节的子元素. 本文定义一个这样的扩展命名空间, 用于<a href="/RFC6121#.E7.AE.A1.E7.90.86.E5.90.8D.E5.86.8C" title="RFC6121">管理名册</a>. 无论如何, IQ节可以包含由一个扩展命名空间限定的结构化的信息.
</p>
<h2> <span class="mw-headline" id=".E7.A4.BA.E4.BE.8B.E4.BC.9A.E8.AF.9D">示例会话</span></h2>
<p>本节的例子展示一个可能的即时消息和出席信息会话. 用户是&lt;romeo@example.net&gt;, 他有一个可用资源，其资源部分是"orchard", 并且在他的名册中有以下人员:
</p>
<dl><dd><ul><li> &lt;juliet@example.com&gt; (订阅状态="both" 并且她有两个可用资源, "chamber" 和 "balcony")
</li><li> &lt;benvolio@example.net&gt; (订阅状态="to")
</li><li> &lt;mercutio@example.org&gt; (订阅状态="from")
</li></ul>
</dd></dl>
<p>首先, 该用户完成如<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>所述的前提条件(流建立, TLS和SASL协商, 以及资源绑定); 那些协议流程在这里不复述了.
</p><p>接下来, 该用户请求他的名册.
</p><p>示例1: 用户向服务器请求当前名册
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;iq</span> <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">id</span>=<span class="st0">'hf61v3n7'</span>
        <span class="re0">type</span>=<span class="st0">'get'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">/&gt;</span>
    <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>示例2: 用户从服务器接收到名册
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;iq</span> <span class="re0">id</span>=<span class="st0">'hf61v3n7'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">type</span>=<span class="st0">'result'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'juliet@example.com'</span>
              <span class="re0">name</span>=<span class="st0">'Juliet'</span>
              <span class="re0">subscription</span>=<span class="st0">'both'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;group<span class="re2">&gt;</span></span><span class="co3">Friends</span><span class="re1">&lt;/group<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/item<span class="re2">&gt;</span></span>
        <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'benvolio@example.org'</span>
              <span class="re0">name</span>=<span class="st0">'Benvolio'</span>
              <span class="re0">subscription</span>=<span class="st0">'to'</span><span class="re2">/&gt;</span>
        <span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'mercutio@example.org'</span>
              <span class="re0">name</span>=<span class="st0">'Mercutio'</span>
              <span class="re0">subscription</span>=<span class="st0">'from'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>现在该用户开始一个出席信息会话.
</p><p>示例3: 用户发送初始出席信息
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;presence</span><span class="re2">/&gt;</span></pre></div></div>
<p>示例4: 用户的服务器代表该用户发送出席信息探测给订阅状态="to"和订阅状态="both"的联系人们
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
        <span class="re0">type</span>=<span class="st0">'probe'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net'</span>
        <span class="re0">to</span>=<span class="st0">'benvolio@example.org'</span>
        <span class="re0">type</span>=<span class="st0">'probe'</span><span class="re2">/&gt;</span></pre></div></div>
<p>示例5: 用户的服务器代表该用户的可用资源发送初始出席信息给订阅状态="from"和订阅状态="both"的联系人们, 以及用户自己
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'mercutio@example.org'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">/&gt;</span></pre></div></div>
<p>示例6: 联系人的服务器代表所有可用资源应答该出席信息探测
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">be right back</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
      <span class="re1">&lt;priority<span class="re2">&gt;</span></span><span class="co3">0</span><span class="re1">&lt;/priority<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
CS: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;priority<span class="re2">&gt;</span></span><span class="co3">1</span><span class="re1">&lt;/priority<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
CS: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'benvolio@example.org/pda'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">dnd</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">gallivanting</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>示例7: 联系人的服务器们递送用户的初始出席信息给所有可用资源
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
CS: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span><span class="re2">/&gt;</span><span class="co3">
&#160;
CS: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'mercutio@example.org'</span><span class="re2">/&gt;</span></pre></div></div>
<p>示例8: 用户发送定向出席信息给另一个不在他的名册中的用户
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'nurse@example.com'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">dnd</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">courting Juliet</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
      <span class="re1">&lt;priority<span class="re2">&gt;</span></span><span class="co3">0</span><span class="re1">&lt;/priority<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>现在该用户和他的联系人之一进入一个聊天会话.
</p><p>示例9: 一个带线索的交谈
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CC: </span><span class="re1">&lt;message</span>
        <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
        <span class="re0">type</span>=<span class="st0">'chat'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">My ears have not yet drunk a hundred words</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
      <span class="re1">&lt;thread<span class="re2">&gt;</span></span><span class="co3">e0ffe42b28561960c6b12b944a092794b9683a38</span><span class="re1">&lt;/thread<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/message<span class="re2">&gt;</span></span><span class="co3">
&#160;
CC: </span><span class="re1">&lt;message</span>
        <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
        <span class="re0">type</span>=<span class="st0">'chat'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">Of that tongue's utterance, yet I know the sound:</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
      <span class="re1">&lt;thread<span class="re2">&gt;</span></span><span class="co3">e0ffe42b28561960c6b12b944a092794b9683a38</span><span class="re1">&lt;/thread<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/message<span class="re2">&gt;</span></span><span class="co3">
&#160;
CC: </span><span class="re1">&lt;message</span>
        <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
        <span class="re0">type</span>=<span class="st0">'chat'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">Art thou not Romeo, and a Montague?</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
      <span class="re1">&lt;thread<span class="re2">&gt;</span></span><span class="co3">e0ffe42b28561960c6b12b944a092794b9683a38</span><span class="re1">&lt;/thread<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/message<span class="re2">&gt;</span></span><span class="co3">
&#160;
UC: </span><span class="re1">&lt;message</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com/balcony'</span>
        <span class="re0">type</span>=<span class="st0">'chat'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">Neither, fair saint, if either thee dislike.</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
      <span class="re1">&lt;thread<span class="re2">&gt;</span></span><span class="co3">e0ffe42b28561960c6b12b944a092794b9683a38</span><span class="re1">&lt;/thread<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/message<span class="re2">&gt;</span></span><span class="co3">
&#160;
CC: </span><span class="re1">&lt;message</span>
        <span class="re0">from</span>=<span class="st0">'juliet@example.com/balcony'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">type</span>=<span class="st0">'chat'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;body<span class="re2">&gt;</span></span><span class="co3">How cam'st thou hither, tell me, and wherefore?</span><span class="re1">&lt;/body<span class="re2">&gt;</span></span>
      <span class="re1">&lt;thread<span class="re2">&gt;</span></span><span class="co3">e0ffe42b28561960c6b12b944a092794b9683a38</span><span class="re1">&lt;/thread<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/message<span class="re2">&gt;</span></span></pre></div></div>
<p>以此类推.
</p><p>该用户也能发送随后的出席信息广播.
</p><p>示例10: 用户发送更新的可用信息用于广播
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;presence</span> <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">I shall return!</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
      <span class="re1">&lt;priority<span class="re2">&gt;</span></span><span class="co3">1</span><span class="re1">&lt;/priority<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>示例11: 用户的服务器广播更新的出席信息给订阅类型为"both"或"from"的联系人(但是不包括该用户向其发送过定向出席信息的实体)
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">I shall return!</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
      <span class="re1">&lt;priority<span class="re2">&gt;</span></span><span class="co3">1</span><span class="re1">&lt;/priority<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'mercutio@example.org'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">I shall return!</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
      <span class="re1">&lt;priority<span class="re2">&gt;</span></span><span class="co3">1</span><span class="re1">&lt;/priority<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>示例12: 联系人们的服务器递送更新的出席信息
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">I shall return!</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
      <span class="re1">&lt;priority<span class="re2">&gt;</span></span><span class="co3">1</span><span class="re1">&lt;/priority<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
CS: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">I shall return!</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
      <span class="re1">&lt;priority<span class="re2">&gt;</span></span><span class="co3">1</span><span class="re1">&lt;/priority<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
CS: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'mercutio@example.org'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;show<span class="re2">&gt;</span></span><span class="co3">away</span><span class="re1">&lt;/show<span class="re2">&gt;</span></span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">I shall return!</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
      <span class="re1">&lt;priority<span class="re2">&gt;</span></span><span class="co3">1</span><span class="re1">&lt;/priority<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>示例13: 联系人们的可用资源之一广播不可用（离线）通知
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CC: </span><span class="re1">&lt;presence</span> <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span> <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">/&gt;</span></pre></div></div>
<p>示例14: 联系人的服务器发送不可用（离线）通知给用户
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">CS: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'juliet@example.com/chamber'</span>
        <span class="re0">to</span>=<span class="st0">'romeo@example.net'</span>
        <span class="re0">type</span>=<span class="st0">'unavailable'</span><span class="re2">/&gt;</span></pre></div></div>
<p>现在该用户结束他的出席信息会话.
</p><p>示例15: 用户发送不可用（离线）通知
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;presence</span> <span class="re0">type</span>=<span class="st0">'unavailable'</span> <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">gone home</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>示例16: 用户的服务器广播离线通知给联系人们以及该用户曾经发送过定向出席信息的那个实体
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'juliet@example.com'</span>
        <span class="re0">type</span>=<span class="st0">'unavailable'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">gone home</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'mercutio@example.org'</span>
        <span class="re0">type</span>=<span class="st0">'unavailable'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">gone home</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span><span class="co3">
&#160;
US: </span><span class="re1">&lt;presence</span>
        <span class="re0">from</span>=<span class="st0">'romeo@example.net/orchard'</span>
        <span class="re0">to</span>=<span class="st0">'nurse@example.com'</span>
        <span class="re0">type</span>=<span class="st0">'unavailable'</span>
        <span class="re0">xml:lang</span>=<span class="st0">'en'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;status<span class="re2">&gt;</span></span><span class="co3">gone home</span><span class="re1">&lt;/status<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/presence<span class="re2">&gt;</span></span></pre></div></div>
<p>最后该用户关闭他的流并且他的服务器以同样方式应答.
</p><p>示例17: 用户关闭流
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">UC: </span><span class="re1">&lt;/stream:stream<span class="re2">&gt;</span></span></pre></div></div>
<p>示例18: 用户的服务器关闭流
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">US: </span><span class="re1">&lt;/stream:stream<span class="re2">&gt;</span></span></pre></div></div>
<p>结束
</p>
<h2> <span class="mw-headline" id=".E5.A4.84.E7.90.86XML.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.A7.84.E5.88.99">处理XML节的服务器规则</span></h2>
<p>处理XML节的基本服务器规则定义于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>, 读者可以参考那个协议的基础规则和安全含义. 本章定义用于XMPP即时消息和出席信息服务器的附加规则.
</p><p>本章定义的一些递送规则指定了"离线存储"的使用, 即, 该服务器代表该用户存储一个消息节的行为以及当该用户下次上线的时候递送它. 关于离线消息存储的建议, 参考<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0160</a>. 
</p>
<h3> <span class="mw-headline" id=".E5.B8.B8.E8.A7.84.E4.BA.8B.E9.A1.B9">常规事项</span></h3>
<p><a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>讨论了节递送的常规事项, 特别是在 (i) 提供一个关于节递送的服务的可接受级别 和 (ii) 防止目录捕获攻击和出席信息泄露 之间的平衡. 无论如何, 目录捕获攻击的概念不适用于一个已知并被一个用户信任的联系人(因为如<a href="/RFC6121#.E7.AE.A1.E7.90.86.E5.90.8D.E5.86.8C" title="RFC6121">第2章</a>所述该联系人在该用户的名册中). 类似的, 出席信息泄露的概念不适用于一个已被授权知道一个用户的出席信息的联系人(通过<a href="/RFC6121#.E7.AE.A1.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85" title="RFC6121">第3章</a>所述的所谓出席信息订阅)或该用户曾经自发的发送出席信息给它的那个实体(如<a href="/RFC6121#.E5.AE.9A.E5.90.91.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">4.6</a>所述的的所谓定向出席信息). 所以, 下面章节的场景中用来防止目录捕获和出席信息泄露的替代方式有 (a) 安静地忽略一个节 或 (b) 返回一个错误, 如果发起的实体在该用户的名册(当该错误将泄露该用户的帐号是否存在)，或被授权从该用户接收出席信息，或已经从该用户接收到定向出席信息(当该错误将泄露一个用户的资源的出席信息)，服务器应该返回一个错误.
</p>
<dl><dd>安全事项: 接下来描述的所有节处理规则的定义，要理解它们将的应用，将遵循相关的隐私和安全行策略的强制检查, 类似那些<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0016</a>或<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0191</a>的部署. 接下来的章节中的一致性语言(MUST, SHOULD, 等等)不意味着覆盖任何本地服务策略.
</dd></dl>
<h3> <span class="mw-headline" id=".E6.97.A0.27to.27.E5.9C.B0.E5.9D.80">无'to'地址</span></h3>
<p>如果该节无'to'属性, 适用规则定义于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>.
</p>
<h3> <span class="mw-headline" id=".E8.BF.9C.E7.AB.AF.E5.9F.9F">远端域</span></h3>
<p>如果包含在一个出站节的'to'属性中的地址的域部分和该服务器本身配置的域不匹配, 则适用的规则见于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>的10.4节.
</p>
<dl><dd>互操作性备注: <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a> 定义了如何使用 _im._xmpp 和 _pres._xmpp SRV记录 <a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">IMP‑SRV</a> 作为一个应急方法来查询是否一个远端的即时消息和出席信息服务能通过以XMPP通讯. 因为那些SRV记录未被广泛部署, 本文不再定义它们的使用, 并且不鼓励新的实现.
</dd></dl>
<h3> <span class="mw-headline" id=".E6.9C.AC.E5.9C.B0.E5.9F.9F">本地域</span></h3>
<p>如果在'to'属性中包含的JID的域部分和该服务器配置的域之一匹配, 该域由该服务器本身(而不是由一个特别的本地服务)提供服务, 并且该JID的格式为&lt;domainpart&gt;或&lt;domainpart/resourcepart&gt;, 适用规则定义于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>.
</p>
<h3> <span class="mw-headline" id=".E6.9C.AC.E5.9C.B0.E7.94.A8.E6.88.B7">本地用户</span></h3>
<p>如果'to'地址指定了一个纯JID &lt;localpart@domainpart&gt; 或全JID &lt;localpart@domainpart/resourcepart&gt;， 该JID的域部分和由该服务器本身提供服务的已配置的域匹配, 该服务器必需做如下处理. 
</p>
<h4> <span class="mw-headline" id=".E6.97.A0.E8.AF.A5.E7.94.A8.E6.88.B7">无该用户</span></h4>
<p>如果由'to'属性而来的该用户帐号标识符不存在, 该节如何处理取决于节类型.
</p>
<dl><dd><ul><li> 对于一个IQ节, 该服务器必须返回一个&lt;service-unavailable/&gt;节错误给该发送者.
</li><li> 对于一个message节, 该服务器必需要么(a) 安静地忽略该消息 要么 (b) 返回一个&lt;service-unavailable/&gt;节错误给该发送者.
</li><li> 对于一个不带'type'属性或'type'属性为"unavailable"的的presence节, 该服务器必须安静地忽略该节.
</li><li> 对于一个类型为"subscribe", "subscribed", "unsubscribe", 或"unsubscribed"的presence节, 该服务器必须安静地忽略该节.
</li><li> 对于一个类型为"probe"的presence节, 该服务器必需要么(a) 安静地忽略该节 要么 (b) 返回一个类型为"unsubscribed"的presence节.
</li></ul>
</dd></dl>
<h4> <span class="mw-headline" id=".E6.9C.AC.E5.9C.B0.E9.83.A8.E5.88.86.40.E5.9F.9F.E9.83.A8.E5.88.86">本地部分@域部分</span></h4>
<p>如果'to'属性中包含的JID的格式为&lt;localpart@domainpart&gt;, 那么该服务器必需遵循以下规则. 
</p>
<h5> <span class="mw-headline" id=".E5.8F.AF.E7.94.A8.E6.88.96.E5.B7.B2.E8.BF.9E.E6.8E.A5.E7.9A.84.E8.B5.84.E6.BA.90">可用或已连接的资源</span></h5>
<p>如果至少有一个可用资源或已连接资源, 如何处理该节取决于该节的类型. 
</p>
<h6> <span class="mw-headline" id="Message">Message</span></h6>
<p>对于一个类型为"normal"的消息节:
</p>
<dl><dd><ul><li> 如果所有可用资源有一个负的出席信息优先级，那么该服务器应该要么 (a) 存储该消息为离线用于晚些时候递送 要么 (b) 返回一个节错误给该发送者, 该错误应该是&lt;service-unavailable/&gt;.
</li><li> 如果有一个可用资源而它是非负的出席信息优先级，那么该服务器必须递送该消息给那个资源.
</li><li> 如果有多个可用资源都有非负的出席信息优先级，那么该服务器必须要么 (a) 递送该消息给"最可用的"资源或资源们(根据服务器的实现特有的机制, 例如, 认为拥有最高出席信息优先级的资源或资源们是"最可用的") 要么 (b) 递送该消息给所有非负的资源.
</li></ul>
</dd></dl>
<p>对于一个类型为"chat"的消息节:
</p>
<dl><dd><ul><li> 如果这个唯一的可用资源有一个负的出席信息优先级，那么该服务器应该要么 (a) 存储该消息为离线用于晚些时候递送 要么 (b) 返回一个节错误给该发送者, 该错误应该是&lt;service-unavailable/&gt;.
</li><li> 如果这个唯一的可用资源有一个非负的出席信息优先级，那么该服务器必须递送该消息给那个资源.
</li><li> 如果有多个可用资源都有非负的出席信息优先级，那么该服务器必须要么 (a) 递送该消息给"最可用的"资源或资源们(根据服务器的实现特有的机制, 例如, 认为拥有最高出席信息优先级的资源或资源们是"最可用的") 要么 (b) 递送该消息给所有曾经被选择接收了聊天消息的非负的资源.
</li></ul>
</dd></dl>
<p>对于类型为"groupchat"的消息节, 该服务器不能(MUST NOT)递送该节给任何可用资源，而必须返回一个节错误给该发送者, 该错误应该是&lt;service-unavailable/&gt;.
</p><p>对于一个类型为"headline"的消息节:
</p>
<dl><dd><ul><li> 如果这个唯一的可用资源有一个负的出席信息优先级，那么该服务器必须安静地忽略该节
</li><li> 如果这个唯一的可用资源有一个非负的出席信息优先级，那么该服务器必须递送该消息给那个资源.
</li><li> 如果有多个可用资源都有非负的出席信息优先级，那么该服务器必须递送该消息给所有非负的资源.
</li></ul>
</dd></dl>
<p>对于类型为"error"的消息节, 该服务器必须安静地忽略该消息.
</p><p>无论如何, 对于任何消息类型，该服务器不能(MUST NOT)递送该节给任何负优先级的可用资源; 如果只有一个可用资源且优先级为负, 该服务器应该如<a href="/RFC6121#.E6.97.A0.E5.8F.AF.E7.94.A8.E6.88.96.E5.B7.B2.E8.BF.9E.E6.8E.A5.E7.9A.84.E8.B5.84.E6.BA.90" title="RFC6121">8.5.2.2</a>所述，视同没有可用资源或已连接资源那样处理该消息.
</p><p>在所有情况下, 该服务器不能(MUST NOT)重写'to'属性(即, 它必须让它就是&lt;localpart@domainpart&gt;而不是把它改成&lt;localpart@domainpart/resourcepart&gt;).
</p>
<h6> <span class="mw-headline" id="Presence">Presence</span></h6>
<p>对于一个没有类型或类型为"unavailable"的出席信息节, 该服务器必须递送它到所有可用资源.
</p><p>对于一个类型为"subscribe", "subscribed", "unsubscribe", 或"unsubscribed"的出席信息节, 该服务器必须遵循<a href="/RFC6121#.E7.AE.A1.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85" title="RFC6121">第3章</a>定义的规则和<a href="/RFC6121#.E9.99.84.E5.BD.95A._.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>的总结.
</p><p>对于一个类型为"probe"的出席信息节, 该服务器必须如<a href="/RFC6121#.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B" title="RFC6121">4.3</a>所述直接处理它.
</p><p>在所有情况下, 该服务器不能(MUST NOT)重写'to'属性(即, 它必须让它就是&lt;localpart@domainpart&gt;而不是把它改成&lt;localpart@domainpart/resourcepart&gt;).
</p>
<h6> <span class="mw-headline" id="IQ">IQ</span></h6>
<p>对于一个IQ节, 该服务器本身必须代表该用户应答一个IQ result 或一个IQ error, 并且不能(MUST NOT)递送该IQ节给该用户的任何可用资源. 特别是, 如果限定的命名空间的语义定义了一个该服务器能代表该用户提供应答, 那么该服务器必须代表该用户应答该节，要么返回一个类型为"result"的IQ节要么是一个类型为"error"的适合原始载荷的IQ节; 否则, 该服务器必须应答一个&lt;service-unavailable/&gt;节错误. 
</p>
<h5> <span class="mw-headline" id=".E6.97.A0.E5.8F.AF.E7.94.A8.E6.88.96.E5.B7.B2.E8.BF.9E.E6.8E.A5.E7.9A.84.E8.B5.84.E6.BA.90">无可用或已连接的资源</span></h5>
<p>如果没有可用资源或已连接资源, 如何处理该节取决于该节的类型. 
</p>
<h6> <span class="mw-headline" id="Message_2">Message</span></h6>
<p>对于一个类型为"normal"或"chat"的消息节, 该服务器应该要么 (a) 添加该消息到离线存储 要么 (b)返回一个节错误给该发送者, 该错误应该为&lt;service-unavailable/&gt;.
</p><p>对于一个类型为"groupchat"的消息节, 该服务器必须返回一个节错误给该发送者, 该错误应该为&lt;service-unavailable/&gt;.
</p><p>对于一个类型为"headline" 或 "error"的消息节, 该服务器必须安静地忽略该消息.
</p>
<h6> <span class="mw-headline" id="Presence_2">Presence</span></h6>
<p>对于一个没有类型或类型为"unavailable"的出席信息节, 该服务器应该安静地忽略该节，不把它存下来用于晚些时候递送，也不代表该用户应答它.
</p><p>对于一个类型为"subscribe", "subscribed", "unsubscribe", 或"unsubscribed"的出席信息节, 该服务器必须遵循<a href="/RFC6121#.E7.AE.A1.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85" title="RFC6121">第3章</a>定义的规则和<a href="/RFC6121#.E9.99.84.E5.BD.95A._.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81" title="RFC6121">附录A</a>的总结.
</p><p>对于一个类型为"probe"的出席信息节, 该服务器必须如<a href="/RFC6121#.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B" title="RFC6121">4.3</a>所述直接处理它.
</p>
<h6> <span class="mw-headline" id="IQ_2">IQ</span></h6>
<p>对于一个IQ节, 该服务器本身必须代表该用户应答一个IQ result 或一个IQ error, 并且不能(MUST NOT)递送该IQ节给该用户的任何可用资源. 特别是, 如果限定的命名空间的语义定义了一个该服务器能代表该用户提供应答, 那么该服务器必须代表该用户应答该节，要么返回一个类型为"result"的IQ节要么是一个类型为"error"的适合原始载荷的IQ节; 否则, 该服务器必须应答一个&lt;service-unavailable/&gt;节错误.
</p>
<h4> <span class="mw-headline" id=".E6.9C.AC.E5.9C.B0.E9.83.A8.E5.88.86.40.E5.9F.9F.E9.83.A8.E5.88.86.2F.E8.B5.84.E6.BA.90.E9.83.A8.E5.88.86">本地部分@域部分/资源部分</span></h4>
<p>如果一个入站节的'to'属性中包含的JID的域部分和该服务器本身配置的域之一匹配并且包含在'to'属性中的JID的格式为&lt;localpart@domainpart/resourcepart&gt;, 那么该服务器必须遵循以下规则. 
</p>
<h5> <span class="mw-headline" id=".E8.B5.84.E6.BA.90.E5.8C.B9.E9.85.8D">资源匹配</span></h5>
<p>如果一个可用的资源或已连接的资源准确地匹配该全JID, 如何处理该节取决于该节的类型.
</p>
<dl><dd> 对于一个类型为"get"或"set"的IQ节, 如果预期的接收者未通过类型为"both"或"from"的所谓出席信息订阅或通过所谓定向出席信息来分享出席信息给请求实体, 那么该服务器不应该(SHOULD NOT)递送该IQ节，而应该返回一个&lt;service-unavailable/&gt;节错误给请求实体. 这个策略帮助防止出席信息泄漏(见<a href="/RFC6121#.E5.AE.89.E5.85.A8.E4.BA.8B.E9.A1.B9" title="RFC6121">第11章</a>).
</dd><dd> 对于一个类型为"result" 或 "error"的IQ节, 该服务器必须递送该节给该资源.
</dd><dd> 对于一个消息节, 该服务器必须递送该节给该资源.
</dd><dd> 对于一个没有'type'属性或'type'属性为"unavailable"的出席信息节, 该服务器必须递送该节给该资源.
</dd><dd> 对于一个类型为"subscribe", "subscribed", "unsubscribe", 或 "unsubscribed"的出席信息节, 该服务器必须遵循<a href="/RFC6121#.E7.AE.A1.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85" title="RFC6121">第3章</a>提供的指南.
</dd><dd> 对于一个类型为"probe"的出席信息节, 该服务器必需跟随<a href="/RFC6121#.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B" title="RFC6121">4.3</a>提供的指南.
</dd></dl>
<h5> <span class="mw-headline" id=".E6.97.A0.E8.B5.84.E6.BA.90.E5.8C.B9.E9.85.8D">无资源匹配</span></h5>
<p>如果没有可用资源或已连接的资源准确匹配该全JID, 如何处理该节取决于该节的类型. 
</p>
<h6> <span class="mw-headline" id="Message_3">Message</span></h6>
<p>对于一个类型为"normal", "groupchat", 或"headline"的消息节, 该服务器必须要么 (a) 安静地忽略该节 要么 (b) 返回一个错误节给该发送者, 该节错误应该是&lt;service-unavailable/&gt;.
</p><p>对于一个类型为"chat"的消息节:
</p>
<dl><dd><ul><li> 如果没有可用或已连接的资源, 该服务器必须要么 (a) 存储该消息到离线用于晚些时候递送 要么 (b) 返回一个错误节给该发送者, 该节错误应该是&lt;service-unavailable/&gt;.
</li><li> 如果所有可用资源都有一个负的出席信息优先级那么该服务器应该 (a) 存储该消息到离线用于晚些时候递送 或 (b) 返回一个错误节给该发送者, 该节错误应该是&lt;service-unavailable/&gt;.
</li><li> 如果有一个可用资源的出席信息优先级不是负的那么该服务器必须递送该消息给那个资源.
</li><li> 如果有多个资源的出席信息优先级是非负的那么该服务器必须要么 (a) 递送该消息给"最可用的"资源或资源们(根据服务器的实现特有的机制, 例如, 认为拥有最高出席信息优先级的资源或资源们是"最可用的") 要么 (b) 递送该消息给所有曾经被选择接收了聊天消息的非负的资源. 
</li></ul>
</dd></dl>
<p>对于一个类型为"error"的消息节, 该服务器必须安静地忽略该节. 
</p>
<h6> <span class="mw-headline" id="Presence_3">Presence</span></h6>
<p>对于一个没有'type'属性或'type'属性为"unavailable"的出席信息节, 该服务器必须安静地忽略该节.
</p><p>对于一个类型为"subscribe"的出席信息节, 该服务器必须遵循<a href="/RFC6121#.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86.E5.85.A5.E7.AB.99.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">3.1.3</a>提供指南.
</p><p>对于一个类型为"subscribed", "unsubscribe", 或 "unsubscribed"的出席信息节, 该服务器必须忽略该节.
</p><p>对于一个类型为"probe"的出席信息节, 该服务器必须遵循<a href="/RFC6121#.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E6.8E.A2.E6.B5.8B" title="RFC6121">4.3</a>提供的指南.
</p>
<h6> <span class="mw-headline" id="IQ_3">IQ</span></h6>
<p>对于一个IQ节, 该服务器必须返回一个&lt;service-unavailable/&gt;节错误给该发送者.
</p>
<h4> <span class="mw-headline" id=".E6.B6.88.E6.81.AF.E9.80.92.E9.80.81.E8.A7.84.E5.88.99.E7.9A.84.E6.80.BB.E7.BB.93">消息递送规则的总结</span></h4>
<p>下表总结了本章前面描述的消息(不是节)递送规则. 左边的列显示了各种条件(不存在的帐号, 没有活跃的资源, 只有一个资源并且出席信息优先级为负, 只有一个资源并且出席信息优先级为非负, 或多个资源并且每个的出席信息优先级都为非负)和'to'地址(纯JID, 匹配一个可用资源的全JID, 或没有匹配的可用资源的全JID)的组合. 随后的列列出了四个主要的消息类型(normal, chat, groupchat, 或 headline) 以及六种可能的递送选项: 存储消息到离线 (O), 以一个节错误弹回该消息 (E), 安静地忽略该消息 (S), 递送该消息到'to'地址中指定的资源 (D), 根据服务器实现特有的机制递送该消息到"最可用的"资源或资源们, 例如, 认为拥有最高出席信息优先级的资源或资源们是"最可用的" (M), 或递送该消息给所有拥有非负出席信息优先级的资源 (A -- 这里对于 chat 消息来说 "所有资源" 可能意味着一组显式地被选中接收每个chat消息的资源). '/' 字符代表"异或". 该服务器在给一个特定的消息选择哪种动作的时候，应该遵守<a href="/RFC6121#.E5.B8.B8.E8.A7.84.E4.BA.8B.E9.A1.B9" title="RFC6121">8.1</a>给出的规则
</p><p>表1: 消息递送规则
</p>
<table border="1" cellspacing="0">
<tr>
<th>条件 </th>
<th>Normal </th>
<th>Chat </th>
<th>Groupchat </th>
<th>Headline
</th></tr>
<tr>
<td>帐号不存在 + 纯JID </td>
<td>S/E </td>
<td>S/E </td>
<td>E </td>
<td>S
</td></tr>
<tr>
<td>帐号不存在 + 全JID </td>
<td>S/E </td>
<td>S/E </td>
<td>S/E </td>
<td>S/E
</td></tr>
<tr>
<td>帐号存在但无活跃资源 + 纯JID </td>
<td>O/E </td>
<td>O/E </td>
<td>E </td>
<td>S
</td></tr>
<tr>
<td>帐号存在但无活跃资源 + 全JID（不匹配） </td>
<td>S/E </td>
<td>O/E </td>
<td>S/E </td>
<td>S/E
</td></tr>
<tr>
<td>多个负资源但无非负资源 + 纯JID </td>
<td>O/E </td>
<td>O/E </td>
<td>E </td>
<td>S
</td></tr>
<tr>
<td>多个负资源但无非负资源 + 全JID(匹配) </td>
<td>D </td>
<td>D </td>
<td>D </td>
<td>D
</td></tr>
<tr>
<td>多个负资源但无非负资源 + 全JID(不匹配) </td>
<td>S/E </td>
<td>O/E </td>
<td>S/E </td>
<td>S/E
</td></tr>
<tr>
<td>一个非负资源 + 纯JID </td>
<td>D </td>
<td>D </td>
<td>E </td>
<td>D
</td></tr>
<tr>
<td>一个非负资源 + 全JID(匹配) </td>
<td>D </td>
<td>D </td>
<td>D </td>
<td>D
</td></tr>
<tr>
<td>一个非负资源 + 全JID(不匹配) </td>
<td>S/E </td>
<td>D </td>
<td>S/E </td>
<td>S/E
</td></tr>
<tr>
<td>多个非负资源 + 纯JID </td>
<td>M/A </td>
<td>M/A* </td>
<td>E </td>
<td>A
</td></tr>
<tr>
<td>多个非负资源 + 全JID(匹配) </td>
<td>D </td>
<td>D/A* </td>
<td>D </td>
<td>D
</td></tr>
<tr>
<td>多个非负资源 + 全JID(不匹配) </td>
<td>S/E </td>
<td>M/A* </td>
<td>S/E </td>
<td>S/E
</td></tr></table>
<dl><dd><ul><li> 对于类型为"chat"的消息, 一个服务器不应该(SHOULD NOT)根据选项(A)来动作，除非客户端能显式地选择接收所有的chat消息; 无论如何, 选择的方法超出了本协议的范围.
</li></ul>
</dd></dl>
<h2> <span class="mw-headline" id="URIs.E7.9A.84.E5.A4.84.E7.90.86">URIs的处理</span></h2>
<p>在一个XMPP网络上用于通讯的XMPP实体的地址(例如, 在一个XML节中的'from'和'to'地址)不能(MUST NOT)被预设为一个统一资源定位符<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">URI</a>scheme.
</p><p>无论如何, 一个位于XMPP本身之外的应用(例如, 一个位于Web网站的页面)可能需要把一个XMPP实体标识为一个URI或一个国际化资源标识符<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">IRI</a>, 并且一个XMPP客户端可能需要和一个这样的外部应用交互(例如, 一个XMPP客户端可能通过点击一个web网页上的链接而被调用). 在这类交互的上下文中, XMPP客户端被鼓励处理<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XMPP‑URI</a>中指定的的被编码为"xmpp:"的URIs和IRIs的地址，更多描述参见<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0147</a>. 尽管XMPP客户端也被鼓励处理<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">CPIM</a>中指定的编码为"im:"的URIs地址和<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">CPP</a>中指定的编码为"pres:"的URIs地址, 它们可以如<a href="/RFC6121#.E8.BF.9C.E7.AB.AF.E5.9F.9F" title="RFC6121">8.3</a>所定义的那样，移除"im:"或"pres:"的scheme并把地址解析委托给服务器.
</p>
<h2> <span class="mw-headline" id=".E5.9B.BD.E9.99.85.E5.8C.96.E4.BA.8B.E9.A1.B9">国际化事项</span></h2>
<p>关于国际化事项, 参考<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>的有关章节.
</p>
<h2> <span class="mw-headline" id=".E5.AE.89.E5.85.A8.E4.BA.8B.E9.A1.B9">安全事项</span></h2>
<p>关于XMPP的核心安全事项位于<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>的第13章, 包括通道加密, 验证, 信息泄露, 拒绝服务攻击, 以及域间联盟的讨论.
</p><p><a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>第13.1节大概描述了在典型的XMPP部署中客户端和服务器的架构角色, 并讨论了和那些角色相关的安全特性. 这些角色对本文描述的即时消息,出席信息订阅，和出席信息通知的安全性上有影响. 本质上, 一个XMPP用户在一个XMPP服务器上注册或已经被预分配)一个帐号, 所以在这个服务器上给予了某些级别的信任以代表该用户完成各种任务, 强制安全性策略, 等等. 因此服务器的责任是:
</p>
<dl><dd><ol><li> 本地客户端和远端服务器之间的通讯最好强制使用通道加密.
</li><li> 验证任何希望访问该用户的帐号的客户端.
</li><li> 处理已经被验证的客户端收到和发出的XML节(特别是关于即时消息和出席信息功能, 存储该用户的名册, 处理入站和出站订阅请求和应答, 生成和处理出席信息探测, 广播出站出席信息通知, 路由出站消息, 以及递送入站消息和出席信息通知).
</li></ol>
</dd></dl>
<p>如<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>的第13.1节和第13.4讨论的, 即使该服务器履行了上述的责任, 该客户端对于节可能和另一个客户端(在同一台服务器上或在一个远端服务器上)的交换没有任何保证，它可能在XMPP通讯路径中的所有跳中被保护, 或只在该服务器本身被保护. 如果该客户端希望确保它的通讯的点对点的机密性和完整性，使用一个适当的技术来对XML节加密和签名是它的责任.
</p><p>只适用于XMPP的即时消息和出席信息应用的额外事项定义于本文的很多地方; 特别是:
</p>
<dl><dd><ul><li> 当一个服务器拥有一个类型为"probe"的入站出席信息节，且它的预期接收者是和该服务器的已配置域之一相关的一个用户, 如果该发送者是一个未被授权接收那个由出席信息订阅决定的信息的实体(见<a href="/RFC6121#.E4.BA.A4.E6.8D.A2.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">第4章</a>),该服务器不能(MUST NOT)透露该用户的出席信息.
</li><li> 一个用户的服务器不能(MUST NOT)泄露该用户的网络可用性给未被授权知道该用户的出席信息的的实体们. 在XMPP本身, 授权的方式是一个显性的从联系人到用户的订阅(如<a href="/RFC6121#.E7.AE.A1.E7.90.86.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85" title="RFC6121">第3章</a>所述). 无论如何,如果在该实体和生成了出席信息的该用户之间已经存在一个信任关系(例如, 如果该组织把强制分享出席信息作为员工协议的一部分，一个XMPP的企业部署可能自动把该用户的出席信息添加到一个员工私有目录),一些XMPP部署可能认为一个实体已被授权.
</li><li> 当一个服务器处理一个没有类型或类型为"unavailable"的出站出席信息节, 它必须遵循定义于<a href="/RFC6121#.E4.BA.A4.E6.8D.A2.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF" title="RFC6121">第4章</a>的规则以确保这类出席信息不被发送给未被授权知道这类信息的实体们.
</li><li> 一个客户端可以忽略&lt;status/&gt;元素，当该节包含在一个类型为"subscribe", "unsubscribe", "subscribed", 或 "unsubscribed"的出席信息节中的时候; 这有助于组织"出席信息订阅垃圾".
</li></ul>
</dd></dl>
<h2> <span class="mw-headline" id=".E4.B8.80.E8.87.B4.E6.80.A7.E9.9C.80.E6.B1.82">一致性需求</span></h2>
<p>本章描述了一个协议特性集合来概述本协议的一致性需求. 本特性集合适用于软件认证, 互操作性测试, 和实现报告. 对于每个特性, 本章提供了以下信息: 
</p>
<dl><dd><ul><li> 自然人可读的名称
</li><li> 描述信息
</li><li> 本文特定章节的参考，该章节规范化地定义了该特性
</li><li> 该特性是否适用于客户端角色，服务器角色，或同时适用于两者(这里 "N/A" 表示该特性不适用于该特定角色)
</li><li> 该特性是必须(MUST)还是应该(SHOULD)被实现, 这里大写的术语被视为<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">KEYWORDS</a>所描述的含义
</li></ul>
</dd></dl>
<p>这里定义的特性集合尝试坚持Larry Masinter于2005年在IETF的NEWTRK工作组中建议的概念和格式, 摘自<a href="/RFC6120#.E5.8F.82.E8.80.83.E6.80.A7.E6.96.87.E7.8C.AE" title="RFC6120">INTEROP</a>. 尽管该特性集合比<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.80.A7.E6.96.87.E7.8C.AE" title="RFC6121">REPORTS</a>中说的更详细, 它为实现报告的生成提供了一个合适的基础，这些报告将被提交以支持本协议按照<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.80.A7.E6.96.87.E7.8C.AE" title="RFC6121">PROCESS</a>从建议标准发展成草案标准.
</p>
<pre>   特性:
       message-body 
   描述:
       支持&lt;message/&gt;节的&lt;body/&gt;子元素. 
   章节:
       <a href="/RFC6121#Body.E5.85.83.E7.B4.A0" title="RFC6121">5.2.3</a>
   角色:
       客户端 必须, 服务器 N/A. 
</pre>
<pre>   特性:
       message-subject 
   描述:
       支持&lt;message/&gt;节的&lt;subject/&gt;子元素. 
   章节:
       <a href="/RFC6121#Subject.E5.85.83.E7.B4.A0" title="RFC6121">5.2.4</a>
   角色:
       客户端 应该, 服务器 N/A. 
</pre>
<pre>   特性:
       message-thread 
   描述:
       支持&lt;message/&gt;节的&lt;thread/&gt;子元素. 
   章节:
       <a href="/RFC6121#Thread.E5.85.83.E7.B4.A0" title="RFC6121">5.2.5</a>
   角色:
       客户端 应该, 服务器 N/A. 
</pre>
<pre>   特性:
       message-type-support 
   描述:
       支持接收类型为"normal", "chat", "groupchat", "headline", 和 "error"的消息. 
   章节:
       <a href="/RFC6121#Type.E5.B1.9E.E6.80.A7" title="RFC6121">5.2.2</a>
   角色:
       客户端 应该, 服务器 N/A. 
</pre>
<pre>   特性:
       message-type-deliver 
   描述:
       适当地递送类型为"normal", "chat", "groupchat", "headline", 和 "error"的消息. 
   章节:
       <a href="/RFC6121#.E5.A4.84.E7.90.86XML.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.A7.84.E5.88.99" title="RFC6121">8</a>
   角色:
       客户端 N/A, 服务器 应该. 
</pre>
<pre>   特性:
       presence-notype 
   描述:
       把没有'type'属性的出席信息节视为指示可用性(在线). 
   章节:
       <a href="/RFC6121#Type.E5.B1.9E.E6.80.A7" title="RFC6121">4.7.1</a>
   角色:
       客户端 必须, 服务器 必须. 
</pre>
<pre>   特性:
       presence-probe 
   描述:
       发送和接收'type'属性为"probe"的出席信息节用来查询出席信息. 
   章节:
       <a href="/RFC6121#Type.E5.B1.9E.E6.80.A7" title="RFC6121">4.7.1</a>
   角色:
       客户端 N/A, 服务器 必须. 
</pre>
<pre>   特性:
       presence-sub-approval 
   描述:
       把类型为"subscribed"的出站出席信息节视为对之前从另一个实体接收到的出席信息订阅请求的批准动作, 并且把类型为"subscribed"的入站出席信息节视为来自另一个实体的订阅批准. 
   章节:
       <a href="/RFC6121#.E8.AF.B7.E6.B1.82.E8.AE.A2.E9.98.85" title="RFC6121">3.1</a>
   角色:
       客户端 必须, 服务器 必须. 
</pre>
<pre>   特性:
       presence-sub-cancel 
   描述:
       把类型为"unsubscribed"的出站出席信息节视为对之前从另一个实体接收到的出席信息订阅请求的拒绝动作或对之前授予另一个实体的订阅批准的取消动作, 并且把类型为"unsubscribed"的入站出席信息节视为来自另一个实体的订阅拒绝或取消.. 
   章节:
       <a href="/RFC6121#.E6.92.A4.E9.94.80.E8.A2.AB.E8.AE.A2.E9.98.85" title="RFC6121">3.2</a>
   角色:
       客户端 必须, 服务器 必须.
</pre>
<pre>   特性:
       presence-sub-preapproval 
   描述:
       把类型为"subscribed"的出站出席信息节视为对之前对从另一个实体接收到的订阅请求的预批准动作的确认; 这包括支持'jabber:iq:roster'命名空间的&lt;item/&gt;元素的'approved'属性. 
   章节:
       <a href="/RFC6121#.E9.A2.84.E6.89.B9.E5.87.86.E8.A2.AB.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">3.4</a>
   角色:
       客户端 可以, 服务器 可以. 
</pre>
<pre>   特性:
       presence-sub-request 
   描述:
       把类型为"subscribe"的出站出席信息节视为请求订阅另一个实体的出席信息, 并且把类型为"subscribe"的入站出席信息节视为来自另一个实体的出席信息订阅请求. 
   章节:
       <a href="/RFC6121#.E8.AF.B7.E6.B1.82.E8.AE.A2.E9.98.85" title="RFC6121">3.1</a>
   角色:
       客户端 必须, 服务器 必须.
</pre>
<pre>   特性:
       presence-sub-unsubscribe 
   描述:
       把类型为"unsubscribe"的出站出席信息节视为从另一个实体取消订阅的动作, 并把类型为"unsubscribe"的入站出席信息视为来自另一个实体的取消订阅通知. 
   章节:
       <a href="/RFC6121#.E5.8F.96.E6.B6.88.E8.AE.A2.E9.98.85" title="RFC6121">3.3</a>
   角色:
       客户端 必须, 服务器 必须.
</pre>
<pre>   特性:
       presence-unavailable 
   描述:
       把'type'属性为"unavailable"的出席信息节视为指示失去可用性. 
   章节:
       <a href="/RFC6121#Type.E5.B1.9E.E6.80.A7" title="RFC6121">4.7.1</a>
   角色:
       客户端 必须, 服务器 必须.
</pre>
<pre>   特性:
       roster-get 
   描述:
       把类型为"get"包含一个空的由'jabber:iq:roster'命名空间限定的&lt;query/&gt;元素的IQ节视为一个获取某个服务器上的某个帐号的名册信息的请求. 
   章节:
       <a href="/RFC6121#.E5.90.8D.E5.86.8C.E8.8E.B7.E5.8F.96" title="RFC6121">2.1.3</a>
   角色:
       客户端 必须, 服务器 必须.
</pre>
<pre>   特性:
       roster-set 
   描述:
       把类型为"set"包含一个由'jabber:iq:roster'命名空间限定的&lt;query/&gt;元素的IQ节视为一个添加或更新包含在该&lt;query/&gt;元素中的条目的请求.
   章节:
       <a href="/RFC6121#.E5.90.8D.E5.86.8C.E8.AE.BE.E7.BD.AE" title="RFC6121">2.1.5</a>
   角色:
       客户端 必须, 服务器 必须.
</pre>
<pre>   特性:
       roster-push 
   描述:
       无论何时服务器那一边名册信息出现了实质上的改变，都要发送一个名册推送给感兴趣的资源, 或在从该服务器接收到的时候处理这类推送. 
   章节:
       <a href="/RFC6121#.E5.90.8D.E5.86.8C.E6.8E.A8.E9.80.81" title="RFC6121">2.1.6</a>
   角色:
       客户端 必须, 服务器 必须.
</pre>
<pre>   特性:
       roster-version 
   描述:
       把由'jabber:iq:roster'命名空间限定的&lt;query/&gt;元素中的'ver'属性视为被发送或接收的名册信息的特定版本的标识符. 
   章节:
       <a href="/RFC6121#Ver.E5.B1.9E.E6.80.A7" title="RFC6121">2.1.1</a>
   角色:
       客户端 应该, 服务器 必须.
</pre>
<h2> <span class="mw-headline" id=".E5.8F.82.E8.80.83">参考</span></h2>
<h3> <span class="mw-headline" id=".E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8">规范引用</span></h3>
<p>[DELAY] 	Saint-Andre, P., “Delayed Delivery,” XSF XEP 0203, September 2009.
</p><p>[KEYWORDS] 	Bradner, S., “Key words for use in RFCs to Indicate Requirement Levels,” BCP 14, <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2119">RFC 2119</a>, March 1997 (TXT, HTML, XML).
</p><p>[XML] 	Maler, E., Yergeau, F., Sperberg-McQueen, C., Paoli, J., and T. Bray, “Extensible Markup Language (XML) 1.0 (Fifth Edition),” World Wide Web Consortium Recommendation REC‑xml‑20081126, November 2008 (HTML).
</p><p>[XML-NAMES] 	Bray, T., Hollander, D., and A. Layman, “Namespaces in XML,” W3C REC-xml-names, January 1999.
</p><p>[XMPP-CORE] 	Saint-Andre, P., “Extensible Messaging and Presence Protocol (XMPP): Core,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc6120">RFC 6120</a>, March 2011.
</p>
<h3> <span class="mw-headline" id=".E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE">参考文献</span></h3>
<p>[CPIM] 	Peterson, J., “Common Profile for Instant Messaging (CPIM),” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3860">RFC 3860</a>, August 2004 (TXT).
</p><p>[CPP] 	Peterson, J., “Common Profile for Presence (CPP),” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3859">RFC 3859</a>, August 2004 (TXT).
</p><p>[DOS] 	Handley, M., Rescorla, E., and IAB, “Internet Denial-of-Service Considerations,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc4732">RFC 4732</a>, December 2006 (TXT).
</p><p>[IMP-MODEL] 	Day, M., Rosenberg, J., and H. Sugano, “A Model for Presence and Instant Messaging,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2778">RFC 2778</a>, February 2000.
</p><p>[IMP-REQS] 	Day, M., Aggarwal, S., and J. Vincent, “Instant Messaging / Presence Protocol Requirements,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2779">RFC 2779</a>, February 2000 (TXT).
</p><p>[IMP-SRV] 	Peterson, J., “Address Resolution for Instant Messaging and Presence,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3861">RFC 3861</a>, August 2004 (TXT).
</p><p>[INTEROP] 	Masinter, L., “Formalizing IETF Interoperability Reporting,” Work in Progress, October 2005.
</p><p>[IRC] 	Kalt, C., “Internet Relay Chat: Architecture,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2810">RFC 2810</a>, April 2000 (TXT).
</p><p>[IRI] 	Duerst, M. and M. Suignard, “Internationalized Resource Identifiers (IRIs),” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3987">RFC 3987</a>, January 2005 (TXT).
</p><p>[PROCESS] 	Bradner, S., “The Internet Standards Process -- Revision 3,” BCP 9, <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2026">RFC 2026</a>, October 1996 (TXT).
</p><p>[REPORTS] 	Dusseault, L. and R. Sparks, “Guidance on Interoperation and Implementation Reports for Advancement to Draft Standard,” BCP 9, <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc5657">RFC 5657</a>, September 2009 (TXT).
</p><p>[RFC3920] 	Saint-Andre, P., Ed., “Extensible Messaging and Presence Protocol (XMPP): Core,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3920">RFC 3920</a>, October 2004 (TXT, HTML, XML).
</p><p>[RFC3921] 	Saint-Andre, P., Ed., “Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>, October 2004 (TXT, HTML, XML).
</p><p>[SASL] 	Melnikov, A. and K. Zeilenga, “Simple Authentication and Security Layer (SASL),” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc4422">RFC 4422</a>, June 2006 (TXT).
</p><p>[SIP-PRES] 	Rosenberg, J., “A Presence Event Package for the Session Initiation Protocol (SIP),” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3856">RFC 3856</a>, August 2004 (TXT).
</p><p>[TLS] 	Dierks, T. and E. Rescorla, “The Transport Layer Security (TLS) Protocol Version 1.2,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc5246">RFC 5246</a>, August 2008 (TXT).
</p><p>[TLS-CERTS] 	Saint-Andre, P. and J. Hodges, “Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS),” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc6125">RFC 6125</a>, March 2011.
</p><p>[UNICODE] 	The Unicode Consortium, “The Unicode Standard, Version 6.0,” 2010.
</p><p>[URI] 	Berners-Lee, T., Fielding, R., and L. Masinter, “Uniform Resource Identifier (URI): Generic Syntax,” STD 66, <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3986">RFC 3986</a>, January 2005 (TXT).
</p><p>[UUID] 	Leach, P., Mealling, M., and R. Salz, “A Universally Unique IDentifier (UUID) URN Namespace,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc4122">RFC 4122</a>, July 2005 (TXT, HTML, XML).
</p><p>[XEP-0016] 	Millard, P. and P. Saint-Andre, “Privacy Lists,” XSF XEP 0016, February 2007.
</p><p>[XEP-0045] 	Saint-Andre, P., “Multi-User Chat,” XSF XEP 0045, July 2008.
</p><p>[XEP-0054] 	Saint-Andre, P., “vcard-temp,” XSF XEP 0054, July 2008.
</p><p>[XEP-0071] 	Saint-Andre, P., “XHTML-IM,” XSF XEP 0071, September 2008.
</p><p>[XEP-0115] 	Hildebrand, J., Saint-Andre, P., and R. Tronçon, “Entity Capabilities,” XSF XEP 0115, February 2008.
</p><p>[XEP-0147] 	Saint-Andre, P., “XMPP URI Scheme Query Components,” XSF XEP 0147, September 2006.
</p><p>[XEP-0160] 	Saint-Andre, P., “Best Practices for Handling Offline Messages,” XSF XEP 0160, January 2006.
</p><p>[XEP-0163] 	Saint-Andre, P. and K. Smith, “Personal Eventing Protocol,” XSF XEP 0163, July 2010.
</p><p>[XEP-0191] 	Saint-Andre, P., “Simple Communications Blocking,” XSF XEP 0191, February 2007.
</p><p>[XEP-0201] 	Saint-Andre, P., Paterson, I., and K. Smith, “Best Practices for Message Threads,” XSF XEP 0201, November 2010.
</p><p>[XEP-0237] 	Saint-Andre, P. and D. Cridland, “Roster Versioning,” XSF XEP 0237, March 2010.
</p><p>[XML-DATATYPES] 	Biron, P. and A. Malhotra, “XML Schema Part 2: Datatypes Second Edition,” W3C REC-xmlschema-2, October 2004 (HTML).
</p><p>[XML-SCHEMA] 	Thompson, H., Maloney, M., Mendelsohn, N., and D. Beech, “XML Schema Part 1: Structures Second Edition,” World Wide Web Consortium Recommendation REC-xmlschema-1-20041028, October 2004 (HTML).
</p><p>[XMPP-ADDR] 	Saint-Andre, P., “Extensible Messaging and Presence Protocol (XMPP): Address Format,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc6122">RFC 6122</a>, March 2011.
</p><p>[XMPP-URI] 	Saint-Andre, P., “Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP),” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc5122">RFC 5122</a>, February 2008 (TXT).
</p><p>[VCARD] 	Dawson, F. and T. Howes, “vCard MIME Directory Profile,” <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2426">RFC 2426</a>, September 1998 (HTML, XML).
</p>
<h2> <span class="mw-headline" id=".E9.99.84.E5.BD.95A._.E8.AE.A2.E9.98.85.E7.8A.B6.E6.80.81">附录A. 订阅状态</span></h2>
<p>本章提供关于订阅状态的详细信息和订阅相关的出席信息节(即, 类型为"subscribe", "subscribed", "unsubscribe", 和"unsubscribed"的出席信息节)的服务器处理. 
</p>
<h3> <span class="mw-headline" id="A.1._.E5.B7.B2.E5.AE.9A.E4.B9.89.E7.9A.84.E7.8A.B6.E6.80.81">A.1. 已定义的状态</span></h3>
<p>有四个主要的订阅状态(这些状态是从用户而不是联系人的视角来描述的):
</p>
<dl><dd> None:
<dl><dd> 该用户没有对该联系人的出席信息的订阅, 且该联系人也没有对该用户的出席信息的订阅. 
</dd></dl>
</dd><dd> To:
<dl><dd> 该用户有一个对该联系人的订阅, 但该联系人没有对该用户的出席信息的订阅. 
</dd></dl>
</dd><dd> From:
<dl><dd> 该联系人有一个对该用户的出席信息的订阅, 该用户没有对该联系人的出席信息的订阅. 
</dd></dl>
</dd><dd> Both:
<dl><dd> 该用户和该联系人对对方的出席信息都有订阅(即, 'from'和'to'的联合). 
</dd></dl>
</dd></dl>
<dl><dd>实现备注: 为了如接下来的章节所述那样处理订阅相关的出席信息节, 订阅状态"None"包括该联系人根本不在该用户的名册中的情形, 即, 一个从用户的名册的视角来看是未知的实体.
</dd></dl>
<p>前述的状态被各种和未决的入站和出站订阅相关的子状态所补充, 所以有高达九种可能的订阅状态:
</p>
<dl><dd><ol><li> "None" = 联系人和用户未彼此订阅, 且未曾向对方请求一个订阅; 反映在该用户的名册中就是 subscription='none'.
</li><li> "None + Pending Out" = 联系人和用户未彼此订阅, 而用户已经发送了一个订阅请求给联系人但是尚未被应答; 这反映在该用户的名册中就是 subscription='none' 且 ask='subscribe'.
</li><li> "None + Pending In" = 联系人和用户未彼此订阅, 而联系人已经发送了一个订阅请求给用户但是尚未被应答. 这个状态可以反映也可以不反映在该用户的名册中, 如下: 如果该用户曾经为该联系人创建一个名册条目那么该服务器必须维护那个名册条目并且也注意到该入站出席信息订阅请求的存在, 反之如果该用户未曾为该联系人创建一个名册条目那么该用户的服务器必须注意该入站出席信息订阅请求的存在但是不能(MUST NOT)为该联系人创建一个名册条目(反之, 在把该联系人添加到该用户的名册之前，该服务器必须等到该用户已经批准该订阅请求).
</li><li> "None + Pending Out+In" = 联系人和用户未彼此订阅, 联系人已经发送了一个订阅请求给用户但是尚未被应答, 而用户已经发送了一个订阅请求给联系人但是尚未被应答; 这反映在该用户的名册中就是 subscription='none' 且 ask='subscribe'.
</li><li> "To" = 用户已经订阅了联系人(单向); 这反映在该用户的名册中就是 subscription='to'.
</li><li> "To + Pending In" = 用户已经订阅了联系人, 而联系人已经发送了一个订阅请求给用户但是尚未被应答; 这反映在该用户的名册中就是 subscription='to'.
</li><li> "From" = 联系人已经订阅了用户(单向); 这反映在该用户的名册中就是 subscription='from'.
</li><li> "From + Pending Out" = 联系人已经订阅了用户, 而用户已经发送了一个订阅请求给联系人但是尚未被应答; 这反映在该用户的名册中就是 subscription='from' 且 ask='subscribe'.
</li><li> "Both" = 用户和联系人彼此订阅了(双向); 这反映在该用户的名册中就是 subscription='both'.
</li></ol>
</dd></dl>
<h3> <span class="mw-headline" id="A.2._.E5.87.BA.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86">A.2. 出站出席信息订阅节的服务器处理</span></h3>
<p>出站出席信息订阅节允许该用户管理他的或她对该联系人的出席信息的订阅(通过"subscribe"和"unsubscribe"类型), 并且管理联系人对该用户的出席信息的访问(通过"subscribed"和"unsubscribed"类型).
</p><p>以下规则适用于该节的出站路由和该用户的名册的变更. (这些规则是从该用户而不是该联系人的视角描述的. 另外, "S.N." 代表不应该(SHOULD NOT)而"M.N." 代表不能(MUST NOT).) 
</p>
<h4> <span class="mw-headline" id="A.2.1._Subscribe">A.2.1. Subscribe</span></h4>
<p>表2: 出站"subscribe"节的处理
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>+------------------------------------------------------------------+
|  EXISTING STATE          |  ROUTE?   |  NEW STATE                |
+------------------------------------------------------------------+
|  &quot;None&quot;                  |  MUST [1] |  &quot;None + Pending Out&quot;     |
|  &quot;None + Pending Out&quot;    |  MUST     |  no state change          |
|  &quot;None + Pending In&quot;     |  MUST [1] |  &quot;None + Pending Out+In&quot;  |
|  &quot;None + Pending Out+In&quot; |  MUST     |  no state change          |
|  &quot;To&quot;                    |  MUST     |  no state change          |
|  &quot;To + Pending In&quot;       |  MUST     |  no state change          |
|  &quot;From&quot;                  |  MUST [1] |  &quot;From + Pending Out&quot;     |
|  &quot;From + Pending Out&quot;    |  MUST     |  no state change          |
|  &quot;Both&quot;                  |  MUST     |  no state change          |
+------------------------------------------------------------------+</pre></div></div>
<dl><dd> [1] 一个状态变更到"pending out"包括了在该用户的名册中把'ask'标志的值设为"subscribe".
</dd></dl>
<h4> <span class="mw-headline" id="A.2.2._Unsubscribe">A.2.2. Unsubscribe</span></h4>
<p>表3: 出站"unsubscribe"节的处理
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>+-----------------------------------------------------------------+
|  EXISTING STATE          |  ROUTE?  |  NEW STATE                |
+-----------------------------------------------------------------+
|  &quot;None&quot;                  |  MUST    |  no state change          |
|  &quot;None + Pending Out&quot;    |  MUST    |  &quot;None&quot;                   |
|  &quot;None + Pending In&quot;     |  MUST    |  no state change          |
|  &quot;None + Pending Out+In&quot; |  MUST    |  &quot;None + Pending In&quot;      |
|  &quot;To&quot;                    |  MUST    |  &quot;None&quot;                   |
|  &quot;To + Pending In&quot;       |  MUST    |  &quot;None + Pending In&quot;      |
|  &quot;From&quot;                  |  MUST    |  no state change          |
|  &quot;From + Pending Out&quot;    |  MUST    |  &quot;From&quot;                   |
|  &quot;Both&quot;                  |  MUST    |  &quot;From&quot;                   |
+-----------------------------------------------------------------+</pre></div></div>
<h4> <span class="mw-headline" id="A.2.3._Subscribed">A.2.3. Subscribed</span></h4>
<p>表4: 出站"subscribed"节的处理
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>+-----------------------------------------------------------------+
|  EXISTING STATE          |  ROUTE?  |  NEW STATE                |
+-----------------------------------------------------------------+
|  &quot;None&quot;                  |  M.N.    |  pre-approval [1]         |
|  &quot;None + Pending Out&quot;    |  M.N.    |  pre-approval [1]         |
|  &quot;None + Pending In&quot;     |  MUST    |  &quot;From&quot;                   |
|  &quot;None + Pending Out+In&quot; |  MUST    |  &quot;From + Pending Out&quot;     |
|  &quot;To&quot;                    |  M.N.    |  pre-approval [1]         |
|  &quot;To + Pending In&quot;       |  MUST    |  &quot;Both&quot;                   |
|  &quot;From&quot;                  |  M.N.    |  no state change          |
|  &quot;From + Pending Out&quot;    |  M.N.    |  no state change          |
|  &quot;Both&quot;                  |  M.N.    |  no state change          |
+-----------------------------------------------------------------+</pre></div></div>
<dl><dd> [1] 关于订阅预批准的详细信息见<a href="/RFC6121#.E9.A2.84.E6.89.B9.E5.87.86.E8.A2.AB.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">3.4</a>.
</dd></dl>
<h4> <span class="mw-headline" id="A.2.4._Unsubscribed">A.2.4. Unsubscribed</span></h4>
<p>表5: 出站"unsubscribed"节的处理
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>+-----------------------------------------------------------------+
|  EXISTING STATE          |  ROUTE?  |  NEW STATE                |
+-----------------------------------------------------------------+
|  &quot;None&quot;                  |  S.N.    |  no state change [1]      |
|  &quot;None + Pending Out&quot;    |  S.N.    |  no state change [1]      |
|  &quot;None + Pending In&quot;     |  MUST    |  &quot;None&quot;                   |
|  &quot;None + Pending Out+In&quot; |  MUST    |  &quot;None + Pending Out&quot;     |
|  &quot;To&quot;                    |  S.N.    |  no state change [1]      |
|  &quot;To + Pending In&quot;       |  MUST    |  &quot;To&quot;                     |
|  &quot;From&quot;                  |  MUST    |  &quot;None&quot;                   |
|  &quot;From + Pending Out&quot;    |  MUST    |  &quot;None + Pending Out&quot;     |
|  &quot;Both&quot;                  |  MUST    |  &quot;To&quot;                     |
+-----------------------------------------------------------------+</pre></div></div>
<dl><dd> [1] 这一时间可能导致取消一个订阅预批准, 如<a href="/RFC6121#.E9.A2.84.E6.89.B9.E5.87.86.E8.A2.AB.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">3.4</a>所述.
</dd></dl>
<h3> <span class="mw-headline" id="A.3._.E5.85.A5.E7.AB.99.E5.87.BA.E5.B8.AD.E4.BF.A1.E6.81.AF.E8.AE.A2.E9.98.85.E8.8A.82.E7.9A.84.E6.9C.8D.E5.8A.A1.E5.99.A8.E5.A4.84.E7.90.86">A.3. 入站出席信息订阅节的服务器处理</span></h3>
<p>入站出席信息订阅节从该用户请求一个订阅相关的操作(通过"subscribe"类型), 向该用户通知由该联系人做的订阅相关的动作(通过"unsubscribe"类型)，或允许该用户管理该联系人对该用户的的出席信息的访问(通过"subscribed"和"unsubscribed"类型).
</p><p>以下规则适用于该入站节的递送和该用户的名册的变更. (这些用于服务器处理入站出席信息订阅节的规则是从该用户而不是该联系人的视角描述的. 另外, "S.N." 代表不应该(SHOULD NOT).) 
</p>
<h4> <span class="mw-headline" id="A.3.1._Subscribe">A.3.1. Subscribe</span></h4>
<p>表6: 入站"subscribe"节的处理
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="co3">+------------------------------------------------------------------+
|  EXISTING STATE          |  DELIVER?  |  NEW STATE               |
+------------------------------------------------------------------+
|  &quot;None&quot;                  |  MUST [1]  |  &quot;None + Pending In&quot;     |
|  &quot;None + Pending Out&quot;    |  MUST      |  &quot;None + Pending Out+In&quot; |
|  &quot;None + Pending In&quot;     |  S.N.      |  no state change         |
|  &quot;None + Pending Out+In&quot; |  S.N.      |  no state change         |
|  &quot;To&quot;                    |  MUST      |  &quot;To + Pending In&quot;       |
|  &quot;To + Pending In&quot;       |  S.N.      |  no state change         |
|  &quot;From&quot;                  |  S.N. [2]  |  no state change         |
|  &quot;From + Pending Out&quot;    |  S.N. [2]  |  no state change         |
|  &quot;Both&quot;                  |  S.N. [2]  |  no state change         |
+------------------------------------------------------------------+</span></pre></div></div>
<dl><dd> [1] 如果该用户之前发送了类型为"subscribed"的出席信息，如<a href="/RFC6121#_A.2.3._Subscribed" title="RFC6121">附录A.2.3</a> 和 <a href="/RFC6121#.E9.A2.84.E6.89.B9.E5.87.86.E8.A2.AB.E8.AE.A2.E9.98.85.E8.AF.B7.E6.B1.82" title="RFC6121">3.4</a>所述, 那么服务器可以以"subscribed"自动应答并把状态改为"From"而不是"None + Pending In".
</dd></dl>
<dl><dd> [2] 服务器应该自动应答"subscribed".
</dd></dl>
<h4> <span class="mw-headline" id="A.3.2._Unsubscribe">A.3.2. Unsubscribe</span></h4>
<p>当该用户的服务器为该用户接收到一个来自该联系人的类型为"unsubscribe"的出席信息节, 如果从该用户视角来看该节导致一个订阅状态的变更,那么该用户的服务器必需变更该状态, 必须从该联系人递送该出席信息节到该用户, 且代表该用户应该自动应答，发送一个类型为"unsubscribed"的出席信息节给该联系人. 否则该用户的服务器不能(MUST NOT)变更该状态并且(因为没有状态变更)不应该(SHOULD NOT)递送该节. 这些规则被总结在下表中.
</p><p>表7: 入站"unsubscribe"节的处理
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>+------------------------------------------------------------------+
|  EXISTING STATE          |  DELIVER?  |  NEW STATE               |
+------------------------------------------------------------------+
|  &quot;None&quot;                  |  S.N.      |  no state change         |
|  &quot;None + Pending Out&quot;    |  S.N.      |  no state change         |
|  &quot;None + Pending In&quot;     |  MUST [1]  |  &quot;None&quot;                  |
|  &quot;None + Pending Out+In&quot; |  MUST [1]  |  &quot;None + Pending Out&quot;    |
|  &quot;To&quot;                    |  S.N.      |  no state change         |
|  &quot;To + Pending In&quot;       |  MUST [1]  |  &quot;To&quot;                    |
|  &quot;From&quot;                  |  MUST [1]  |  &quot;None&quot;                  |
|  &quot;From + Pending Out&quot;    |  MUST [1]  |  &quot;None + Pending Out&quot;    |
|  &quot;Both&quot;                  |  MUST [1]  |  &quot;To&quot;                    |
+------------------------------------------------------------------+</pre></div></div>
<dl><dd>[1] 服务器应该自动应答"unsubscribed".
</dd></dl>
<h4> <span class="mw-headline" id="A.3.3._Subscribed">A.3.3. Subscribed</span></h4>
<p>当该用户的服务器为该用户接收到一个来自该联系人的类型为"subscribed"的出席信息节, 如果没有未决的访问该联系人的出席信息的出站请求, 那么它不能(MUST NOT)变更该订阅状态且(因为没有状态变更)不应该(SHOULD NOT)递送该节给该用户. 如果有一个未决的访问该联系人的出席信息的出站请求并且该类型为"subscribed"的入站出席信息节会导致一个订阅状态变更, 那么该用户的服务器必须变更该订阅状态且必须递送该节到该用户. 如果该用户已经订阅了该联系人的出席信息, 该类型为"subscribed"的入站出席信息节不会导致一个订阅状态变更; 所以该用户的服务器不能(MUST NOT)变更该订阅状态且(因为没有状态变更)不应该(SHOULD NOT）递送该节给该用户. 这些规则总结在下表中.
</p><p>表8: 入站"subscribed"节的处理
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>+------------------------------------------------------------------+
|  EXISTING STATE          |  DELIVER?  |  NEW STATE               |
+------------------------------------------------------------------+
|  &quot;None&quot;                  |  S.N.      |  no state change         |
|  &quot;None + Pending Out&quot;    |  MUST      |  &quot;To&quot;                    |
|  &quot;None + Pending In&quot;     |  S.N.      |  no state change         |
|  &quot;None + Pending Out+In&quot; |  MUST      |  &quot;To + Pending In&quot;       |
|  &quot;To&quot;                    |  S.N.      |  no state change         |
|  &quot;To + Pending In&quot;       |  S.N.      |  no state change         |
|  &quot;From&quot;                  |  S.N.      |  no state change         |
|  &quot;From + Pending Out&quot;    |  MUST      |  &quot;Both&quot;                  |
|  &quot;Both&quot;                  |  S.N.      |  no state change         |
+------------------------------------------------------------------+</pre></div></div>
<h4> <span class="mw-headline" id="A.3.4._Unsubscribed">A.3.4. Unsubscribed</span></h4>
<p>当该用户的服务器为该用户接收了一个来自该联系人的类型为"unsubscribed"的出席信息节, 如果没有一个访问该联系人的出席信息的未决出站请求或如果该用户目前已经订阅了该联系人的出席信息, 那么该用户的服务器必须变更该订阅状态且必须递送该节给该用户. 否则, 该用户的服务器不能(MUST NOT)变更该订阅状态且(因为没有状态变更)不应该(SHOULD NOT)递送该节. 这些规则总结在下笔中.
</p><p>表9: 入站"unsubscribed"节的处理
</p>
<div dir="ltr" style="text-align: left;"><div class="source-text" style="font-family: monospace;"><pre>+------------------------------------------------------------------+
|  EXISTING STATE          |  DELIVER?  |  NEW STATE               |
+------------------------------------------------------------------+
|  &quot;None&quot;                  |  S.N.      |  no state change         |
|  &quot;None + Pending Out&quot;    |  MUST      |  &quot;None&quot;                  |
|  &quot;None + Pending In&quot;     |  S.N.      |  no state change         |
|  &quot;None + Pending Out+In&quot; |  MUST      |  &quot;None + Pending In&quot;     |
|  &quot;To&quot;                    |  MUST      |  &quot;None&quot;                  |
|  &quot;To + Pending In&quot;       |  MUST      |  &quot;None + Pending In&quot;     |
|  &quot;From&quot;                  |  S.N.      |  no state change         |
|  &quot;From + Pending Out&quot;    |  MUST      |  &quot;From&quot;                  |
|  &quot;Both&quot;                  |  MUST      |  &quot;From&quot;                  |
+------------------------------------------------------------------+</pre></div></div>
<h2> <span class="mw-headline" id=".E9.99.84.E5.BD.95B._.E9.99.90.E5.88.B6.E9.80.9A.E8.AE.AF">附录B. 限制通讯</span></h2>
<p><a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">IMP‑REQS</a>的2.3.5节和5.4.10节要求一个兼容的即使消息和出席信息技术需要允许一个用户限制来自选定用户们的通讯. 实现这些的协议定义于<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0016</a>和<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0191</a>中.
</p>
<h2> <span class="mw-headline" id=".E9.99.84.E5.BD.95C._vCards">附录C. vCards</span></h2>
<p><a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">IMP‑REQS</a>的3.1.3节和4.1.4节要求有可能获取其他联系人的带外联系人信息(例如, 电话号码或email地址). 在XMPP社区中通常使用一个<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">RFC 2426</a> [VCARD]定义的vCard的XML形式来提供这类信息, 但是这超出了本协议的范围(这个协议的文档被包含在<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0054</a>).
</p>
<h2> <span class="mw-headline" id=".E9.99.84.E5.BD.95D._.E7.94.A8.E4.BA.8Ejabber:iq:roster.E7.9A.84XML_Schema">附录D. 用于jabber:iq:roster的XML Schema</span></h2>
<p>以下schema正式地定义本文中使用的'jabber:iq:roster'命名空间, 和<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XML‑SCHEMA</a>一致. 因为XML流和节的确认是可选的, 本schema不是规范的并且只被提供用于描述用. 关于定义核心XMPP命名空间的schemas, 参考<a href="/RFC6121#.E8.A7.84.E8.8C.83.E5.BC.95.E7.94.A8" title="RFC6121">XMPP‑CORE</a>.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;?xml</span> <span class="re0">version</span>=<span class="st0">'1.0'</span> <span class="re0">encoding</span>=<span class="st0">'UTF-8'</span><span class="re2">?&gt;</span>
&#160;
<span class="re1">&lt;xs:schema</span>
    <span class="re0">xmlns:xs</span>=<span class="st0">'http://www.w3.org/2001/XMLSchema'</span>
    <span class="re0">targetNamespace</span>=<span class="st0">'jabber:iq:roster'</span>
    <span class="re0">xmlns</span>=<span class="st0">'jabber:iq:roster'</span>
    <span class="re0">elementFormDefault</span>=<span class="st0">'qualified'</span><span class="re2">&gt;</span>
&#160;
  <span class="re1">&lt;xs:element</span> <span class="re0">name</span>=<span class="st0">'query'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;xs:complexType<span class="re2">&gt;</span></span>
      <span class="re1">&lt;xs:sequence<span class="re2">&gt;</span></span>
        <span class="re1">&lt;xs:element</span> <span class="re0">ref</span>=<span class="st0">'item'</span>
                    <span class="re0">minOccurs</span>=<span class="st0">'0'</span>
                    <span class="re0">maxOccurs</span>=<span class="st0">'unbounded'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/xs:sequence<span class="re2">&gt;</span></span>
      <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'ver'</span>
                    <span class="re0">type</span>=<span class="st0">'xs:string'</span>
                    <span class="re0">use</span>=<span class="st0">'optional'</span><span class="re2">/&gt;</span>
    <span class="re1">&lt;/xs:complexType<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/xs:element<span class="re2">&gt;</span></span>
&#160;
  <span class="re1">&lt;xs:element</span> <span class="re0">name</span>=<span class="st0">'item'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;xs:complexType<span class="re2">&gt;</span></span>
      <span class="re1">&lt;xs:sequence<span class="re2">&gt;</span></span>
        <span class="re1">&lt;xs:element</span> <span class="re0">ref</span>=<span class="st0">'group'</span>
                    <span class="re0">minOccurs</span>=<span class="st0">'0'</span>
                    <span class="re0">maxOccurs</span>=<span class="st0">'unbounded'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/xs:sequence<span class="re2">&gt;</span></span>
      <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'approved'</span>
                    <span class="re0">type</span>=<span class="st0">'xs:boolean'</span>
                    <span class="re0">use</span>=<span class="st0">'optional'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'ask'</span>
                    <span class="re0">use</span>=<span class="st0">'optional'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;xs:simpleType<span class="re2">&gt;</span></span>
          <span class="re1">&lt;xs:restriction</span> <span class="re0">base</span>=<span class="st0">'xs:NMTOKEN'</span><span class="re2">&gt;</span>
            <span class="re1">&lt;xs:enumeration</span> <span class="re0">value</span>=<span class="st0">'subscribe'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;/xs:restriction<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/xs:simpleType<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/xs:attribute<span class="re2">&gt;</span></span>
      <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'jid'</span>
                    <span class="re0">type</span>=<span class="st0">'xs:string'</span>
                    <span class="re0">use</span>=<span class="st0">'required'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'name'</span>
                    <span class="re0">type</span>=<span class="st0">'xs:string'</span>
                    <span class="re0">use</span>=<span class="st0">'optional'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'subscription'</span>
                    <span class="re0">use</span>=<span class="st0">'optional'</span>
                    <span class="re0">default</span>=<span class="st0">'none'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;xs:simpleType<span class="re2">&gt;</span></span>
          <span class="re1">&lt;xs:restriction</span> <span class="re0">base</span>=<span class="st0">'xs:NMTOKEN'</span><span class="re2">&gt;</span>
            <span class="re1">&lt;xs:enumeration</span> <span class="re0">value</span>=<span class="st0">'both'</span><span class="re2">/&gt;</span>
            <span class="re1">&lt;xs:enumeration</span> <span class="re0">value</span>=<span class="st0">'from'</span><span class="re2">/&gt;</span>
            <span class="re1">&lt;xs:enumeration</span> <span class="re0">value</span>=<span class="st0">'none'</span><span class="re2">/&gt;</span>
            <span class="re1">&lt;xs:enumeration</span> <span class="re0">value</span>=<span class="st0">'remove'</span><span class="re2">/&gt;</span>
            <span class="re1">&lt;xs:enumeration</span> <span class="re0">value</span>=<span class="st0">'to'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;/xs:restriction<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/xs:simpleType<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/xs:attribute<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/xs:complexType<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/xs:element<span class="re2">&gt;</span></span>
&#160;
  <span class="re1">&lt;xs:element</span> <span class="re0">name</span>=<span class="st0">'group'</span> <span class="re0">type</span>=<span class="st0">'xs:string'</span><span class="re2">/&gt;</span>
&#160;
<span class="re1">&lt;/xs:schema<span class="re2">&gt;</span></span></pre></div></div>
<h2> <span class="mw-headline" id=".E9.99.84.E5.BD.95E._.E5.92.8CRFC_3921.E7.9A.84.E4.B8.8D.E5.90.8C">附录E. 和<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>的不同</span></h2>
<p>在来自实现和应用实践的一致性和延续性以及正式的互操作性测试的基础上, 对<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">RFC3921</a>做了以下大量修改(还有很多编辑方面的修改).
</p>
<dl><dd><ul><li> 会话建立的协议被决定是不必要的并且因而之前在<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>的第3章定义的内容被移除. 无论如何, 为了向后兼容，鼓励服务器实现声明对该特性的支持, 即使会话建立是一个"no-op"（非选项）.
</li><li> 为了更加无缝地修复位于不同服务器上的名册之间缺少订阅状态同步的问题, 澄清和修改了和出席信息订阅请求，出席信息探测和出席信息通知相关的错误处理.
</li><li> 为出席信息探测修改了'from'地址，现在它是纯JID, 而不是全JID.
</li><li> 基于实现和部署实践调整和澄清了节递送规则.
</li><li> 显式地定义了一个服务器被允许递送一个类型为"normal"或"chat"的消息节给所有资源，如果它有办法允许所有的资源选择这一行为.
</li><li> 允许一个服务器使用它自己的机制来确定"最可用的"资源，用来递送消息, 但是提到了来自<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>的机制(基于出席信息优先级)作为可能的机制.
</li><li> 添加了可选的名册信息版本以在多个会话之间名册没有变更(或只变更了很少)的时候节省带宽; 有关的协议交互开始是在<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0237</a>中描述的.
</li><li> 添加了可选的对预批准出席信息订阅的服务器支持，通过类型为"subscribed"的出席信息节, 包括一个新的'approved'属性，该属性能被设为"true" (用于一个预批准订阅) 或 "false" (缺省值).
</li><li> 给&lt;thread/&gt;元素添加了可选的'parent'属性.
</li><li> 把关于通讯限制的协议(定义于<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>的第10章)移回到<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0016</a>,那里是它最开始采用的地方.
</li><li> 建议在对探测的应答中返回出席信息不可用(离线).
</li><li> 澄清发送给全JIDs的出席信息探测的处理.
</li><li> 显式地定义了出席信息&lt;priority/&gt;元素的缺省值为零.
</li><li> 移除了对"_im"和"_pres"的SRV记录的支持的建议.
</li></ul>
</dd></dl>
<h2> <span class="mw-headline" id=".E9.99.84.E5.BD.95F._.E8.87.B4.E8.B0.A2">附录F. 致谢</span></h2>
<p>本文衍生自自<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>，是对它的更新. 没有贡献者们和评论者们的工作，本文是不可能完成的.
</p><p>从<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>发布以来，数百人提供了实现反馈, 错误报告, 澄清的请求, 和改善建议. 尽管本文的编辑已经努力找出所有这类反馈, 但他独自对任何其余的错误和含糊的地方负责.
</p><p>一些关于名册版本的文本来自<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0237</a>，而一些关于消息线索的文本来自<a href="/RFC6121#.E5.8F.82.E8.80.83.E6.96.87.E7.8C.AE" title="RFC6121">XEP‑0201</a>.
</p><p>特别感谢 Kevin Smith, Matthew Wild, Dave Cridland, Waqas Hussain, Philipp Hancke, Florian Zeitz, Jonas Lindberg, Jehan Pages, Tory Patnoe, 和其他在工作组最后召集期间做评论的人.
</p><p>也感谢代表安全局进行复审的 Richard Barnes.
</p><p>工作组主席是 Ben Campbell 和 Joe Hildebrand. 责任区域编辑是 Gonzalo Camarillo.
</p>
<h2> <span class="mw-headline" id=".E4.BD.9C.E8.80.85.E7.9A.84.E5.9C.B0.E5.9D.80">作者的地址</span></h2>
<pre> 	Peter Saint-Andre
 	Cisco
 	1899 Wyknoop Street, Suite 600
 	Denver, CO 80202
 	USA
 Phone:+1-303-308-3282
 EMail:psaintan@cisco.com
</pre>
<!-- 
NewPP limit report
Preprocessor node count: 1751/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mediawiki:pcache:idhash:748-0!*!0!!zh-cn!*!* and timestamp 20160221162309 -->
</div><div class="printfooter">
来自“<a href="http://wiki.jabbercn.org/index.php?title=RFC6121&amp;oldid=3578">http://wiki.jabbercn.org/index.php?title=RFC6121&amp;oldid=3578</a>”</div>
		<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks"><a href="/%E7%89%B9%E6%AE%8A:%E9%A1%B5%E9%9D%A2%E5%88%86%E7%B1%BB" title="特殊:页面分类">3个分类</a>: <ul><li><a href="/%E5%88%86%E7%B1%BB:XMPP%E7%9B%B8%E5%85%B3RFC" title="分类:XMPP相关RFC">XMPP相关RFC</a></li><li><a href="/%E5%88%86%E7%B1%BB:XMPP%E6%A0%B8%E5%BF%83RFC" title="分类:XMPP核心RFC">XMPP核心RFC</a></li><li><a href="/%E5%88%86%E7%B1%BB:%E5%B7%B2%E7%BF%BB%E8%AF%91" title="分类:已翻译">已翻译</a></li></ul></div></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>查看</h5>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="/RFC6121" title="查看内容页面 [c]" accesskey="c">页面</a></li>
				<li id="ca-talk" class="new"><a href="/index.php?title=%E8%AE%A8%E8%AE%BA:RFC6121&amp;action=edit&amp;redlink=1" title="关于内容页面的讨论 [t]" accesskey="t">讨论</a></li>
				<li id="ca-viewsource"><a href="/index.php?title=RFC6121&amp;action=edit" title="本页面已被保护。你可以查看其源代码。 [e]" accesskey="e">查看源代码</a></li>
				<li id="ca-history"><a href="/index.php?title=RFC6121&amp;action=history" title="本页面的早前修订版本 [h]" accesskey="h">历史</a></li>
			</ul>
		</div>
	</div>

	<div class="portlet" id="p-personal">
		<h5>个人工具</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/index.php?title=%E7%89%B9%E6%AE%8A:%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95&amp;returnto=RFC6121" title="我们希望您可以登入，但不强求 [o]" accesskey="o">登录/创建账户</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a title="访问首页" style="background-image: url(/skins/common/images/xmppcn.png);" href="/%E9%A6%96%E9%A1%B5"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>导航</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/%E9%A6%96%E9%A1%B5" title="访问首页 [z]" accesskey="z">首页</a></li>
				<li id="n-portal"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E7%A4%BE%E5%8C%BA%E4%B8%93%E9%A1%B5" title="关于本项目，你可以做什么，在哪里找到你需要的事物">社区专页</a></li>
				<li id="n-currentevents"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E6%96%B0%E9%97%BB%E5%8A%A8%E6%80%81" title="查看当前事件的背景信息">新闻动态</a></li>
				<li id="n-recentchanges"><a href="/%E7%89%B9%E6%AE%8A:%E6%9C%80%E8%BF%91%E6%9B%B4%E6%94%B9" title="本wiki的最近更改列表 [r]" accesskey="r">最近更改</a></li>
				<li id="n-randompage"><a href="/%E7%89%B9%E6%AE%8A:%E9%9A%8F%E6%9C%BA%E9%A1%B5%E9%9D%A2" title="随机进入一个页面 [x]" accesskey="x">随机页面</a></li>
				<li id="n-help"><a href="/%E5%B8%AE%E5%8A%A9:%E7%9B%AE%E5%BD%95" title="寻求帮助的地方">帮助</a></li>
			</ul>
		</div>
	</div>
	<div class="generated-sidebar portlet" id="p-XMPP.E8.B5.84.E6.BA.90">
		<h5>XMPP资源</h5>
		<div class='pBody'>
			<ul>
				<li id="n-XMPP.E5.85.AC.E5.85.B1.E6.9C.8D.E5.8A.A1"><a href="/XMPP%E5%85%AC%E5%85%B1%E6%9C%8D%E5%8A%A1">XMPP公共服务</a></li>
				<li id="n-XMPP.E5.AE.A2.E6.88.B7.E7.AB.AF.E8.BD.AF.E4.BB.B6"><a href="/XMPP%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6">XMPP客户端软件</a></li>
				<li id="n-XMPP.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.BD.AF.E4.BB.B6"><a href="/XMPP%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AF%E4%BB%B6">XMPP服务器软件</a></li>
				<li id="n-.E5.8F.8B.E6.83.85.E9.93.BE.E6.8E.A5"><a href="/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5">友情链接</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">搜索</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/index.php" id="searchform">
				<input type='hidden' name="title" value="特殊:搜索"/>
				<input type="search" name="search" title="在Jabber/XMPP中文翻译计划中搜索 [f]" accesskey="f" id="searchInput" />
				<input type="submit" name="go" value="提交" title="如果相同的标题存在的话便直接前往该页面" id="searchGoButton" class="searchButton" />&#160;
				<input type="submit" name="fulltext" value="搜索" title="搜索含这些文字的页面" id="mw-searchButton" class="searchButton" />
			</form>
		</div>
	</div>




<script src="http://yacy.jabbercn.org:8090/yacy/ui/js/jquery-1.3.2.min.js" type="text/javascript"></script>
<script>
   $(document).ready(function() {
      yconf = {
         url : 'http://yacy.jabbercn.org:8090/',
         theme : 'smoothness',
         title : 'XMPP搜索大全',
         logo     : 'http://yacy.jabbercn.org:8090/env/grafics/50-xmpp_logo.jpg',
         link     : 'http://wiki.jabbercn.org',
         urlmaskfilter : '.*',
         width : 500,
         height : 500
      };
      $.getScript(yconf.url+'/yacy/ui/js/yacyui-portalsearch.js', function(){});
   });
</script>
        <div id="p-search" class="portlet">
<h5>站外搜索</h5>
<div id="yacylivesearch" class="pBody">
   <form id="ysearch" method="get" accept-charset="UTF-8" action="http://yacy.jabbercn.org:8090/yacysearch.html">
      <input name="search" id="yquery" type="text" size="8" maxlength="80" value=""/>
      <input type="hidden" name="verify" value="false" />
      <input type="hidden" name="maximumRecords" value="10" />
      <input type="hidden" name="resource" value="local" />
      <input type="hidden" name="urlmaskfilter" value=".*" />
      <input type="hidden" name="prefermaskfilter" value="" />
      <input type="hidden" name="former" value="" />
      <input type="hidden" name="display" value="2" />
      <input type="hidden" name="nav" value="all" />
      <input type="submit" name="Enter" value="搜索" class="searchButton" />
   </form>
</div>
</div>



	<div class="portlet" id="p-tb">
		<h5>工具箱</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/%E7%89%B9%E6%AE%8A:%E9%93%BE%E5%85%A5%E9%A1%B5%E9%9D%A2/RFC6121" title="所有链入本页的wiki页面列表 [j]" accesskey="j">链入页面</a></li>
				<li id="t-recentchangeslinked"><a href="/%E7%89%B9%E6%AE%8A:%E9%93%BE%E5%87%BA%E6%9B%B4%E6%94%B9/RFC6121" title="本页链入的页面的最近更改 [k]" accesskey="k">链出更改</a></li>
				<li id="t-specialpages"><a href="/%E7%89%B9%E6%AE%8A:%E7%89%B9%E6%AE%8A%E9%A1%B5%E9%9D%A2" title="所有特殊页面列表 [q]" accesskey="q">特殊页面</a></li>
				<li><a href="/index.php?title=RFC6121&amp;printable=yes" rel="alternate">可打印版</a></li>
				<li id="t-permalink"><a href="/index.php?title=RFC6121&amp;oldid=3578" title="本页面该修订版本的永久链接">永久链接</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-copyrightico">
		<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution-Noncommercial-Share Alike 3.0 Unported" width="88" height="31" /></a>
	</div>
	<div id="f-poweredbyico">
		<a href="http://www.mediawiki.org/"><img src="/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
	</div>
	<ul id="f-list">
		<li id="lastmod"> 本页面最后修订于2014年3月17日 (星期一) 14:47。</li>
		<li id="viewcount">此页面已被浏览过82,177次。</li>
		<li id="copyright">本站全部文字内容使用<a class="external" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Attribution-Noncommercial-Share Alike 3.0 Unported</a>授权。</li>
		<li id="privacy"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E9%9A%90%E7%A7%81%E6%9D%83%E6%94%BF%E7%AD%96" title="Jabber/XMPP中文翻译计划:隐私权政策">隐私权政策</a></li>
		<li id="about"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E5%85%B3%E4%BA%8E" title="Jabber/XMPP中文翻译计划:关于">关于Jabber/XMPP中文翻译计划</a></li>
		<li id="disclaimer"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E5%85%8D%E8%B4%A3%E5%A3%B0%E6%98%8E" title="Jabber/XMPP中文翻译计划:免责声明">免责声明</a></li>
	</ul>
</div>
</div>
<script>if(window.mw){
	mw.loader.load(["mediawiki.user", "mediawiki.util", "mediawiki.page.ready", "mediawiki.legacy.wikibits", "mediawiki.legacy.ajax", "mediawiki.legacy.mwsuggest"]);
}
</script>
<script>if(window.mw){
	mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"highlightbroken":1,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,
	"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"zh-cn","language":"zh-cn","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;mw.user.tokens.set({"editToken":"+\\","watchToken":false});;mw.loader.state({"user.options":"ready","user.tokens":"ready"});
	
	/* cache key: mediawiki:resourceloader:filter:minify-js:4:42c4e9caefe8ca663d220ee0c286ac74 */
}
</script><!-- Piwik -->
<script type="text/javascript">
/* <![CDATA[ */
var pkBaseURL = (("https:" == document.location.protocol) ? "https://rtp.rooyee.im/piwik/" : "http://rtp.rooyee.im/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 5);
piwikTracker.setDocumentTitle("RFC6121");
piwikTracker.setIgnoreClasses("image");

piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
/* ]]> */
</script><noscript><p><img src="http://rtp.rooyee.im/piwik/piwik.php?idsite=5" style="border:0" alt=""/></p></noscript>
<!-- /Piwik --><!-- Served in 0.040 secs. --></body></html>