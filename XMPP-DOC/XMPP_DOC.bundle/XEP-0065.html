<!DOCTYPE html>
<html lang="zh-cn" dir="ltr" class="client-nojs">
<head>
<title>XEP-0065 - Jabber/XMPP中文翻译计划</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.18.2" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Jabber/XMPP中文翻译计划 (zh-cn)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.jabbercn.org/api.php?action=rsd" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/" />
<link rel="alternate" type="application/atom+xml" title="Jabber/XMPP中文翻译计划的Atom" href="/index.php?title=%E7%89%B9%E6%AE%8A:%E6%9C%80%E8%BF%91%E6%9B%B4%E6%94%B9&amp;feed=atom" />
<link rel="stylesheet" href="/load.php?debug=false&amp;lang=zh-cn&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cskins.monobook&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE50Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE55Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/skins/monobook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/skins/monobook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}a.new,#quickbar a.new{color:#ba0000}

/* cache key: mediawiki:resourceloader:filter:minify-css:4:c88e2bcd56513749bec09a7e29cb3ffa */</style>
<script src="/load.php?debug=false&amp;lang=zh-cn&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
	mw.config.set({"wgCanonicalNamespace": "", "wgCanonicalSpecialPageName": false, "wgNamespaceNumber": 0, "wgPageName": "XEP-0065", "wgTitle": "XEP-0065", "wgCurRevisionId": 10, "wgArticleId": 9, "wgIsArticle": true, "wgAction": "view", "wgUserName": null, "wgUserGroups": ["*"], "wgCategories": ["XMPP扩展", "已翻译"], "wgBreakFrames": false, "wgRestrictionEdit": [], "wgRestrictionMove": [], "wgSearchNamespaces": [0]});
}
</script><script>if(window.mw){
	mw.loader.load(["mediawiki.page.startup"]);
}
</script>
<style type="text/css">/*<![CDATA[*/
.source-xml {border: 1px dashed #2f6fab; color: black; background-color: #f9f9f9;}
.source-xml li, .source-xml pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for xml
 * CSS class: source-xml, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-xml .de1, .source-xml .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-xml  {font-family: monospace;}
.source-xml .imp {font-weight: bold; color: red;}
.source-xml li, .source-xml li.li1 {font-weight: normal;}
.source-xml li.li2 {font-weight: bold;}
.source-xml .co1 {color: #808080; font-style: italic;}
.source-xml .co2 {color: #404040; font-style: italic;}
.source-xml .co3 {color: #000000;}
.source-xml .co4 {color: #400000; font-weight: bold;}
.source-xml .es0 {color: #000099; font-weight: bold;}
.source-xml .br0 {color: #66cc66;}
.source-xml .sy0 {color: #66cc66;}
.source-xml .st0 {color: #ff0000;}
.source-xml .nu0 {color: #cc66cc;}
.source-xml .re0 {color: #000066;}
.source-xml .re1 {color: #000000; font-weight: bold;}
.source-xml .re2 {color: #000000; font-weight: bold;}
.source-xml .ln-xtra, .source-xml li.ln-xtra, .source-xml div.ln-xtra {background-color: #ffc;}
.source-xml span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-XEP-0065 action-view skin-monobook">
<div id="globalWrapper">
<div id="column-content"><div id="content">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading">XEP-0065</h1>
	<div id="bodyContent">
		<div id="siteSub">来自Jabber/XMPP中文翻译计划</div>
		<div id="contentSub"></div>
		<div id="jump-to-nav">跳转到： <a href="#column-one">导航</a>, <a href="#searchInput">搜索</a></div>
		<!-- start content -->
<div lang="zh-cn" dir="ltr" class="mw-content-ltr"><p><br />
<b>本文的英文原文来自<a rel="nofollow" class="external text" href="http://www.xmpp.org/extensions/xep-0065.html">XEP-0065</a></b>
</p><p><b>XEP-0065: SOCKS5字节流</b>
</p><p>本文定一个XMPP协议扩展,用于在任意两个XMPP用户之间建立一个带外字节流,主要目的是文件传输. 这个字节流可以是直连(点对点)或间接连接(通过一个专用的代理服务器). 典型的传输协议使用TCP, 尽管也可选的支持UDP.
</p><p>注意: 这里定义的协议是XMPP标准化基金会的一个草案标准.对本协议的执行是被鼓励的,也适于部署到生产系统,但是在它成为最终标准之前可能还会有一些变动.
</p><p><b>文档信息</b>
</p><p>系列: [<a rel="nofollow" class="external text" href="http://www.xmpp.org/extensions/">XEP</a>] <a href="/index.php?title=XMPP%E6%89%A9%E5%B1%95&amp;action=edit&amp;redlink=1" class="new" title="XMPP扩展（尚未撰写）">译文</a>
</p><p>编号: 0065
</p><p>发行者: <a rel="nofollow" class="external text" href="http://www.xmpp.org/xsf/">XMPP标准化基金会</a> <a href="/index.php?title=XMPP%E6%A0%87%E5%87%86%E5%9F%BA%E9%87%91%E4%BC%9A&amp;action=edit&amp;redlink=1" class="new" title="XMPP标准基金会（尚未撰写）">译文</a>
</p><p>状态: 草案
</p><p>类型: 标准跟踪
</p><p>版本: 1.7
</p><p>最后更新日期: 2007-05-21
</p><p>批准机构: <a rel="nofollow" class="external text" href="http://www.xmpp.org/council/">XMPP理事会</a> <a href="/index.php?title=XMPP%E7%90%86%E4%BA%8B%E4%BC%9A&amp;action=edit&amp;redlink=1" class="new" title="XMPP理事会（尚未撰写）">译文</a>
</p><p>依赖于: <a href="/RFC3920" title="RFC3920">XMPP Core</a>, <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc1928">RFC 1928</a>, <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3174">RFC 3174</a>, XEP-0030
</p><p>上文: 无
</p><p>下文: 无
</p><p>简称: bytestreams
</p><p>名字空间的XML方案: &lt;<a rel="nofollow" class="external free" href="http://www.xmpp.org/schemas/bytestreams.xsd">http://www.xmpp.org/schemas/bytestreams.xsd</a>&gt;
</p><p>Wiki页: &lt;<a rel="nofollow" class="external free" href="http://wiki.jabber.org/index.php/SOCKS5">http://wiki.jabber.org/index.php/SOCKS5</a> Bytestreams (XEP-0065)&gt;
</p><p><b>作者信息</b>
</p><p><b>Dave Smith</b>
</p>
<dl><dd>Email: <a rel="nofollow" class="external text" href="mailto:dizzyd@jabber.org">dizzyd@jabber.org</a>
</dd></dl>
<dl><dd>JabberID: [xmpp:dizzyd@jabber.org dizzyd@jabber.org]
</dd></dl>
<p><b>Matthew Miller</b>
</p>
<dl><dd>Email: <a rel="nofollow" class="external text" href="mailto:linuxwolf@outer-planes.net">linuxwolf@outer-planes.net</a>
</dd></dl>
<dl><dd>JabberID: [xmpp:linuxwolf@outer-planes.net linuxwolf@outer-planes.net]
</dd></dl>
<p><b>Peter Saint-Andre</b>
</p>
<dl><dd>JID: [xmpp:stpeter@jabber.org stpeter@jabber.org
</dd></dl>
<dl><dd>URI: <a rel="nofollow" class="external autonumber" href="https://stpeter.im/">[1]</a>
</dd></dl>
<p><b>法律通告</b>
</p><p><b>版权</b>
</p><p>XMPP扩展协议的版权(1999-2008)归XMPP标准化基金会(XSF)所有.
</p><p><b>权限</b>
</p><p>特此授权,费用全免,对任何获得本协议副本的人,对使用本协议没有限制,包括不限制在软件程序中实现本协议,不限制在网络服务中布署本协议,不限制拷贝,修改,合并,发行,翻译,分发,转授,或销售本协议的副本,被允许使用本协议做了以上工作的人士,应接受前述的版权声明和本许可通知并且必须包含在所有的副本或实质性部分的规格中.除非单独的许可，被重新分发的修改工作，不得含有关于作者，标题，编号，或出版者的规格的误导性资料，并不得宣称修改工作是由本文的作者，作者所属的任何组织或项目，或XMPP标准基金会签注。
</p><p><b>免责声明</b>
</p><p>注意：本协议是提供的“原样”的基础，没有担保或任何形式的条件，明示或暗示，包括，但不限于任何担保或关于名称，非侵权性，适销性或适合作某一特定目的的条件.在任何情况XMPP标准基金会或作者不对此协议承担任何责任索赔，损害赔偿，或其他责任，无论是在一项行动的合同，侵权，或否则，所产生的，运出，或在他涉嫌与规格或执行，部署或以其它方式使用本协议. ##
</p><p><b>责任限制</b>
</p><p>在任何情况下以及没有任何法律规定时，不论是侵权行为（包括疏忽），合同或其它方面，除非根据适用法律的要求（如蓄意和有严重疏忽行为）或同意以书面形式，XMPP标准基金会或任何作者不对本协议承担所造成的损失，包括任何直接，间接，特殊，偶发，或相应的损害赔偿的任何字符利用所产生的或不能使用的规格（包括但不限于善意的损失，停止作业，电脑失灵或故障，或任何和所有其他商业损害或损失） ，即使XMPP标准基金会或作者已被告知此类损害的可能性。
</p><p><b>知识产权的一致性</b>
</p><p>XMPP扩展协议完全遵守XSF的知识产权策略(可在&lt;<a rel="nofollow" class="external free" href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt;找到副本或写信给XSF, P.O. Box 1641, Denver, CO 80201 USA). 
</p><p><b>讨论地点</b>
</p><p>首选的讨论的地方是标准讨论邮件列表: &lt;<a rel="nofollow" class="external free" href="http://mail.jabber.org/mailman/listinfo/standards">http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.
</p><p>勘误表发送到<a rel="nofollow" class="external text" href="mailto:editor@xmpp.org">editor@xmpp.org</a>
</p><p><b>XMPP 相关信息</b>
</p><p>XMPP 是由XSF(XMPP标准化基金会)按互联网标准程序贡献的,和 IETF的<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2026">RFC 2026</a>兼容的规范,包括 XMPP核心(<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3920">RFC 3920</a>)和 XMPP IM(<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3921">RFC 3921</a>).在本文中定义的任何协议,都是在互联网标准程序之外开发的,是扩展XMPP，而不是改变、发展和修改 XMPP本身。
</p><p><b>一致性术语</b>
</p><p>本文中以下关键词的含义如 <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc2119">RFC 2119</a> 所述: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>目录</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#.E7.BB.AA.E8.AE.BA"><span class="tocnumber">1</span> <span class="toctext">绪论</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#.E6.9C.AF.E8.AF.AD"><span class="tocnumber">2</span> <span class="toctext">术语</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#.E5.8F.99.E8.BF.B0"><span class="tocnumber">3</span> <span class="toctext">叙述</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#.E7.9B.B4.E6.8E.A5.E8.BF.9E.E6.8E.A5"><span class="tocnumber">3.1</span> <span class="toctext">直接连接</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#.E9.97.B4.E6.8E.A5.E8.BF.9E.E6.8E.A5"><span class="tocnumber">3.2</span> <span class="toctext">间接连接</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#.E5.8D.8F.E8.AE.AE"><span class="tocnumber">4</span> <span class="toctext">协议</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#.E5.88.9D.E5.A7.8B.E6.96.B9.E6.9F.A5.E8.AF.A2.E7.9B.AE.E6.A0.87.E6.96.B9.E6.98.AF.E5.90.A6.E6.94.AF.E6.8C.81.E5.AD.97.E8.8A.82.E6.B5.81"><span class="tocnumber">4.1</span> <span class="toctext">初始方查询目标方是否支持字节流</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#.E5.88.9D.E5.A7.8B.E6.96.B9.E6.9F.A5.E6.89.BE.E4.BB.A3.E7.90.86.E6.9C.8D.E5.8A.A1"><span class="tocnumber">4.2</span> <span class="toctext">初始方查找代理服务</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#.E5.88.9D.E5.A7.8B.E6.96.B9.E6.9F.A5.E8.AF.A2.E7.A1.AE.E5.AE.9A.E6.98.AF.E5.90.A6.E4.BB.A3.E7.90.86"><span class="tocnumber">4.3</span> <span class="toctext">初始方查询确定是否代理</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#.E5.88.9D.E5.A7.8B.E6.96.B9.E9.80.9A.E7.9F.A5.E7.9B.AE.E6.A0.87.E6.96.B9.E6.B5.81.E4.B8.BB.E6.9C.BA"><span class="tocnumber">4.4</span> <span class="toctext">初始方通知目标方流主机</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#.E7.9B.AE.E6.A0.87.E6.96.B9.E4.BD.BF.E7.94.A8.E6.B5.81.E4.B8.BB.E6.9C.BA.E5.BB.BA.E7.AB.8BSOCKS5.E8.BF.9E.E6.8E.A5"><span class="tocnumber">4.5</span> <span class="toctext">目标方使用流主机建立SOCKS5连接</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#.E7.9B.AE.E6.A0.87.E6.96.B9.E7.A1.AE.E8.AE.A4SOCKS5.E8.BF.9E.E6.8E.A5"><span class="tocnumber">4.6</span> <span class="toctext">目标方确认SOCKS5连接</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#.E5.88.9D.E5.A7.8B.E6.96.B9.E4.B8.8E.E6.B5.81.E4.B8.BB.E6.9C.BA.E5.BB.BA.E7.AB.8BSOCKS5.E8.BF.9E.E6.8E.A5"><span class="tocnumber">4.7</span> <span class="toctext">初始方与流主机建立SOCKS5连接</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#.E6.BF.80.E6.B4.BB.E5.AD.97.E8.8A.82.E6.B5.81"><span class="tocnumber">4.8</span> <span class="toctext">激活字节流</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15"><a href="#.E8.A7.84.E8.8C.83.E7.94.A8.E4.BE.8B"><span class="tocnumber">5</span> <span class="toctext">规范用例</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#.E5.9F.BA.E6.9C.AC.E6.B5.81.E7.A8.8B"><span class="tocnumber">5.1</span> <span class="toctext">基本流程</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#.E6.9B.BF.E4.BB.A3.E6.B5.81.E7.A8.8B"><span class="tocnumber">5.2</span> <span class="toctext">替代流程</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="#.E6.AD.A3.E5.BC.8F.E6.8F.8F.E8.BF.B0"><span class="tocnumber">6</span> <span class="toctext">正式描述</span></a>
<ul>
<li class="toclevel-2 tocsection-19"><a href="#.3Cquery.2F.3E.E5.85.83.E7.B4.A0"><span class="tocnumber">6.1</span> <span class="toctext">&lt;query/&gt;元素</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#.3Cstreamhost.2F.3E.E5.85.83.E7.B4.A0"><span class="tocnumber">6.2</span> <span class="toctext">&lt;streamhost/&gt;元素</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#.3Cstreamhost-used.2F.3E.E5.85.83.E7.B4.A0"><span class="tocnumber">6.3</span> <span class="toctext">&lt;streamhost-used/&gt;元素</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#.3Cactivate.2F.3E.E5.85.83.E7.B4.A0"><span class="tocnumber">6.4</span> <span class="toctext">&lt;activate/&gt;元素</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23"><a href="#.E5.8F.AF.E9.80.89.E7.9A.84UDP.E6.94.AF.E6.8C.81"><span class="tocnumber">7</span> <span class="toctext">可选的UDP支持</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="#.E6.9F.A5.E8.AF.A2UDP.E7.9A.84.E6.94.AF.E6.8C.81"><span class="tocnumber">7.1</span> <span class="toctext">查询UDP的支持</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#.E8.AF.B7.E6.B1.82UDP.E6.A8.A1.E5.BC.8F"><span class="tocnumber">7.2</span> <span class="toctext">请求UDP模式</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#UDP.E5.A4.84.E7.90.86"><span class="tocnumber">7.3</span> <span class="toctext">UDP处理</span></a>
<ul>
<li class="toclevel-3 tocsection-27"><a href="#.E5.BB.BA.E7.AB.8BUDP.E8.BF.9E.E6.8E.A5"><span class="tocnumber">7.3.1</span> <span class="toctext">建立UDP连接</span></a></li>
<li class="toclevel-3 tocsection-28"><a href="#.E5.88.9D.E5.A7.8B.E5.8C.96UDP.E9.A2.91.E9.81.93"><span class="tocnumber">7.3.2</span> <span class="toctext">初始化UDP频道</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-29"><a href="#.E4.BA.A4.E6.8D.A2UDP.E5.8C.85"><span class="tocnumber">7.4</span> <span class="toctext">交换UDP包</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-30"><a href="#.E5.AE.9E.E7.8E.B0.E6.B3.A8.E6.84.8F"><span class="tocnumber">8</span> <span class="toctext">实现注意</span></a>
<ul>
<li class="toclevel-2 tocsection-31"><a href="#.E6.B5.81.E4.B8.BB.E6.9C.BA.E8.A6.81.E6.B1.82"><span class="tocnumber">8.1</span> <span class="toctext">流主机要求</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#SOCKS5.E5.8F.82.E6.95.B0.E6.98.A0.E5.B0.84"><span class="tocnumber">8.2</span> <span class="toctext">SOCKS5参数映射</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-33"><a href="#.E5.AE.89.E5.85.A8.E4.BA.8B.E9.A1.B9"><span class="tocnumber">9</span> <span class="toctext">安全事项</span></a></li>
<li class="toclevel-1 tocsection-34"><a href="#IANA.E4.BA.8B.E9.A1.B9"><span class="tocnumber">10</span> <span class="toctext">IANA事项</span></a></li>
<li class="toclevel-1 tocsection-35"><a href="#XMPP.E6.B3.A8.E5.86.8C.E4.BA.8B.E9.A1.B9"><span class="tocnumber">11</span> <span class="toctext">XMPP注册事项</span></a>
<ul>
<li class="toclevel-2 tocsection-36"><a href="#.E5.8D.8F.E8.AE.AE.E5.91.BD.E5.90.8D.E7.A9.BA.E9.97.B4"><span class="tocnumber">11.1</span> <span class="toctext">协议命名空间</span></a></li>
<li class="toclevel-2 tocsection-37"><a href="#.E6.9C.8D.E5.8A.A1.E5.8F.91.E7.8E.B0.E7.89.B9.E6.80.A7"><span class="tocnumber">11.2</span> <span class="toctext">服务发现特性</span></a></li>
<li class="toclevel-2 tocsection-38"><a href="#.E6.9C.8D.E5.8A.A1.E5.8F.91.E7.8E.B0.E7.9B.AE.E5.BD.95.2F.E7.B1.BB.E5.9E.8B"><span class="tocnumber">11.3</span> <span class="toctext">服务发现目录/类型</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-39"><a href="#Schema"><span class="tocnumber">12</span> <span class="toctext">Schema</span></a></li>
<li class="toclevel-1 tocsection-40"><a href="#.E5.A4.87.E6.B3.A8"><span class="tocnumber">13</span> <span class="toctext">备注</span></a></li>
<li class="toclevel-1 tocsection-41"><a href="#.E4.BF.AE.E8.AE.A2.E5.8E.86.E5.8F.B2"><span class="tocnumber">14</span> <span class="toctext">修订历史</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id=".E7.BB.AA.E8.AE.BA">绪论</span></h2>
<p>XMPP是为在2个网络实体间发送相对较小的XML片段而设计的(参考XMPP Core)而不是为发送二进制字节设计的。然而，有时也需要发送给在XMPP网络上的已知另一个实体(比如，发送文件)。因此在Jabber社区里，如果有一个通用的有关在网络上任意2个实体间发送二进制流的协议的话，就会被广泛认可。字节流技术的主要应用就是文件传输，因为现在有一些不相容的协议(导致缺乏兼容性)。然而，其他应用程序却是有可能的，这就是为什么开发一个通用的协议而不是专用的协议比如文件传输，是如此重要。本文档定义的协议满足以下条件：
</p>
<ul><li> 字节流是建立标准TCP连接上的(<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc793">RFC 793</a>)或者UDP连接(<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc768">RFC 768</a>)，TCP的支持是被要求的(REQUIRED)，UDP的支持是可选的。
</li></ul>
<ul><li> 套接字可能是直连的(点对点)或者是间接的(通过字节流服务)。
</li></ul>
<ul><li> 在有可能的地方，使用标准的有线协议
</li></ul>
<p>特别的，本文档建议Jabber社区使用SOCKS5协议，该协议是IETF批准，也将支持IPv6的字节流技术。(注意：此处的建议是使用SOCKS5协议的子集，是为了特别适应Jabber字节流，现存的SOCKC5代理如果不修改的话，不能用于实现本协议)。
</p>
<h2> <span class="mw-headline" id=".E6.9C.AF.E8.AF.AD">术语</span></h2>
<p>以下术语在本文档中使用。
</p><p><b>表格 1: 实体的术语</b>
</p>
<table border="1" cellspacing="0">
<tr>
<th>术语 </th>
<th>描述
</th></tr>
<tr>
<td>初始方 </td>
<td> 想要和另一个实体建立字节流的Jabber实体。
</td></tr>
<tr>
<td>目标方 </td>
<td> 初始方想要建立字节流连接的实体
</td></tr>
<tr>
<td>代理 </td>
<td> 不在NAT或者防火墙之后的，并且在初始方和目标方充当中间人的Jabber实体
</td></tr>
<tr>
<td>流主机 </td>
<td> 目标方连接的系统，并且控制着字节流，可能是初始方或者是代理
</td></tr>
<tr>
<td>流ID </td>
<td> 该连接相关的唯一流ID；是由发送者为了跟踪目的而生成的并且，长度必须(MUST)小于128个字符。
</td></tr></table>
<h2> <span class="mw-headline" id=".E5.8F.99.E8.BF.B0">叙述</span></h2>
<p>有2个满足本协议的方案：
</p>
<ol><li> 直接连接(换言之，流主机是初始方)
</li><li> 间接连接(换言之，流主机是代理)
</li></ol>
<p>为了更容易理解，较好的方法就是分开描述。这些方案的完整描述在正式用例中。该叙述只描述了TCP连接；UDP连接将会在本文档的“可选的UDP连接”部分描述。
</p>
<h3> <span class="mw-headline" id=".E7.9B.B4.E6.8E.A5.E8.BF.9E.E6.8E.A5">直接连接</span></h3>
<p>直接连接是比较简单的方式。在此情况下，流主机好似初始方(流主机/发送方)，这意味着初始方知道流主机的网络地址并且知道何时激活流自己。建立流字节的过程如下：
</p>
<ol><li> 初始方发送IQ-set节点给指定了全JID的目标方以及流主机/初始方的网络和字节流的流ID(SID)。
</li><li> 目标方打开一个TCP套接字连接到指定的网络地址。
</li><li> 目标方通过SOCKS5请求连接，请求参数设置为下面定义的DST.ADDR 和 DST.PORT
</li><li> 流主机/初始方发送成功通过SOCKS5连接的应答。
</li><li> 目标方发送IQ-result节点给初始方，该'id'与初始方发送的IQ-set相同。
</li><li> 流主机/初始方激活字节流。
</li><li> 初始方和目标方就可以开始字节流。
</li></ol>
<h3> <span class="mw-headline" id=".E9.97.B4.E6.8E.A5.E8.BF.9E.E6.8E.A5">间接连接</span></h3>
<p>间接连接稍微复杂点。在此情景下，流主机不是初始方而是代理，这意味着初始方必须在发送IQ-set之前先查询到流主机的网络地址，并且必须和流主机协商，目标方也是如此，然后，在它可用之前先请求激活字节流。建立字节流的过程如下：
</p>
<ol><li> 可选的，初始方可以在带内查询的流主机网络地址。
</li><li> 初始方发送IQ-set给指定了全JID的目标方以及流主机的网络地址和流ID(SID)。
</li><li> 目标方打开选择的流主机的TCP套接字。
</li><li> 目标方通过SOCKS5建立连接，连接参数是在下面定义的DST.ADDR和DST.PORT
</li><li> 流主机发送一个通过SOCKS5连接目标方成功的应答。
</li><li> 目标方发送IQ-result给初始方，该'id'与初始方发送的IQ-set相同。
</li><li> 初始方打开连接到流主机的TCP套接字。
</li><li> 初始方通过SOCKS5建立连接，参数为以下定义的DST.ADDR和DST.PORT
</li><li> 流主机发送一个通过SOCKS5连接初始方成功的应答
</li><li> 初始方发送IQ-set到流主机请求流主机激活和流ID相关的字节流。
</li><li> 流主机激活字节流。(数据可以通过该代理在这2个SOCKS5连接之间传递。)
</li><li> 流主机发送IQ-result给初始方应答字节流已激活(或者是错误)。
</li><li> 初始方和目标方开始使用字节流。
</li></ol>
<h2> <span class="mw-headline" id=".E5.8D.8F.E8.AE.AE">协议</span></h2>
<h3> <span class="mw-headline" id=".E5.88.9D.E5.A7.8B.E6.96.B9.E6.9F.A5.E8.AF.A2.E7.9B.AE.E6.A0.87.E6.96.B9.E6.98.AF.E5.90.A6.E6.94.AF.E6.8C.81.E5.AD.97.E8.8A.82.E6.B5.81">初始方查询目标方是否支持字节流</span></h3>
<p>在初始化字节流之前，初始方可能想要知道目标方是否支持字节流协议。这可以按照如下方式，通过使用服务发现来确定：
</p><p><b>例子1. 初始方发送服务发现请求给目标方</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'get'</span> 
    <span class="re0">from</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">to</span>=<span class="st0">'target@example.org/bar'</span> 
    <span class="re0">id</span>=<span class="st0">'hello'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/disco#info'</span><span class="re2">/&gt;</span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>如果目标方支持字节流，它必须(MUST)在服务发现结果中答复。
</p><p><b>例子2. 目标方应答服务发现请求</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'result'</span> 
    <span class="re0">from</span>=<span class="st0">'target@example.org/bar'</span> 
    <span class="re0">to</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">id</span>=<span class="st0">'hello'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/disco#info'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;identity</span> 
        <span class="re0">category</span>=<span class="st0">'proxy'</span>
        <span class="re0">type</span>=<span class="st0">'bytestreams'</span>
        <span class="re0">name</span>=<span class="st0">'SOCKS5 Bytestreams Service'</span><span class="re2">/&gt;</span><span class="co3">
    ...
    </span><span class="re1">&lt;feature</span> <span class="re0">var</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span><span class="re2">/&gt;</span><span class="co3">
    ...
  </span><span class="re1">&lt;/query<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h3> <span class="mw-headline" id=".E5.88.9D.E5.A7.8B.E6.96.B9.E6.9F.A5.E6.89.BE.E4.BB.A3.E7.90.86.E6.9C.8D.E5.8A.A1">初始方查找代理服务</span></h3>
<p>在初始化字节流之前，初始方需要找到代理。可以使用如下的服务发现：
</p><p><b>例子3. 初始方发送服务发现请求给服务器</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'get'</span> 
    <span class="re0">from</span>=<span class="st0">'initiator@example.com/foo'</span>
    <span class="re0">to</span>=<span class="st0">'example.com'</span> 
    <span class="re0">id</span>=<span class="st0">'server_items'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/disco#items'</span><span class="re2">/&gt;</span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>服务器返回在disco列表中已知的所有JID
</p><p><b>例子4. 服务器应答服务发现请求</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'result'</span> 
    <span class="re0">from</span>=<span class="st0">'example.com'</span> 
    <span class="re0">to</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">id</span>=<span class="st0">'server_items'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/disco#items'</span><span class="re2">&gt;</span><span class="co3">
    ...
    </span><span class="re1">&lt;item</span> <span class="re0">jid</span>=<span class="st0">'streamhostproxy.example.net'</span> <span class="re0">name</span>=<span class="st0">'Bytestreams Proxy'</span><span class="re2">/&gt;</span><span class="co3">
    ...
  </span><span class="re1">&lt;/query<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>在这个例子中，字节流代理由第三方服务器"example.net"管理，该代理有自己的地址"streamhostproxy.example.net"
</p>
<h3> <span class="mw-headline" id=".E5.88.9D.E5.A7.8B.E6.96.B9.E6.9F.A5.E8.AF.A2.E7.A1.AE.E5.AE.9A.E6.98.AF.E5.90.A6.E4.BB.A3.E7.90.86">初始方查询确定是否代理</span></h3>
<p>对于disco#items结果的每一项，初始方必须查询并确定其是否是字节流代理。它可以采取服务发现，见如下方式：
</p><p><b>例子5. 初始方发送服务发现请求给代理</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'get'</span> 
    <span class="re0">from</span>=<span class="st0">'initiator@example.com/foo'</span>
    <span class="re0">to</span>=<span class="st0">'streamhostproxy.example.net'</span> 
    <span class="re0">id</span>=<span class="st0">'proxy_info'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/disco#info'</span><span class="re2">/&gt;</span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>代理会返回信息。初始方应该(SHOULD)检查每个identity看其是否包含目录为"proxy"和类型为"bytestreams"的identity。
</p><p><b>例子6. 服务器响应服务发现请求</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'result'</span> 
    <span class="re0">from</span>=<span class="st0">'streamhostproxy.example.net'</span> 
    <span class="re0">to</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">id</span>=<span class="st0">'proxy_info'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/disco#info'</span><span class="re2">&gt;</span><span class="co3">
    ...
    </span><span class="re1">&lt;identity</span> <span class="re0">category</span>=<span class="st0">'proxy'</span>
              <span class="re0">type</span>=<span class="st0">'bytestreams'</span>
              <span class="re0">name</span>=<span class="st0">'SOCKS5 Bytestreams Service'</span><span class="re2">/&gt;</span><span class="co3">
    ...
    </span><span class="re1">&lt;feature</span> <span class="re0">var</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span><span class="re2">/&gt;</span><span class="co3">
    ...
  </span><span class="re1">&lt;/query<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>===初始方查询流主机的网络地址
</p><p>如果流主机是代理，那么初始方必须先使用字节流请求所有网络地址(显而易见的，如果流主机是初始方就不用请求)。可以通过在字节流命名空间内发送IQ-set给代理方，如下：
</p><p><b>例子7. 初始方从代理方那里请求网络地址</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'get'</span> 
    <span class="re0">from</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">to</span>=<span class="st0">'streamhostproxy.example.net'</span> 
    <span class="re0">id</span>=<span class="st0">'discover'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span><span class="re2">/&gt;</span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>指定了网络地址的&lt;streamhost/&gt;元素必须(MUST)有如下属性：
</p>
<ul><li> jid = 用来在Jabber中交互的流主机的JID
</li></ul>
<p>另外，&lt;streamhost/&gt;必须(MUST)包含：
</p><p>要么是
</p>
<ul><li> host = 基于TCP，为了SOCKS5交互的主机名或者IP地址
</li></ul>
<ul><li> port = 基于TCP为了SOCKS5交互和主机或者IP地址相关的端口
</li></ul>
<p>或者是
</p>
<ul><li> zeroconf = 一个可连接的实体的zeroconf标识符，其服务标识和协议名应该(SHOULD)是"_jabber.bytestreams"。
</li></ul>
<p><b>例子8. 代理通知初始方网络地址</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'result'</span> 
    <span class="re0">from</span>=<span class="st0">'streamhostproxy.example.net'</span> 
    <span class="re0">to</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">id</span>=<span class="st0">'discover'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;streamhost</span> 
        <span class="re0">jid</span>=<span class="st0">'streamhostproxy.example.net'</span> 
        <span class="re0">host</span>=<span class="st0">'24.24.24.1'</span> 
        <span class="re0">zeroconf</span>=<span class="st0">'_jabber.bytestreams'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>如果初始方无论因为什么原因而不能初始流字节(比如，代理可能允许管理员禁止某些JID或者域名使用代理)，代理必须(MUST)返回&lt;forbidden/&gt;错误给初始方(关于错误信息的语法，参考“错误条件映射”)：
</p><p><b>例子9. 代理返回错误给初始方</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'error'</span> 
    <span class="re0">from</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">to</span>=<span class="st0">'streamhostproxy.example.net'</span> 
    <span class="re0">id</span>=<span class="st0">'discover'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;error</span> <span class="re0">code</span>=<span class="st0">'403'</span> <span class="re0">type</span>=<span class="st0">'auth'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;forbidden</span> <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>如果代理不能作为流主机，那么代理应该(SHOULD)返回一个&lt;not-allowed/&gt;错误给初始方：
</p><p><b>例子10. 代理返回错误给初始方</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'error'</span> 
    <span class="re0">from</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">to</span>=<span class="st0">'streamhostproxy.example.net'</span> 
    <span class="re0">id</span>=<span class="st0">'discover'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;error</span> <span class="re0">code</span>=<span class="st0">'405'</span> <span class="re0">type</span>=<span class="st0">'cancel'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;not-allowed</span> <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h3> <span class="mw-headline" id=".E5.88.9D.E5.A7.8B.E6.96.B9.E9.80.9A.E7.9F.A5.E7.9B.AE.E6.A0.87.E6.96.B9.E6.B5.81.E4.B8.BB.E6.9C.BA">初始方通知目标方流主机</span></h3>
<p>为了初始方和目标方之间建立字节流，初始方必须提供关于流主机的网络地址给目标方。这可以在带发送一个IQ-set，其中必须包含如下信息：
</p>
<ul><li> 至少一个流主机网络地址，目标方很有可能连接此地址
</li></ul>
<ul><li> 该连接的流ID
</li></ul>
<ul><li> 要使用的"mode", 一般是"tcp"，但是可选的，可以是"udp"(参考本文档的“可选的UDP支持”)
</li></ul>
<p>协议格式显示如下。
</p><p><b>例子11. 交互的初始化</b>(译者注：其中的流ID属性sid要与Stream Initation中初始化的时候用的sid相同)
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'set'</span> 
    <span class="re0">from</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">to</span>=<span class="st0">'target@example.org/bar'</span> 
    <span class="re0">id</span>=<span class="st0">'initiate'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span> 
         <span class="re0">sid</span>=<span class="st0">'mySID'</span> 
	 <span class="re0">mode</span>=<span class="st0">'tcp'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;streamhost</span> 
        <span class="re0">jid</span>=<span class="st0">'initiator@example.com/foo'</span> 
        <span class="re0">host</span>=<span class="st0">'192.168.4.1'</span> 
        <span class="re0">port</span>=<span class="st0">'5086'</span><span class="re2">/&gt;</span>
    <span class="re1">&lt;streamhost</span> 
        <span class="re0">jid</span>=<span class="st0">'streamhostproxy.example.net'</span> 
        <span class="re0">host</span>=<span class="st0">'24.24.24.1'</span> 
        <span class="re0">zeroconf</span>=<span class="st0">'_jabber.bytestreams'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>如果目标方不想接收字节流，它必须(MUST)返回&lt;not-acceptable/&gt;错误给初始方。
</p><p><b>例子12. 目标方拒绝字节流</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'error'</span> 
    <span class="re0">from</span>=<span class="st0">'target@example.org/bar'</span> 
    <span class="re0">to</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">id</span>=<span class="st0">'initiate'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;error</span> <span class="re0">code</span>=<span class="st0">'406'</span> <span class="re0">type</span>=<span class="st0">'auth'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;not-acceptable</span> <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h3> <span class="mw-headline" id=".E7.9B.AE.E6.A0.87.E6.96.B9.E4.BD.BF.E7.94.A8.E6.B5.81.E4.B8.BB.E6.9C.BA.E5.BB.BA.E7.AB.8BSOCKS5.E8.BF.9E.E6.8E.A5">目标方使用流主机建立SOCKS5连接</span></h3>
<p>如果目标方接受字节流，它必须(MUST)打开标准的TCP套接字连接到和初始方交互的流主机。如果初始方提供了多个流主机，那么目标方应该(SHOULD)试着按他们出现的顺序连接他们。
</p><p>如果目标方不能连接到任何流主机或者不想从这边连接，它必须(MUST)返回一个&lt;item-not-found/&gt;错误给初始者。
</p><p><b>例子13. 目标方不能连接任何流主机并且终止该事物</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'error'</span> 
    <span class="re0">from</span>=<span class="st0">'target@example.org/bar'</span> 
    <span class="re0">to</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">id</span>=<span class="st0">'initiate'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;error</span> <span class="re0">code</span>=<span class="st0">'404'</span> <span class="re0">type</span>=<span class="st0">'cancel'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;item-not-found</span> <span class="re0">xmlns</span>=<span class="st0">'urn:ietf:params:xml:ns:xmpp-stanzas'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;/error<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>如果目标方能够打开TCP套接字连接到一个流主机，那么它必须(MUST)使用<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc1928">RFC 1928</a>指定的SOCKS5协议建立与流主机的连接。根据RFC的SOCKS5，目标方为了使用代理可能(MAY)需要验证。然而，任何验证要求已经超出本文档的范畴。
</p><p>一旦目标方成功通过代理服务的验证(即使是匿名的),它为了继续协商应该(SHOULD)发送一个连接请求给适当的主机。使用如下规则：
</p>
<ol><li> 主机名必须(MUST)SHA1编码的(SID + Initiator JID + Target JID),就如在<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3174">RFC 3174</a>中定义的SHA1算法并且输出是十六进制编码的(不是二进制)。
</li><li> 端口必须(MUST)是0。
</li><li> 提供的JID必须(MUST)是用于IQ交换的JID，可以(MAY)是全JID(&lt;localpart@domain.tld/resource&gt;或者是&lt;domain.tld/resource&gt;)或者是春JID(&lt;localpart@domain.tld&gt;或者是&lt;domain.tld&gt;)。
</li><li> 在应用SHA1算法之前，JID必须(MUST)要做适当的字符准备(XMPP Core指定的)
</li></ol>
<p><b>例子14. 目标连接流主机</b>
</p><p>CMD = X'01'
</p><p>ATYP = X'03'
</p><p>DST.ADDR = SHA1 Hash of: (SID + Initiator JID + Target JID)
</p><p>DST.PORT = 0
</p><p><b>例子15. 流主机应答连接</b>
</p><p>STATUS = X'00'
</p><p>根据<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc1928">RFC 1928</a>第六部分应答客户端时，流主机应该(SHOULD)设置BND.ADDR和BND.PORT为客户端连接时请求中相应的值。
</p>
<h3> <span class="mw-headline" id=".E7.9B.AE.E6.A0.87.E6.96.B9.E7.A1.AE.E8.AE.A4SOCKS5.E8.BF.9E.E6.8E.A5">目标方确认SOCKS5连接</span></h3>
<p>在目标方通过流主机的验证后，它必须(MUST)发送一个IQ-result给初始方指出使用了哪个流主机。
</p><p><b>例子16. 目标方通知初始方关于连接的信息</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'result'</span> 
    <span class="re0">from</span>=<span class="st0">'target@example.org/bar'</span> 
    <span class="re0">to</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">id</span>=<span class="st0">'initiate'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;streamhost-used</span> <span class="re0">jid</span>=<span class="st0">'streamhostproxy.example.net'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>此时，初始方知道了目标方使用了哪个流主机。
</p>
<h3> <span class="mw-headline" id=".E5.88.9D.E5.A7.8B.E6.96.B9.E4.B8.8E.E6.B5.81.E4.B8.BB.E6.9C.BA.E5.BB.BA.E7.AB.8BSOCKS5.E8.BF.9E.E6.8E.A5">初始方与流主机建立SOCKS5连接</span></h3>
<p>如果被采用的流主机是代理，那么初始方必须(MUST)在请求激活字节流之前通过验证和建立与流主机的连接。初始方将会使用和目标方一样方式建立SOCKS5连接(使用相同的请求参数)，见如下示例。
</p><p><b>例子17. 初始方连接流主机</b>
</p><p>CMD = X'01'
</p><p>ATYP = X'03'
</p><p>DST.ADDR = SHA1 Hash of: (SID + Initiator JID + Target JID)
</p><p>DST.PORT = 0
</p><p><b>例子18. 流主机应答初始方的连接</b>
</p><p>STATUS = X'00'
</p>
<h3> <span class="mw-headline" id=".E6.BF.80.E6.B4.BB.E5.AD.97.E8.8A.82.E6.B5.81">激活字节流</span></h3>
<p>为了使用字节流，它必须(MUST)先激活流主机。如果流主机是初始方，那么很简单不需要任何带内协议。然而，如果流主机是代理，那么初始方必须(MUST)发送一个带内的请求给流主机。可以通过发送一个IQ-set节点给代理，该节点包含&lt;activate/&gt;元素，元素的内容是目标方的全JID。
</p><p><b>例子19. 初始方请求激活流</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'set'</span> 
    <span class="re0">from</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">to</span>=<span class="st0">'streamhostproxy.example.net'</span> 
    <span class="re0">id</span>=<span class="st0">'activate'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span> <span class="re0">sid</span>=<span class="st0">'mySID'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;activate<span class="re2">&gt;</span></span><span class="co3">target@example.org/bar</span><span class="re1">&lt;/activate<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>使用了数据包中的SID以及from地址这些信息后，代理才能根据SID + Initiator JID + Target JID的哈希值激活流。并提供一个合理的信任等级激活来自初始方的请求。
</p><p>如果代理能完成请求，它必须(MUST)使用IQ-result响应初始方
</p><p><b>例子20. 代理通知初始方有关激活的信息</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'result'</span> 
    <span class="re0">from</span>=<span class="st0">'streamhostproxy.example.net'</span> 
    <span class="re0">to</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">id</span>=<span class="st0">'activate'</span><span class="re2">/&gt;</span></pre></div></div>
<p>如果代理不能完成请求，它必须(MUST)返回一个IQ-error错误给初始方；错误条件定义如下：
</p>
<ul><li> &lt;item-not-found/&gt;错误，如果from地址不匹配初始方的全JID。
</li></ul>
<ul><li> &lt;not-allowed/&gt;错误，如果只有一方(初始方或者接收方，但是不是同时连接)连接到代理
</li></ul>
<ul><li> &lt;internal-server-error/&gt;错误，如果代理因为一些内部故障不能激活。
</li></ul>
<h2> <span class="mw-headline" id=".E8.A7.84.E8.8C.83.E7.94.A8.E4.BE.8B">规范用例</span></h2>
<p>这是以上提供的信息的规范表述。基础角色是初始方，目标是在初始方和目标方之间建立字节流。(注意："UCE"代表"Use Case Ends"(我们假定是成功的除非有其他指定的问题)，"P"代表"Primary Flow"，"A"代表"Alternate Flow")。
</p>
<h3> <span class="mw-headline" id=".E5.9F.BA.E6.9C.AC.E6.B5.81.E7.A8.8B">基本流程</span></h3>
<ol><li> 初始方想要与目标方建立一个字节流。
</li><li> 初始方发送一个IQ-set给目标方以指定一个流ID和一个或多个流主机的网络地址. [A1|XMPP文档列表/XMPP扩展/XEP-0065#A1]
</li><li> 目标方希望建立与初始方的字节流[A2|XMPP文档列表/XMPP扩展/XEP-0065#A2]
</li><li> 目标方请求与流主机的TCP连接[A3|XMPP文档列表/XMPP扩展/XEP-0065#A3]
</li><li> 目标方从流主机接收TCP应答[A4|XMPP文档列表/XMPP扩展/XEP-0065#A4]
</li><li> 目标方通过SOCKS5提交验证证书。
</li><li> 目标方通过SOCKS5接收流主机的验证应答。[A5|XMPP文档列表/XMPP扩展/XEP-0065#A5]
</li><li> 目标方通过SOCKS5请求与流主机连接
</li><li> 目标方通过SOCKS5从流主机处接收连接成功的应答.[A7|XMPP文档列表/XMPP扩展/XEP-0065#A7]
</li><li> 目标方发送IQ-result给初始方通知其连接流主机成功.[A6|XMPP文档列表/XMPP扩展/XEP-0065#A6]
</li><li> 用例结束(字节流已建立并且已准备好)
</li></ol>
<h3> <span class="mw-headline" id=".E6.9B.BF.E4.BB.A3.E6.B5.81.E7.A8.8B">替代流程</span></h3>
<p><b>A1.</b> 初始方不知道流主机的完全网络地址(换言之，就是代理的地址)
</p>
<ol><li> 初始方发送IQ-get到代理
</li><li> 初始方从代理接收包含网络地址的IQ-result. [A9|XMPP文档列表/XMPP扩展/XEP-0065#A9][A10|XMPP文档列表/XMPP扩展/XEP-0065#A10]
</li><li> 返回P2
</li></ol>
<p><b>A2.</b> 目标方不想与初始方建立字节流
</p>
<ol><li> 初始方从目标方接收&lt;not-acceptable/&gt;错误
</li><li> 因没有成功，终止用例
</li></ol>
<p><b>A3.</b> 在列表中没有流主机(目标方不能连接任何流主机)
</p>
<ol><li> 目标方返回&lt;remote-server-not-found/&gt;错误给初始方
</li><li> 因没有成功，终止用例
</li></ol>
<p><b>A4.</b> 目标方不能连接流主机
</p>
<ol><li> 返回P4
</li></ol>
<p><b>A5.</b> 目标方在流主机上验证失败 
</p>
<ol><li> 返回P4
</li></ol>
<p><b>A6.</b> 代理不愿作为流主机 
</p>
<ol><li> 初始方从代理接收到&lt;forbidden/&gt;错误
</li><li> 返回P2
</li></ol>
<p><b>A7.</b> 代理不能作为流主机 
</p>
<ol><li> 初始方从代理处接收到&lt;not-allowed/&gt;错误
</li><li> 返回P2
</li></ol>
<p><b>A8.</b> 目标方连接代理 
</p>
<ol><li> 初始方连接代理
</li><li> 目标方从流主机接收TCP应答。
</li><li> 初始方通过SOCKS5在代理服务上进行验证
</li><li> 初始方通过SOCKS5收到代理服务器的验证应答. [A10|XMPP文档列表/XMPP扩展/XEP-0065#A10]
</li><li> 初始方通过SOCKS5向代理请求连接
</li><li> 初始方通过SOCKS5接收连接成功的应答. [A11|XMPP文档列表/XMPP扩展/XEP-0065#A11]
</li><li> 初始方向代理发送IQ-set请求激活字节流
</li><li> 初始方从代理接收到IQ-result字节流激活应答. [A12|XMPP文档列表/XMPP扩展/XEP-0065#A12]
</li><li> 返回P9
</li></ol>
<p><b>A9.</b> 初始方不能连接代理 
</p>
<ol><li> 因没有成功，终止用例
</li></ol>
<p><b>A10.</b> 初始方没有通过代理的验证 
</p>
<ol><li> 因没有成功，终止用例
</li></ol>
<p><b>A11.</b>初始方不能连接到代理
</p>
<ol><li> 因没有成功，终止用例
</li></ol>
<p><b>A12.</b> 代理不能激活字节流 
</p>
<ol><li> 初始方从代理服务器接收到&lt;internal-server-error/&gt;错误
</li><li> 因没有成功，终止用例
</li></ol>
<h2> <span class="mw-headline" id=".E6.AD.A3.E5.BC.8F.E6.8F.8F.E8.BF.B0">正式描述</span></h2>
<h3> <span class="mw-headline" id=".3Cquery.2F.3E.E5.85.83.E7.B4.A0">&lt;query/&gt;元素</span></h3>
<p>&lt;query/&gt;元素是所有带内交互的容器。这个元素必须(MUST)是在"<a rel="nofollow" class="external free" href="http://jabber.org/protocol/bytestreams">http://jabber.org/protocol/bytestreams</a>"命名空间内。此元素有个表示流会话标识的属性，并包含了多个&lt;streamhost/&gt;元素，一个&lt;streamhost-used/&gt;元素或者一个&lt;activate/&gt;元素。
</p><p>"sid"指明了字节流会话的标识。该属性必须(MUST)出现。属性值可以是任何字符。
</p><p>"mode"属性指明了使用的模式，可以是'tcp'或者'udp'。如果没有属性，那么必须(MUST)假设默认值是"tcp"。
</p><p>&lt;streamhost/&gt;元素是负责传送网络连接的信息。在初始方发送给目标方的初始IQ-set中，至少有一个实例必须(MUST)出现。如果有多个实例出现，每个必须(MUST)是独立的主机/端口组成。
</p><p>&lt;streamhost-used/&gt;元素指明正在使用的带外传输的流主机。它必须(MUST)在从目标方发送给初始方的IQ-set中出现，并且必须(MUST)只有一个实例。
</p><p>&lt;activate/&gt;元素是用来请求激活双向的或者单向的字节流。它必须(MUST)在从初始方发送给流主机的的IQ-set中出现，而且是在从目标方接收到IQ-result之后，并且必须(MUST)只有一个实例。
</p>
<h3> <span class="mw-headline" id=".3Cstreamhost.2F.3E.E5.85.83.E7.B4.A0">&lt;streamhost/&gt;元素</span></h3>
<p>&lt;streamhost/&gt;元素包含了字节流连接的信息。该元素有表示流主机的JID属性，网络主机/地址，网路端口。该元素不能(MUST NOT)包含任何文本节点。
</p><p>"jid"属性指明了流主机的JID。该属性必须(MUST)出现，并且必须(MUST)在&lt;iq/&gt;中是合法的JID。
</p><p>"host"属性指明了要连接的主机。该属性必须(MUST)出现。该属性的值必须(MUST)要么是可分解的域名或者是“带点的十进制”IP地址(比如1.2.3.4)。
</p><p>"port"属性指定了要连接的端口。该属性可以(MAY)出现。该属性的值必须(MUST)是十进制的合法的数字。
</p><p>"zeroconf"属性指定了对于字节流可用的zero-configuratio服务。属性应该(SHOULD)出现。该属性值应该是(SHOULD) '_jabber.bytestreams'。
</p><p>当正在连接可用的主机时，初始方必须(MUST)要么包含主机和端口要么包含zeroconf信息。
</p>
<h3> <span class="mw-headline" id=".3Cstreamhost-used.2F.3E.E5.85.83.E7.B4.A0">&lt;streamhost-used/&gt;元素</span></h3>
<p>&lt;streamhost-used/&gt;元素指定了连接的流主机。该元素有个目的方连接的流主机的JID。该元素不能(MUST NOT)包含任何文本节点。
</p><p>"jid"属性指定了流主机的全JID。该属性必须(MUST)出现，并且必须(MUST)在&lt;iq/&gt;中是合法的JID。
</p>
<h3> <span class="mw-headline" id=".3Cactivate.2F.3E.E5.85.83.E7.B4.A0">&lt;activate/&gt;元素</span></h3>
<p>&lt;activate/&gt;元素是一个用来触发代理完成连接的标志。
</p>
<h2> <span class="mw-headline" id=".E5.8F.AF.E9.80.89.E7.9A.84UDP.E6.94.AF.E6.8C.81">可选的UDP支持</span></h2>
<p>对UDP连接的支持完全是可选的(OPTIONAL)。然而，支持UDP连接的具体实现必须(MUST)遵循本文档描述部分。
</p>
<h3> <span class="mw-headline" id=".E6.9F.A5.E8.AF.A2UDP.E7.9A.84.E6.94.AF.E6.8C.81">查询UDP的支持</span></h3>
<p>如果一个协议的实现支持UDP连接，它必须(MUST)在服务发现请求的响应中，发布'<a rel="nofollow" class="external free" href="http://jabber.org/protocol/bytestreams#udp'特性。">http://jabber.org/protocol/bytestreams#udp'特性。</a>
</p><p><b>例子21. 初始方发送服务发现请求给目标方</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'get'</span> 
    <span class="re0">from</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">to</span>=<span class="st0">'target@example.org/bar'</span> 
    <span class="re0">id</span>=<span class="st0">'hello2'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/disco#info'</span><span class="re2">/&gt;</span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<p>如果目标方支持UDP连接，它必须(MUST)在服务发现结果中响应这个结果。
</p><p><b>例子22. 目标方响应服务发现请求</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'result'</span> 
    <span class="re0">from</span>=<span class="st0">'target@example.org/bar'</span> 
    <span class="re0">to</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">id</span>=<span class="st0">'hello2'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/disco#info'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;identity</span> 
        <span class="re0">category</span>=<span class="st0">'proxy'</span>
        <span class="re0">type</span>=<span class="st0">'bytestreams'</span>
        <span class="re0">name</span>=<span class="st0">'SOCKS5 Bytestreams Service'</span><span class="re2">/&gt;</span><span class="co3">
    ...
    </span><span class="re1">&lt;feature</span> <span class="re0">var</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span><span class="re2">/&gt;</span>
    <span class="re1">&lt;feature</span> <span class="re0">var</span>=<span class="st0">'http://jabber.org/protocol/bytestreams#udp'</span><span class="re2">/&gt;</span><span class="co3">
    ...
  </span><span class="re1">&lt;/query<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h3> <span class="mw-headline" id=".E8.AF.B7.E6.B1.82UDP.E6.A8.A1.E5.BC.8F">请求UDP模式</span></h3>
<p>UDP连接要求将'mode'属性设置为"udp"而不是"tcp"。
</p><p><b>例子23. 初始化交互(UDP)</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;iq</span> <span class="re0">type</span>=<span class="st0">'set'</span> 
    <span class="re0">from</span>=<span class="st0">'initiator@example.com/foo'</span> 
    <span class="re0">to</span>=<span class="st0">'target@example.org/bar'</span> 
    <span class="re0">id</span>=<span class="st0">'initiate'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;query</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span> 
         <span class="re0">sid</span>=<span class="st0">'mySID'</span> 
	 <span class="re0">mode</span>=<span class="st0">'udp'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;streamhost</span> 
        <span class="re0">jid</span>=<span class="st0">'initiator@example.com/foo'</span> 
        <span class="re0">host</span>=<span class="st0">'192.168.4.1'</span> 
        <span class="re0">port</span>=<span class="st0">'5086'</span><span class="re2">/&gt;</span>
  <span class="re1">&lt;/query<span class="re2">&gt;</span></span>
<span class="re1">&lt;/iq<span class="re2">&gt;</span></span></pre></div></div>
<h3> <span class="mw-headline" id="UDP.E5.A4.84.E7.90.86">UDP处理</span></h3>
<p>UDP模式和TCP模式有一个主要的不同：不是简单的建立TCP连接，目标方或者初始方必须(MUST)(1)建立UDP连接(2)初始化UDP频道。特别地：
</p>
<ul><li> 如果接下来是直接连接，目标方必须(MUST)在通过&lt;streamhost-used/&gt;元素通知初始方建立连接成功之前，完成UDP连接和初始化UDP频道。
</li></ul>
<ul><li> 如果接下来是间接连接，(1)目标方必须(MUST)在通知初始方建立连接成功之前，完成UDP连接并且初始化UDP连接，并且(2)初始方必须(MUST)在请求激活流主机之前完成UDP连接和初始化UDP频道。
</li></ul>
<p>建立UDP连接和初始化UDP频道的过程如下。
</p>
<h4> <span class="mw-headline" id=".E5.BB.BA.E7.AB.8BUDP.E8.BF.9E.E6.8E.A5">建立UDP连接</span></h4>
<p>一旦目标方成功通过代理的验证(在以下的“目标方与流主机建立SOCKS5连接”)，它必须(MUST)发送UDP连接(ASSOCIATE)请求(而不是CONNECT)请求给以上算法指定的主机。
</p><p><b>例子24. 目标方向流主机请求UDP连接</b>
</p><p>CMD = X'03'
</p><p>ATYP = X'03'
</p><p>DST.ADDR = SHA1 Hash of: (SID + Initiator JID + Target JID)
</p><p>DST.PORT = 0
</p><p>流主机应答请求
</p><p><b>例子25.流主机应答请求</b>
</p><p>STATUS = X'00'
</p>
<h4> <span class="mw-headline" id=".E5.88.9D.E5.A7.8B.E5.8C.96UDP.E9.A2.91.E9.81.93">初始化UDP频道</span></h4>
<p>在连接了流主机之后，目标方(直接连接)或者目标方和初始方(间接连接)都必须(MUST)初始化UDP频道。为了初始话频道，每个发送实体必须(MUST)发送SOCKS5的UDP包给与初始化TCP连接相同的流主机的端口(根据在之前的例子中，主机是192.168.4.1，端口是5086)，DST.PORT设置为'1'，DATA包含发送实体的JID(也就是，要么是目标方的JID要么是初始方的JID)。
</p><p><b>例子26. 目标方或者初始方发送UDP初始包到流主机</b>
</p><p>ATYP = X'03'
</p><p>DST.ADDR = SHA1 Hash of: (SID + Initiator JID + Target JID)
</p><p>DST.PORT = 1
</p><p>DATA = Target or Initiator JID
</p><p>在流主机成功接收到了之后，流主机必须(MUST)响应一个消息通知来指明以及成功：
</p><p><b>例子27. 流主机通知目标方或者初始方，初始化UDP成功</b>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;message</span> 
    <span class="re0">from</span>=<span class="st0">'streamhostproxy.example.net'</span> 
    <span class="re0">to</span>=<span class="st0">'target@example.org/bar'</span> 
    <span class="re0">id</span>=<span class="st0">'initiate'</span><span class="re2">&gt;</span>
  <span class="re1">&lt;udpsuccess</span> <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span> <span class="re0">dstaddr</span>=<span class="st0">'Value of Hash'</span><span class="re2">/&gt;</span>
<span class="re1">&lt;/message<span class="re2">&gt;</span></span></pre></div></div>
<p>&lt;udpsuccess/&gt;元素表明流主机已经接收到UDP初始包。该元素有一个属性，此属性包含了在先前UDP包中使用的DST.ADDR。
</p><p>如果目标方不能初始化UDP频道，那么它必须(MUST)返回一个&lt;remote-server-not-found/&gt;错误给初始方
</p><p>注意：因为UDP是不可靠的，如果在短时间内(推荐(RECOMMENDED)5秒的重试时间)没有收到响应通知，目标方应该(SHOULD)重新发送UDP包。一旦响应了一个通知，流主机应该(SHOULD)忽略因接收到之后的UDP初始包而发生的冲突。
</p>
<h3> <span class="mw-headline" id=".E4.BA.A4.E6.8D.A2UDP.E5.8C.85">交换UDP包</span></h3>
<p>一旦UDP连接建立，就能和流主机交换UDP包。当任何一方发送了UDP包，它必须(MUST)包含4个字节的头信息(除了其他可能的头信息以外，比如SOCKS5)，头信息由发送源的实际端口以及目标源的实际端口组成，这2者都是16位的网络字节序列。这可以允许网络节点在一个会话中可以多路传输许多包到不同的目标。实际的应用程序的数据应该跟在这些头信息之后，那么发送的大小是“应用程序数据大小 + 4”。
</p><p>对于发送到流主机的所有包，DST.PORT设置位0，DATA包含了承载发送的数据
</p><p><b>例子28. 发送UDP到流主机</b>
</p><p>ATYP = X'03'
</p><p>DST.ADDR = SHA1 Hash of: (SID + Initiator JID + Target JID)
</p><p>DST.PORT = 0
</p><p>DATA = (payload)
</p><p>从流主机发送的UDP包没有任何SOCKS5头，所以承载发送的数据应该就按照本来的数据发送。
</p><p>应用程序界面对于SOCKS5的UDP字节流的处理必须(MUST)报告一个可用的UDP数据包的缓存空间，如果可以的话，该空间小于操作系统和SOCKS5层提供的实际空间，换言之，小于4个八位字节或更多。
</p>
<h2> <span class="mw-headline" id=".E5.AE.9E.E7.8E.B0.E6.B3.A8.E6.84.8F">实现注意</span></h2>
<h3> <span class="mw-headline" id=".E6.B5.81.E4.B8.BB.E6.9C.BA.E8.A6.81.E6.B1.82">流主机要求</span></h3>
<p>一个流主机必须(MUST)支持TCP连接。
</p><p>一个流主机应该(SHOULD):
</p>
<ol><li> 允许在初始方和接收方之间的双向的字节流
</li><li> 只允许一个目标方连接到字节流(换言之，不允许多播)。
</li><li> 跟踪基于流ID和初始方全JID的标识的会话，允许初始方建立多个同步会话。
</li><li> 忽略但是不要丢失任何在流激活之前发送的字节
</li><li> 如果支持zero-configuration的话，优先使用。
</li></ol>
<p>一个流主机可以(MAY)
</p>
<ol><li> 除了支持TCP连接以外来还可以支持UDP连接
</li><li> 如果需要的话，忽略DST.ADDR和DST.PORT参数。
</li></ol>
<h3> <span class="mw-headline" id="SOCKS5.E5.8F.82.E6.95.B0.E6.98.A0.E5.B0.84">SOCKS5参数映射</span></h3>
<p>为了便于使用SOCKS5，命令参数必须(MUST)映射到合适的值. 没有在下表中指定的参数的使用应该参考<a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc1928">RFC 1928</a>的定义
</p><p><b>表格 2: 请求的连接参数映射</b>
</p>
<table border="1" cellspacing="0">
<tr>
<th>参数 </th>
<th> 值
</th></tr>
<tr>
<td>CMD </td>
<td> 1 (CONNECT)
</td></tr>
<tr>
<td>ATYP </td>
<td> Hardcoded to 3 (DOMAINNAME) in this usage
</td></tr>
<tr>
<td>DST.ADDR </td>
<td> (SID + Initiator JID + Target JID)的SHA1哈希值
</td></tr>
<tr>
<td>DST.PORT </td>
<td> 0
</td></tr></table>
<p><b>表格 3: 请求中的UDP连接的参数映射</b>
</p>
<table border="1" cellspacing="0">
<tr>
<th>参数 </th>
<th> 值
</th></tr>
<tr>
<td>CMD </td>
<td> 3 (UDP ASSOCIATE)
</td></tr>
<tr>
<td>ATYP </td>
<td> Hardcoded to 3 (DOMAINNAME) in this usage
</td></tr>
<tr>
<td>DST.ADDR </td>
<td> (SID + Initiator JID + Target JID)的SHA1哈希值
</td></tr>
<tr>
<td>DST.PORT </td>
<td> 0
</td></tr></table>
<p><b>表格 4: 请求中的UDP包的参数映射</b>
</p>
<table border="1" cellspacing="0">
<tr>
<th>参数 </th>
<th> 值
</th></tr>
<tr>
<td>ATYP </td>
<td> Hardcoded to 3 (DOMAINNAME) in this usage
</td></tr>
<tr>
<td>DST.ADDR </td>
<td> SHA1哈希值: (SID + Initiator JID + Target JID)
</td></tr>
<tr>
<td>DST.PORT </td>
<td> 0 or 1, 分别代表负载或和初始化包
</td></tr></table>
<h2> <span class="mw-headline" id=".E5.AE.89.E5.85.A8.E4.BA.8B.E9.A1.B9">安全事项</span></h2>
<p>本协议没有包含安全加密SOCKS5的方法，如果需要安全连接，它必须(MUST)使用标准的协议通过字节流进行协商(一旦建立之后),比如SSL或者TLS。安全协商的方式已经超出了本文档的范畴。
</p>
<h2> <span class="mw-headline" id="IANA.E4.BA.8B.E9.A1.B9">IANA事项</span></h2>
<p>本文档不需要与Internet Assigned Numbers Authority (IANA)交互。
</p>
<h2> <span class="mw-headline" id="XMPP.E6.B3.A8.E5.86.8C.E4.BA.8B.E9.A1.B9">XMPP注册事项</span></h2>
<h3> <span class="mw-headline" id=".E5.8D.8F.E8.AE.AE.E5.91.BD.E5.90.8D.E7.A9.BA.E9.97.B4">协议命名空间</span></h3>
<p>在协议命名空间的注册项中包含了'<a rel="nofollow" class="external free" href="http://jabber.org/protocol/bytestreams'">http://jabber.org/protocol/bytestreams'</a>
</p>
<h3> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.8F.91.E7.8E.B0.E7.89.B9.E6.80.A7">服务发现特性</span></h3>
<p>在服务发现特征中的注册项中包含了'<a rel="nofollow" class="external free" href="http://jabber.org/protocol/bytestreams#udp'">http://jabber.org/protocol/bytestreams#udp'</a>
</p>
<h3> <span class="mw-headline" id=".E6.9C.8D.E5.8A.A1.E5.8F.91.E7.8E.B0.E7.9B.AE.E5.BD.95.2F.E7.B1.BB.E5.9E.8B">服务发现目录/类型</span></h3>
<p>在服务发现注册项中包含了"proxy"目录和"bytestreams"类型。注册项提交如下：
</p>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre>  <span class="re1">&lt;category<span class="re2">&gt;</span></span>
    <span class="re1">&lt;name<span class="re2">&gt;</span></span><span class="co3">proxy</span><span class="re1">&lt;/name<span class="re2">&gt;</span></span>
    <span class="re1">&lt;desc<span class="re2">&gt;</span></span><span class="co3">Proxy servers or services</span><span class="re1">&lt;/desc<span class="re2">&gt;</span></span>
    <span class="re1">&lt;type<span class="re2">&gt;</span></span>
      <span class="re1">&lt;name<span class="re2">&gt;</span></span><span class="co3">bytestreams</span><span class="re1">&lt;/name<span class="re2">&gt;</span></span>
      <span class="re1">&lt;desc<span class="re2">&gt;</span></span><span class="co3">A proxy for SOCKS5 bytestreams</span><span class="re1">&lt;/desc<span class="re2">&gt;</span></span>
      <span class="re1">&lt;doc<span class="re2">&gt;</span></span><span class="co3">XEP-0065</span><span class="re1">&lt;/doc<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/type<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/category<span class="re2">&gt;</span></span></pre></div></div>
<h2> <span class="mw-headline" id="Schema">Schema</span></h2>
<div dir="ltr" style="text-align: left;"><div class="source-xml" style="font-family: monospace;"><pre><span class="re1">&lt;?xml</span> <span class="re0">version</span>=<span class="st0">'1.0'</span> <span class="re0">encoding</span>=<span class="st0">'UTF-8'</span><span class="re2">?&gt;</span>
&#160;
<span class="re1">&lt;xs:schema</span>
    <span class="re0">xmlns:xs</span>=<span class="st0">'http://www.w3.org/2001/XMLSchema'</span>
    <span class="re0">targetNamespace</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span>
    <span class="re0">xmlns</span>=<span class="st0">'http://jabber.org/protocol/bytestreams'</span>
    <span class="re0">elementFormDefault</span>=<span class="st0">'qualified'</span><span class="re2">&gt;</span>
&#160;
  <span class="re1">&lt;xs:annotation<span class="re2">&gt;</span></span>
    <span class="re1">&lt;xs:documentation<span class="re2">&gt;</span></span><span class="co3">
      The protocol documented by this schema is defined in
      XEP-0065: http://www.xmpp.org/extensions/xep-0065.html
    </span><span class="re1">&lt;/xs:documentation<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/xs:annotation<span class="re2">&gt;</span></span>
&#160;
  <span class="re1">&lt;xs:element</span> <span class="re0">name</span>=<span class="st0">'query'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;xs:complexType<span class="re2">&gt;</span></span>
      <span class="re1">&lt;xs:choice<span class="re2">&gt;</span></span>
        <span class="re1">&lt;xs:element</span> <span class="re0">ref</span>=<span class="st0">'streamhost'</span> <span class="re0">minOccurs</span>=<span class="st0">'0'</span> <span class="re0">maxOccurs</span>=<span class="st0">'unbounded'</span><span class="re2">/&gt;</span>
        <span class="re1">&lt;xs:element</span> <span class="re0">ref</span>=<span class="st0">'streamhost-used'</span> <span class="re0">minOccurs</span>=<span class="st0">'0'</span><span class="re2">/&gt;</span>
        <span class="re1">&lt;xs:element</span> <span class="re0">name</span>=<span class="st0">'activate'</span> <span class="re0">type</span>=<span class="st0">'empty'</span> <span class="re0">minOccurs</span>=<span class="st0">'0'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;/xs:choice<span class="re2">&gt;</span></span>
      <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'sid'</span> <span class="re0">type</span>=<span class="st0">'xs:string'</span> <span class="re0">use</span>=<span class="st0">'optional'</span><span class="re2">/&gt;</span>
      <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'mode'</span> <span class="re0">use</span>=<span class="st0">'optional'</span> <span class="re0">default</span>=<span class="st0">'tcp'</span><span class="re2">&gt;</span>
        <span class="re1">&lt;xs:simpleType<span class="re2">&gt;</span></span>
          <span class="re1">&lt;xs:restriction</span> <span class="re0">base</span>=<span class="st0">'xs:NCName'</span><span class="re2">&gt;</span>
            <span class="re1">&lt;xs:enumeration</span> <span class="re0">value</span>=<span class="st0">'tcp'</span><span class="re2">/&gt;</span>
            <span class="re1">&lt;xs:enumeration</span> <span class="re0">value</span>=<span class="st0">'udp'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;/xs:restriction<span class="re2">&gt;</span></span>
        <span class="re1">&lt;/xs:simpleType<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/xs:attribute<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/xs:complexType<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/xs:element<span class="re2">&gt;</span></span>
&#160;
  <span class="re1">&lt;xs:element</span> <span class="re0">name</span>=<span class="st0">'streamhost'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;xs:complexType<span class="re2">&gt;</span></span>
      <span class="re1">&lt;xs:simpleContent<span class="re2">&gt;</span></span>
        <span class="re1">&lt;xs:extension</span> <span class="re0">base</span>=<span class="st0">'empty'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'jid'</span> <span class="re0">type</span>=<span class="st0">'xs:string'</span> <span class="re0">use</span>=<span class="st0">'required'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'host'</span> <span class="re0">type</span>=<span class="st0">'xs:string'</span> <span class="re0">use</span>=<span class="st0">'required'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'zeroconf'</span> <span class="re0">type</span>=<span class="st0">'xs:string'</span> <span class="re0">use</span>=<span class="st0">'optional'</span><span class="re2">/&gt;</span>
          <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'port'</span> <span class="re0">type</span>=<span class="st0">'xs:string'</span> <span class="re0">use</span>=<span class="st0">'optional'</span><span class="re2">/&gt;</span>
        <span class="re1">&lt;/xs:extension<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/xs:simpleContent<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/xs:complexType<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/xs:element<span class="re2">&gt;</span></span>
&#160;
  <span class="re1">&lt;xs:element</span> <span class="re0">name</span>=<span class="st0">'udpsuccess'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;xs:complexType<span class="re2">&gt;</span></span>
      <span class="re1">&lt;xs:simpleContent<span class="re2">&gt;</span></span>
        <span class="re1">&lt;xs:extension</span> <span class="re0">base</span>=<span class="st0">'empty'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'dstaddr'</span> <span class="re0">type</span>=<span class="st0">'xs:string'</span> <span class="re0">use</span>=<span class="st0">'required'</span><span class="re2">/&gt;</span>
        <span class="re1">&lt;/xs:extension<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/xs:simpleContent<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/xs:complexType<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/xs:element<span class="re2">&gt;</span></span>
&#160;
  <span class="re1">&lt;xs:element</span> <span class="re0">name</span>=<span class="st0">'streamhost-used'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;xs:complexType<span class="re2">&gt;</span></span>
      <span class="re1">&lt;xs:simpleContent<span class="re2">&gt;</span></span>
        <span class="re1">&lt;xs:extension</span> <span class="re0">base</span>=<span class="st0">'empty'</span><span class="re2">&gt;</span>
          <span class="re1">&lt;xs:attribute</span> <span class="re0">name</span>=<span class="st0">'jid'</span> <span class="re0">type</span>=<span class="st0">'xs:string'</span> <span class="re0">use</span>=<span class="st0">'required'</span><span class="re2">/&gt;</span>
        <span class="re1">&lt;/xs:extension<span class="re2">&gt;</span></span>
      <span class="re1">&lt;/xs:simpleContent<span class="re2">&gt;</span></span>
    <span class="re1">&lt;/xs:complexType<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/xs:element<span class="re2">&gt;</span></span>
&#160;
  <span class="re1">&lt;xs:simpleType</span> <span class="re0">name</span>=<span class="st0">'empty'</span><span class="re2">&gt;</span>
    <span class="re1">&lt;xs:restriction</span> <span class="re0">base</span>=<span class="st0">'xs:string'</span><span class="re2">&gt;</span>
      <span class="re1">&lt;xs:enumeration</span> <span class="re0">value</span>=<span class="st0">''</span><span class="re2">/&gt;</span>
    <span class="re1">&lt;/xs:restriction<span class="re2">&gt;</span></span>
  <span class="re1">&lt;/xs:simpleType<span class="re2">&gt;</span></span>
&#160;
<span class="re1">&lt;/xs:schema<span class="re2">&gt;</span></span></pre></div></div>
<h2> <span class="mw-headline" id=".E5.A4.87.E6.B3.A8">备注</span></h2>
<ol><li> <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3920">RFC 3920</a>: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a rel="nofollow" class="external free" href="http://tools.ietf.org/html/rfc3920">http://tools.ietf.org/html/rfc3920</a>&gt;.
</li><li> <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc793">RFC 793</a>: Transmission Control Protocol &lt;<a rel="nofollow" class="external free" href="http://tools.ietf.org/html/rfc0793">http://tools.ietf.org/html/rfc0793</a>&gt;.
</li><li> <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc768">RFC 768</a>: User Datagram Protocol &lt;<a rel="nofollow" class="external free" href="http://tools.ietf.org/html/rfc0768">http://tools.ietf.org/html/rfc0768</a>&gt;.
</li><li> XEP-0030: Service Discovery &lt;<a rel="nofollow" class="external free" href="http://www.xmpp.org/extensions/xep-0030.html">http://www.xmpp.org/extensions/xep-0030.html</a>&gt;.
</li><li> Zeroconf is a set of protocols that enable IP networking without the need for configuration. For further information, refer to &lt;<a rel="nofollow" class="external free" href="http://www.zeroconf.org/">http://www.zeroconf.org/</a>&gt;.
</li><li> XEP-0086: Error Condition Mappings &lt;<a rel="nofollow" class="external free" href="http://www.xmpp.org/extensions/xep-0086.html">http://www.xmpp.org/extensions/xep-0086.html</a>&gt;.
</li><li> <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc1928">RFC 1928</a>: SOCKS Protocol Version 5 &lt;<a rel="nofollow" class="external free" href="http://tools.ietf.org/html/rfc1928">http://tools.ietf.org/html/rfc1928</a>&gt;.
</li><li> <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3174">RFC 3174</a>: US Secure Hash Algorithm 1 (SHA1) &lt;<a rel="nofollow" class="external free" href="http://tools.ietf.org/html/rfc3174">http://tools.ietf.org/html/rfc3174</a>&gt;.
</li><li> <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3920">RFC 3920</a>: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a rel="nofollow" class="external free" href="http://tools.ietf.org/html/rfc3920">http://tools.ietf.org/html/rfc3920</a>&gt;.
</li><li> The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a rel="nofollow" class="external free" href="http://www.iana.org/">http://www.iana.org/</a>&gt;.
</li><li> The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a rel="nofollow" class="external free" href="http://www.xmpp.org/registrar/">http://www.xmpp.org/registrar/</a>&gt;.
</li></ol>
<h2> <span class="mw-headline" id=".E4.BF.AE.E8.AE.A2.E5.8E.86.E5.8F.B2">修订历史</span></h2>
<p>Version 1.7 (2007-05-21)
</p><p>Incorporated errata: specified format for SHA1 output; specified BND.ADDR and BND.PORT for SOCKS5 reply; removed extraneous SOCKS5 acknowledgement example from Section 4.9; clarified rules for creation of SOCKS5 connection request in Section 4.6; added examples to Section 4.8; specified that ATYP value is hardcoded to 3 in this usage.
</p><p>(psa) 
</p><p>Version 1.6 (2004-11-12)
</p><p>Added UDP support (OPTIONAL).
</p><p>(ds/psa) 
</p><p>Version 1.5 (2004-06-29)
</p><p>Added requirement to apply stringprep profiles before SHA1 hashing; added reference to <a class="external mw-magiclink-rfc" href="//tools.ietf.org/html/rfc3174">RFC 3174</a>.
</p><p>(psa) 
</p><p>Version 1.4 (2004-06-28)
</p><p>Cleaned up narratives to reflect current practices and removed unnecessary authentication references; fixed mismatch SOCKS5 parameter table values.
</p><p>(ds) 
</p><p>Version 1.3 (2003-09-24)
</p><p>Added disco#info &lt;identity/&gt; and corresponding XMPP Registrar submission; added XMPP error handling.
</p><p>(psa) 
</p><p>Version 1.2 (2003-07-15)
</p><p>Removed SIDs from the result queries, you should key off the IQ 'id' attribute instead. Added the disco exchange for finding available proxies.
</p><p>(rwe) 
</p><p>Version 1.1 (2003-07-09)
</p><p>Changed srvid to zeroconf; cleaned up use cases; updated the schema.
</p><p>(ds) 
</p><p>Version 1.0 (2003-04-21)
</p><p>Per a vote of the Jabber Council, advanced status to Draft.
</p><p>(psa) 
</p><p>Version 0.7 (2003-03-04)
</p><p>Clarified that this proposal uses an adaptation of the SOCKS5 protocol, not the full protocol; replaced DTD with schema; added security considerations.
</p><p>(psa) 
</p><p>Version 0.6 (2003-01-27)
</p><p>Added service discovery example; added 'srvid' attribute to streamhost element and required inclusion of either 'srvid' or 'port' attribute; improved the algorithms for generating SOCKS5 UNAME and PASSWD parameters; specified that the DST.ADDR and DST.PORT parameters may be ignored; removed references to connected/disconnected notification, bidirectional bytestreams, and multiple targets; updated implementation notes.
</p><p>(psa/ds) 
</p><p>Version 0.5 (2002-12-20)
</p><p>Specified option of "reversing the connection" (Target becomes Initiator); added more error cases; resurrected and cleaned up formal use case.
</p><p><br />
</p><p>(psa) 
</p><p>Version 0.4 (2002-12-19)
</p><p>Added section on connected/disconnected notifications sent from Proxy to Initiator; cleaned up several examples; specified more error conditions; clarified the formal descriptions; added implementation notes and future considerations.
</p><p>(psa, mm) 
</p><p>Version 0.3 (2002-12-17)
</p><p>Added lots of detail to the narrative and protocol.
</p><p>(psa) 
</p><p>Version 0.2 (2002-12-16)
</p><p>Added SOCKS info.
</p><p>(ds) 
</p><p>Version 0.1 (2002-12-13)
</p><p>Initial version.
</p><p>(ds) 
</p><p>结束
</p>
<!-- 
NewPP limit report
Preprocessor node count: 361/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mediawiki:pcache:idhash:9-0!*!0!!zh-cn!*!* and timestamp 20160222023622 -->
</div><div class="printfooter">
来自“<a href="http://wiki.jabbercn.org/index.php?title=XEP-0065&amp;oldid=10">http://wiki.jabbercn.org/index.php?title=XEP-0065&amp;oldid=10</a>”</div>
		<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks"><a href="/%E7%89%B9%E6%AE%8A:%E9%A1%B5%E9%9D%A2%E5%88%86%E7%B1%BB" title="特殊:页面分类">2个分类</a>: <ul><li><a href="/%E5%88%86%E7%B1%BB:XMPP%E6%89%A9%E5%B1%95" title="分类:XMPP扩展">XMPP扩展</a></li><li><a href="/%E5%88%86%E7%B1%BB:%E5%B7%B2%E7%BF%BB%E8%AF%91" title="分类:已翻译">已翻译</a></li></ul></div></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>查看</h5>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="/XEP-0065" title="查看内容页面 [c]" accesskey="c">页面</a></li>
				<li id="ca-talk" class="new"><a href="/index.php?title=%E8%AE%A8%E8%AE%BA:XEP-0065&amp;action=edit&amp;redlink=1" title="关于内容页面的讨论 [t]" accesskey="t">讨论</a></li>
				<li id="ca-viewsource"><a href="/index.php?title=XEP-0065&amp;action=edit" title="本页面已被保护。你可以查看其源代码。 [e]" accesskey="e">查看源代码</a></li>
				<li id="ca-history"><a href="/index.php?title=XEP-0065&amp;action=history" title="本页面的早前修订版本 [h]" accesskey="h">历史</a></li>
			</ul>
		</div>
	</div>

	<div class="portlet" id="p-personal">
		<h5>个人工具</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/index.php?title=%E7%89%B9%E6%AE%8A:%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95&amp;returnto=XEP-0065" title="我们希望您可以登入，但不强求 [o]" accesskey="o">登录/创建账户</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a title="访问首页" style="background-image: url(/skins/common/images/xmppcn.png);" href="/%E9%A6%96%E9%A1%B5"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>导航</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/%E9%A6%96%E9%A1%B5" title="访问首页 [z]" accesskey="z">首页</a></li>
				<li id="n-portal"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E7%A4%BE%E5%8C%BA%E4%B8%93%E9%A1%B5" title="关于本项目，你可以做什么，在哪里找到你需要的事物">社区专页</a></li>
				<li id="n-currentevents"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E6%96%B0%E9%97%BB%E5%8A%A8%E6%80%81" title="查看当前事件的背景信息">新闻动态</a></li>
				<li id="n-recentchanges"><a href="/%E7%89%B9%E6%AE%8A:%E6%9C%80%E8%BF%91%E6%9B%B4%E6%94%B9" title="本wiki的最近更改列表 [r]" accesskey="r">最近更改</a></li>
				<li id="n-randompage"><a href="/%E7%89%B9%E6%AE%8A:%E9%9A%8F%E6%9C%BA%E9%A1%B5%E9%9D%A2" title="随机进入一个页面 [x]" accesskey="x">随机页面</a></li>
				<li id="n-help"><a href="/%E5%B8%AE%E5%8A%A9:%E7%9B%AE%E5%BD%95" title="寻求帮助的地方">帮助</a></li>
			</ul>
		</div>
	</div>
	<div class="generated-sidebar portlet" id="p-XMPP.E8.B5.84.E6.BA.90">
		<h5>XMPP资源</h5>
		<div class='pBody'>
			<ul>
				<li id="n-XMPP.E5.85.AC.E5.85.B1.E6.9C.8D.E5.8A.A1"><a href="/XMPP%E5%85%AC%E5%85%B1%E6%9C%8D%E5%8A%A1">XMPP公共服务</a></li>
				<li id="n-XMPP.E5.AE.A2.E6.88.B7.E7.AB.AF.E8.BD.AF.E4.BB.B6"><a href="/XMPP%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6">XMPP客户端软件</a></li>
				<li id="n-XMPP.E6.9C.8D.E5.8A.A1.E5.99.A8.E8.BD.AF.E4.BB.B6"><a href="/XMPP%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AF%E4%BB%B6">XMPP服务器软件</a></li>
				<li id="n-.E5.8F.8B.E6.83.85.E9.93.BE.E6.8E.A5"><a href="/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5">友情链接</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">搜索</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/index.php" id="searchform">
				<input type='hidden' name="title" value="特殊:搜索"/>
				<input type="search" name="search" title="在Jabber/XMPP中文翻译计划中搜索 [f]" accesskey="f" id="searchInput" />
				<input type="submit" name="go" value="提交" title="如果相同的标题存在的话便直接前往该页面" id="searchGoButton" class="searchButton" />&#160;
				<input type="submit" name="fulltext" value="搜索" title="搜索含这些文字的页面" id="mw-searchButton" class="searchButton" />
			</form>
		</div>
	</div>




<script src="http://yacy.jabbercn.org:8090/yacy/ui/js/jquery-1.3.2.min.js" type="text/javascript"></script>
<script>
   $(document).ready(function() {
      yconf = {
         url : 'http://yacy.jabbercn.org:8090/',
         theme : 'smoothness',
         title : 'XMPP搜索大全',
         logo     : 'http://yacy.jabbercn.org:8090/env/grafics/50-xmpp_logo.jpg',
         link     : 'http://wiki.jabbercn.org',
         urlmaskfilter : '.*',
         width : 500,
         height : 500
      };
      $.getScript(yconf.url+'/yacy/ui/js/yacyui-portalsearch.js', function(){});
   });
</script>
        <div id="p-search" class="portlet">
<h5>站外搜索</h5>
<div id="yacylivesearch" class="pBody">
   <form id="ysearch" method="get" accept-charset="UTF-8" action="http://yacy.jabbercn.org:8090/yacysearch.html">
      <input name="search" id="yquery" type="text" size="8" maxlength="80" value=""/>
      <input type="hidden" name="verify" value="false" />
      <input type="hidden" name="maximumRecords" value="10" />
      <input type="hidden" name="resource" value="local" />
      <input type="hidden" name="urlmaskfilter" value=".*" />
      <input type="hidden" name="prefermaskfilter" value="" />
      <input type="hidden" name="former" value="" />
      <input type="hidden" name="display" value="2" />
      <input type="hidden" name="nav" value="all" />
      <input type="submit" name="Enter" value="搜索" class="searchButton" />
   </form>
</div>
</div>



	<div class="portlet" id="p-tb">
		<h5>工具箱</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/%E7%89%B9%E6%AE%8A:%E9%93%BE%E5%85%A5%E9%A1%B5%E9%9D%A2/XEP-0065" title="所有链入本页的wiki页面列表 [j]" accesskey="j">链入页面</a></li>
				<li id="t-recentchangeslinked"><a href="/%E7%89%B9%E6%AE%8A:%E9%93%BE%E5%87%BA%E6%9B%B4%E6%94%B9/XEP-0065" title="本页链入的页面的最近更改 [k]" accesskey="k">链出更改</a></li>
				<li id="t-specialpages"><a href="/%E7%89%B9%E6%AE%8A:%E7%89%B9%E6%AE%8A%E9%A1%B5%E9%9D%A2" title="所有特殊页面列表 [q]" accesskey="q">特殊页面</a></li>
				<li><a href="/index.php?title=XEP-0065&amp;printable=yes" rel="alternate">可打印版</a></li>
				<li id="t-permalink"><a href="/index.php?title=XEP-0065&amp;oldid=10" title="本页面该修订版本的永久链接">永久链接</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-copyrightico">
		<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Attribution-Noncommercial-Share Alike 3.0 Unported" width="88" height="31" /></a>
	</div>
	<div id="f-poweredbyico">
		<a href="http://www.mediawiki.org/"><img src="/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
	</div>
	<ul id="f-list">
		<li id="lastmod"> 本页面最后修订于2009年3月30日 (星期一) 16:48。</li>
		<li id="viewcount">此页面已被浏览过15,510次。</li>
		<li id="copyright">本站全部文字内容使用<a class="external" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Attribution-Noncommercial-Share Alike 3.0 Unported</a>授权。</li>
		<li id="privacy"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E9%9A%90%E7%A7%81%E6%9D%83%E6%94%BF%E7%AD%96" title="Jabber/XMPP中文翻译计划:隐私权政策">隐私权政策</a></li>
		<li id="about"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E5%85%B3%E4%BA%8E" title="Jabber/XMPP中文翻译计划:关于">关于Jabber/XMPP中文翻译计划</a></li>
		<li id="disclaimer"><a href="/Jabber/XMPP%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E8%AE%A1%E5%88%92:%E5%85%8D%E8%B4%A3%E5%A3%B0%E6%98%8E" title="Jabber/XMPP中文翻译计划:免责声明">免责声明</a></li>
	</ul>
</div>
</div>
<script>if(window.mw){
	mw.loader.load(["mediawiki.user", "mediawiki.util", "mediawiki.page.ready", "mediawiki.legacy.wikibits", "mediawiki.legacy.ajax", "mediawiki.legacy.mwsuggest"]);
}
</script>
<script>if(window.mw){
	mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"highlightbroken":1,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,
	"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"zh-cn","language":"zh-cn","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;mw.user.tokens.set({"editToken":"+\\","watchToken":false});;mw.loader.state({"user.options":"ready","user.tokens":"ready"});
	
	/* cache key: mediawiki:resourceloader:filter:minify-js:4:42c4e9caefe8ca663d220ee0c286ac74 */
}
</script><!-- Piwik -->
<script type="text/javascript">
/* <![CDATA[ */
var pkBaseURL = (("https:" == document.location.protocol) ? "https://rtp.rooyee.im/piwik/" : "http://rtp.rooyee.im/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 5);
piwikTracker.setDocumentTitle("XEP-0065");
piwikTracker.setIgnoreClasses("image");

piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
/* ]]> */
</script><noscript><p><img src="http://rtp.rooyee.im/piwik/piwik.php?idsite=5" style="border:0" alt=""/></p></noscript>
<!-- /Piwik --><!-- Served in 0.040 secs. --></body></html>